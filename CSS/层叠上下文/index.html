<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"mst123.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="转载于  张鑫旭  简短总结什么是层叠上下文 层叠上下文，英文称作”stacking context”. 是HTML中的一个三维的概念。简单来说就是一个容器，比普通元素高一个层级 如何产生一个层叠上下文 如何创建层叠上下文(MDN) 文档根元素（&lt;html&gt;）； position 值为 absolute（绝对定位）或 relative（相对定位）且 z-index 值不为 auto">
<meta property="og:type" content="article">
<meta property="og:title" content="层叠上下文-张鑫旭">
<meta property="og:url" content="https://mst123.github.io/css/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/index.html">
<meta property="og:site_name" content="博客">
<meta property="og:description" content="转载于  张鑫旭  简短总结什么是层叠上下文 层叠上下文，英文称作”stacking context”. 是HTML中的一个三维的概念。简单来说就是一个容器，比普通元素高一个层级 如何产生一个层叠上下文 如何创建层叠上下文(MDN) 文档根元素（&lt;html&gt;）； position 值为 absolute（绝对定位）或 relative（相对定位）且 z-index 值不为 auto">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/2016-01-09_211116.png">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/z-aris.png">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/point.gif">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/point.gif">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/2016-01-07_223349.png">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/ask.gif">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/2016-01-07_235108.png">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/2016-01-07_235830.jpg">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm1.jpg">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm2.jpg">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm1.jpg">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm2.jpg">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/2016-01-08_220622.jpg">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/think-2.gif">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm1.jpg">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/2016-01-08_235511.png">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm1.jpg">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/2016-01-08_235217.png">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm1.jpg">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm1.jpg">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm1.jpg">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm1.jpg">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm1.jpg">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm2.jpg">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm1.jpg">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm2.jpg">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm1.jpg">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm1.jpg">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/2016-01-09_211116.png">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm1.jpg">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm2.jpg">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/https:/image.zhangxinxu.com/image/study/s/s256/mm2.jpg">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/https:/image.zhangxinxu.com/image/study/s/s256/mm1.jpg">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/https:/image.zhangxinxu.com/image/study/s/s256/mm1.jpg">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/https:/image.zhangxinxu.com/image/study/s/s256/mm1.jpg">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/2018-01-09_004641.png">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/36.gif">
<meta property="og:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/2018-01-09_004654.png">
<meta property="article:published_time" content="2021-02-27T16:00:00.000Z">
<meta property="article:modified_time" content="2024-07-19T06:47:59.634Z">
<meta property="article:author" content="马农">
<meta property="article:tag" content="css">
<meta property="article:tag" content="层叠上下文">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://mst123.github.io/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/2016-01-09_211116.png">


<link rel="canonical" href="https://mst123.github.io/css/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://mst123.github.io/css/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/","path":"css/层叠上下文/","title":"层叠上下文-张鑫旭"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>层叠上下文-张鑫旭 | 博客</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">博客</p>
      <i class="logo-line"></i>
    </a>
      <img class="custom-logo-image" src="/images/gintama.jpg" alt="博客">
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E7%9F%AD%E6%80%BB%E7%BB%93"><span class="nav-number">1.</span> <span class="nav-text">简短总结</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="nav-number">1.1.</span> <span class="nav-text">什么是层叠上下文</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87-MDN"><span class="nav-number">1.2.</span> <span class="nav-text">如何创建层叠上下文(MDN)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87%E5%86%85%E9%83%A8%E5%85%83%E7%B4%A0%E7%9A%84%E9%A1%BA%E5%BA%8F"><span class="nav-number">1.3.</span> <span class="nav-text">层叠上下文内部元素的顺序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8D%E5%90%8C%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87%E7%9A%84%E5%B1%82%E5%8F%A0%E9%A1%BA%E5%BA%8F"><span class="nav-number">1.4.</span> <span class="nav-text">不同层叠上下文的层叠顺序</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8B%93%E5%B1%95%EF%BC%9A%E5%B1%82%E5%8F%A0%E5%9B%BE%E5%B1%82%E5%92%8C%E5%A4%8D%E5%90%88%E5%9B%BE%E5%B1%82%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB%E5%92%8C%E8%81%94%E7%B3%BB%E5%91%A2"><span class="nav-number">1.5.</span> <span class="nav-text">拓展：层叠图层和复合图层有什么区别和联系呢</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BA%86%E8%A7%A3%E5%B1%82"><span class="nav-number">1.5.1.</span> <span class="nav-text">了解层</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A5%E4%B8%8B%E6%98%AF%E8%BD%AC%E8%BD%BD%E5%8E%9F%E6%96%87"><span class="nav-number">2.</span> <span class="nav-text">以下是转载原文</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="nav-number">3.</span> <span class="nav-text">一、什么是层叠上下文</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E5%B1%82%E5%8F%A0%E6%B0%B4%E5%B9%B3"><span class="nav-number">4.</span> <span class="nav-text">二、什么是层叠水平</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E5%B1%82%E5%8F%A0%E9%A1%BA%E5%BA%8F"><span class="nav-number">5.</span> <span class="nav-text">三、什么是层叠顺序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E5%8A%A1%E5%BF%85%E7%89%A2%E8%AE%B0%E7%9A%84%E5%B1%82%E5%8F%A0%E5%87%86%E5%88%99"><span class="nav-number">6.</span> <span class="nav-text">四、务必牢记的层叠准则</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87%E7%9A%84%E7%89%B9%E6%80%A7"><span class="nav-number">7.</span> <span class="nav-text">五、层叠上下文的特性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%AD%E3%80%81%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87%E7%9A%84%E5%88%9B%E5%BB%BA"><span class="nav-number">8.</span> <span class="nav-text">六、层叠上下文的创建</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%83%E3%80%81%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87%E4%B8%8E%E5%B1%82%E5%8F%A0%E9%A1%BA%E5%BA%8F"><span class="nav-number">9.</span> <span class="nav-text">七、层叠上下文与层叠顺序</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%AB%E3%80%81%E7%BB%93%E6%9D%9F%E8%AF%AD"><span class="nav-number">10.</span> <span class="nav-text">八、结束语</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="马农"
      src="/images/luopo.gif">
  <p class="site-author-name" itemprop="name">马农</p>
  <div class="site-description" itemprop="description">学习记录</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">105</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">125</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://mst123.github.io/css/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luopo.gif">
      <meta itemprop="name" content="马农">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="博客">
      <meta itemprop="description" content="学习记录">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="层叠上下文-张鑫旭 | 博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          层叠上下文-张鑫旭
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-02-28 00:00:00" itemprop="dateCreated datePublished" datetime="2021-02-28T00:00:00+08:00">2021-02-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-07-19 14:47:59" itemprop="dateModified" datetime="2024-07-19T14:47:59+08:00">2024-07-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/css/" itemprop="url" rel="index"><span itemprop="name">css</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><blockquote>
<p>转载于  <a target="_blank" rel="noopener" href="https://www.zhangxinxu.com/wordpress/2016/01/understand-css-stacking-context-order-z-index/">张鑫旭</a></p>
</blockquote>
<h3 id="简短总结"><a href="#简短总结" class="headerlink" title="简短总结"></a>简短总结</h3><h4 id="什么是层叠上下文"><a href="#什么是层叠上下文" class="headerlink" title="什么是层叠上下文"></a>什么是层叠上下文</h4><p> 层叠上下文，英文称作”stacking context”. 是HTML中的一个三维的概念。简单来说就是一个容器，比普通元素高一个层级</p>
<p>如何产生一个层叠上下文</p>
<h4 id="如何创建层叠上下文-MDN"><a href="#如何创建层叠上下文-MDN" class="headerlink" title="如何创建层叠上下文(MDN)"></a>如何创建<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/CSS/Understanding_z_index/The_stacking_context?spm=taofed.bloginfo.blog.3.19585ac8FPDXDu">层叠上下文(MDN)</a></h4><ol>
<li>文档根元素（<code>&lt;html&gt;</code>）；</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/position"><code>position</code></a> 值为 <code>absolute</code>（绝对定位）或 <code>relative</code>（相对定位）且 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/z-index"><code>z-index</code></a> 值不为 <code>auto</code> 的元素；</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/position"><code>position</code></a> 值为 <code>fixed</code>（固定定位）或 <code>sticky</code>（粘滞定位）的元素（沾滞定位适配所有移动设备上的浏览器，但老的桌面浏览器不支持）；</li>
<li>flex (<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/flexbox"><code>flexbox</code></a>) 容器的子元素，且 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/z-index"><code>z-index</code></a> 值不为 <code>auto</code>；</li>
<li>grid (<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/grid"><code>grid</code></a>) 容器的子元素，且 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/z-index"><code>z-index</code></a> 值不为 <code>auto</code>；</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/opacity"><code>opacity</code></a> 属性值小于 <code>1</code> 的元素（参见 <a target="_blank" rel="noopener" href="http://www.w3.org/TR/css3-color/#transparency">the specification for opacity</a>）；</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/mix-blend-mode"><code>mix-blend-mode</code></a> 属性值不为 <code>normal</code> 的元素；</li>
<li>以下任意属性值不为<code>none</code>的元素：<ul>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/transform"><code>transform</code></a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/filter"><code>filter</code></a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/perspective"><code>perspective</code></a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/clip-path"><code>clip-path</code></a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/mask"><code>mask</code></a> &#x2F; <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/mask-image"><code>mask-image</code></a> &#x2F; <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/mask-border"><code>mask-border</code></a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/isolation"><code>isolation</code></a> 属性值为 <code>isolate</code> 的元素；</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/-webkit-overflow-scrolling"><code>-webkit-overflow-scrolling</code></a> 属性值为 <code>touch</code> 的元素；</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/will-change"><code>will-change</code></a> 值设定了任一属性而该属性在 non-initial 值时会创建层叠上下文的元素（参考<a target="_blank" rel="noopener" href="http://dev.opera.com/articles/css-will-change-property/">这篇文章</a>）；</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/contain"><code>contain</code></a> 属性值为 <code>layout</code>、<code>paint</code> 或包含它们其中之一的合成值（比如 <code>contain: strict</code>、<code>contain: content</code>）的元素。</li>
</ol>
<h4 id="层叠上下文内部元素的顺序"><a href="#层叠上下文内部元素的顺序" class="headerlink" title="层叠上下文内部元素的顺序"></a>层叠上下文内部元素的顺序</h4><p><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/2016-01-09_211116.png" alt="更完整的7阶层叠顺序图"></p>
<h4 id="不同层叠上下文的层叠顺序"><a href="#不同层叠上下文的层叠顺序" class="headerlink" title="不同层叠上下文的层叠顺序"></a>不同层叠上下文的层叠顺序</h4><ol>
<li>如果层叠上下文元素不依赖<code>z-index</code>数值，则其层叠顺序是<code>z-index:auto</code>可看成<code>z:index:0</code>级别；</li>
<li>如果层叠上下文元素依赖<code>z-index</code>数值，则其层叠顺序由<code>z-index</code>值决定。</li>
<li>后写的居上</li>
</ol>
<h4 id="拓展：层叠图层和复合图层有什么区别和联系呢"><a href="#拓展：层叠图层和复合图层有什么区别和联系呢" class="headerlink" title="拓展：层叠图层和复合图层有什么区别和联系呢"></a>拓展：层叠图层和复合图层有什么区别和联系呢</h4><h5 id="了解层"><a href="#了解层" class="headerlink" title="了解层"></a>了解层</h5><p>首先说明，这里讨论的是 WebKit，描述的是 Chrome 的实现细节，而并非是 web 平台的功能，因此这里介绍的内容不一定适用于其他浏览器。</p>
<ul>
<li>Chrome 拥有两套不同的渲染路径(rendering path)：硬件加速路径和旧软件路径(older software path)</li>
<li>Chrome 中有不同类型的层： RenderLayer(渲染层)和GraphicsLayer(图形层，也称复合图层)，只有 GraphicsLayer 是作为纹理(texture)上传给GPU的。</li>
</ul>
<p>浏览器中图层一般包含两大类：渲染图层（普通图层）以及复合图层</p>
<ul>
<li>渲染图层，是页面普通的<a target="_blank" rel="noopener" href="https://blog.csdn.net/wangfeijiu/article/details/106563074">文档流</a>。我们<strong>虽然可以通过绝对定位，相对定位，浮动定位脱离文档流</strong>，但它<strong>仍然属于默认渲染图层</strong>，共用同一个绘图上下文对象（GraphicsContext）。<ul>
<li>满足形成层叠上下文条件的 LayoutObject 一定会<strong>为其创建新的独立的渲染层</strong></li>
</ul>
</li>
<li>复合图层，又称图形层。它会单独分配系统资源，每个复合图层都有一个独立的<strong>GraphicsContext</strong>。（当然也会脱离普通文档流，这样一来，不管这个复合图层中怎么变化，也不会影响默认复合层里的回流重绘）</li>
</ul>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://fed.taobao.org/blog/taofed/do71ct/performance-composite/">淘宝的文章描述的很清楚</a></p>
</blockquote>
<hr>
<h3 id="以下是转载原文"><a href="#以下是转载原文" class="headerlink" title="以下是转载原文"></a>以下是转载原文</h3><p>在这个世界上，凡事都有个先后顺序，凡物都有个论资排辈。比方说食堂排队打饭，对吧，讲求先到先得，总不可能一拥而上。再比如说话语权，老婆的话永远是对的，领导的话永远是对的。</p>
<p>在CSS届，也是如此。只是，一般情况下，大家歌舞升平，看不出什么差异，即所谓的众生平等。但是，当发生冲突发生纠葛的时候，显然，是不可能做到完全等同的，先后顺序，身份差异就显现出来了。例如，杰克和罗斯，只能一人浮在木板上，此时，出现了冲突，结果大家都知道的。那对于CSS世界中的元素而言，所谓的“冲突”指什么呢，其中，很重要的一个层面就是“层叠显示冲突”。</p>
<p>默认情况下，网页内容是没有偏移角的垂直视觉呈现，当内容发生层叠的时候，一定会有一个前后的层叠顺序产生，有点类似于真实世界中论资排辈的感觉。</p>
<p>而要理解网页中元素是如何“论资排辈”的，就需要深入理解CSS中的层叠上下文和层叠顺序。</p>
<p>我们大家可能都熟悉CSS中的<code>z-index</code>属性，需要跟大家讲的是，<code>z-index</code>实际上只是CSS层叠上下文和层叠顺序中的一叶小舟。</p>
<h3 id="一、什么是层叠上下文"><a href="#一、什么是层叠上下文" class="headerlink" title="一、什么是层叠上下文"></a>一、什么是层叠上下文</h3><p>层叠上下文，英文称作”stacking context”. 是HTML中的一个三维的概念。如果一个元素含有层叠上下文，我们可以理解为这个元素在z轴上就“高人一等”。</p>
<p>这里出现了一个名词-<strong>z轴</strong>，指的是什么呢？</p>
<p>表示的是用户与屏幕的这条看不见的垂直线（参见下图示意-红线）：<br><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/z-aris.png" alt="网页中z轴示意"></p>
<p>层叠上下文是一个概念，跟「<a target="_blank" rel="noopener" href="http://www.zhangxinxu.com/wordpress/?p=4588">块状格式化上下文(BFC)</a>」类似。然而，概念这个东西是比较虚比较抽象的，要想轻松理解，我们需要将其具象化。</p>
<p>怎么个具象化法呢？</p>
<p>你可以<strong>把「层叠上下文」理解为当官</strong>：网页中有很多很多的元素，我们可以看成是真实世界的芸芸众生。真实世界里，我们大多数人是普通老百姓们，还有一部分人是做官的官员。OK，这里的“官员”就可以理解为网页中的层叠上下文元素。</p>
<p>换句话说，页面中的元素有了层叠上下文，就好比我们普通老百姓当了官，一旦当了官，相比普通老百姓而言，离皇帝更近了，对不对，就等同于网页中元素级别更高，离我们用户更近了。</p>
<p><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/point.gif" alt="你懂的"></p>
<h3 id="二、什么是层叠水平"><a href="#二、什么是层叠水平" class="headerlink" title="二、什么是层叠水平"></a>二、什么是层叠水平</h3><p>再来说说层叠水平。“层叠水平”英文称作”stacking level”，决定了同一个层叠上下文中元素在z轴上的显示顺序。level这个词很容易让我们联想到我们真正世界中的三六九等、论资排辈。真实世界中，每个人都是独立的个体，包括同卵双胞胎，有差异就有区分。例如，双胞胎虽然长得像Ctrl+C&#x2F;Ctrl+V得到的，但实际上，出生时间还是有先后顺序的，先出生的那个就大，大哥或大姐。网页中的元素也是如此，页面中的每个元素都是独立的个体，他们一定是会有一个类似的排名排序的情况存在。而这个排名排序、论资排辈就是我们这里所说的“层叠水平”。层叠上下文元素的层叠水平可以理解为官员的职级，1品2品，县长省长之类；对于普通元素，这个嘛……你自己随意理解。</p>
<p>于是，显而易见，所有的元素都有层叠水平，包括层叠上下文元素，层叠上下文元素的层叠水平可以理解为官员的职级，1品2品，县长省长之类。然后，对于普通元素的层叠水平，我们的探讨仅仅局限在当前层叠上下文元素中。为什么呢？因为否则没有意义。</p>
<p>这么理解吧~ 上面提过元素具有层叠上下文好比当官，大家都知道的，这当官的家里都有丫鬟啊保镖啊管家啊什么的。所谓打狗看主人，A官员家里的管家和B官员家里的管家做PK实际上是没有意义的，因为他们牛不牛逼完全由他们的主子决定的。一人得道鸡犬升天，你说这和珅家里的管家和七侠镇娄知县县令家里的管家有可比性吗？李总理的秘书是不是分分钟灭了你村支部书记的秘书（如果有）。</p>
<p>翻译成术语就是：普通元素的层叠水平优先由层叠上下文决定，因此，层叠水平的比较只有在当前层叠上下文元素中才有意义。</p>
<p><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/point.gif" alt="你懂的"></p>
<p>需要注意的是，诸位千万不要把层叠水平和CSS的z-index属性混为一谈。没错，某些情况下z-index确实可以影响层叠水平，但是，只限于定位元素以及flex盒子的孩子元素；而层叠水平所有的元素都存在。</p>
<h3 id="三、什么是层叠顺序"><a href="#三、什么是层叠顺序" class="headerlink" title="三、什么是层叠顺序"></a>三、什么是层叠顺序</h3><p>再来说说层叠顺序。“层叠顺序”英文称作”stacking order”. 表示元素发生层叠时候有着特定的垂直显示顺序，注意，这里跟上面两个不一样，上面的<strong>层叠上下文和层叠水平是概念</strong>，而这里的<strong>层叠顺序是规则</strong>。</p>
<p>在CSS2.1的年代，在CSS3还没有出现的时候（注意这里的前提），层叠顺序规则遵循下面这张图：<br><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/2016-01-07_223349.png" alt="层叠顺序"></p>
<p>有人可能有见过类似图，那个图是很多很多年前老外绘制的，英文内容。而是更关键的是国内估计没有同行进行过验证与实践，实际上很多关键信息缺失。上面是我自己手动重绘的中文版同时补充很多其他地方绝对没有的重要知识信息。如果想要无水印高清大图，点击这里购买(0.5元)。</p>
<p>缺失的关键信息包括：</p>
<ol>
<li>位于最低水平的<code>border</code>&#x2F;<code>background</code>指的是层叠上下文元素的边框和背景色。每一个层叠顺序规则适用于一个完整的层叠上下文元素。</li>
<li>原图没有呈现inline-block的层叠顺序，实际上，inline-block和inline水平元素是同等level级别。</li>
<li>z-index:0实际上和z-index:auto单纯从层叠水平上看，是可以看成是一样的。注意这里的措辞——“单纯从层叠水平上看”，实际上，两者在层叠上下文领域有着根本性的差异。</li>
</ol>
<p>下面我要向大家发问了，大家有没有想过，为什么内联元素的层叠顺序要比浮动元素和块状元素都高？<br><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/ask.gif" alt="疑问"></p>
<p>为什么呢？我明明感觉浮动元素和块状元素要更屌一点啊。</p>
<p>嘿嘿嘿，我就不卖关子了，直接看下图的标注说明：<br><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/2016-01-07_235108.png" alt="层叠顺序元素的标注说明"></p>
<p>诸如<code>border</code>&#x2F;<code>background</code>一般为装饰属性，而浮动和块状元素一般用作布局，而内联元素都是内容。网页中最重要的是什么？当然是内容了哈，对不对！</p>
<p>因此，一定要让内容的层叠顺序相当高，当发生层叠是很好，重要的文字啊图片内容可以优先暴露在屏幕上。例如，文字和浮动图片重叠的时候：</p>
<p><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/2016-01-07_235830.jpg" alt="浮动和文字重叠"></p>
<p>上面说的这些层叠顺序规则还是老时代的，如果把CSS3也牵扯进来，科科，事情就不一样了。</p>
<h3 id="四、务必牢记的层叠准则"><a href="#四、务必牢记的层叠准则" class="headerlink" title="四、务必牢记的层叠准则"></a>四、务必牢记的层叠准则</h3><p>下面这两个是层叠领域的黄金准则。当元素发生层叠的时候，其覆盖关系遵循下面2个准则：</p>
<ol>
<li><strong>谁大谁上：</strong>当具有明显的层叠水平标示的时候，如识别的z-indx值，在同一个层叠上下文领域，层叠水平值大的那一个覆盖小的那一个。通俗讲就是官大的压死官小的。</li>
<li><strong>后来居上：</strong>当元素的层叠水平一致、层叠顺序相同的时候，在DOM流中处于后面的元素会覆盖前面的元素。</li>
</ol>
<p>在CSS和HTML领域，只要元素发生了重叠，都离不开上面这两个黄金准则。因为后面会有多个实例说明，这里就到此为止。</p>
<h3 id="五、层叠上下文的特性"><a href="#五、层叠上下文的特性" class="headerlink" title="五、层叠上下文的特性"></a>五、层叠上下文的特性</h3><p>层叠上下文元素有如下特性：</p>
<ul>
<li>层叠上下文的层叠水平要比普通元素高（原因后面会说明）；</li>
<li>层叠上下文可以阻断元素的混合模式（见<a target="_blank" rel="noopener" href="http://www.zhangxinxu.com/wordpress/?p=5155">此文第二部分说明</a>）；</li>
<li>层叠上下文可以嵌套，内部层叠上下文及其所有子元素均受制于外部的层叠上下文。</li>
<li>每个层叠上下文和兄弟元素独立，也就是当进行层叠变化或渲染的时候，只需要考虑后代元素。</li>
<li>每个层叠上下文是自成体系的，当元素发生层叠的时候，整个元素被认为是在父层叠上下文的层叠顺序中。</li>
</ul>
<p>翻译成真实世界语言就是：</p>
<ul>
<li>当官的比老百姓更有机会面见圣上；</li>
<li>领导下去考察，会被当地官员阻隔只看到繁荣看不到真实民情；</li>
<li>一个家里，爸爸可以当官，孩子也是可以同时当官的。但是，孩子这个官要受爸爸控制。</li>
<li>自己当官，兄弟不占光。有什么福利或者变故只会影响自己的孩子们。</li>
<li>每个当官的都有属于自己的小团体，当家眷管家发生摩擦磕碰的时候（包括和其他官员的家眷管家），都是要优先看当官的也就是主子的脸色。</li>
</ul>
<h3 id="六、层叠上下文的创建"><a href="#六、层叠上下文的创建" class="headerlink" title="六、层叠上下文的创建"></a>六、层叠上下文的创建</h3><p>卖了这么多文字，到底层叠上下文是个什么鬼，倒是拿出来瞅瞅啊！</p>
<p>哈哈。如同块状格式化上下文，层叠上下文也基本上是有一些特定的CSS属性创建的。我将其总结为3个流派，也就是做官的3种途径：</p>
<ol>
<li><strong>皇亲国戚</strong>派：页面根元素天生具有层叠上下文，称之为“根层叠上下文”。</li>
<li><strong>科考入选</strong>派：z-index值为数值的定位元素的传统层叠上下文。</li>
<li><strong>其他当官途径</strong>：其他CSS3属性。</li>
</ol>
<p>&#x2F;&#x2F;zxx: 下面很多例子是实时CSS效果，建议您去<a target="_blank" rel="noopener" href="http://www.zhangxinxu.com/wordpress/?p=5115">原地址浏览</a>，以便预览更准确的效果。</p>
<p><strong>①. 根层叠上下文</strong><br>指的是页面根元素，也就是滚动条的默认的始作俑者<code>&lt;html&gt;</code>元素。这就是为什么，绝对定位元素在<code>left</code>&#x2F;<code>top</code>等值定位的时候，如果没有其他定位元素限制，会相对浏览器窗口定位的原因。</p>
<p><strong>②. 定位元素与传统层叠上下文</strong><br>对于包含有<code>position:relative</code>&#x2F;<code>position:absolute</code>的定位元素，以及FireFox&#x2F;IE浏览器（不包括Chrome等webkit内核浏览器）（目前，也就是2016年初是这样）下含有<code>position:fixed</code>声明的定位元素，当其<code>z-index</code>值不是<code>auto</code>的时候，会创建层叠上下文。</p>
<p>知道了这一点，有些现象就好理解了。</p>
<p>如下HTML代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;div style=&quot;position:relative; z-index:auto;&quot;&gt;</span><br><span class="line">    &lt;img src=&quot;mm1.jpg&quot; style=&quot;position:absolute; z-index:2;&quot;&gt;    &lt;-- 横妹子 --&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div style=&quot;position:relative; z-index:auto;&quot;&gt;</span><br><span class="line">    &lt;img src=&quot;mm2.jpg&quot; style=&quot;position:relative; z-index:1;&quot;&gt;    &lt;-- 竖妹子 --&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm1.jpg" alt="img"></p>
<p><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm2.jpg" alt="img"></p>
<p>大家会发现，竖着的妹子(mm2)被横着的妹子(mm1)给覆盖了。</p>
<p>下面，我们对父级简单调整下，把<code>z-index:auto</code>改成层叠水平一致的<code>z-index:0</code>, 代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;div style=&quot;position:relative; z-index:0;&quot;&gt;</span><br><span class="line">    &lt;img src=&quot;mm1.jpg&quot; style=&quot;position:absolute; z-index:2;&quot;&gt;    &lt;-- 横妹子 --&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div style=&quot;position:relative; z-index:0;&quot;&gt;</span><br><span class="line">    &lt;img src=&quot;mm2.jpg&quot; style=&quot;position:relative; z-index:1;&quot;&gt;    &lt;-- 竖妹子 --&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm1.jpg" alt="img"></p>
<p><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm2.jpg" alt="img"></p>
<p>大家会发现，尼玛反过来了，竖着的妹子(mm2)这回趴在了横着的妹子(mm1)身上。</p>
<p><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/2016-01-08_220622.jpg" alt="百合大法好"></p>
<p>为什么小小的改变会有想法的结果呢？<br><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/think-2.gif" alt="思考"></p>
<p>差别就在于，<code>z-index:0</code>所在的<code>&lt;div&gt;</code>元素是层叠上下文元素，而<code>z-index:auto</code>所在的<code>&lt;div&gt;</code>元素是一个普通的元素，于是，里面的两个<code>&lt;img&gt;</code>妹子的层叠比较就不受父级的影响，两者直接套用层叠黄金准则，这里，两者有着明显不一的<code>z-index</code>值，因此，遵循“<strong>谁大谁上</strong>”的准则，于是，<code>z-index</code>为<code>2</code>的那个横妹子，就趴在了<code>z-index</code>为<code>1</code>的竖妹子身上。</p>
<p>而<code>z-index</code>一旦变成数值，哪怕是<code>0</code>，都会创建一个层叠上下文。此时，层叠规则就发生了变化。层叠上下文的特性里面最后一条——自成体系。两个<code>&lt;img&gt;</code>妹子的层叠顺序比较变成了优先比较其父级层叠上下文元素的层叠顺序。这里，由于两者都是<code>z-index:0</code>，层叠顺序这一块两者一样大，此时，遵循层叠黄金准则的另外一个准则“<strong>后来居上</strong>”，根据在DOM流中的位置决定谁在上面，于是，位于后面的竖着的妹子就自然而然趴在了横着的妹子身上。对，没错，<code>&lt;img&gt;</code>元素上的<code>z-index</code>打酱油了！</p>
<p>有时候，我们在网页重构的时候，会发现，<code>z-index</code>嵌套错乱，看看是不是受父级的层叠上下文元素干扰了。然后，可能没多大意义了，但我还是提一下，算是祭奠下，IE6&#x2F;IE7浏览器有个bug，就是<code>z-index:auto</code>的定位元素也会创建层叠上下文。这就是为什么在过去，IE6&#x2F;IE7的<code>z-index</code>会搞死人的原因。</p>
<p>然后，我再提一下<code>position:fixed</code>, 在过去，<code>position:fixed</code>和<code>relative/absolute</code>在层叠上下文这一块是一路货色，都是需要<code>z-index</code>为数值才行。但是，不知道什么时候起，Chrome等webkit内核浏览器，<code>position:fixed</code>元素天然层叠上下文元素，无需<code>z-index</code>为数值。根据我的测试，目前，IE以及FireFox仍是老套路。</p>
<p><strong>③. CSS3与新时代的层叠上下文</strong><br>CSS3的出现除了带来了新属性，同时还对过去的很多规则发出了挑战。例如，CSS3 <code>transform</code><a target="_blank" rel="noopener" href="http://www.zhangxinxu.com/wordpress/2015/05/css3-transform-affect/">对overflow隐藏对position:fixed定位的影响</a>等。而这里，层叠上下文这一块的影响要更加广泛与显著。</p>
<p>如下：</p>
<ol>
<li><code>z-index</code>值不为<code>auto</code>的<code>flex</code>项(父元素<code>display:flex|inline-flex</code>).</li>
<li>元素的<code>opacity</code>值不是<code>1</code>.</li>
<li>元素的<code>transform</code>值不是<code>none</code>.</li>
<li>元素<code>mix-blend-mode</code>值不是<code>normal</code>.</li>
<li>元素的<code>filter</code>值不是<code>none</code>.</li>
<li>元素的<code>isolation</code>值是<code>isolate</code>.</li>
<li><code>will-change</code>指定的属性值为上面任意一个。</li>
<li>元素的<code>-webkit-overflow-scrolling</code>设为<code>touch</code>.</li>
</ol>
<p>基本上每一项都有很多槽点。</p>
<p><strong>1. display:flex|inline-flex与层叠上下文</strong><br>注意，这里的规则有些<del>负责</del>复杂。要满足两个条件才能形成层叠上下文：条件1是父级需要是<code>display:flex</code>或者<code>display:inline-flex</code>水平，条件2是子元素的z-index不是<code>auto</code>，必须是数值。此时，这个子元素为层叠上下文元素，没错，注意了，是子元素，不是flex父级元素。</p>
<p>眼见为实，给大家上例子吧。</p>
<p>如下HTML和CSS代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">     &lt;img src=&quot;mm1.jpg&quot;&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">.box &#123;  &#125;</span><br><span class="line">.box &gt; div &#123; background-color: blue; z-index: 1; &#125;    /* 此时该div是普通元素，z-index无效 */</span><br><span class="line">.box &gt; div &gt; img &#123; </span><br><span class="line">  position: relative; z-index: -1; right: -150px;     /* 注意这里是负值z-index */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<p><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm1.jpg" alt="img"></p>
<p>会发现，妹子跑到蓝色背景的下面了。为什么呢？层叠顺序图可以找到答案，如下：<br><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/2016-01-08_235511.png" alt="负值z-index的层叠顺序"></p>
<p>从上图可以看出负值z-index的层叠顺序在block水平元素的下面，而蓝色背景<code>div</code>元素是个普通元素，因此，妹子直接穿越过去，在蓝色背景后面的显示了。</p>
<p>现在，我们CSS微调下，增加<code>display:flex</code>, 如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">.box &#123; display: flex; &#125;</span><br><span class="line">.box &gt; div &#123; background-color: blue; z-index: 1; &#125;    /* 此时该div是层叠上下文元素，同时z-index生效 */</span><br><span class="line">.box &gt; div &gt; img &#123; </span><br><span class="line">  position: relative; z-index: -1; right: -150px;     /* 注意这里是负值z-index */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<p><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm1.jpg" alt="img"></p>
<p>会发现，妹子在蓝色背景上面显示了，为什么呢？层叠顺序图可以找到答案，如下：<br><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/2016-01-08_235217.png" alt="img"></p>
<p>从上图可以看出负值<code>z-index</code>的层叠顺序在当前第一个父层叠上下文元素的上面，而此时，那个<code>z-index</code>值为<code>1</code>的蓝色背景<code>&lt;div&gt;</code>的父元素的<code>display</code>值是<code>flex</code>，一下子升官发财变成层叠上下文元素了，于是，图片在蓝色背景上面显示了。这个现象也证实了层叠上下文元素是<code>flex</code>子元素，而不是<code>flex</code>容器元素。</p>
<p>另外，另外，这个例子也颠覆了我们传统的对<code>z-index</code>的理解。在CSS2.1时代，<code>z-index</code>属性必须和定位元素一起使用才有作用，但是，在CSS3的世界里，非定位元素也能和<code>z-index</code>愉快地搞基。</p>
<p><strong>2. opacity与层叠上下文</strong><br>我们直接看代码，原理和上面例子一样，就不解释了。</p>
<p>如下HTML和CSS代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;img src=&quot;mm1.jpg&quot;&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">.box &#123; background-color: blue;  &#125;</span><br><span class="line">.box &gt; img &#123; </span><br><span class="line">  position: relative; z-index: -1; right: -150px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<p><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm1.jpg" alt="img"></p>
<p>然后价格透明度，例如50%透明：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.box &#123; background-color: blue; opacity: 0.5;  &#125;</span><br><span class="line">.box &gt; img &#123; </span><br><span class="line">  position: relative; z-index: -1; right: -150px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<p><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm1.jpg" alt="img"></p>
<p>原因就是半透明元素具有层叠上下文，妹子图片的<code>z-index:-1</code>无法穿透，于是，在蓝色背景上面乖乖显示了。</p>
<p><strong>3. transform与层叠上下文</strong><br>应用了<a target="_blank" rel="noopener" href="http://www.zhangxinxu.com/wordpress/2010/11/css3-transitions-transforms-animation-introduction/">transform变换</a>的元素同样具有菜单上下文。</p>
<p>我们直接看应用后的结果，如下CSS代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.box &#123; background-color: blue; transform: rotate(15deg);  &#125;</span><br><span class="line">.box &gt; img &#123; </span><br><span class="line">  position: relative; z-index: -1; right: -150px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<p><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm1.jpg" alt="img"></p>
<p>妹子同样在蓝色背景之上。</p>
<p><strong>4. mix-blend-mode与层叠上下文</strong><br><code>mix-blend-mode</code>类似于PS中的混合模式，之前专门有文章介绍-“<a target="_blank" rel="noopener" href="http://www.zhangxinxu.com/wordpress/2015/05/css3-mix-blend-mode-background-blend-mode/">CSS3混合模式mix-blend-mode简介</a>”。</p>
<p>元素和白色背景混合。无论哪种模式，要么全白，要么没有任何变化。为了让大家有直观感受，因此，下面例子我特意加了个原创平铺背景：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.box &#123; background-color: blue; mix-blend-mode: darken;  &#125;</span><br><span class="line">.box &gt; img &#123; </span><br><span class="line">  position: relative; z-index: -1; right: -150px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<p><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm1.jpg" alt="img"></p>
<p>需要注意的是，目前，IE浏览器(包括IE14)还不支持<code>mix-blend-mode</code>，因此，要想看到妹子在背景色之上，请使用Chrome或FireFox。</p>
<p>同样的，因为蓝色背景元素升级成了层叠上下文，因此，<code>z-index:-1</code>无法穿透，在蓝色背景上显示了。</p>
<p><strong>5. filter与层叠上下文</strong><br>此处说的<code>filter</code>是CSS3中规范的滤镜，不是旧IE时代私有的那些，虽然目的类似。同样的，我之前有提过，例如<a target="_blank" rel="noopener" href="http://www.zhangxinxu.com/wordpress/2012/08/css-svg-filter-image-grayscale/">图片的灰度</a>或者<a target="_blank" rel="noopener" href="http://www.zhangxinxu.com/wordpress/2013/11/css-svg-image-blur/">图片的毛玻璃效果</a>等。</p>
<p>我们使用常见的模糊效果示意下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.box &#123; background-color: blue; filter: blur(5px);  &#125;</span><br><span class="line">.box &gt; img &#123; </span><br><span class="line">  position: relative; z-index: -1; right: -150px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<p><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm1.jpg" alt="img"></p>
<p>好吧，果然被你猜对了，妹子蓝色床上躺着，只是你眼镜摘了，看得有些不够真切罢了。</p>
<p><strong>6. isolation:isolate与层叠上下文</strong><br><code>isolation:isolate</code>这个声明是<code>mix-blend-mode</code>应运而生的。默认情况下，<code>mix-blend-mode</code>会混合z轴所有层叠在下面的元素，要是我们不希望某个层叠的元素参与混合怎么办呢？就是使用<code>isolation:isolate</code>。由于一言难尽，我特意为此写了篇文章：“<a target="_blank" rel="noopener" href="http://www.zhangxinxu.com/wordpress/?p=5155">理解CSS3 isolation: isolate的表现和作用</a>”，解释了其阻隔混合模式的原理，建议大家看下。</p>
<p>要演示这个效果，我需要重新设计下，如下HTML结构：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;img/mm2.jpg&quot; class=&quot;mode&quot;&gt;</span><br><span class="line">&lt;div class=&quot;box&quot;&gt;</span><br><span class="line">    &lt;img src=&quot;mm1.jpg&quot;&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>CSS主要代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.mode &#123;</span><br><span class="line">  /* 竖妹子绝对定位，同时混合模式 */</span><br><span class="line">  position: absolute; mix-blend-mode: darken;</span><br><span class="line">&#125;    </span><br><span class="line">.box &#123;</span><br><span class="line">  background: blue;         </span><br><span class="line">&#125;</span><br><span class="line">.box &gt; img &#123; </span><br><span class="line">  position: relative; z-index: -1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结构如下：</p>
<p><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm2.jpg" alt="img"></p>
<p><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm1.jpg" alt="img"></p>
<p>会发现，横妹子被混合模式了。此时，我们给妹子所在容器增加<code>isolation:isolate</code>，如下CSS所示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">.mode &#123;</span><br><span class="line">  /* 竖妹子绝对定位，同时混合模式 */</span><br><span class="line">  position: absolute; mix-blend-mode: darken;</span><br><span class="line">&#125;    </span><br><span class="line">.box &#123;</span><br><span class="line">  background: blue; isolation:isolate;         </span><br><span class="line">&#125;</span><br><span class="line">.box &gt; img &#123; </span><br><span class="line">  position: relative; z-index: -1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果为：</p>
<p><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm2.jpg" alt="img"></p>
<p><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm1.jpg" alt="img"></p>
<p>会发现横着的妹子跑到蓝色背景上面了。这表明确实创建了层叠上下文。</p>
<p><strong>7. will-change与层叠上下文</strong><br>关于<code>will-change</code>，如果有同学还不了解，可以参见我之前写的文章：“<a target="_blank" rel="noopener" href="http://www.zhangxinxu.com/wordpress/2015/11/css3-will-change-improve-paint/">使用CSS3 will-change提高页面滚动、动画等渲染性能</a>”。</p>
<p>都是类似的演示代码：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">.box &#123; background-color: blue; will-change: transform;  &#125;</span><br><span class="line">.box &gt; img &#123; </span><br><span class="line">  position: relative; z-index: -1; right: -150px;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<p><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm1.jpg" alt="img"></p>
<p>果然不出所料，妹子上了蓝色的背景。</p>
<h3 id="七、层叠上下文与层叠顺序"><a href="#七、层叠上下文与层叠顺序" class="headerlink" title="七、层叠上下文与层叠顺序"></a>七、层叠上下文与层叠顺序</h3><p>本文多次提到，一旦普通元素具有了层叠上下文，其层叠顺序就会变高。那它的层叠顺序究竟在哪个位置呢？</p>
<p>这里需要分两种情况讨论：</p>
<ol>
<li>如果层叠上下文元素不依赖<code>z-index</code>数值，则其层叠顺序是<code>z-index:auto</code>可看成<code>z:index:0</code>级别；</li>
<li>如果层叠上下文元素依赖<code>z-index</code>数值，则其层叠顺序由<code>z-index</code>值决定。</li>
</ol>
<p>于是乎，我们上面提供的层叠顺序表，实际上还是缺少其他重要信息。我又花功夫重新绘制了一个更完整的7阶层叠顺序图（同样的版权所有，商业请购买，可得无水印大图）：</p>
<p><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/2016-01-09_211116.png" alt="更完整的7阶层叠顺序图"></p>
<p>大家知道为什么定位元素会层叠在普通元素的上面吗？</p>
<p>其根本原因就在于，元素一旦成为定位元素，其<code>z-index</code>就会自动生效，此时其<code>z-index</code>就是默认的<code>auto</code>，也就是<code>0</code>级别，根据上面的层叠顺序表，就会覆盖<code>inline</code>或<code>block</code>或<code>float</code>元素。</p>
<p>而不支持z-index的层叠上下文元素天然<code>z-index:auto</code>级别，也就意味着，层叠上下文元素和定位元素是一个层叠顺序的，于是当他们发生层叠的时候，遵循的是“后来居上”准则。</p>
<p>我们可以速度测试下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;img src=&quot;mm1&quot; style=&quot;position:relative&quot;&gt;</span><br><span class="line">&lt;img src=&quot;mm2&quot; style=&quot;transform:scale(1);&quot;&gt;</span><br><span class="line">&lt;img src=&quot;mm2&quot; style=&quot;transform:scale(1);&quot;&gt;</span><br><span class="line">&lt;img src=&quot;mm1&quot; style=&quot;position:relative&quot;&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm1.jpg" alt="img"><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/mm2.jpg" alt="img"><br><img src="/md-images/css/assets/https:/image.zhangxinxu.com/image/study/s/s256/mm2.jpg" alt="img"><img src="/md-images/css/assets/https:/image.zhangxinxu.com/image/study/s/s256/mm1.jpg" alt="img"></p>
<p>会发现，两者样式一模一样，仅仅是在DOM流中的位置不一样，导致他们的层叠表现不一样，后面的妹子趴在了前面妹子的身上。这也说明了，层叠上下文元素的层叠顺序就是<code>z-index:auto</code>级别。</p>
<p><strong>z-index值与层叠顺序</strong><br>如果元素支持z-index值，则层叠顺序就要好理解些了，比较数值大小嘛，小盆友都会，本质上是应用的“谁大谁上”的准则。在以前，我们只需要关心定位元素的z-index就好，但是，在CSS3时代，flex子项也支持<code>z-index</code>，使得我们面对的情况比以前要负复杂。然而，好的是，规则都是一样的，对于<code>z-index</code>的使用和表现也是如此，套用上面的7阶层叠顺序表就可以了。</p>
<p>同样，举个简单例子，看下<code>z-index:-1</code>和<code>z-index:1</code>变化对层叠表现的影响，如下两段HTML：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;div style=&quot;display:flex; background:blue;&quot;&gt;</span><br><span class="line">   &lt;img src=&quot;mm1.jpg&quot; style=&quot;z-index:-1;&quot;&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;div style=&quot;display:flex; background:blue;&quot;&gt;</span><br><span class="line">   &lt;img src=&quot;mm1.jpg&quot; style=&quot;z-index:1;&quot;&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>最后，会发现，<code>z-index:-1</code>跑到了背景色小面，而<code>z-index:1</code>高高在上。</p>
<p><img src="/md-images/css/assets/https:/image.zhangxinxu.com/image/study/s/s256/mm1.jpg" alt="img"></p>
<p><img src="/md-images/css/assets/https:/image.zhangxinxu.com/image/study/s/s256/mm1.jpg" alt="img"></p>
<p><strong>一个与层叠上下文相关的有趣的显示现象</strong><br>在实际项目中，我们可能会渐进使用CSS3的fadeIn淡入animation效果增强体验，于是，我们可能就会遇到类似下面的现象：</p>
<p>您可以狠狠地点击这里：<a target="_blank" rel="noopener" href="http://www.zhangxinxu.com/study/201601/css3-fadein-animation-stacking-context.html">CSS3 fadeIn淡入animation动画有趣现象</a></p>
<p>有一个绝对定位的黑色半透明层覆盖在图片上，默认显示是这样的：</p>
<p><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/2018-01-09_004641.png" alt="文字在妹子上"></p>
<p>但是，一旦图片开始走fadeIn淡出的CSS3动画，文字跑到图片后面去了<img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/36.gif" alt="img">：</p>
<p><img src="/md-images/css/assets/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/2018-01-09_004654.png" alt="文字跑到图片后面"></p>
<p>为什么会这样？</p>
<p>实际上，学了本文的内容，就很简单了！fadeIn动画本质是<code>opacity</code>透明度的变化：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@keyframes fadeIn &#123;</span><br><span class="line">  0% &#123; </span><br><span class="line">    opacity: 0;</span><br><span class="line">  &#125;</span><br><span class="line">  100% &#123;</span><br><span class="line">    opacity: 1;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要知道，<code>opacity</code>的值不是<code>1</code>的时候，是具有层叠上下文的，层叠顺序是<code>z-index:auto</code>级别，跟没有<code>z-index</code>值的<code>absolute</code>绝对定位元素是平起平坐的。而本demo中的文字元素在图片元素的前面，于是，当CSS3动画只要不是最终一瞬间的<code>opacity: 1</code>，位于DOM流后面的图片就会遵循“后来居上”准则，覆盖文字。</p>
<p>这就是原因，于是，我们想要解决这个问题就很简单。</p>
<p>\1. 调整DOM流的先后顺序；<br>\2. 提高文字的层叠顺序，例如，设置<code>z-index:1</code>;</p>
<h3 id="八、结束语"><a href="#八、结束语" class="headerlink" title="八、结束语"></a>八、结束语</h3><p>只要元素发生层叠，要解释其表现，基本上就本文的这些内容了。</p>
<p>我发现很多重构小伙伴都有z-index滥用，或者使用不规范的问题。我觉得最主要的原因还是对理解层叠上下文以及层叠顺序这些概念都不了解。例如，只要使用了定位元素，尤其<code>absolute</code>绝对定位，都离不开设置一个<code>z-index</code>值；或者只要元素被其他元素覆盖了，例如变成定位元素或者增加<code>z-index</code>值升级。页面一复杂，必然搞得乱七八糟。</p>
<p>实际上，在我看来，觉得多数常见，z-index根本就没有出现的必要。知道了内联元素的层叠水平比块状元素高，于是，某条线你想覆盖上去的时候，需要设置<code>position:relative</code>吗？不需要，<code>inline-block</code>化就可以。因为IE6&#x2F;IE7 <code>position:relative</code>会创建层叠上下文，很烦的。</p>
<p>OK，本文已经够长了，就不多啰嗦了。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/css/" rel="tag"># css</a>
              <a href="/tags/%E5%B1%82%E5%8F%A0%E4%B8%8A%E4%B8%8B%E6%96%87/" rel="tag"># 层叠上下文</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/css/%E6%B7%98%E5%AE%9D%E5%9B%A2%E9%98%9F%E6%96%87%E7%AB%A0/" rel="prev" title="层叠上下文-淘宝团队">
                  <i class="fa fa-angle-left"></i> 层叠上下文-淘宝团队
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/%E9%9B%B6%E6%95%A3%E7%9F%A5%E8%AF%86/promise/" rel="next" title="Promise A+规范">
                  Promise A+规范 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">马农</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  





</body>
</html>
