<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"mst123.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="学习记录">
<meta property="og:type" content="website">
<meta property="og:title" content="博客">
<meta property="og:url" content="https://mst123.github.io/page/2/index.html">
<meta property="og:site_name" content="博客">
<meta property="og:description" content="学习记录">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="马农">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://mst123.github.io/page/2/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/2/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>博客</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">博客</h1>
      <i class="logo-line"></i>
    </a>
      <img class="custom-logo-image" src="/images/gintama.jpg" alt="博客">
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="马农"
      src="/images/luopo.gif">
  <p class="site-author-name" itemprop="name">马农</p>
  <div class="site-description" itemprop="description">学习记录</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">105</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">125</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mst123.github.io/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/git/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luopo.gif">
      <meta itemprop="name" content="马农">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="博客">
      <meta itemprop="description" content="学习记录">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/git/" class="post-title-link" itemprop="url">git 简记</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-07-13 14:55:07" itemprop="dateCreated datePublished" datetime="2024-07-13T14:55:07+08:00">2024-07-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">计算机基础</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>git 简记，主要参考掘金小册和以前的视频笔记，构建一个简单的记忆结构</p>
<h3 id="add"><a href="#add" class="headerlink" title="add"></a>add</h3><ul>
<li>提交所有被删除和修改的文件到数据暂存区</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add -u 或 git add –update</span><br></pre></td></tr></table></figure>

<ul>
<li>提交所有修改的和新建的到数据暂存区</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add .</span><br></pre></td></tr></table></figure>

<ul>
<li>提交所有被删除、被替换、被修改和新增的文件到数据暂存区</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git add -A 或 git add –all</span><br></pre></td></tr></table></figure>

<h3 id="撤销-add"><a href="#撤销-add" class="headerlink" title="撤销 add"></a>撤销 add</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 恢复暂存区的所有文件到工作区 =&gt; vscode git工具中的 取消暂存所有更改</span><br><span class="line"></span><br><span class="line">$ git reset HEAD 如果后面什么都不跟的话 就是上一次add 里面的全部撤销了 相当于git restore -staged .</span><br><span class="line"></span><br><span class="line">$ git reset HEAD XXX/XXX/XXX.php 就是对某个php文件进行撤销了</span><br></pre></td></tr></table></figure>

<h3 id="commit"><a href="#commit" class="headerlink" title="commit"></a>commit</h3><p>将暂存区内容添加到仓库中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit -m &#x27;一些描述&#x27;</span><br></pre></td></tr></table></figure>

<p>再简单提一些常见场景， 比如说<code>commit</code>完之后，突然发现一些错别字需要修改，又不想为改几个错别字而新开一个<code>commit</code>到<code>history</code>区，那么就可以使用下面这个命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git commit --amend</span><br></pre></td></tr></table></figure>

<p>这样就是把错别字的修改和之前的那个<code>commit</code>中的修改合并 并覆盖上次的commit。</p>
<h3 id="撤销-修改-commit"><a href="#撤销-修改-commit" class="headerlink" title="撤销 修改 commit"></a>撤销 修改 commit</h3><h4 id="丢弃上次的提交"><a href="#丢弃上次的提交" class="headerlink" title="丢弃上次的提交"></a>丢弃上次的提交</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset HEAD^</span><br></pre></td></tr></table></figure>

<blockquote>
<p>说明：在 Git 中，有两个「偏移符号」： <code>^</code> 和 <code>~</code>。</p>
<p><code>^</code> 的用法：在 <code>commit</code> 的后面加一个或多个 <code>^</code> 号，可以把 <code>commit</code> 往回偏移，偏移的数量是 <code>^</code> 的数量。例如：<code>master^</code> 表示 <code>master</code> 指向的 <code>commit</code> 之前的那个 <code>commit</code>； <code>HEAD^^</code> 表示 <code>HEAD</code> 所指向的 <code>commit</code> 往前数两个 <code>commit</code>。</p>
<p><code>~</code> 的用法：在 <code>commit</code> 的后面加上 <code>~</code> 号和一个数，可以把 <code>commit</code> 往回偏移，偏移的数量是 <code>~</code> 号后面的数。例如：<code>HEAD~5</code> 表示 <code>HEAD</code> 指向的 <code>commit</code>往前数 5 个 <code>commit</code>。</p>
</blockquote>
<h4 id="如果已经推送到远端"><a href="#如果已经推送到远端" class="headerlink" title="如果已经推送到远端"></a>如果已经推送到远端</h4><ul>
<li><p>1 确定无风险可以执行，git push -f 可以强制推送，无视冲突，远端的那次commit也会消失</p>
</li>
<li><p>2 安全操作，你希望撤销哪个 <code>commit</code>，就把它填在后面：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git revert HEAD^</span><br></pre></td></tr></table></figure>

<p>上面这行代码就会增加一条新的 <code>commit</code>，它的内容和倒数第二个 <code>commit</code> 是相反的，从而和<strong>倒数第二个</strong> <code>commit</code> 相互抵消，达到撤销的效果。</p>
<p>在 <code>revert</code> 完成之后，把新的 <code>commit</code> 再 <code>push</code> 上去，这个 <code>commit</code> 的内容就被撤销了。它和前面所介绍的撤销方式相比，最主要的区别是，这次改动只是被「反转」了，并没有在历史中消失掉，你的历史中会存在两条 <code>commit</code> ：一个原始 <code>commit</code> ，一个对它的反转 <code>commit</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git revert HEAD                撤销最新一次 commit</span><br><span class="line">git revert HEAD^               撤销前一次 commit</span><br><span class="line">git revert commitid            撤销指定commitid的commit </span><br></pre></td></tr></table></figure>
</li>
<li><p>撤销commit，同时将代码恢复到对应ID的版本(中间的commit都没了)</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard commitId</span><br></pre></td></tr></table></figure>

<p><strong>reset后接参数</strong></p>
<ol>
<li>–hard：重置位置的同时，清空工作目录和暂存区的所有内容；</li>
<li>–soft：重置位置的同时，保留工作目录和暂存区的内容，并把重置 HEAD 的位置所导致的新的文件差异放进暂存区。</li>
<li>–mixed（默认）：重置位置的同时，保留工作目录的内容，把暂存区和重置 HEAD 的位置所导致的新的文件差异都放入工作目录</li>
</ol>
<h4 id="修改前几次的commit-不新增commit"><a href="#修改前几次的commit-不新增commit" class="headerlink" title="修改前几次的commit 不新增commit"></a>修改前几次的commit 不新增commit</h4><p>详见#rebase章节</p>
<h3 id="restore-撤销"><a href="#restore-撤销" class="headerlink" title="restore 撤销"></a>restore 撤销</h3><p><code>git restore --staged &lt;file&gt;...</code>  撤销add，将暂存区的文件从暂存区撤出，但不会更改文件的内容</p>
<p><code>git restore &lt;file&gt;...</code> 撤销工作区改动，已经在暂存区的改动不会撤销 相当于 <code>git checkout -- filepathname</code></p>
<h3 id="push"><a href="#push" class="headerlink" title="push"></a>push</h3><p>实质上，<code>push</code> 做的事是：<strong>把当前 <code>branch</code> 的位置（即它指向哪个 <code>commit</code>）上传到远端仓库，并把它的路径上的 <code>commit</code>s 一并上传</strong>。</p>
<p>也就是每次仅上传当前的分支上的commit</p>
<h3 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h3><h4 id="创建一个分支"><a href="#创建一个分支" class="headerlink" title="创建一个分支"></a>创建一个分支</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch feature1</span><br></pre></td></tr></table></figure>

<h4 id="切换到分支"><a href="#切换到分支" class="headerlink" title="切换到分支"></a>切换到分支</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout feature1</span><br></pre></td></tr></table></figure>

<h4 id="切换分支-如果不存在就创建一个分支"><a href="#切换分支-如果不存在就创建一个分支" class="headerlink" title="切换分支 如果不存在就创建一个分支"></a>切换分支 如果不存在就创建一个分支</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout -b feature1</span><br></pre></td></tr></table></figure>

<h4 id="删除分支"><a href="#删除分支" class="headerlink" title="删除分支"></a>删除分支</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git branch -d feature1 </span><br></pre></td></tr></table></figure>

<blockquote>
<p>没有合并到master，删除会失败，强行删除 -d 换成 -D</p>
</blockquote>
<h4 id="查看分支"><a href="#查看分支" class="headerlink" title="查看分支"></a>查看分支</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git branch 列出本地已经存在的分支,并且当前分支会用*标记</span><br><span class="line">git branch -r 查看远程版本库的分支列表</span><br></pre></td></tr></table></figure>

<h4 id="推送远端不存在的分支"><a href="#推送远端不存在的分支" class="headerlink" title="推送远端不存在的分支"></a>推送远端不存在的分支</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git checkout feature1</span><br><span class="line">去推送本地分支到远程分支 的同时，为他俩建立联系(默认联系)</span><br><span class="line">以后push这个分支 默认就推送到现在建立联系的远端分支上</span><br><span class="line">git push --set-upstream origin feature1</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在 Git 中（2.0 及它之后的版本），默认情况下，你用不加参数的 <code>git push</code> 只能上传那些之前从远端 <code>clone</code> 下来或者 <code>pull</code> 下来的分支，而如果需要 <code>push</code> 你本地的自己创建的分支，则需要手动指定目标仓库和目标分支（并且目标分支的名称必须和本地分支完全相同），就像上面这样</p>
</blockquote>
<h4 id="删除远端仓库的分支"><a href="#删除远端仓库的分支" class="headerlink" title="删除远端仓库的分支"></a>删除远端仓库的分支</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin -d feature1 # 用 -d 参数把远程仓库的 branch 也删了</span><br></pre></td></tr></table></figure>

<h4 id="找回被删除的分支"><a href="#找回被删除的分支" class="headerlink" title="找回被删除的分支"></a>找回被删除的分支</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reflog 查看删除分支前的commit </span><br></pre></td></tr></table></figure>

<p><img src="/md-images/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/assets/git/15fe3de05468c613~tplv-t2oaga2asx-watermark.gif" alt="img"></p>
<p>从图中可以看出，<code>HEAD</code> 的最后一次移动行为是「从 <code>branch1</code> 移动到 <code>master</code>」。而在这之后，<code>branch1</code> 就被删除了。所以它之前的那个 <code>commit</code> 就是 <code>branch1</code> 被删除之前的位置了，也就是第二行的 <code>c08de9a</code>。</p>
<p>所以现在就可以切换回 <code>c08de9a</code>，然后重新创建 <code>branch1</code> ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git checkout c08de9a</span><br><span class="line">git checkout -b branch1</span><br></pre></td></tr></table></figure>

<p>这样，你刚删除的 <code>branch1</code> 就找回来了。</p>
<h4 id="合并分支"><a href="#合并分支" class="headerlink" title="合并分支"></a>合并分支</h4><p>两种方式，一种利用merge，一种利用rebase</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git merge branch</span><br></pre></td></tr></table></figure>

<p><img src="/md-images/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/assets/git/15fdea7b6646a1f3~tplv-t2oaga2asx-watermark.gif" alt="img"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1 git checkout branch1</span><br><span class="line">2 git rebase master</span><br><span class="line">在 rebase 之后，记得切回 master 再 merge 一下，把 master 移到最新的 commit</span><br><span class="line">3 git checkout master</span><br><span class="line">4 git merge(rebase) branch1</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="/md-images/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/assets/git/1600abd620a8e28c~tplv-t2oaga2asx-watermark.gif" alt="img"></p>
<p><img src="/md-images/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/assets/git/160149e054fe485c~tplv-t2oaga2asx-watermark.gif" alt="img"></p>
<h3 id="merge"><a href="#merge" class="headerlink" title="merge"></a>merge</h3><p><code>merge</code> 的意思是「合并」，它做的事也是合并：指定一个 <code>commit</code>，把它合并到当前的 <code>commit</code> 来。具体来讲，<code>merge</code> 做的事是：</p>
<p><strong>从目标 <code>commit</code> 和当前 <code>commit</code> （即 <code>HEAD</code> 所指向的 <code>commit</code>）分叉的位置起，把目标 <code>commit</code> 的路径上的所有 <code>commit</code> 的内容一并应用到当前 <code>commit</code>，然后自动生成一个新的 <code>commit</code>。</strong></p>
<p>merge有时产生冲突:</p>
<ul>
<li>git pull时，远端仓库包含本地没有的 <code>commit</code>，而且本地仓库也包含远端没有的 <code>commit</code> 时</li>
<li><code>git pull = git fetch + git merge origin/HEAD</code></li>
<li>git merge 合并的时候，文件有冲突</li>
</ul>
<p>处于冲突解决状态时</p>
<p> 解决冲突，解决完冲突后进行commit时，会自动填入commit信息”这是一个merge信息”</p>
<p> 放弃解决  <code>git merge --abort</code>输入这行代码，你的 Git 仓库就会回到 <code>merge</code> 前的状态</p>
<h3 id="checkout"><a href="#checkout" class="headerlink" title="checkout"></a>checkout</h3><p><code>git checkout</code>命令用于切换分支或恢复工作树文件，也可以指定HEAD指针的位置。</p>
<p><code>checkout</code> 本质上的功能其实是：签出（ checkout ）指定的 <code>commit</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">此命令用来放弃掉所有还没有加入到缓存区（就是 git add 命令）的修改</span><br><span class="line"></span><br><span class="line"># 放弃单个文件修改,注意不要忘记中间的&quot;--&quot;,不写就成了检出分支了!</span><br><span class="line">git checkout -- filepathname</span><br><span class="line"></span><br><span class="line"># 放弃所有的文件修改</span><br><span class="line">git checkout . </span><br><span class="line"></span><br><span class="line"># 切换到分支</span><br><span class="line"></span><br><span class="line">git checkout feature1</span><br><span class="line"></span><br><span class="line"># 切换分支 如果不存在就创建一个分支</span><br><span class="line"></span><br><span class="line">git checkout -b feature1</span><br><span class="line"></span><br><span class="line"># 签出commit</span><br></pre></td></tr></table></figure>

<p>首先介绍一下<code>HEAD</code>，可以把HEAD理解成一个指针，HEAD指针通常会指向一个分支，如下图所示</p>
<p><img src="/md-images/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/assets/git/image-20210427143641740.png" alt="e&#39;m"></p>
<p>HEAD–&gt;master–&gt;commitID，通常情况下，HEAD会一直跟随着当前分支，并指向分支，而分支则指向当前最新的commit</p>
<p>还有一种 <code>detached HEAD</code>的状态，使用<code>git checkout C3</code>即可以把HEAD指针指向C3</p>
<blockquote>
<p>经过我的测试，在工作区和暂存区有改动的情况下，无法进行git checkout commitID or branch</p>
<p><img src="/md-images/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/assets/git/image-20220106112249119.png" alt="image-20220106112249119"></p>
</blockquote>
<blockquote>
<p>还有一种相对引用的方式，<code>git checkout main^</code>*3 或者  <code>git checkout main^^^</code> 或者 <code>git checkout main~3</code>  或者使用 <code>git checkout HEAD^^^</code>,这几种方法都是向父节点方向移动</p>
</blockquote>
<p><img src="/md-images/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/assets/git/image-20210427144448741.png" alt="image-20210427144448741"></p>
<p>如果此时进行commit，git的返回信息会提示我们，You are in ‘detached HEAD’ state.（你现在处于’分离头’状态）。然后会从C3节点出现一个新的节点，HEAD会指向新的节点，可以简单的理解为匿名分支（图和上边不一样，仅做示意）</p>
<p><img src="/md-images/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/assets/git/image-20210427145825615.png" alt="image-20210427145825615"></p>
<p>我们现在有两个选择，如下：</p>
<ul>
<li><p>丢弃这个匿名分支</p>
<ul>
<li>直接检出到任何一个别的分支，就相当于放弃了这些提交</li>
</ul>
</li>
<li><p>保留这个匿名分支</p>
<ul>
<li>创建一个名为newtest的分支来保存这些提交<ul>
<li><code>git branch newtest c7</code>  这种方式HEAD并未指向newtest，而是指向了C7，仍是指针分离状态</li>
<li><code>git checkout -b newtest</code>   HEAD指向了newtest，newtest指向了C7</li>
</ul>
</li>
</ul>
</li>
<li><p>与现存分支合并，参考分支命令章节</p>
</li>
</ul>
<h3 id="stash"><a href="#stash" class="headerlink" title="stash"></a>stash</h3><ul>
<li><p><code>git stash save &quot;save message&quot;</code> : 执行存储时，添加备注，方便查找，只有git stash 也要可以的，但查找时不方便识别。</p>
<ul>
<li>增加参数可以存储没有追踪的文件  <code>git stash save -u</code>   &#x3D;&#x3D;&#x3D;  <code>git stash save --include-untracked</code></li>
</ul>
</li>
<li><p><code>git stash list</code> ：查看stash了哪些存储</p>
</li>
<li><p><code>git stash show</code> ：显示做了哪些改动，默认show第一个存储,如果要显示其他存贮，后面加stash@{$num}，比如第二个 git stash show stash@{1}</p>
</li>
<li><p><code>git stash show -p</code> : 显示第一个存储的改动，如果想显示其他存存储，命令：git stash show stash@{$num} -p ，比如第二个：git stash show stash@{1} -p</p>
</li>
<li><p><code>git stash apply</code>:应用某个存储,但不会把存储从存储列表中删除，默认使用第一个存储,即stash@{0}，如果要使用其他个，git s tash apply stash@{$num} ， 比如第二个：git stash apply stash@{1}</p>
</li>
<li><p><code>git stash pop</code> ：命令恢复之前缓存的工作目录，将缓存堆栈中的对应stash删除，并将对应修改应用到当前的工作目录下,默认为第一个stash,即stash@{0}，如果要应用并删除其他stash，命令：git stash pop stash@{$num} ，比如应用并删除第二个：git stash pop stash@{1}</p>
</li>
<li><p><code>git stash drop stash@&#123;$num&#125;</code>：丢弃stash@{$num}存储，从列表中删除这个存储192.168.1.110</p>
</li>
<li><p><code>git stash clear</code>：删除所有缓存的stash</p>
</li>
</ul>
<h3 id="查看改动"><a href="#查看改动" class="headerlink" title="查看改动"></a>查看改动</h3><p>查看改动内容的方法，大致有这么几类：</p>
<ol>
<li><p>查看历史中的多个commit：log</p>
<ol>
<li>查看详细改动： <code>git log -p</code></li>
<li>查看大致改动：<code>git log --stat</code></li>
</ol>
</li>
<li><p>查看具体某个commit：show</p>
<ol>
<li>要看最新 <code>commit</code> ，直接输入 <code>git show</code> ；要看指定 <code>commit</code> ，输入 <code>git show commit的引用或SHA-1</code></li>
<li>如果还要指定文件，在 <code>git show</code> 的最后加上文件名</li>
</ol>
</li>
<li><p>查看未提交的内容：diff</p>
<ol>
<li><p>查看暂存区和上一条 <code>commit</code> 的区别：<code>git diff --staged</code>（或 <code>--cached</code>）也就是暂存区 tobe commit的内容</p>
</li>
<li><p>查看工作目录和暂存区的区别：<code>git diff</code> 不加选项参数</p>
</li>
<li><p>查看工作目录和上一条 <code>commit</code> 的区别：<code>git diff HEAD(commitID)</code> <strong>vscode默认展示的</strong>,也就是工作目录和暂存区所有的改动相较于最新commit的区别</p>
</li>
</ol>
</li>
</ol>
<blockquote>
<p>git reflog  查看<strong>本地所有</strong>的所有操作记录（包括分支、包括已经被删除的 commit 记录和 reset 的操作）,适合找回</p>
</blockquote>
<h3 id="rebase"><a href="#rebase" class="headerlink" title="rebase"></a>rebase</h3><p>git rebase 可以理解为嫁接、编辑（包括删除）commit链条，可以完成很多功能，包括但不限于合并分支、编辑任意数量commit节点、删除任意数量的commit节点、插入任意数量的节点</p>
<h4 id="git-rebase-commitID-branch"><a href="#git-rebase-commitID-branch" class="headerlink" title="git rebase commitID || branch"></a>git rebase commitID || branch</h4><blockquote>
<p>没有commit分叉点的话，除了快速移动外应该没有作用</p>
</blockquote>
<p>见合并分支一节，如果是commitID的话，效果如下图所示</p>
<p><img src="/md-images/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/assets/git/15fe24400508e3c8~tplv-t2oaga2asx-watermark.gif" alt="img"></p>
<p>如果在这里执行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rebase 第3个commit</span><br></pre></td></tr></table></figure>

<p>那么 Git 会自动选取 <code>3</code> 和 <code>5</code> 的历史交叉点 <code>2</code> 作为 <code>rebase</code> 的起点，依次将 <code>4</code> 和 <code>5</code> 重新提交到 <code>3</code> 的路径上去。</p>
<h4 id="git-rebase-i"><a href="#git-rebase-i" class="headerlink" title="git rebase -i"></a>git rebase -i</h4><p><code>git rebase -i HEAD^^</code></p>
<p>可以编辑（ 倒数第三个commit, HEAD ] 之间的commit ，按下 i 进行编辑模式，操作命令写的很清楚，一般会用到edit和drop</p>
<p>如果使用了edit，会是HEAD进入游离状态，并指向edit对应的commit</p>
<p>这个时候可以进行各种操作，比如修改工作区并新增一个commit或者直接使用 <code>git commit -amend</code> 来修改这条commit message</p>
<p>操作完成后 使用 <code>git rebase --continue</code> 结束回归正常</p>
<p>也可以放弃 <code>rebase</code> <code>git rebase --abort</code></p>
<blockquote>
<p>建议熟练后在进行骚操作</p>
</blockquote>
<p><img src="/md-images/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/assets/git/image-20220106215219131.png" alt="image-20220106215219131"></p>
<h4 id="Git-rebase-–onto"><a href="#Git-rebase-–onto" class="headerlink" title="Git rebase –onto"></a>Git rebase –onto</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rebase --onto 目标commit 起点commit(不包括起点) 终点commit</span><br></pre></td></tr></table></figure>

<p><code>--onto</code> 参数后面有三个附加参数：目标 <code>commit</code>、起点 <code>commit</code>（注意：rebase 的时候会把起点排除在外）、终点 <code>commit</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rebase --onto 第3个commit 第4个commit branch1</span><br></pre></td></tr></table></figure>

<p><img src="/md-images/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/assets/git/15fe24400d7d73d0~tplv-t2oaga2asx-watermark.gif" alt="img"></p>
<p>同样的，你也可以用 <code>rebase --onto</code> 来撤销提交：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git rebase --onto HEAD^^ HEAD^ branch1</span><br></pre></td></tr></table></figure>

<p>上面这行代码的意思是：以倒数第二个 <code>commit</code> 为起点（起点不包含在 <code>rebase</code> 序列里哟），<code>branch1</code> 为终点，<code>rebase</code> 到倒数第三个 <code>commit</code> 上。</p>
<p>也就是这样：</p>
<p><img src="/md-images/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/assets/git/15fe243fce5804fd~tplv-t2oaga2asx-watermark.gif" alt="img"></p>
<h3 id="reset"><a href="#reset" class="headerlink" title="reset"></a>reset</h3><p>实质上，<code>reset</code> 这个指令虽然可以用来撤销 <code>commit</code> ，但它的实质行为并不是撤销，而是移动 <code>HEAD</code> ，并且「捎带」上 <code>HEAD</code> 所指向的 <code>branch</code>（如果有的话）。</p>
<p>reset后接参数</p>
<ol>
<li>–hard：重置位置的同时，清空工作目录和暂存区的所有内容；</li>
<li>–soft：重置位置的同时，保留工作目录和暂存区的内容，并把重置 HEAD 的位置所导致的新的文件差异放进暂存区。</li>
<li>–mixed（默认）：重置位置的同时，保留工作目录的内容，把暂存区和重置 HEAD 的位置所导致的新的文件差异都放入工作目录</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard C3</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Git 的历史只能往回看，不能向未来看，所以把 <code>HEAD</code> 和 <code>branch</code> 往回移动，就能起到撤回 <code>commit</code> 的效果。</p>
<p>在relog里可以回溯哦，前提在git没回收commit节点之前</p>
</blockquote>
<p><img src="/md-images/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/assets/git/15fe19c8a3235853~tplv-t2oaga2asx-watermark.gif" alt="img"></p>
<p>所以同理，<code>reset --hard</code> 不仅可以撤销提交，还可以用来把 <code>HEAD</code> 和 <code>branch</code> 移动到其他的任何地方。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard branch2</span><br></pre></td></tr></table></figure>

<p><img src="/md-images/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/assets/git/15fe333cb605b0de~tplv-t2oaga2asx-watermark.gif" alt="img"></p>
<h3 id="tag"><a href="#tag" class="headerlink" title="tag"></a>tag</h3><h4 id="git打tag"><a href="#git打tag" class="headerlink" title="git打tag"></a>git打tag</h4><p>通常在发布软件的时候打一个tag，tag会记录版本的commit号，方便后期回溯。</p>
<h4 id="列出已有的tag"><a href="#列出已有的tag" class="headerlink" title="列出已有的tag"></a>列出已有的tag</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag</span><br></pre></td></tr></table></figure>

<p>加上<code>-l</code>命令可以使用通配符来过滤<code>tag</code></p>
<p><img src="/md-images/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/assets/git/webp" alt="img"></p>
<h4 id="新建tag"><a href="#新建tag" class="headerlink" title="新建tag"></a>新建tag</h4><p>使用<code>git tag</code>命令跟上tag名字，直接创建一个tag。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag v1.0</span><br></pre></td></tr></table></figure>

<p>上面创建一个名为<code>v1.0</code>的tag。使用<code>git tag</code>命令可以看到新增加的tag。</p>
<p>还可以加上<code>-a</code>参数来创建一个带备注的tag，备注信息由<code>-m</code>指定。如果你未传入<code>-m</code>则创建过程系统会自动为你打开编辑器让你填写备注信息。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag -a tagName -m &quot;my tag&quot;</span><br></pre></td></tr></table></figure>

<h4 id="查看tag详细信息"><a href="#查看tag详细信息" class="headerlink" title="查看tag详细信息"></a>查看tag详细信息</h4><p><code>git show</code>命令可以查看tag的详细信息，包括commit号等。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git show tagName</span><br></pre></td></tr></table></figure>

<p><img src="/md-images/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/assets/git/image-20220107114423786.png" alt="image-20220107114423786"></p>
<p>tag最重要的是有git commit号，后期我们可以根据这个commit号来回溯代码。</p>
<h4 id="给指定的某个commit号加tag"><a href="#给指定的某个commit号加tag" class="headerlink" title="给指定的某个commit号加tag"></a>给指定的某个commit号加tag</h4><p>打tag不必要在head之上，也可在之前的版本上打，这需要你知道某个提交对象的校验和（通过git log获取，取校验和的前几位数字即可）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag -a v1.2 9fceb02 -m &quot;my tag&quot;</span><br></pre></td></tr></table></figure>

<h4 id="将tag同步到远程服务器"><a href="#将tag同步到远程服务器" class="headerlink" title="将tag同步到远程服务器"></a>将tag同步到远程服务器</h4><p>同提交代码后，使用<code>git push</code>来推送到远程服务器一样，<code>tag</code>也需要进行推送才能到远端服务器。</p>
<h5 id="推送单个分支"><a href="#推送单个分支" class="headerlink" title="推送单个分支"></a>推送单个分支</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin v1.0</span><br></pre></td></tr></table></figure>

<h5 id="推送本地所有tag"><a href="#推送本地所有tag" class="headerlink" title="推送本地所有tag"></a>推送本地所有tag</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin --tags</span><br></pre></td></tr></table></figure>

<h4 id="切换到某个tag"><a href="#切换到某个tag" class="headerlink" title="切换到某个tag"></a>切换到某个tag</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout tagName</span><br></pre></td></tr></table></figure>

<p>跟分支一样，可以直接切换到某个tag去。这个时候不位于任何分支，处于游离状态，可以考虑基于这个tag创建一个分支。</p>
<h4 id="删除某个tag"><a href="#删除某个tag" class="headerlink" title="删除某个tag"></a>删除某个tag</h4><ul>
<li>本地删除</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag -d v0.1.2 </span><br></pre></td></tr></table></figure>

<ul>
<li>远端删除<br>git push origin :refs&#x2F;tags&#x2F;<tagName></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push origin :refs/tags/v0.1.2</span><br></pre></td></tr></table></figure>

<h3 id="cherry-pick"><a href="#cherry-pick" class="headerlink" title="cherry-pick"></a>cherry-pick</h3><p><a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2020/04/git-cherry-pick.html">详见阮一峰</a></p>
<p><code>git cherry-pick</code>命令的作用，就是将指定的提交（commit）应用于其他分支。</p>
<p>会将指定的提交<code>commitHash</code>，应用于当前分支。这会在当前分支产生一个新的提交，<strong>当然它们的哈希值会不一样</strong>。</p>
<p>举例来说，代码仓库有<code>master</code>和<code>feature</code>两个分支。</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a - b - c - d   Master</span><br><span class="line">     \</span><br><span class="line">       e - f - g Feature</span><br></pre></td></tr></table></figure>

<p>现在将提交<code>f</code>应用到<code>master</code>分支。</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 切换到 master 分支</span></span><br><span class="line">$ git checkout master</span><br><span class="line"></span><br><span class="line"><span class="comment"># Cherry pick 操作</span></span><br><span class="line">$ git cherry-pick f</span><br></pre></td></tr></table></figure>

<p>上面的操作完成以后，代码库就变成了下面的样子。</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a - b - c - d - f   Master</span><br><span class="line">     \</span><br><span class="line">       e - f - g Feature</span><br></pre></td></tr></table></figure>

<p>从上面可以看到，<code>master</code>分支的末尾增加了一个提交<code>f</code>。</p>
<p><code>git cherry-pick</code>命令的参数，不一定是提交的哈希值，分支名也是可以的，表示转移该分支的最新提交。</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git cherry-pick feature</span><br></pre></td></tr></table></figure>

<p>上面代码表示将<code>feature</code>分支的<strong>最近一次提交</strong>，转移到当前分支。</p>
<p>Cherry pick 支持一次转移多个提交。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git cherry-pick &lt;HashA&gt; &lt;HashB&gt;</span><br></pre></td></tr></table></figure>

<p>上面的命令将 A 和 B 两个提交应用到当前分支。这会在当前分支生成两个对应的新提交。</p>
<p>如果想要转移一系列的连续提交，可以使用下面的简便语法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git cherry-pick A..B </span><br></pre></td></tr></table></figure>

<p>上面的命令可以转移从 A 到 B 的所有提交。它们必须按照正确的顺序放置：提交 A 必须早于提交 B，否则命令将失败，但不会报错。</p>
<p> 一定要注意<strong>不包括节点 A</strong></p>
<h3 id="git-config"><a href="#git-config" class="headerlink" title="git config"></a>git config</h3><h4 id="查看配置-git-config-l"><a href="#查看配置-git-config-l" class="headerlink" title="查看配置 - git config -l"></a>查看配置 - git config -l</h4><p>使用git config -l 可以查看现在的git环境详细配置</p>
<p>查看不同级别的配置文件：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看系统config</span></span><br><span class="line">git config --system --<span class="keyword">list</span></span><br><span class="line">　　</span><br><span class="line"><span class="comment">#查看当前用户（global）配置</span></span><br><span class="line">git config --<span class="keyword">global</span>  --<span class="keyword">list</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">#查看当前仓库配置信息</span></span><br><span class="line">git config --local  --<span class="keyword">list</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="设置用户名与邮箱（用户标识，必要）"><a href="#设置用户名与邮箱（用户标识，必要）" class="headerlink" title="设置用户名与邮箱（用户标识，必要）"></a>设置用户名与邮箱（用户标识，必要）</h4><p>当你安装Git后首先要做的事情是设置你的用户名称和e-mail地址。这是非常重要的，因为每次Git提交都会使用该信息。它被永远的嵌入到了你的提交中：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --<span class="keyword">global</span> user.name <span class="string">&quot;mazhihong&quot;</span>  <span class="meta">#名称</span></span><br><span class="line">git config --<span class="keyword">global</span> user.email <span class="string">&quot;xxxx@qq.com&quot;</span>   <span class="meta">#邮箱</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="添加配置项"><a href="#添加配置项" class="headerlink" title="添加配置项"></a>添加配置项</h4><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git config [--local|--<span class="keyword">global</span>|--system]  section.key <span class="keyword">value</span></span><br><span class="line">[--local|--<span class="keyword">global</span>|--system]  <span class="meta">#可选的，对应本地，全局，系统不同级别的设置</span></span><br><span class="line">section.key <span class="meta">#区域下的键</span></span><br><span class="line"><span class="keyword">value</span> <span class="meta">#对应的值</span></span><br></pre></td></tr></table></figure>

<p>–local 项目级<br> –global 当前用户级<br> –system 系统级</p>
<h4 id="删除配置项"><a href="#删除配置项" class="headerlink" title="删除配置项"></a>删除配置项</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config [--<span class="built_in">local</span>|--global|--system] --<span class="built_in">unset</span> section.key</span><br></pre></td></tr></table></figure>

<h3 id="tips"><a href="#tips" class="headerlink" title="tips"></a>tips</h3><h4 id="checkout-和-reset-的不同"><a href="#checkout-和-reset-的不同" class="headerlink" title="checkout 和 reset 的不同"></a>checkout 和 reset 的不同</h4><p><code>checkout</code> 和 <code>reset</code> 都可以切换 <code>HEAD</code> 的位置，它们除了有许多细节的差异外，最大的区别在于：<code>reset</code> 在移动 <code>HEAD</code> 时会带着它所指向的 <code>branch</code> 一起移动，而 <code>checkout</code> 不会。当你用 <code>checkout</code> 指向其他地方的时候，<code>HEAD</code> 和 它所指向的 <code>branch</code> 就自动脱离了。</p>
<p>事实上，<code>checkout</code> 有一个专门用来只让 <code>HEAD</code> 和 <code>branch</code> 脱离而不移动 <code>HEAD</code> 的用法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git checkout --detach</span><br></pre></td></tr></table></figure>

<p>执行这行代码，Git 就会把 <code>HEAD</code> 和 <code>branch</code> 脱离，直接指向当前 <code>commit</code>：</p>
<p><img src="/md-images/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%9F%BA%E7%A1%80/assets/git/1600acce7b90b009~tplv-t2oaga2asx-watermark.gif" alt="git checkout --detach"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mst123.github.io/%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/peacetime/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luopo.gif">
      <meta itemprop="name" content="马农">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="博客">
      <meta itemprop="description" content="学习记录">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/peacetime/" class="post-title-link" itemprop="url">工作中遇到的-小-问题记录</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-07-13 14:39:31" itemprop="dateCreated datePublished" datetime="2024-07-13T14:39:31+08:00">2024-07-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/" itemprop="url" rel="index"><span itemprop="name">问题记录</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1-有效解决setTimeout跨级传参数"><a href="#1-有效解决setTimeout跨级传参数" class="headerlink" title="1 有效解决setTimeout跨级传参数"></a>1 有效解决setTimeout跨级传参数</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">功能：修改 window.setTimeout，使之可以传递参数和对象参数 </span><br><span class="line">使用方法： setTimeout(回调函数,时间,参数1,...,参数n)</span><br></pre></td></tr></table></figure>

<h2 id="2-单击和双击的冲突问题"><a href="#2-单击和双击的冲突问题" class="headerlink" title="2 单击和双击的冲突问题"></a>2 单击和双击的冲突问题</h2><p>在一个对象同时绑定单击和双击事件时，当双击该对象时，事件发生顺序为 单击-单击-双击。<br>解决该问题可以通过定时器解决</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">var TimeFn = null;</span><br><span class="line">$(&#x27;#box&#x27;).click(function () &#123;</span><br><span class="line">    clearTimeout(TimeFn);</span><br><span class="line">    TimeFn = setTimeout(function()&#123;</span><br><span class="line">        console.log(&#x27;click&#x27;)</span><br><span class="line">    &#125;,100);</span><br><span class="line">&#125;);</span><br><span class="line">$(&#x27;#box&#x27;).dblclick(function () &#123;</span><br><span class="line">    clearTimeout(TimeFn);</span><br><span class="line">    console.log(&#x27;dbclick&#x27;);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>当定时器延迟启动的时间小于300毫秒，第一个单击事件无法被抹消，发生事件为 单击-双击<br>（第二个单击事件和双击事件触发的时间隔间几乎为0，延迟时间对它没有影响）<br>当定时器延迟启动的事件大于300毫秒，第一个单击事件可以被抹消，发生事件为 双击</p>
<h2 id="3-jQuery-事件传参"><a href="#3-jQuery-事件传参" class="headerlink" title="3 jQuery 事件传参"></a>3 jQuery 事件传参</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=&quot;js/jquery-2.1.1.js&quot; type=&quot;text/javascript&quot; charset=&quot;utf-8&quot;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    function Ceshi()&#123;</span><br><span class="line">      this.a=1;</span><br><span class="line">      this.b=2;</span><br><span class="line">      this.c=3;</span><br><span class="line">      this.d=4;    </span><br><span class="line">    &#125;</span><br><span class="line">    Ceshi.prototype.aa=function()&#123;</span><br><span class="line">      var _this=this;</span><br><span class="line">//    $(&#x27;input&#x27;).on(&#x27;click&#x27;,&#123;e:_this&#125;,this.bb) 用此方法可以拿到</span><br><span class="line">      $(&#x27;input&#x27;).on(&#x27;click&#x27;,this.bb).bind(this)</span><br><span class="line">    &#125;</span><br><span class="line">    Ceshi.prototype.bb=function(evt)&#123;               </span><br><span class="line">      console.log(this.b)// undefined</span><br><span class="line">//    console.log(_this.b) // _this is not defined</span><br><span class="line">//    console.log(evt.data.e.b)   //用此方法可以拿到</span><br><span class="line">//    console.log(evt.clientX)</span><br><span class="line">    &#125;</span><br><span class="line">    var demo=new Ceshi()</span><br><span class="line">    demo.aa()</span><br><span class="line">&lt;/script&gt;  </span><br></pre></td></tr></table></figure>

<h2 id="4-ajax-同步异步"><a href="#4-ajax-同步异步" class="headerlink" title="4 ajax 同步异步"></a>4 ajax 同步异步</h2><p>ajax异步请求，不会按上下顺序执行，注意数组操作，以防错位，可以使用同步</p>
<h2 id="5-利用元素记录信息"><a href="#5-利用元素记录信息" class="headerlink" title="5 利用元素记录信息"></a>5 利用元素记录信息</h2><p>利用JSON.stringfiy 可以将复杂json数据存入元素中，利用JSON.parse可以拿出</p>
<h2 id="6-窗口大小改变事件"><a href="#6-窗口大小改变事件" class="headerlink" title="6 窗口大小改变事件"></a>6 窗口大小改变事件</h2><p>window.onresize以最后一个函数为准， $(window).resize(function(){})，可以同时存在多个</p>
<h2 id="7-判断一个对象是否存在的方法"><a href="#7-判断一个对象是否存在的方法" class="headerlink" title="7 判断一个对象是否存在的方法"></a>7 判断一个对象是否存在的方法</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (typeof myObj == &quot;undefined&quot;) &#123;</span><br><span class="line">　var myObj = &#123; &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这是目前使用最广泛的判断javascript对象是否存在的方法。</p>
</blockquote>
<h2 id="8-深拷贝函数，可以复制对象中的函数及数组（很全面）"><a href="#8-深拷贝函数，可以复制对象中的函数及数组（很全面）" class="headerlink" title="8 深拷贝函数，可以复制对象中的函数及数组（很全面）"></a>8 深拷贝函数，可以复制对象中的函数及数组（很全面）</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function deepCopy(p, c) &#123;</span><br><span class="line">  var c = c || &#123;&#125;;</span><br><span class="line">  for (var i in p) &#123;</span><br><span class="line">    if(! p.hasOwnProperty(i))&#123;</span><br><span class="line">      continue;</span><br><span class="line">    &#125;</span><br><span class="line">    if (typeof p[i] === &#x27;object&#x27;) &#123;</span><br><span class="line">      c[i] = (p[i].constructor === Array) ? [] : &#123;&#125;;</span><br><span class="line">      deepCopy(p[i], c[i]);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      c[i] = p[i];</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  return c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Parent = &#123;name: &#x27;foo&#x27;, birthPlaces: [&#x27;北京&#x27;,&#x27;上海&#x27;,&#x27;香港&#x27;]&#125;</span><br><span class="line">var Child = deepCopy(Parent);</span><br></pre></td></tr></table></figure>

<h2 id="9-‘undefined’-和-undefined-使用区别"><a href="#9-‘undefined’-和-undefined-使用区别" class="headerlink" title="9  ‘undefined’ 和 undefined 使用区别"></a>9  ‘undefined’ 和 undefined 使用区别</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var obj = &#123;</span><br><span class="line">     a:1, </span><br><span class="line">&#125;</span><br><span class="line">console.log(obj.b == &#x27;undefined&#x27;) //  false</span><br><span class="line">console.log(obj.b == undefined) //  true 判断元素属性是否存在的常用方法</span><br><span class="line">console.log(typeof obj.b ==&#x27;undefined&#x27;)  //true</span><br><span class="line">console.log(typeof ob)        //  &#x27;undefined&#x27;</span><br><span class="line">console.log(typeof ob == &#x27;undefined&#x27;) // true  此为最常用的判断元素是否存在的方法</span><br><span class="line">console.log(typeof ob == undefined) //  false</span><br></pre></td></tr></table></figure>

<h2 id="10-padding-bottom"><a href="#10-padding-bottom" class="headerlink" title="10 padding-bottom"></a>10 padding-bottom</h2><p>占位防止图片加载过程中的抖动 % 定义基于父元素宽度的百分比下内边距</p>
<h2 id="11-siblings-兄弟元素-且包括它本身"><a href="#11-siblings-兄弟元素-且包括它本身" class="headerlink" title="11 siblings() 兄弟元素 且包括它本身"></a>11 siblings() 兄弟元素 且包括它本身</h2><h2 id="12-撑开父元素宽度超过父元素外层宽度的方法"><a href="#12-撑开父元素宽度超过父元素外层宽度的方法" class="headerlink" title="12 撑开父元素宽度超过父元素外层宽度的方法"></a>12 撑开父元素宽度超过父元素外层宽度的方法</h2><p>父元素 white-space: nowrap;  内部元素 display: inline-block;</p>
<h2 id="13-pointer-events"><a href="#13-pointer-events" class="headerlink" title="13 pointer-events"></a>13 pointer-events</h2><p>更像是JavaScript，它能够：</p>
<ul>
<li>阻止用户的点击动作产生任何效果</li>
<li>阻止缺省鼠标指针的显示</li>
<li>阻止CSS里的 hover 和 active 状态的变化触发事件</li>
<li>阻止JavaScript点击动作触发的事件<br>pointer-events: none 顾名思义，就是鼠标事件拜拜的意思。元素应用了该 CSS 属性，链接啊，点击啊什么的都变成了 “浮云牌酱油”。pointer-events: none 的作用是让元素实体 “虚化”。例如一个应用 pointer-events: none 的按钮元素，则我们在页面上看到的这个按钮，只是一个虚幻的影子而已，您可以理解为海市蜃楼，幽灵的躯体。当我们用手触碰它的时候可以轻易地没有任何感觉地从中穿过去。</li>
</ul>
<h2 id="14-switch需要注意的地方，没有break的情况"><a href="#14-switch需要注意的地方，没有break的情况" class="headerlink" title="14 switch需要注意的地方，没有break的情况"></a>14 switch需要注意的地方，没有break的情况</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function handle(num)&#123;</span><br><span class="line">  switch (num)&#123;</span><br><span class="line">    case 1:</span><br><span class="line">      console.log(1)</span><br><span class="line">    case 2:</span><br><span class="line">      console.log(2)</span><br><span class="line">    case 3:</span><br><span class="line">      console.log(3)</span><br><span class="line">    case 4:</span><br><span class="line">      console.log(4)</span><br><span class="line">    case 5:</span><br><span class="line">      console.log(5)</span><br><span class="line">    case 6:</span><br><span class="line">      console.log(6)</span><br><span class="line">    default:</span><br><span class="line">      break;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">handle(3)   // 3 4 5 6 </span><br></pre></td></tr></table></figure>

<p>没有break的情况下，从<strong>满足条件开始</strong>一直会向下执行，无视case，直至break停止</p>
<h2 id="15-设置position-absolute元素的宽高百分比时，并不是依据父元素的，而是依据定位参考的元素"><a href="#15-设置position-absolute元素的宽高百分比时，并不是依据父元素的，而是依据定位参考的元素" class="headerlink" title="15 设置position absolute元素的宽高百分比时，并不是依据父元素的，而是依据定位参考的元素"></a>15 设置position absolute元素的宽高百分比时，并不是依据父元素的，而是依据定位参考的元素</h2><h2 id="16-js中如何判断属性是对象实例中的属性还是原型中的属性"><a href="#16-js中如何判断属性是对象实例中的属性还是原型中的属性" class="headerlink" title="16 js中如何判断属性是对象实例中的属性还是原型中的属性"></a>16 js中如何判断属性是对象实例中的属性还是原型中的属性</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function hasPrototypeProperty(obj, name) &#123;</span><br><span class="line">  return !obj.hasOwnProperty(name) &amp;&amp; (name in obj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当属性存在对象实例上的时候，函数返回false，表示该属性不是存在原型上，当属性存在原型上的时候，函数返回true。</p>
<h2 id="17-vue中-dispath-支持promise-和-commit"><a href="#17-vue中-dispath-支持promise-和-commit" class="headerlink" title="17 vue中 dispath(支持promise) 和 commit"></a>17 vue中 dispath(支持promise) 和 commit</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">this.$store.dispatch(&#x27;LoginByUsername&#x27;, this.loginForm).then(() =&gt; &#123;</span><br><span class="line">  this.$router.push(&#123; path: &#x27;/&#x27; &#125;); //登录成功之后重定向到首页</span><br><span class="line">&#125;).catch(err =&gt; &#123;</span><br><span class="line">  this.$message.error(err); //登录失败提示错误</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">LoginByUsername(&#123; commit &#125;, userInfo) &#123;</span><br><span class="line">  const username = userInfo.username.trim()</span><br><span class="line">  return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">    loginByUsername(username, userInfo.password).then(response =&gt; &#123;</span><br><span class="line">      const data = response.data</span><br><span class="line">      Cookies.set(&#x27;Token&#x27;, response.data.token) //登录成功后将token存储在cookie之中</span><br><span class="line">      commit(&#x27;SET_TOKEN&#x27;, data.token)</span><br><span class="line">      resolve()</span><br><span class="line">    &#125;).catch(error =&gt; &#123;</span><br><span class="line">      reject(error)</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="18-变量提升也有优先级-函数声明-arguments-变量声明"><a href="#18-变量提升也有优先级-函数声明-arguments-变量声明" class="headerlink" title="18 变量提升也有优先级, 函数声明 &gt; arguments &gt; 变量声明"></a>18 变量提升也有优先级, 函数声明 &gt; arguments &gt; 变量声明</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">console.log(c);</span><br><span class="line">function c(a) &#123;</span><br><span class="line">  console.log(a);</span><br><span class="line">  var a = 3;</span><br><span class="line">&#125;</span><br><span class="line">//function c()&#123;...&#125;</span><br><span class="line">//案例2 </span><br><span class="line">console.log(c);</span><br><span class="line">var c = function (a) &#123;</span><br><span class="line">  console.log(a);</span><br><span class="line">  var a = 3;</span><br><span class="line">&#125;</span><br><span class="line">//undefined</span><br></pre></td></tr></table></figure>

<p>重复声明会被忽略</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">foo(); // 1</span><br><span class="line">var foo;</span><br><span class="line">function foo() &#123; console.log( 1 ); &#125;</span><br><span class="line">foo = function() &#123; console.log( 2 ); &#125;;</span><br></pre></td></tr></table></figure>

<p>注意，var foo 尽管出现在 function foo()… 的声明之前，<strong>但它是重复的声明（因此被忽略了）</strong>，因为函数声明会被提升到普通变量之前。</p>
<blockquote>
<p>看一下你所不知道的JavaScript上 40页</p>
</blockquote>
<h2 id="19-npx讲解"><a href="#19-npx讲解" class="headerlink" title="19 npx讲解"></a>19 npx讲解</h2><p>npx 会帮你执行依赖包里的二进制文件<br>举个例子：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm i webpack -D      //非全局安装</span><br><span class="line">//如果要执行 webpack 的命令</span><br><span class="line">./node_modules/.bin/webpack -v</span><br></pre></td></tr></table></figure>

<p>有了 npx 之后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm i webpack -D    //非全局安装</span><br><span class="line">npx webpack -v </span><br></pre></td></tr></table></figure>

<p>npx 会自动查找当前依赖包中的可执行文件，如果找不到，就会去 PATH 里找。如果依然找不到，就会帮你安装。</p>
<blockquote>
<p>使用package.json中的script命令，也会优先使用依赖包里的二进制文件</p>
</blockquote>
<h2 id="20-引用图片-两种方式都可以"><a href="#20-引用图片-两种方式都可以" class="headerlink" title="20 引用图片,两种方式都可以"></a>20 引用图片,两种方式都可以</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const url = require(&#x27;./bg.jpg&#x27;)</span><br><span class="line">import url from &#x27;./bg.jpg&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="21-ES6类和TS类的区别记忆"><a href="#21-ES6类和TS类的区别记忆" class="headerlink" title="21 ES6类和TS类的区别记忆"></a>21 ES6类和TS类的区别记忆</h2><h3 id="ES6类的写法"><a href="#ES6类的写法" class="headerlink" title="ES6类的写法"></a>ES6类的写法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">class Person &#123;</span><br><span class="line">  name = &#x27;aaa&#x27; //可以用此方式定义实例属性初始值</span><br><span class="line">  constructor(name)&#123;</span><br><span class="line">    this.name = name //实例属性</span><br><span class="line">  &#125;</span><br><span class="line">  say()&#123; //原型方法</span><br><span class="line">    return this.name</span><br><span class="line">  &#125;</span><br><span class="line">  //不需要符号间隔</span><br><span class="line">  eat()&#123;</span><br><span class="line">    return &#x27;food&#x27;</span><br><span class="line">  &#125;</span><br><span class="line">  //静态方法，不会被实例继承，只能通过Person.destroyed()调用，可以被子类继承</span><br><span class="line">  static destroyed() &#123; </span><br><span class="line">    </span><br><span class="line">  &#125;</span><br><span class="line">  //类的内部所有定义的方法，与ES5不同，都是不可枚举的（non-enumerable）</span><br><span class="line">&#125;</span><br><span class="line">//仅可以用下述方式添加原型属性</span><br><span class="line">Person.prototype.prop = &#x27;prop&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="TS类的写法"><a href="#TS类的写法" class="headerlink" title="TS类的写法"></a>TS类的写法</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// 传统写法</span><br><span class="line">class Person &#123;</span><br><span class="line">  public name: string; //实例属性</span><br><span class="line">  constructor(name: string) &#123;</span><br><span class="line">    this.name = name;</span><br><span class="line">  &#125;</span><br><span class="line">  say()&#123; //原型方法</span><br><span class="line">    return this.name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 简化写法</span><br><span class="line">class Person &#123; </span><br><span class="line">  constructor(public name: string) &#123; //实例属性</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  say()&#123; //原型方法</span><br><span class="line">    return this.name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>TS类 有不同的访问类型</p>
<ul>
<li>private, protected, public 访问类型<ul>
<li>public 完全开放使用</li>
<li>private 仅允许在类内被使用</li>
<li>protected 仅允许在类内及继承的子类中使用</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class Person &#123;</span><br><span class="line">  public name: string; //不写constructor 实例属性name压根不存在</span><br><span class="line">  constructor(name: string) &#123;</span><br><span class="line">    this.name = name;</span><br><span class="line">  &#125;</span><br><span class="line">  protected sayHi() &#123;</span><br><span class="line">    this.name;</span><br><span class="line">    console.log(&#x27;hi&#x27;);</span><br><span class="line">  &#125;</span><br><span class="line">  private sayABC() &#123;</span><br><span class="line">    this.name;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="ES6类的继承"><a href="#ES6类的继承" class="headerlink" title="ES6类的继承"></a>ES6类的继承</h3><p>详细书写在分类继承下</p>
<h2 id="22-TS转义代码中发现的-的骚操作"><a href="#22-TS转义代码中发现的-的骚操作" class="headerlink" title="22 TS转义代码中发现的,的骚操作"></a>22 TS转义代码中发现的<code>,</code>的骚操作</h2><p>原代码较为复杂，用下方简化代码示意</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function handle(a, b)&#123;</span><br><span class="line">  console.log(a+b);</span><br><span class="line">&#125;</span><br><span class="line">var d = 4</span><br><span class="line">var c = ((handle(1, 2)), d)</span><br><span class="line">console.log(c);</span><br><span class="line">//3</span><br><span class="line">//4</span><br></pre></td></tr></table></figure>

<blockquote>
<p>程序会先执行逗号之前的语句，然后把逗号之后的语句赋值<br>必须要加外层的括号</p>
</blockquote>
<h2 id="error类无法直观的打印，可以借用下列方法"><a href="#error类无法直观的打印，可以借用下列方法" class="headerlink" title="error类无法直观的打印，可以借用下列方法"></a>error类无法直观的打印，可以借用下列方法</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for (const key of Object.keys(error)) &#123;</span><br><span class="line">  console.log(error[key]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="vue中事件绑定的this指向"><a href="#vue中事件绑定的this指向" class="headerlink" title="vue中事件绑定的this指向"></a>vue中事件绑定的this指向</h2><p>下面是从vue单文件中methods方法中截取的代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">addPointMove() &#123;</span><br><span class="line">  this.$refs[&quot;preview-img&quot;].addEventListener(&quot;mousedown&quot;, this.mouseDownHandle);</span><br><span class="line">  document.addEventListener(&quot;mouseup&quot;, this.mouseUpHandle);</span><br><span class="line">  this.$refs[&quot;preview-img&quot;].onclick = function () &#123;</span><br><span class="line">    console.log(this);</span><br><span class="line">  &#125;;</span><br><span class="line">  this.$refs[&quot;preview-img&quot;].addEventListener(&quot;click&quot;, this.ceshi1);</span><br><span class="line">  this.$refs[&quot;preview-img&quot;].addEventListener(&quot;click&quot;, this.ceshi2);</span><br><span class="line">  this.$refs[&quot;preview-img&quot;].addEventListener(&quot;click&quot;, this.ceshi3);</span><br><span class="line">&#125;,</span><br><span class="line">ceshi1() &#123;</span><br><span class="line">  console.log(this);</span><br><span class="line">&#125;,</span><br><span class="line">ceshi2: function () &#123;</span><br><span class="line">  console.log(this);</span><br><span class="line">&#125;,</span><br><span class="line">ceshi3: () =&gt; &#123;</span><br><span class="line">  console.log(this);</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>当点击click后，控制台输出如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1 this.$refs[&quot;preview-img&quot;]</span><br><span class="line">2 vue实例</span><br><span class="line">3 vue实例</span><br><span class="line">4 undefined</span><br></pre></td></tr></table></figure>

<h2 id="async的错误捕捉"><a href="#async的错误捕捉" class="headerlink" title="async的错误捕捉"></a>async的错误捕捉</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">async function main() &#123;</span><br><span class="line">  try &#123;</span><br><span class="line">    const val1 = await 1;</span><br><span class="line">    const val2 = await 2;</span><br><span class="line">    await Promise.reject(new Error(&quot;222&quot;))</span><br><span class="line">    const val3 = await 3;</span><br><span class="line">    console.log(&#x27;Final: &#x27;, val3);</span><br><span class="line">  &#125;</span><br><span class="line">  catch (err) &#123;</span><br><span class="line">    console.error(err);</span><br><span class="line">  &#125;</span><br><span class="line">  console.log(111);</span><br><span class="line">&#125;</span><br><span class="line">main()</span><br></pre></td></tr></table></figure>

<p>运行至reject，try模块内的代码就停止了，然后运行catch代码块，之后正常运行<br>Error: 222<br>111  </p>
<h2 id="require-一个图片资源出现的问题"><a href="#require-一个图片资源出现的问题" class="headerlink" title="require 一个图片资源出现的问题"></a>require 一个图片资源出现的问题</h2><p>我在项目中书写一个头部组件的时候，需要动态引入背景图片</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">backgroundImage: &quot;url(&quot; + require(&quot;../assets/rwkb.png&quot;) + &quot;)&quot;</span><br></pre></td></tr></table></figure>

<p>写法是对的，但是死活出不来，我真是百思不得其解、、、后来发现打印出来的资源<br><img src="/md-images/%E9%97%AE%E9%A2%98%E7%A7%AF%E7%B4%AF/assets/peacetime/require1.png" alt="资源"></p>
<hr>
<p>然后我抱着试一试的态度多写了一个<code>.default</code>竟然成功了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">backgroundImage: &quot;url(&quot; + require(&quot;../../assets/img/rwkb.png&quot;).default + &quot;)&quot;</span><br></pre></td></tr></table></figure>

<p>后来我在另一个项目里打印</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(require(&quot;@/assets/img/401.png&quot;));</span><br></pre></td></tr></table></figure>

<p>控制台输出 <code>/img/401.abca6a5b.png</code></p>
<h2 id="element-ui-form表单动态验证"><a href="#element-ui-form表单动态验证" class="headerlink" title="element ui form表单动态验证"></a>element ui form表单动态验证</h2><p><img src="/md-images/%E9%97%AE%E9%A2%98%E7%A7%AF%E7%B4%AF/assets/peacetime/form1.jpg" alt="资源"><br><img src="/md-images/%E9%97%AE%E9%A2%98%E7%A7%AF%E7%B4%AF/assets/peacetime/form2.jpg" alt="资源"><br>切换某一个选项后，会动态改变表单及需要校验的表单<br>项目中采用v-if v-else方法改变表单，但是form rules验证会失效，解决方法：<strong>给元素添加唯一KEY</strong>  </p>
<blockquote>
<p>产生bug的原因在于diff算法的复用</p>
</blockquote>
<h2 id="vue-响应式的注意点"><a href="#vue-响应式的注意点" class="headerlink" title="vue 响应式的注意点"></a>vue 响应式的注意点</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  data()&#123;</span><br><span class="line">    return &#123;</span><br><span class="line">      obj1: &#123;</span><br><span class="line">        a: 1</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>没有任何方法能在初始化后添加根级别的响应式</p>
<ul>
<li>结合上方代码即无法添加obj1以外的响应式</li>
</ul>
</li>
<li><p>向存在的嵌套对象添加新的响应式 property，比如obj1，有下面两种方式</p>
<ol>
<li><p>Vue.set(object, propertyName, value)</p>
</li>
<li><p>this.someObject &#x3D; Object.assign({}, this.someObject, { a: 1, b: 2 })</p>
<blockquote>
<p>注意 Object.assign 第一个参数是  { }</p>
</blockquote>
</li>
</ol>
</li>
<li><h3 id="Vue-delete-target-propertyName-index"><a href="#Vue-delete-target-propertyName-index" class="headerlink" title="Vue.delete( target, propertyName&#x2F;index )"></a><a target="_blank" rel="noopener" href="https://cn.vuejs.org/v2/api/#Vue-delete">Vue.delete( target, propertyName&#x2F;index )</a></h3><ul>
<li>不能删除根对象 例如obj1 可以删除obj1.xx</li>
</ul>
</li>
</ul>
<h2 id="element的table组件在flex布局下宽度自适应解决办法"><a href="#element的table组件在flex布局下宽度自适应解决办法" class="headerlink" title="element的table组件在flex布局下宽度自适应解决办法"></a>element的table组件在flex布局下宽度自适应解决办法</h2><p>给宽度一个99% 可以很简单的搞定</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;tp-el-table-ex</span><br><span class="line">  class=&quot;table&quot;</span><br><span class="line">  ref=&quot;clickTable&quot;</span><br><span class="line">  border</span><br><span class="line">  highlight-current-row</span><br><span class="line">  :loading=&quot;tableLoading&quot;</span><br><span class="line">  :data=&quot;tableData&quot;</span><br><span class="line">  style=&quot;width: 99%;&quot;</span><br></pre></td></tr></table></figure>

<h2 id="input事件和change事件的区别"><a href="#input事件和change事件的区别" class="headerlink" title="input事件和change事件的区别"></a>input事件和change事件的区别</h2><ul>
<li><p>input事件：</p>
<blockquote>
<p>input事件在输入框输入的时候回实时响应并触发</p>
</blockquote>
</li>
<li><p>change事件：</p>
<blockquote>
<p>change事件在input失去焦点才会考虑触发，它的缺点是无法实时响应。与blur事件有着相似的功能，但与blur事件不同的是，change事件在输入框的值未改变时并不会触发，当输入框的值和上一次的值不同，并且输入框失去焦点，就会触发change事件。</p>
</blockquote>
</li>
</ul>
<h2 id="GC-垃圾回收机制"><a href="#GC-垃圾回收机制" class="headerlink" title="GC 垃圾回收机制"></a>GC 垃圾回收机制</h2><ul>
<li>引用计数 无法解决循环引用 基本上被淘汰了</li>
<li>标记清除 mark and sweep 也存在一定的局限（对象如果有一个属性经常使用，其余属性就无法被回收）</li>
</ul>
<h2 id="void-0"><a href="#void-0" class="headerlink" title="void 0"></a>void 0</h2><ul>
<li>viod 任何东西都会返回 <code>undefined</code>，之所以使用0，是因为void 0 是表达式中最短的  </li>
<li>undefined可以被重写，所以用 void 0 比较保险</li>
<li>不少 JavaScript 压缩工具在压缩过程中，正是将 undefined 用 void 0 代替掉了</li>
</ul>
<h2 id="URLSearchParams-Object-fromEntries"><a href="#URLSearchParams-Object-fromEntries" class="headerlink" title="URLSearchParams Object.fromEntries"></a>URLSearchParams Object.fromEntries</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Object.fromEntries(new URLSearchParams(‘foo=bar&amp;baz=qux’))</span><br><span class="line">// &#123; foo: “bar”, baz: “qux” &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="node-contains-otherNode"><a href="#node-contains-otherNode" class="headerlink" title="node.contains(otherNode)"></a>node.contains(otherNode)</h2><p>node 是否包含otherNode节点, otherNode 是否是node的后代节点<br>如果 otherNode 是 node 的后代节点或是 node 节点本身.则返回true , 否则返回 false.</p>
<h2 id="getComputedStyle-和-style的区别"><a href="#getComputedStyle-和-style的区别" class="headerlink" title="getComputedStyle 和 style的区别"></a>getComputedStyle 和 style的区别</h2><p>用法<br>let style &#x3D; window.getComputedStyle(element, [pseudoElt]);</p>
<ul>
<li><p>element 用于获取计算样式的Element。</p>
</li>
<li><p>pseudoElt 可选<br>指定一个要匹配的伪元素的字符串，例如’::after’，必须对普通元素省略（或null）。</p>
</li>
<li><p>只读与可写<br>getComputedStyle方法是只读的，只能获取样式，不能设置；而element.style能读能写，能屈能伸。</p>
</li>
<li><p>获取的对象范围<br>getComputedStyle方法获取的是最终应用在元素上的所有CSS属性对象（即使没有CSS代码，也会把默认的祖宗八代都显示出来）；而element.style只能获取元素style属性中的CSS样式。因此对于一个光秃秃的元素<p>，getComputedStyle方法返回对象中length属性值（如果有）就是190+(据我测试FF:192, IE9:195, Chrome:253, 不同环境结果可能有差异), 而element.style就是0。</p>
</li>
<li><p>作用<br>getComputedStyle方法有一个很重要的，类似css()方法没有的功能——获取伪类元素样式</p>
</li>
<li><p>兼容性<br>getComputedStyle方法IE6~8是不支持的</p>
</li>
</ul>
<h2 id="Math-floor-的另类写法"><a href="#Math-floor-的另类写法" class="headerlink" title="Math.floor 的另类写法"></a>Math.floor 的另类写法</h2><p>Math.floor((touch.y2 - touch.y1) &#x2F; ANCHOR_HEIGHT) &#x3D;&#x3D;&#x3D; Math.floor((touch.y2 - touch.y1) | 0</p>
<h2 id="取一段区间值的小技巧"><a href="#取一段区间值的小技巧" class="headerlink" title="取一段区间值的小技巧"></a>取一段区间值的小技巧</h2><p>如果需要参数范围控制在[min,max]之间，传统方法可能需要三个控制流，借助math函数可以这么写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arg = Math.max(min, Math.min(arg, max))</span><br></pre></td></tr></table></figure>

<p>即可以arg控制在[min, max] 范围内</p>
<h2 id="filter-和-backdrop-filter"><a href="#filter-和-backdrop-filter" class="headerlink" title="filter 和 backdrop-filter"></a>filter 和 backdrop-filter</h2><ul>
<li>backdrop-filter CSS 属性可以让你为一个元素后面区域添加图形效果（如模糊或颜色偏移）。 因为它适用于元素背后的所有元素，为了看到效果，必须使元素或其背景至少部分透明。</li>
<li>filter CSS属性将模糊或颜色偏移等图形效果应用于元素。滤镜通常用于调整图像，背景和边框的渲染。<br><a target="_blank" rel="noopener" href="https://www.jb51.net/css/745019.html">详情</a></li>
</ul>
<h2 id="需要小范围闭环取值"><a href="#需要小范围闭环取值" class="headerlink" title="需要小范围闭环取值"></a>需要小范围闭环取值</h2><p>可以借助取余函数，例如type只有三种值 0 1 2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">let type = 0 </span><br><span class="line">function changeType()&#123;</span><br><span class="line">  type = (type + 1) % 3</span><br><span class="line">&#125;</span><br><span class="line">for(var i = 0;i&lt;=100;i++)&#123;</span><br><span class="line">  changeType()</span><br><span class="line">  console.log(type) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果 0、1、2、0、1、2、0、1、2………….<br>适合闭环取值</p>
<h2 id="console-log-打印彩色"><a href="#console-log-打印彩色" class="headerlink" title="console.log 打印彩色"></a>console.log 打印彩色</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var message = &quot;Hello word&quot;;</span><br><span class="line">var color = &quot;red&quot;;</span><br><span class="line">   </span><br><span class="line">console.log(&quot;%c &quot; + message ,  &quot;color:&quot; + color);</span><br><span class="line">console.log(&quot;%c &quot; + message ,  &quot;color:&quot; + &quot;blue&quot;);</span><br><span class="line">console.log(&quot;%c &quot; + message ,  &quot;color:&quot; + &quot;yellow&quot;);</span><br></pre></td></tr></table></figure>

<h2 id="element-动态rules"><a href="#element-动态rules" class="headerlink" title="element 动态rules"></a>element 动态rules</h2><p>form默认会在rules改变后，重新校验，有字段可以设置。需要注意数据变化和rules变化的先后顺序问题，会带来一些不可预见的bug，form有去除校验结果的办法</p>
<h2 id="arguments-和对应参数的绑定"><a href="#arguments-和对应参数的绑定" class="headerlink" title="arguments 和对应参数的绑定"></a>arguments 和对应参数的绑定</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">function foo(name, age, sex, hobbit) &#123;</span><br><span class="line"></span><br><span class="line">    console.log(name, arguments[0]); // name name</span><br><span class="line"></span><br><span class="line">    // 改变形参</span><br><span class="line">    name = &#x27;new name&#x27;;</span><br><span class="line"></span><br><span class="line">    console.log(name, arguments[0]); // new name new name</span><br><span class="line"></span><br><span class="line">    // 改变arguments</span><br><span class="line">    arguments[1] = &#x27;new age&#x27;;</span><br><span class="line"></span><br><span class="line">    console.log(age, arguments[1]); // new age new age</span><br><span class="line"></span><br><span class="line">    // 测试未传入的是否会绑定</span><br><span class="line">    console.log(sex); // undefined</span><br><span class="line"></span><br><span class="line">    sex = &#x27;new sex&#x27;;</span><br><span class="line"></span><br><span class="line">    console.log(sex, arguments[2]); // new sex undefined</span><br><span class="line"></span><br><span class="line">    arguments[3] = &#x27;new hobbit&#x27;;</span><br><span class="line"></span><br><span class="line">    console.log(hobbit, arguments[3]); // undefined new hobbit</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo(&#x27;name&#x27;, &#x27;age&#x27;)</span><br></pre></td></tr></table></figure>

<p>传入的参数，实参和 arguments 的值会共享，当没有传入时，实参与 arguments 值不会共享</p>
<p>除此之外，以上是在非严格模式下，如果是在严格模式下，实参和 arguments 是不会共享的。</p>
<h2 id="JSON-stringify-有第二个参数-replacer"><a href="#JSON-stringify-有第二个参数-replacer" class="headerlink" title="JSON.stringify 有第二个参数 replacer"></a>JSON.stringify 有第二个参数 replacer</h2><p>它可以是数组或者函数，用来指定对象序列化过程中哪些属性应该被处理，哪些应该被排除。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function replacer(key, value) &#123;</span><br><span class="line">  if (typeof value === &quot;string&quot;) &#123;</span><br><span class="line">    return undefined;</span><br><span class="line">  &#125;</span><br><span class="line">  return value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var foo = &#123;foundation: &quot;Mozilla&quot;, model: &quot;box&quot;, week: 45, transport: &quot;car&quot;, month: 7&#125;;</span><br><span class="line">var jsonString = JSON.stringify(foo, replacer);</span><br><span class="line"></span><br><span class="line">console.log(jsonString)</span><br><span class="line">// &#123;&quot;week&quot;:45,&quot;month&quot;:7&#125;</span><br><span class="line">var foo = &#123;foundation: &quot;Mozilla&quot;, model: &quot;box&quot;, week: 45, transport: &quot;car&quot;, month: 7&#125;;</span><br><span class="line">console.log(JSON.stringify(foo, [&#x27;week&#x27;, &#x27;month&#x27;]));</span><br><span class="line">// &#123;&quot;week&quot;:45,&quot;month&quot;:7&#125;</span><br></pre></td></tr></table></figure>

<p>如果一个被序列化的对象拥有 toJSON 方法，那么该 toJSON 方法就会覆盖该对象默认的序列化行为：不是那个对象被序列化，而是调用 toJSON 方法后的返回值会被序列化，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var obj = &#123;</span><br><span class="line">  foo: &#x27;foo&#x27;,</span><br><span class="line">  toJSON: function () &#123;</span><br><span class="line">    return &#x27;bar&#x27;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line">JSON.stringify(obj);      // &#x27;&quot;bar&quot;&#x27;</span><br><span class="line">JSON.stringify(&#123;x: obj&#125;); // &#x27;&#123;&quot;x&quot;:&quot;bar&quot;&#125;&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="inject-provide-响应式"><a href="#inject-provide-响应式" class="headerlink" title="inject provide 响应式"></a>inject provide 响应式</h2><p>provide使用函数可以实现响应式，看起来不像是能响应的样子。。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 父</span></span><br><span class="line"><span class="title function_">data</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">ceshiObj1</span>: &#123;</span><br><span class="line">      <span class="attr">a</span>: <span class="number">1</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="title function_">provide</span> () &#123;</span><br><span class="line">  <span class="keyword">return</span> &#123;</span><br><span class="line">    <span class="attr">getInfo</span>: <span class="function">() =&gt;</span> <span class="variable language_">this</span>.<span class="property">ceshiObj1</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">methods</span>: &#123;</span><br><span class="line">  <span class="title function_">testInject</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ceshiObj1</span>.<span class="property">a</span>++</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 子</span></span><br><span class="line"><span class="attr">computed</span>: &#123;</span><br><span class="line">  <span class="title function_">test</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">getInfo</span>().<span class="property">a</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="defer和async"><a href="#defer和async" class="headerlink" title="defer和async"></a>defer和async</h2><p>js的执行都会阻塞html parsing</p>
<p><img src="/md-images/%E9%97%AE%E9%A2%98%E7%A7%AF%E7%B4%AF/assets/peacetime/bVWhRl.png" alt="wfL82.png"></p>
<h2 id="bind函数的参数"><a href="#bind函数的参数" class="headerlink" title="bind函数的参数"></a>bind函数的参数</h2><p>直接看代码吧</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function resolve(res) &#123;</span><br><span class="line">  console.log(res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function bindHandle(...rest) &#123;</span><br><span class="line">  console.log(rest);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const after = bindHandle.bind(null, resolve, &quot;promise&quot;)</span><br><span class="line"></span><br><span class="line">after(&quot;res&quot;,&quot;res2&quot;)</span><br><span class="line"></span><br><span class="line">[ [Function: resolve], &#x27;promise&#x27;, &#x27;res&#x27;, &#x27;res2&#x27; ]</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mst123.github.io/%E9%9D%A2%E8%AF%95/%E5%B8%B8%E7%94%A8%E6%A6%82%E5%BF%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luopo.gif">
      <meta itemprop="name" content="马农">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="博客">
      <meta itemprop="description" content="学习记录">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E9%9D%A2%E8%AF%95/%E5%B8%B8%E7%94%A8%E6%A6%82%E5%BF%B5/" class="post-title-link" itemprop="url">需要掌握的概念</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-07-13 13:25:31" itemprop="dateCreated datePublished" datetime="2024-07-13T13:25:31+08:00">2024-07-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E9%9D%A2%E8%AF%95/" itemprop="url" rel="index"><span itemprop="name">面试</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="进程和线程"><a href="#进程和线程" class="headerlink" title="进程和线程"></a>进程和线程</h2><p> 启动一个程序的时候，操作系统会为该程序创建一块内存，用来存放代码、运行中的数据和一个执行任务的主线程，我们把这样的一个运行环境叫进程</p>
<ul>
<li><strong>一个进程就是一个程序的运行实例</strong></li>
<li><strong>线程是不能单独存在的，它是由进程来启动和管理的</strong></li>
<li><strong>线程是依附于进程的，而进程中使用多线程并行处理能提升运算效率</strong></li>
</ul>
<p><img src="/md-images/%E9%9D%A2%E8%AF%95/assets/%E5%B8%B8%E7%94%A8%E6%A6%82%E5%BF%B5/image-20210712222146731.png" alt="image-20210712222146731"></p>
<p>总结来说，进程和线程之间的关系有以下 4 个特点。</p>
<ul>
<li><strong>1. 进程中的任意一线程执行出错，都会导致整个进程的崩溃。</strong></li>
<li><strong>2. 线程之间共享进程中的数据。</strong></li>
<li><strong>3. 当一个进程关闭之后，操作系统会回收进程所占用的内存(包括泄漏的内存)。</strong></li>
<li><strong>4. 进程之间的内容相互隔离。(通信依靠IPC进程间通信)</strong></li>
</ul>
<h2 id="网络协议"><a href="#网络协议" class="headerlink" title="网络协议"></a>网络协议</h2><h3 id="常见网页协议"><a href="#常见网页协议" class="headerlink" title="常见网页协议"></a>常见网页协议</h3><ul>
<li><strong>TCP&#x2F;IP</strong>  是互联网相关的各类协议族的总称</li>
<li><strong>IP</strong>（Internet Protocol）网际协议（<strong>网络层协议</strong>）IP 协议的作用是把各种数据包传送给对方。而要保证确实传送到对方 那里，则需要满足各类条件。其中两个重要的条件是 IP 地址和 MAC 地址（Media Access Control Address）</li>
<li><strong>HTTP</strong> 超文本传输协议是一个用于传输超媒体文档（例如 HTML）的<strong>应用层协议</strong>。它是为 Web 浏览器与 Web 服务器之间的通信而设计的，但也可以用于其他目的</li>
<li><strong>TCP</strong>（Transmission Control Protocol，传输控制协议）是一种面向连接的、可靠的、基于字节流的<strong>传输层通信协议</strong></li>
<li><strong>UDP</strong>（User Data Protocol，用户数据报协议）一个非连接的协议，传输数据之前源端和终端不建立连接， 当它想传送时就简单地去抓取来自应用程序的数据，并尽可能快地把它扔到网络上</li>
</ul>
<h3 id="TCP-IP-的分层管理"><a href="#TCP-IP-的分层管理" class="headerlink" title="TCP&#x2F;IP 的分层管理"></a><strong>TCP&#x2F;IP</strong> 的分层管理</h3><p><strong>利用 TCP&#x2F;IP 协议族进行网络通信时，会通过分层顺序与对方进行通信</strong></p>
<p><img src="/md-images/%E9%9D%A2%E8%AF%95/assets/%E5%B8%B8%E7%94%A8%E6%A6%82%E5%BF%B5/image-20210714152647756.png" alt="image-20210714152647756"></p>
<p>这些层基本上被分为4层：</p>
<ul>
<li><p>应用层</p>
<ul>
<li>1、超文本传输协议（<strong>HTTP</strong>):万维网的基本协议</li>
<li>2、文件传输（FTP文件传输协议）；</li>
<li>3、远程登录（Telnet），提供远程访问其它主机功能, 它允许用户登录internet主机，并在这台主机上执行命令</li>
<li>4、网络管理（SNMP简单网络管理协议），该协议提供了监控网络设备的方法， 以及配置管理,统计信息收集,性能管理及安全管理等</li>
<li>5、域名系统（<strong>DNS</strong>），该系统用于在internet中将域名及其公共广播的网络节点转换成IP地址</li>
</ul>
</li>
<li><p>传输层</p>
<ul>
<li>1、<strong>TCP</strong></li>
<li>2、<strong>UDP</strong></li>
</ul>
</li>
<li><p>网络层</p>
<ul>
<li>1、Internet协议（IP）</li>
<li>2、Internet控制信息协议（ICMP）</li>
<li>3、地址解析协议（ARP）ARP 是一种用以解析地址的协议，根据通信方的 IP 地址就可以反查出对应的 MAC 地址。</li>
<li>4、反向地址解析协议（RARP）</li>
</ul>
</li>
<li><p>链路层</p>
<p>用来处理连接网络的硬件部分。包括控制操作系统、硬件的设备驱动、NIC（Network Interface Card，网络适配器，即网卡），及光纤等物理可见部分（还包括连接器等一切传输媒介）。硬件上的范畴均在链路层的作用范围之内。</p>
</li>
</ul>
<h2 id="Cookies-的属性"><a href="#Cookies-的属性" class="headerlink" title="Cookies 的属性"></a>Cookies 的属性</h2><p>在下面这张图里我们可以看到 Cookies 相关的一些属性：</p>
<p><img src="/md-images/%E9%9D%A2%E8%AF%95/assets/%E5%B8%B8%E7%94%A8%E6%A6%82%E5%BF%B5/170eb95c6ae10887~tplv-t2oaga2asx-watermark.gif" alt="img"></p>
<p>这里主要说一些大家可能没有注意的点：</p>
<h3 id="Name-Value"><a href="#Name-Value" class="headerlink" title="Name&#x2F;Value"></a>Name&#x2F;Value</h3><p>用 JavaScript 操作 Cookie 的时候注意对 Value 进行编码处理。</p>
<h3 id="Expires"><a href="#Expires" class="headerlink" title="Expires"></a>Expires</h3><p>Expires 用于设置 Cookie 的过期时间。比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: id=a3fWa; Expires=Wed, 21 Oct 2015 07:28:00 GMT;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>当 Expires 属性缺省时，表示是会话性 Cookie，像上图 Expires 的值为 Session，表示的就是会话性 Cookie。当为会话性 Cookie 的时候，值保存在客户端内存中，并在用户关闭浏览器时失效。需要注意的是，有些浏览器提供了会话恢复功能，这种情况下即使关闭了浏览器，会话期 Cookie 也会被保留下来，就好像浏览器从来没有关闭一样。</p>
<p>与会话性 Cookie 相对的是持久性 Cookie，持久性 Cookies 会保存在用户的硬盘中，直至过期或者清除 Cookie。这里值得注意的是，设定的日期和时间<strong>只与客户端相关，而不是服务端</strong>。</p>
<h3 id="Max-Age"><a href="#Max-Age" class="headerlink" title="Max-Age"></a>Max-Age</h3><p>Max-Age 用于设置在 Cookie 失效之前需要经过的秒数。比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: id=a3fWa; Max-Age=604800;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<p>Max-Age 可以为正数、负数、甚至是 0。</p>
<p>如果 max-Age 属性为正数时，浏览器会将其持久化，即写到对应的 Cookie 文件中。</p>
<p>当 max-Age 属性为负数，则表示该 Cookie 只是一个会话性 Cookie。</p>
<p>当 max-Age 为 0 时，则会立即删除这个 Cookie。</p>
<p>假如 Expires 和 Max-Age 都存在，Max-Age 优先级更高。</p>
<h3 id="Domain"><a href="#Domain" class="headerlink" title="Domain"></a>Domain</h3><p>Domain 指定了 Cookie 可以送达的主机名。假如没有指定，那么默认值为当前文档访问地址中的主机部分（但是不包含子域名）。</p>
<p>像淘宝首页设置的 Domain 就是 .taobao.com，这样无论是 a.taobao.com 还是 b.taobao.com 都可以使用 Cookie。</p>
<p>在这里注意的是，不能跨域设置 Cookie，比如阿里域名下的页面把 Domain 设置成百度是无效的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Set</span>-<span class="title class_">Cookie</span>: qwerty=219ffwef9w0f; <span class="title class_">Domain</span>=baidu.<span class="property">com</span>; <span class="title class_">Path</span>=/; <span class="title class_">Expires</span>=<span class="title class_">Wed</span>, <span class="number">30</span> <span class="title class_">Aug</span> <span class="number">2020</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> <span class="variable constant_">GMT</span></span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<h3 id="Path"><a href="#Path" class="headerlink" title="Path"></a>Path</h3><p>Path 指定了一个 URL 路径，这个路径必须出现在要请求的资源的路径中才可以发送 Cookie 首部。比如设置 <code>Path=/docs</code>，<code>/docs/Web/</code> 下的资源会带 Cookie 首部，<code>/test</code> 则不会携带 Cookie 首部。</p>
<p><strong>Domain 和 Path 标识共同定义了 Cookie 的作用域：即 Cookie 应该发送给哪些 URL</strong>。</p>
<blockquote>
<p>1.domain表示的是cookie所在的域，默认为请求的地址，如网址为<a target="_blank" rel="noopener" href="http://www.jb51.net/test/test.aspx%EF%BC%8C%E9%82%A3%E4%B9%88domain%E9%BB%98%E8%AE%A4%E4%B8%BAwww.jb51.net%E3%80%82%E8%80%8C%E8%B7%A8%E5%9F%9F%E8%AE%BF%E9%97%AE%EF%BC%8C%E5%A6%82%E5%9F%9FA%E4%B8%BAt1.test.com%EF%BC%8C%E5%9F%9FB%E4%B8%BAt2.test.com%EF%BC%8C%E9%82%A3%E4%B9%88%E5%9C%A8%E5%9F%9FA%E7%94%9F%E4%BA%A7%E4%B8%80%E4%B8%AA%E4%BB%A4%E5%9F%9FA%E5%92%8C%E5%9F%9FB%E9%83%BD%E8%83%BD%E8%AE%BF%E9%97%AE%E7%9A%84cookie%E5%B0%B1%E8%A6%81%E5%B0%86%E8%AF%A5cookie%E7%9A%84domain%E8%AE%BE%E7%BD%AE%E4%B8%BA.test.com%EF%BC%9B%E5%A6%82%E6%9E%9C%E8%A6%81%E5%9C%A8%E5%9F%9FA%E7%94%9F%E4%BA%A7%E4%B8%80%E4%B8%AA%E4%BB%A4%E5%9F%9FA%E4%B8%8D%E8%83%BD%E8%AE%BF%E9%97%AE%E8%80%8C%E5%9F%9FB%E8%83%BD%E8%AE%BF%E9%97%AE%E7%9A%84cookie%E5%B0%B1%E8%A6%81%E5%B0%86%E8%AF%A5cookie%E7%9A%84domain%E8%AE%BE%E7%BD%AE%E4%B8%BAt2.test.com%E3%80%82">www.jb51.net/test/test.aspx，那么domain默认为www.jb51.net。而跨域访问，如域A为t1.test.com，域B为t2.test.com，那么在域A生产一个令域A和域B都能访问的cookie就要将该cookie的domain设置为.test.com；如果要在域A生产一个令域A不能访问而域B能访问的cookie就要将该cookie的domain设置为t2.test.com。</a></p>
<p>2.path表示cookie所在的目录，asp.net默认为&#x2F;，就是根目录。在同一个服务器上有目录如下：&#x2F;test&#x2F;,&#x2F;test&#x2F;cd&#x2F;,&#x2F;test&#x2F;dd&#x2F;，现设一个cookie1的path为&#x2F;test&#x2F;，cookie2的path为&#x2F;test&#x2F;cd&#x2F;，那么test下的所有页面都可以访问到cookie1，而&#x2F;test&#x2F;和&#x2F;test&#x2F;dd&#x2F;的子页面不能访问cookie2。这是因为cookie能让其path路径下的页面访问。</p>
</blockquote>
<h3 id="Secure属性"><a href="#Secure属性" class="headerlink" title="Secure属性"></a>Secure属性</h3><p>标记为 Secure 的 Cookie 只应通过被HTTPS协议加密过的请求发送给服务端。使用 HTTPS 安全协议，可以保护 Cookie 在浏览器和 Web 服务器间的传输过程中不被窃取和篡改。</p>
<h3 id="HTTPOnly"><a href="#HTTPOnly" class="headerlink" title="HTTPOnly"></a>HTTPOnly</h3><p>设置 HTTPOnly 属性可以防止客户端脚本通过 document.cookie 等方式访问 Cookie，有助于避免 XSS 攻击。</p>
<h3 id="SameSite"><a href="#SameSite" class="headerlink" title="SameSite"></a>SameSite</h3><p>Cookie 的<code>SameSite</code>属性用来限制第三方 Cookie，从而减少安全风险。</p>
<p>它可以设置三个值。</p>
<ul>
<li>Strict</li>
<li>Lax</li>
<li>None</li>
</ul>
<h4 id="Strict"><a href="#Strict" class="headerlink" title="Strict"></a>Strict</h4><p><code>Strict</code>最为严格，完全禁止第三方 Cookie，跨站点时，任何情况下都不会发送 Cookie。换言之，只有当前网页的 URL 与请求目标一致，才会带上 Cookie。</p>
 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: CookieName=CookieValue; SameSite=Strict;</span><br></pre></td></tr></table></figure>

<p>这个规则过于严格，可能造成非常不好的用户体验。比如，当前网页有一个 GitHub 链接，用户点击跳转就不会带有 GitHub 的 Cookie，跳转过去总是未登陆状态。</p>
<h4 id="Lax"><a href="#Lax" class="headerlink" title="Lax"></a>Lax</h4><p><code>Lax</code>规则稍稍放宽，大多数情况也是不发送第三方 Cookie，但是导航到目标网址的 Get 请求除外。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: CookieName=CookieValue; SameSite=Lax;</span><br></pre></td></tr></table></figure>

<p>导航到目标网址的 GET 请求，只包括三种情况：链接，预加载请求，GET 表单。详见下表。</p>
<table>
<thead>
<tr>
<th align="left">请求类型</th>
<th align="center">示例</th>
<th align="right">正常情况</th>
<th align="left">Lax</th>
</tr>
</thead>
<tbody><tr>
<td align="left">链接</td>
<td align="center"><code>&lt;a href=&quot;...&quot;&gt;&lt;/a&gt;</code></td>
<td align="right">发送 Cookie</td>
<td align="left">发送 Cookie</td>
</tr>
<tr>
<td align="left">预加载</td>
<td align="center"><code>&lt;link rel=&quot;prerender&quot; href=&quot;...&quot;/&gt;</code></td>
<td align="right">发送 Cookie</td>
<td align="left">发送 Cookie</td>
</tr>
<tr>
<td align="left">GET 表单</td>
<td align="center"><code>&lt;form method=&quot;GET&quot; action=&quot;...&quot;&gt;</code></td>
<td align="right">发送 Cookie</td>
<td align="left">发送 Cookie</td>
</tr>
<tr>
<td align="left">POST 表单</td>
<td align="center"><code>&lt;form method=&quot;POST&quot; action=&quot;...&quot;&gt;</code></td>
<td align="right">发送 Cookie</td>
<td align="left">不发送</td>
</tr>
<tr>
<td align="left">iframe</td>
<td align="center"><code>&lt;iframe src=&quot;...&quot;&gt;&lt;/iframe&gt;</code></td>
<td align="right">发送 Cookie</td>
<td align="left">不发送</td>
</tr>
<tr>
<td align="left">AJAX</td>
<td align="center"><code>$.get(&quot;...&quot;)</code></td>
<td align="right">发送 Cookie</td>
<td align="left">不发送</td>
</tr>
<tr>
<td align="left">Image</td>
<td align="center"><code>&lt;img src=&quot;...&quot;&gt;</code></td>
<td align="right">发送 Cookie</td>
<td align="left">不发送</td>
</tr>
</tbody></table>
<p>设置了<code>Strict</code>或<code>Lax</code>以后，基本就杜绝了 CSRF 攻击。当然，前提是用户浏览器支持 SameSite 属性。</p>
<h4 id="None"><a href="#None" class="headerlink" title="None"></a>None</h4><p>Chrome 计划将<code>Lax</code>变为默认设置。这时，网站可以选择显式关闭<code>SameSite</code>属性，将其设为<code>None</code>。不过，前提是必须同时设置<code>Secure</code>属性（Cookie 只能通过 HTTPS 协议发送），否则无效。</p>
<p>下面的设置无效。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: widget_session=abc123; SameSite=None</span><br></pre></td></tr></table></figure>

<p>下面的设置有效。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set-Cookie: widget_session=abc123; SameSite=None; Secure</span><br></pre></td></tr></table></figure>

<blockquote>
<p>cookie作者：冴羽</p>
<p>链接：<a target="_blank" rel="noopener" href="https://juejin.cn/post/6844904095711494151">https://juejin.cn/post/6844904095711494151</a></p>
<p>samesite作者：阮一峰</p>
<p>链接：<a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2019/09/cookie-samesite.html">https://www.ruanyifeng.com/blog/2019/09/cookie-samesite.html</a></p>
</blockquote>
<h2 id="层叠上下文"><a href="#层叠上下文" class="headerlink" title="层叠上下文"></a>层叠上下文</h2><ul>
<li>文档根元素（<code>&lt;html&gt;</code>）；</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/position"><code>position</code></a> 值为 <code>absolute</code>（绝对定位）或 <code>relative</code>（相对定位）且 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/z-index"><code>z-index</code></a> 值不为 <code>auto</code> 的元素；</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/position"><code>position</code></a> 值为 <code>fixed</code>（固定定位）或 <code>sticky</code>（粘滞定位）的元素（沾滞定位适配所有移动设备上的浏览器，但老的桌面浏览器不支持）；</li>
<li>flex (<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Flexible_Box_Layout/Basic_Concepts_of_Flexbox"><code>flexbox</code> (en-US)</a>) 容器的子元素，且 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/z-index"><code>z-index</code></a> 值不为 <code>auto</code>；</li>
<li>grid (<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/grid"><code>grid</code></a>) 容器的子元素，且 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/z-index"><code>z-index</code></a> 值不为 <code>auto</code>；</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/opacity"><code>opacity</code></a> 属性值小于 <code>1</code> 的元素（参见 <a target="_blank" rel="noopener" href="https://www.w3.org/TR/css3-color/#transparency">the specification for opacity</a>）；</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/mix-blend-mode"><code>mix-blend-mode</code></a> 属性值不为 <code>normal</code> 的元素；</li>
<li>以下任意属性值不为none的元素：<ul>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/transform"><code>transform</code></a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/filter"><code>filter</code></a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/perspective"><code>perspective</code></a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/clip-path"><code>clip-path</code></a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/mask"><code>mask</code></a> &#x2F; <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/mask-image"><code>mask-image</code></a> &#x2F; <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/mask-border"><code>mask-border</code></a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/isolation"><code>isolation</code></a> 属性值为 <code>isolate</code> 的元素；</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/-webkit-overflow-scrolling"><code>-webkit-overflow-scrolling</code></a> 属性值为 <code>touch</code> 的元素；</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/will-change"><code>will-change</code></a> 值设定了任一属性而该属性在 non-initial 值时会创建层叠上下文的元素（参考<a target="_blank" rel="noopener" href="https://dev.opera.com/articles/css-will-change-property/">这篇文章</a>）；</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/contain"><code>contain</code></a> 属性值为 <code>layout</code>、<code>paint</code> 或包含它们其中之一的合成值（比如 <code>contain: strict</code>、<code>contain: content</code>）的元素。</li>
</ul>
<p><img src="/md-images/%E9%9D%A2%E8%AF%95/assets/%E5%B8%B8%E7%94%A8%E6%A6%82%E5%BF%B5/image-20211213143326679.png" alt="image-20211213143326679"></p>
<h2 id="BFC"><a href="#BFC" class="headerlink" title="BFC"></a>BFC</h2><p><strong>块格式化上下文（Block Formatting Context，BFC）</strong> 是Web页面的可视CSS渲染的一部分，是块盒子的布局过程发生的区域，也是浮动元素与其他元素交互的区域。</p>
<p>下列方式会创建<strong>块格式化上下文</strong>：</p>
<ul>
<li>根元素（<code>&lt;html&gt;）</code></li>
<li>浮动元素（元素的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/float"><code>float</code></a> 不是 <code>none</code>）</li>
<li>绝对定位元素（元素的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/position"><code>position</code></a> 为 <code>absolute</code> 或 <code>fixed</code>）</li>
<li>行内块元素（元素的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/display"><code>display</code></a> 为 <code>inline-block</code>）</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/overflow"><code>overflow</code></a> 计算值(Computed)不为 <code>visible</code> 的块元素</li>
<li>弹性元素（<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/display"><code>display</code></a> 为 <code>flex</code> 或 <code>inline-flex</code>元素的直接子元素）</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/contain"><code>contain</code></a> 值为 <code>layout</code>、<code>content</code>或 paint 的元素</li>
<li><strong>前边的是比较常见的</strong></li>
<li>表格单元格（元素的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/display"><code>display</code></a> 为 <code>table-cell</code>，HTML表格单元格默认为该值）</li>
<li>表格标题（元素的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/display"><code>display</code></a> 为 <code>table-caption</code>，HTML表格标题默认为该值）</li>
<li>匿名表格单元格元素（元素的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/display"><code>display</code></a> 为 <code>table、``table-row</code>、 <code>table-row-group、``table-header-group、``table-footer-group</code>（分别是HTML table、row、tbody、thead、tfoot 的默认属性）或 <code>inline-table</code>）</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/display"><code>display</code></a> 值为 <code>flow-root</code> 的元素</li>
<li>网格元素（<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/display"><code>display</code></a> 为 <code>grid</code> 或 <code>inline-grid</code> 元素的直接子元素）</li>
<li>多列容器（元素的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/column-count"><code>column-count</code></a> 或 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/CSS/column-width"><code>column-width</code> (en-US)</a> 不为 <code>auto，包括 ``column-count</code> 为 <code>1</code>）</li>
<li><code>column-span</code> 为 <code>all</code> 的元素始终会创建一个新的BFC，即使该元素没有包裹在一个多列容器中（<a target="_blank" rel="noopener" href="https://github.com/w3c/csswg-drafts/commit/a8634b96900279916bd6c505fda88dda71d8ec51">标准变更</a>，<a target="_blank" rel="noopener" href="https://bugs.chromium.org/p/chromium/issues/detail?id=709362">Chrome bug</a>）。</li>
</ul>
<p>块格式化上下文包含创建它的元素内部的所有内容.</p>
<p>块格式化上下文对浮动定位（参见 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/float"><code>float</code></a>）与清除浮动（参见 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/clear"><code>clear</code></a>）都很重要。浮动定位和清除浮动时只会应用于同一个BFC内的元素。浮动不会影响其它BFC中元素的布局，而清除浮动只能清除同一BFC中在它前面的元素的浮动。外边距折叠（<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Box_Model/Mastering_margin_collapsing">Margin collapsing</a>）也只会发生在属于同一BFC的块级元素之间。</p>
<p>规则:</p>
<ul>
<li>属于同一个 BFC 的两个相邻 Box 垂直排列</li>
<li>属于同一个 BFC 的两个相邻 Box 的 margin 会发生重叠</li>
<li>BFC 中子元素的 margin box 的左边， 与包含块 (BFC) border box的左边相接触 (子元素 absolute 除外)</li>
<li>BFC 的区域不会与 float 的元素区域重叠 自适应两栏布局</li>
<li><img src="/md-images/%E9%9D%A2%E8%AF%95/assets/%E5%B8%B8%E7%94%A8%E6%A6%82%E5%BF%B5/v2-5ebd48f09fac875f0bd25823c76ba7fa_720w.png" alt="img"></li>
<li>计算 BFC 的高度时，浮动子元素也参与计算</li>
<li>文字层不会被浮动层覆盖，环绕于周围</li>
</ul>
<p>应用:</p>
<ul>
<li>阻止<code>margin</code>重叠</li>
<li>可以包含浮动元素 —— 清除内部浮动(清除浮动的原理是两个<code>div</code>都位于同一个 BFC 区域之中)</li>
<li>自适应两栏布局</li>
<li>可以阻止元素被浮动元素覆盖</li>
</ul>
<p>可以参考<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/25321647">知乎</a></p>
<h2 id="同源的定义"><a href="#同源的定义" class="headerlink" title="同源的定义"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy#%E5%90%8C%E6%BA%90%E7%9A%84%E5%AE%9A%E4%B9%89"><strong>同源</strong>的<strong>定义</strong></a></h2><p>如果两个 URL 的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Glossary/Protocol">protocol</a>、<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Glossary/Port">port (en-US)</a> (如果有指定的话)和 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Glossary/Host">host</a> 都相同的话，则这两个 URL 是<em>同源</em>。这个方案也被称为“协议&#x2F;主机&#x2F;端口元组”，或者直接是 “元组”。（“元组” 是指一组项目构成的整体，双重&#x2F;三重&#x2F;四重&#x2F;五重&#x2F;等的通用形式）。</p>
<p>下表给出了与 URL <code>http://store.company.com/dir/page.html</code> 的源进行对比的示例:</p>
<table>
<thead>
<tr>
<th align="left">URL</th>
<th align="left">结果</th>
<th align="right">原因</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>http://store.company.com/dir2/other.html</code></td>
<td align="left">同源</td>
<td align="right">只有路径不同</td>
</tr>
<tr>
<td align="left"><code>http://store.company.com/dir/inner/another.html</code></td>
<td align="left">同源</td>
<td align="right">只有路径不同</td>
</tr>
<tr>
<td align="left"><code>https://store.company.com/secure.html</code></td>
<td align="left">失败</td>
<td align="right">协议不同</td>
</tr>
<tr>
<td align="left"><code>http://store.company.com:81/dir/etc.html</code></td>
<td align="left">失败</td>
<td align="right">端口不同 ( <code>http://</code> 默认端口是80)</td>
</tr>
<tr>
<td align="left"><code>http://news.company.com/dir/other.html</code></td>
<td align="left">失败</td>
<td align="right">主机不同</td>
</tr>
</tbody></table>
<blockquote>
<p>Cookie中的「同站」判断就比较宽松：只要两个 URL 的 eTLD+1 相同即可，不需要考虑协议和端口。其中，eTLD 表示有效顶级域名，注册于 Mozilla 维护的公共后缀列表（Public Suffix List）中，例如，.com、.co.uk、.github.io 等。eTLD+1 则表示，有效顶级域名+二级域名，例如 taobao.com 等。</p>
</blockquote>
<h2 id="withCredentials"><a href="#withCredentials" class="headerlink" title="withCredentials"></a>withCredentials</h2><p><code>withCredentials</code>是<code>XMLHttpRequest</code>的一个属性，表示跨域请求是否提供凭据信息(cookie、HTTP认证及客户端SSL证明等)</p>
<p>实际中用途就是跨域请求是要不要携带cookie</p>
<p>在<code>samesite</code>默认为<code>lax</code>的<code>chrome</code>80+，只设置<code>withCredentials</code>已经没用了</p>
<h2 id="位-bit-字节-Byte"><a href="#位-bit-字节-Byte" class="headerlink" title="位(bit) &amp; 字节(Byte)"></a>位(bit) &amp; 字节(Byte)</h2><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/7002088412903637022#heading-2">详细</a></p>
<h3 id="bit"><a href="#bit" class="headerlink" title="bit"></a>bit</h3><p>1位二进制数，也就是1bit，有2种可能，可以表示数0,1 <strong>也就是开关状态 是计算机的存储基础</strong></p>
<p>2位二进制数，2bit，有4种可能(2x2)，可以表示数0,1,2,3</p>
<p>3位二进制数,3bit，有8种可能(2x2x2)，可以表示数0,1,2,3,4,5,6,7</p>
<h3 id="Byte"><a href="#Byte" class="headerlink" title="Byte"></a>Byte</h3><p>大B，表示字节</p>
<p>1Byte &#x3D; 8 bit, 2^8是256，1个字节能表示的数就是0-255,共256种可能性。</p>
<h2 id="Unicode编码"><a href="#Unicode编码" class="headerlink" title="Unicode编码"></a>Unicode编码</h2><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6844903590155272199#heading-3">摘抄</a></p>
<p> Unicode（统一码、万国码、单一码）是计算机科学领域里的一项业界标准,包括字符集、编码方案等。Unicode 是为了解决传统的字符编码方案的局限而产生的，它为每种语言中的每个字符设定了统一并且唯一的二进制编码，以满足跨语言、跨平台进行文本转换、处理的要求。</p>
<h3 id="UTF-8"><a href="#UTF-8" class="headerlink" title="UTF-8"></a>UTF-8</h3><p>UTF-8（<strong>8-bit Unicode Transformation Format</strong>）是一种针对Unicode的可变长度字符编码，又称万国码。UTF-8 <strong>用1到6个字节编码Unicode字符</strong>。用在网页上可以统一页面显示中文简体繁体及其它语言（如英文，日文，韩文）。</p>
<blockquote>
<p>UTF-8是一种非常通用的<strong>可变长</strong>字符编码方式</p>
<p>像UTF-8里面，<a target="_blank" rel="noopener" href="http://ascii.wjccx.com/">ASCII</a>所表示的字符集就是用1 Byte来表示，而大部分汉字则是用3 Byte来表示。</p>
</blockquote>
<h3 id="UTF-16"><a href="#UTF-16" class="headerlink" title="UTF-16"></a>UTF-16</h3><blockquote>
<p>UTF-16 Unicode字符编码五层次模型的第三层：字符编码表（Character Encoding Form，也称为 “storage format”）的一种实现方式。即把Unicode字符集的抽象码位映射为16位长的二进制整数（即码元， 长度为2 Byte）的序列，用于数据存储或传递。Unicode字符的码位，需要1个或者2个16位长的码元(2字节或者4字节)来表示，因此这是一个变长表示。</p>
</blockquote>
<p>引用维基百科中对于UTF-16编码的解释我们可以知道，UTF-16最少也会用2 Byte来表示一个字符，因此没有办法兼容ASCII编码（ASCII编码使用1 Byte来进行存储）。</p>
<h3 id="JS中的string"><a href="#JS中的string" class="headerlink" title="JS中的string"></a>JS中的string</h3><p>在JavaScript中，所有的string类型（或者被称为DOMString）都是使用UTF-16编码的。</p>
<p>因此，当我们需要转换成二进制与后端进行通信时，需要注意相关的编码方式。</p>
<h2 id="性能指标"><a href="#性能指标" class="headerlink" title="性能指标"></a>性能指标</h2><p>在chrome的devtools里有很多性能指标，下面简单介绍一下这些指标</p>
<p>首先是可以在chrome的performance中标识的指标</p>
<ul>
<li><p>DCL (DOMContentLoaded Event)</p>
<ul>
<li>当初始的 <strong>HTML</strong> 文档被完全加载和解析完成之后，**<code>DOMContentLoaded</code>** 事件被触发，而无需等待样式表、图像和子框架的完全加载。(MDN的概念)</li>
<li>更加清晰的结论是，DOMContentLoaded 事件在 html文档加载完毕，并且 html 所引用的内联 js、以及外链 js 的<strong>同步</strong>代码都执行完毕后触发。</li>
</ul>
</li>
<li><p>L (Onload Event)</p>
<ul>
<li><strong>load</strong> 应该仅用于检测一个完全加载的页面 当一个资源及其依赖资源已完成加载时，将触发load事件</li>
<li>更加清晰的结论是，当页面 DOM 结构中的 js、css、图片，以及 js 异步加载的 js、css 、图片都加载完成之后，才会触发 load 事件。</li>
</ul>
<blockquote>
<p>页面中引用的 js 代码如果有异步加载的 js、css、图片，是会影响 load 事件触发的。<br>video、audio、flash 不会影响 load 事件触发。</p>
</blockquote>
</li>
<li><p>FP (First Paint)</p>
<ul>
<li><code>首次绘制</code>: 标记浏览器渲染任何在视觉上不同于导航前屏幕内容之内容的时间点，<strong>简而言之就是浏览器第一次发生变化的时间</strong></li>
</ul>
</li>
<li><p>FCP (First Contentful Paint)</p>
<ul>
<li><code>首次内容绘制</code> 标记浏览器渲染来自 DOM 第一位内容的时间点，该内容可能是文本、图像、SVG 甚至 元素.</li>
</ul>
</li>
<li><p>LCP (Largest Contentful Paint)</p>
<ul>
<li><code>最大内容渲染</code>: 代表在viewport中最大的页面元素加载的时间. LCP的数据会通过PerformanceEntry对象记录, 每次出现更大的内容渲染, 则会产生一个新的PerformanceEntry对象.(2019年11月新增)</li>
</ul>
</li>
</ul>
<p>然后是在性能分析 lighthouse中出现的六个指标,前两个在performance中也存在</p>
<ul>
<li>FCP (First Contentful Paint)</li>
<li>LCP (Largest Contentful Paint)</li>
<li>SI (Speed Index)<ul>
<li>指标用于显示页面可见部分的显示速度, 单位是时间</li>
</ul>
</li>
<li>TTI (Time to Interactive)<ul>
<li><code>可交互时间</code>: 指标用于标记应用已进行视觉渲染并能可靠响应用户输入的时间点.</li>
</ul>
</li>
<li>TBT (Total Blocking Time)<ul>
<li><code>页面阻塞总时长</code>: TBT汇总所有加载过程中阻塞用户操作的时长，在FCP和TTI之间任何long task中阻塞部分都会被汇总（超过50ms的长任务）</li>
</ul>
</li>
<li>CLS (Cumulative Layout Shift)<ul>
<li><code>累积布局偏移</code>: 总结起来就是一个元素初始时和其hidden之间的任何时间如果元素偏移了, 则会被计算进去，说简单点就是用户不期望的元素位置偏移。</li>
<li>根据 Google 的介绍，CLS 问题产生的原因一般包括：<ul>
<li>图片没有宽高</li>
<li>无尺寸的广告、嵌入式和iframes</li>
<li>动态注入的内容</li>
<li>导致FOIT&#x2F;FOUT的Web字体</li>
<li>在更新DOM之前等待网络响应的操作</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="对象获取属性的方法"><a href="#对象获取属性的方法" class="headerlink" title="对象获取属性的方法"></a>对象获取属性的方法</h2><table>
<thead>
<tr>
<th align="center">方法</th>
<th align="center">不可枚举属性</th>
<th align="center">继承属性</th>
<th align="center">symbol属性</th>
<th align="center">自身属性</th>
</tr>
</thead>
<tbody><tr>
<td align="center">in</td>
<td align="center">✅</td>
<td align="center">✅</td>
<td align="center">✅</td>
<td align="center">✅</td>
</tr>
<tr>
<td align="center">for…in</td>
<td align="center">❌</td>
<td align="center">✅</td>
<td align="center">❌</td>
<td align="center">✅</td>
</tr>
<tr>
<td align="center">JSON.stringfy()</td>
<td align="center">❌</td>
<td align="center">❌</td>
<td align="center">❌</td>
<td align="center">✅</td>
</tr>
<tr>
<td align="center">Object.assign()</td>
<td align="center">❌</td>
<td align="center">❌</td>
<td align="center">✅</td>
<td align="center">✅</td>
</tr>
<tr>
<td align="center">… 扩展运算符</td>
<td align="center">❌</td>
<td align="center">❌</td>
<td align="center">✅</td>
<td align="center">✅</td>
</tr>
<tr>
<td align="center">Object.keys()、Object.values()、Object.entries()</td>
<td align="center">❌</td>
<td align="center">❌</td>
<td align="center">❌</td>
<td align="center">✅</td>
</tr>
<tr>
<td align="center">Object.getOwnPropertyNames()</td>
<td align="center">✅</td>
<td align="center">❌</td>
<td align="center">❌</td>
<td align="center">✅</td>
</tr>
<tr>
<td align="center">Object.getOwnPropertySymbols(obj)</td>
<td align="center">❌</td>
<td align="center">❌</td>
<td align="center">✅</td>
<td align="center">❌</td>
</tr>
<tr>
<td align="center">Reflect.ownKeys(obj)</td>
<td align="center">✅</td>
<td align="center">❌</td>
<td align="center">✅</td>
<td align="center">✅</td>
</tr>
<tr>
<td align="center">Object.getOwnPropertyDescriptor(s)</td>
<td align="center">✅</td>
<td align="center">❌</td>
<td align="center">✅</td>
<td align="center">✅</td>
</tr>
</tbody></table>
<h2 id="寄生组合继承"><a href="#寄生组合继承" class="headerlink" title="寄生组合继承"></a>寄生组合继承</h2><p> <strong>避免二次调用父的prototype</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"> // 父</span><br><span class="line"> function SuperType(name) &#123;</span><br><span class="line">   this.name = name;</span><br><span class="line">   this.colors = [&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;];</span><br><span class="line"> &#125;</span><br><span class="line"> SuperType.prototype.sayName = function () &#123;</span><br><span class="line">   console.log(this.name);</span><br><span class="line"> &#125;;</span><br><span class="line"></span><br><span class="line">// 借助辅助原型函数链接到父prototype</span><br><span class="line">function object(o) &#123; </span><br><span class="line">   function F() &#123;&#125; </span><br><span class="line">   F.prototype = o; </span><br><span class="line">   return new F(); </span><br><span class="line"> &#125;</span><br><span class="line"> // 保证正确的construct，将只prototype链接到辅助原型函数上的实例上</span><br><span class="line"> function inheritPrototype(subType, superType) &#123;</span><br><span class="line">   let prototype = object(superType.prototype); // 创建对象</span><br><span class="line">   prototype.constructor = subType; // 增强对象 </span><br><span class="line">   subType.prototype = prototype; // 赋值对象</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line">// 继承</span><br><span class="line"> function SubType(name, age) &#123;</span><br><span class="line">  // 一</span><br><span class="line">   SuperType.call(this, name);</span><br><span class="line">   this.age = age;</span><br><span class="line"> &#125;</span><br><span class="line"> // 二</span><br><span class="line"> inheritPrototype(SubType, SuperType);</span><br><span class="line"> </span><br><span class="line"> SubType.prototype.sayAge = function () &#123;</span><br><span class="line">   console.log(this.age);</span><br><span class="line"> &#125;;</span><br><span class="line"> var child = new SubType(&quot;头疼&quot;, 30)</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mst123.github.io/webpack/HMR/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luopo.gif">
      <meta itemprop="name" content="马农">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="博客">
      <meta itemprop="description" content="学习记录">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/webpack/HMR/" class="post-title-link" itemprop="url">webpack热更新</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-07-13 13:13:38" itemprop="dateCreated datePublished" datetime="2024-07-13T13:13:38+08:00">2024-07-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/webpack/" itemprop="url" rel="index"><span itemprop="name">webpack</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><code>Hot Module Replacement</code>，简称<code>HMR</code>，无需完全刷新整个页面的同时，更新模块。<code>HMR</code>的好处，在日常开发工作中体会颇深：<strong>节省宝贵的开发时间、提升开发体验</strong>。</p>
<p>在这里简单介绍一个 HMR 的原理</p>
<h3 id="HMR-初始化"><a href="#HMR-初始化" class="headerlink" title="HMR 初始化"></a>HMR 初始化</h3><h4 id="webpack-dev-server"><a href="#webpack-dev-server" class="headerlink" title="webpack-dev-server"></a>webpack-dev-server</h4><p>Webpack-dev-server 的执行过程，其实也是一个 HMR 开启的过程</p>
<ul>
<li><p>修改 webpackOptions，添加两个入口文件，一个是 websocket 客户端代码，一个是热更新客户端代码(主要是用于检查更新逻辑)。</p>
</li>
<li><p>启动<code>webpack</code>，生成<code>compiler</code>实例。<code>compiler</code>上有很多方法，比如可以启动 <code>webpack</code> 所有<strong>编译</strong>工作，以及<strong>监听</strong>本地文件的变化。</p>
</li>
<li><p>使用<code>express</code>框架启动本地<code>server</code>，让浏览器可以请求本地的<strong>静态资源</strong>。</p>
<ul>
<li>启动 server 的时候，监听 compiler 的 done 事件，当监听到一次<code>webpack</code>编译结束，就会调用<code>_sendStats</code>方法通过<code>websocket</code>给浏览器发送通知，<code>ok</code>和<code>hash</code>事件，这样浏览器就可以拿到最新的<code>hash</code>值了，做检查更新逻辑</li>
<li>生成 <strong>webpack-dev-middleware</strong> 中间件实例，保存在 this.middleware（主要是本地文件的<strong>编译</strong>和<strong>输出</strong>以及<strong>监听</strong>）</li>
</ul>
</li>
<li><p>本地<code>server</code>启动之后，再去启动<code>websocket</code>服务，通过<code>websocket</code>，可以建立本地服务和浏览器的双向通信。这样就可以实现当本地文件发生变化，立马告知浏览器可以热更新代码啦！</p>
</li>
</ul>
<h4 id="webpack-dev-middleware"><a href="#webpack-dev-middleware" class="headerlink" title="webpack-dev-middleware"></a>webpack-dev-middleware</h4><p>文件相关的操作都抽离到<code>webpack-dev-middleware</code>库了，主要是本地文件的<strong>编译</strong>和<strong>输出</strong>以及<strong>监听</strong></p>
<p>主要流程都在下述代码中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">share.setOptions(context.options);</span><br><span class="line">share.setFs(context.compiler);</span><br><span class="line"></span><br><span class="line">context.compiler.plugin(&quot;done&quot;, share.compilerDone);</span><br><span class="line">context.compiler.plugin(&quot;invalid&quot;, share.compilerInvalid);</span><br><span class="line">context.compiler.plugin(&quot;watch-run&quot;, share.compilerInvalid);</span><br><span class="line">context.compiler.plugin(&quot;run&quot;, share.compilerInvalid);</span><br><span class="line"></span><br><span class="line">share.startWatch();</span><br></pre></td></tr></table></figure>

<ul>
<li>初始化配置，利用<code>memory-fs</code>库将文件打包到内存中(访问文件系统中的文件更快，而且也减少了代码写入文件的开销)</li>
<li>注册一系列事件。</li>
<li>开启对本地文件的监听，当文件发生变化，重新编译，编译完成之后继续监听</li>
</ul>
<h3 id="一次完整的-HMR-流程"><a href="#一次完整的-HMR-流程" class="headerlink" title="一次完整的 HMR 流程"></a>一次完整的 HMR 流程</h3><ol>
<li><p>当文件发生变化，就触发重新编译。当监听到一次<code>webpack</code>编译结束，<code>_sendStats</code>方法就通过<code>websoket</code>给浏览器发送通知</p>
<ol>
<li><code>hash</code>事件，更新最新一次打包后的<code>hash</code>值</li>
<li><code>ok</code>事件，进行热更新检查</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">this.sockWrite(sockets, &#x27;hash&#x27;, stats.hash);</span><br><span class="line"> if (stats.errors.length &gt; 0) &#123;</span><br><span class="line">  this.sockWrite(sockets, &#x27;errors&#x27;, stats.errors);</span><br><span class="line"> &#125; else if (stats.warnings.length &gt; 0) &#123;</span><br><span class="line">  this.sockWrite(sockets, &#x27;warnings&#x27;, stats.warnings);</span><br><span class="line"> &#125; else &#123; this.sockWrite(sockets, &#x27;ok&#x27;); &#125;</span><br></pre></td></tr></table></figure>

<p><img src="/md-images/webpack/assets/HMR/image-20220111134320575.png" alt="image-20220111134320575"></p>
</li>
<li><p>客户端接受到 ws 消息后，<code>hash</code>事件更新当前<code>hash</code>值，ok 事件触发<code>hotEmitter</code></p>
</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// webpack-dev-server/client/index.js</span><br><span class="line">var socket = require(&#x27;./socket&#x27;);</span><br><span class="line">var onSocketMessage = &#123;</span><br><span class="line">    hash: function hash(_hash) &#123;</span><br><span class="line">        // 更新currentHash值</span><br><span class="line">        status.currentHash = _hash;</span><br><span class="line">    &#125;,</span><br><span class="line">    ok: function ok() &#123;</span><br><span class="line">        sendMessage(&#x27;Ok&#x27;);</span><br><span class="line">        // 进行更新检查等操作</span><br><span class="line">        reloadApp(options, status);</span><br><span class="line">    &#125;,</span><br><span class="line">&#125;;</span><br><span class="line">// 连接服务地址socketUrl，?http://localhost:8080，本地服务地址</span><br><span class="line">socket(socketUrl, onSocketMessage);</span><br><span class="line"></span><br><span class="line">function reloadApp() &#123;</span><br><span class="line"> if (hot) &#123;</span><br><span class="line">        log.info(&#x27;[WDS] App hot update...&#x27;);</span><br><span class="line"></span><br><span class="line">        // hotEmitter其实就是EventEmitter的实例</span><br><span class="line">        var hotEmitter = require(&#x27;webpack/hot/emitter&#x27;);</span><br><span class="line">        hotEmitter.emit(&#x27;webpackHotUpdate&#x27;, currentHash);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>web-dev-server 插入的客户端的另一个入口文件 <code>webpack/hot/dev-server.js</code>，监听<code>hotEmitter</code>事件，进行热更新检查 <code>check</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// webpack/hot/dev-server.js</span><br><span class="line">var check = function check() &#123;</span><br><span class="line">  // 热更新核心代码</span><br><span class="line">    module.hot.check(true)</span><br><span class="line">        .then(function(updatedModules) &#123;</span><br><span class="line">            // 容错，直接刷新页面</span><br><span class="line">            if (!updatedModules) &#123;</span><br><span class="line">                window.location.reload();</span><br><span class="line">                return;</span><br><span class="line">            &#125;</span><br><span class="line">            // 热更新结束，打印信息</span><br><span class="line">            if (upToDate()) &#123;</span><br><span class="line">                log(&quot;info&quot;, &quot;[HMR] App is up to date.&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">        .catch(function(err) &#123;</span><br><span class="line">            window.location.reload();</span><br><span class="line">        &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">var hotEmitter = require(&quot;./emitter&quot;);</span><br><span class="line">hotEmitter.on(&quot;webpackHotUpdate&quot;, function(currentHash) &#123;</span><br><span class="line">    lastHash = currentHash;</span><br><span class="line">    check();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>check</code>代码<code>module.hot.check</code>在<code>HotModuleReplacementPlugin.runtime.js</code>中</p>
<p><code>hotCheck</code>主要做了三件事</p>
<ol>
<li><p>利用上一次保存的<code>hash</code>值，调用<code>hotDownloadManifest</code>发送<code>xxx/hash.hot-update.json</code>的<code>ajax</code>请求；</p>
</li>
<li><p>请求结果获取热更新模块，以及下次热更新的<code>Hash</code> 标识，并进入热更新准备阶段。</p>
</li>
<li><p>调用<code>hotDownloadUpdateChunk</code>发送<code>xxx/hash.hot-update.js</code> 请求，通过<code>JSONP</code>方式。</p>
<p><img src="/md-images/webpack/assets/HMR/16ec04316d6ac5e3~tplv-t2oaga2asx-watermark.gif" alt="img"></p>
</li>
<li><p>返回结果后，要立即执行<code>webpackHotUpdate</code>这个方法。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">window[&quot;webpackHotUpdate&quot;] = function (chunkId, moreModules) &#123;</span><br><span class="line">    hotAddUpdateChunk(chunkId, moreModules);</span><br><span class="line">&#125; ;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>hotAddUpdateChunk</code>方法<strong>会把更新的模块</strong><code>moreModules</code>赋值给全局全量<code>hotUpdate</code>。</p>
</li>
<li><p><code>hotUpdateDownloaded</code>方法会调用<code>hotApply</code>进行代码的替换。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function hotAddUpdateChunk(chunkId, moreModules) &#123;</span><br><span class="line">    // 更新的模块moreModules赋值给全局全量hotUpdate</span><br><span class="line">    for (var moduleId in moreModules) &#123;</span><br><span class="line">        if (Object.prototype.hasOwnProperty.call(moreModules, moduleId)) &#123;</span><br><span class="line">        hotUpdate[moduleId] = moreModules[moduleId];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // 调用hotApply进行模块的替换</span><br><span class="line">    hotUpdateDownloaded();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>hotApply 热更新模块替换</p>
<ol>
<li>删除过期的模块，就是需要替换的模块</li>
</ol>
<p>通过<code>hotUpdate</code>可以找到旧模块</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">var queue = outdatedModules.slice();</span><br><span class="line">while (queue.length &gt; 0) &#123;</span><br><span class="line">    moduleId = queue.pop();</span><br><span class="line">    // 从缓存中删除过期的模块</span><br><span class="line">    module = installedModules[moduleId];</span><br><span class="line">    // 删除过期的依赖</span><br><span class="line">    delete outdatedDependencies[moduleId];</span><br><span class="line"></span><br><span class="line">    // 存储了被删掉的模块id，便于更新代码</span><br><span class="line">    outdatedSelfAcceptedModules.push(&#123;</span><br><span class="line">        module: moduleId</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>将新的模块添加到 modules 中</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">appliedUpdate[moduleId] = hotUpdate[moduleId];</span><br><span class="line">for (moduleId in appliedUpdate) &#123;</span><br><span class="line">    if (Object.prototype.hasOwnProperty.call(appliedUpdate, moduleId)) &#123;</span><br><span class="line">        modules[moduleId] = appliedUpdate[moduleId];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">复制代码</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>通过<strong>webpack_require</strong>执行相关模块的代码</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">for (i = 0; i &lt; outdatedSelfAcceptedModules.length; i++) &#123;</span><br><span class="line">    var item = outdatedSelfAcceptedModules[i];</span><br><span class="line">    moduleId = item.module;</span><br><span class="line">    try &#123;</span><br><span class="line">        // 执行最新的代码</span><br><span class="line">        __webpack_require__(moduleId);</span><br><span class="line">    &#125; catch (err) &#123;</span><br><span class="line">        // ...容错处理</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mst123.github.io/vue/diff%E7%AE%97%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luopo.gif">
      <meta itemprop="name" content="马农">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="博客">
      <meta itemprop="description" content="学习记录">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/vue/diff%E7%AE%97%E6%B3%95/" class="post-title-link" itemprop="url">diff算法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-07-13 13:13:38" itemprop="dateCreated datePublished" datetime="2024-07-13T13:13:38+08:00">2024-07-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-07-18 16:49:32" itemprop="dateModified" datetime="2024-07-18T16:49:32+08:00">2024-07-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/vue/" itemprop="url" rel="index"><span itemprop="name">vue</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><strong>转载至</strong> <a target="_blank" rel="noopener" href="https://github.com/aooy/blog/issues/2">blog</a><br>diff 算法 也可以参考<a target="_blank" rel="noopener" href="https://juejin.cn/book/6844733705089449991/section/6844733705232056328">掘金小册</a></p>
<h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><ul>
<li>前言</li>
<li>virtual dom</li>
<li>分析diff</li>
<li>总结</li>
</ul>
<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>vue2.0加入了virtual dom，有向react靠拢的意思。vue的diff位于<a target="_blank" rel="noopener" href="https://github.com/vuejs/vue/blob/dev/src/core/vdom/patch.js">patch.js</a>文件中，我的一个小框架<a target="_blank" rel="noopener" href="https://github.com/aooy/aoy">aoy</a>也同样使用此算法，该算法来源于<a target="_blank" rel="noopener" href="https://github.com/snabbdom/snabbdom">snabbdom</a>，复杂度为O(n)。<br>了解diff过程可以让我们更高效的使用框架。<br>本文力求以图文并茂的方式来讲明这个diff的过程。</p>
<h1 id="virtual-dom"><a href="#virtual-dom" class="headerlink" title="virtual dom"></a>virtual dom</h1><p>如果不了解virtual dom，要理解diff的过程是比较困难的。虚拟dom对应的是真实dom， 使用<code>document.CreateElement</code> 和 <code>document.CreateTextNode</code>创建的就是真实节点。</p>
<p>我们可以做个试验。打印出一个空元素的第一层属性，可以看到标准让元素实现的东西太多了。如果每次都重新生成新的元素，对性能是巨大的浪费。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var mydiv = document.createElement(&#x27;div&#x27;);</span><br><span class="line">for(var k in mydiv )&#123;</span><br><span class="line">  console.log(k)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>virtual dom就是解决这个问题的一个思路，到底什么是virtual dom呢？通俗易懂的来说就是用一个简单的对象去代替复杂的dom对象。<br>举个简单的例子，我们在body里插入一个class为a的div。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var mydiv = document.createElement(&#x27;div&#x27;);</span><br><span class="line">mydiv.className = &#x27;a&#x27;;</span><br><span class="line">document.body.appendChild(mydiv);</span><br></pre></td></tr></table></figure>

<p>对于这个div我们可以用一个简单的对象<code>mydivVirtual</code>代表它，它存储了对应dom的一些重要参数，在改变dom之前，会先比较相应虚拟dom的数据，如果需要改变，才会将改变应用到真实dom上。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//伪代码</span><br><span class="line">var mydivVirtual = &#123; </span><br><span class="line">  tagName: &#x27;DIV&#x27;,</span><br><span class="line">  className: &#x27;a&#x27;</span><br><span class="line">&#125;;</span><br><span class="line">var newmydivVirtual = &#123;</span><br><span class="line">   tagName: &#x27;DIV&#x27;,</span><br><span class="line">   className: &#x27;b&#x27;</span><br><span class="line">&#125;</span><br><span class="line">if(mydivVirtual.tagName !== newmydivVirtual.tagName || mydivVirtual.className  !== newmydivVirtual.className)&#123;</span><br><span class="line">   change(mydiv)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 会执行相应的修改 mydiv.className = &#x27;b&#x27;;</span><br><span class="line">//最后  &lt;div class=&#x27;b&#x27;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h4 id="读到这里就会产生一个疑问，为什么不直接修改dom而需要加一层virtual-dom呢？"><a href="#读到这里就会产生一个疑问，为什么不直接修改dom而需要加一层virtual-dom呢？" class="headerlink" title="读到这里就会产生一个疑问，为什么不直接修改dom而需要加一层virtual dom呢？"></a>读到这里就会产生一个疑问，为什么不直接修改dom而需要加一层virtual dom呢？</h4><p>很多时候手工优化dom确实会比virtual dom效率高，对于比较简单的dom结构用手工优化没有问题，但当页面结构很庞大，结构很复杂时，手工优化会花去大量时间，而且可维护性也不高，不能保证每个人都有手工优化的能力。至此，virtual dom的解决方案应运而生，<strong>virtual dom很多时候都不是最优的操作，但它具有普适性，在效率、可维护性之间达平衡。</strong></p>
<p>virtual dom 另一个重大意义就是提供一个中间层，js去写ui，ios安卓之类的负责渲染，就像reactNative一样。</p>
<h1 id="分析diff"><a href="#分析diff" class="headerlink" title="分析diff"></a>分析diff</h1><p>一篇相当经典的文章<a target="_blank" rel="noopener" href="https://calendar.perfplanet.com/2013/diff/">React’s diff algorithm</a>中的图，react的diff其实和vue的diff大同小异。所以这张图能很好的解释过程。<strong>比较只会在同层级进行, 不会跨层级比较。</strong></p>
<p><a target="_blank" rel="noopener" href="https://github.com/aooy/blog/blob/master/images/issues-2/diff.png?raw=true"><img src="/md-images/vue/assets/diff%E7%AE%97%E6%B3%95/diff.png" alt="img"></a></p>
<p>举个形象的例子。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 之前 --&gt;</span><br><span class="line">&lt;div&gt;           &lt;!-- 层级1 --&gt;</span><br><span class="line">  &lt;p&gt;            &lt;!-- 层级2 --&gt;</span><br><span class="line">    &lt;b&gt; aoy &lt;/b&gt;   &lt;!-- 层级3 --&gt;   </span><br><span class="line">    &lt;span&gt;diff&lt;/Span&gt;</span><br><span class="line">  &lt;/P&gt; </span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 之后 --&gt;</span><br><span class="line">&lt;div&gt;            &lt;!-- 层级1 --&gt;</span><br><span class="line">  &lt;p&gt;             &lt;!-- 层级2 --&gt;</span><br><span class="line">      &lt;b&gt; aoy &lt;/b&gt;        &lt;!-- 层级3 --&gt;</span><br><span class="line">  &lt;/p&gt;</span><br><span class="line">  &lt;span&gt;diff&lt;/Span&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>我们可能期望将<code>&lt;span&gt;</code>直接移动到<code>&lt;p&gt;</code>的后边，这是最优的操作。但是实际的diff操作是移除<code>&lt;p&gt;</code>里的<code>&lt;span&gt;</code>在创建一个新的<code>&lt;span&gt;</code>插到<code>&lt;p&gt;</code>的后边。<br>因为新加的<code>&lt;span&gt;</code>在层级2，旧的在层级3，属于不同层级的比较。</p>
<h2 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h2><p>文中的代码位于<a target="_blank" rel="noopener" href="https://github.com/aooy/aoy/blob/master/src/vdom/diff.js">aoy-diff</a>中，已经精简了很多代码，留下最核心的部分。</p>
<p>diff的过程就是调用patch函数，就像打补丁一样修改真实dom。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function patch (oldVnode, vnode) &#123;</span><br><span class="line"> if (sameVnode(oldVnode, vnode)) &#123;</span><br><span class="line">  patchVnode(oldVnode, vnode)</span><br><span class="line"> &#125; else &#123;</span><br><span class="line">  const oEl = oldVnode.el</span><br><span class="line">  let parentEle = api.parentNode(oEl)</span><br><span class="line">  createEle(vnode)</span><br><span class="line">  if (parentEle !== null) &#123;</span><br><span class="line">   api.insertBefore(parentEle, vnode.el, api.nextSibling(oEl))</span><br><span class="line">   api.removeChild(parentEle, oldVnode.el)</span><br><span class="line">   oldVnode = null</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> return vnode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>patch</code>函数有两个参数，<code>vnode</code>和<code>oldVnode</code>，也就是新旧两个虚拟节点。在这之前，我们先了解完整的vnode都有什么属性，举个一个简单的例子:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// body下的 &lt;div id=&quot;v&quot; class=&quot;classA&quot;&gt;&lt;div&gt; 对应的 oldVnode 就是</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  el:  div  //对真实的节点的引用，本例中就是document.querySelector(&#x27;#id.classA&#x27;)</span><br><span class="line">  tagName: &#x27;DIV&#x27;,   //节点的标签</span><br><span class="line">  sel: &#x27;div#v.classA&#x27;  //节点的选择器</span><br><span class="line">  data: null,       // 一个存储节点属性的对象，对应节点的el[prop]属性，例如onclick , style</span><br><span class="line">  children: [], //存储子节点的数组，每个子节点也是vnode结构</span><br><span class="line">  text: null,    //如果是文本节点，对应文本节点的textContent，否则为null</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>需要注意的是，el属性引用的是此 virtual dom对应的真实dom，<code>patch</code>的<code>vnode</code>参数的<code>el</code>最初是null，因为<code>patch</code>之前它还没有对应的真实dom。</p>
<p>来到<code>patch</code>的第一部分，</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if (sameVnode(oldVnode, vnode)) &#123;</span><br><span class="line"> patchVnode(oldVnode, vnode)</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p><code>sameVnode</code>函数就是看这两个节点是否值得比较，代码相当简单：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function sameVnode(oldVnode, vnode)&#123;</span><br><span class="line"> return vnode.key === oldVnode.key &amp;&amp; vnode.sel === oldVnode.sel</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>两个vnode的key和sel相同才去比较它们，比如<code>p</code>和<code>span</code>，<code>div.classA</code>和<code>div.classB</code>都被认为是不同结构而不去比较它们。</p>
<p>如果值得比较会执行<code>patchVnode(oldVnode, vnode)</code>，稍后会详细讲<code>patchVnode</code>函数。</p>
<p>当节点不值得比较，进入else中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">else &#123;</span><br><span class="line">  const oEl = oldVnode.el</span><br><span class="line">  let parentEle = api.parentNode(oEl)</span><br><span class="line">  createEle(vnode)</span><br><span class="line">  if (parentEle !== null) &#123;</span><br><span class="line">   api.insertBefore(parentEle, vnode.el, api.nextSibling(oEl))</span><br><span class="line">   api.removeChild(parentEle, oldVnode.el)</span><br><span class="line">   oldVnode = null</span><br><span class="line">  &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>过程如下：</p>
<ul>
<li>取得<code>oldvnode.el</code>的父节点，<code>parentEle</code>是真实dom</li>
<li><code>createEle(vnode)</code>会为<code>vnode</code>创建它的真实dom，令<code>vnode.el</code> &#x3D;<code>真实dom</code></li>
<li><code>parentEle</code>将新的dom插入，移除旧的dom<br><strong>当不值得比较时，新节点直接把老节点整个替换了</strong></li>
</ul>
<p>最后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">return vnode</span><br></pre></td></tr></table></figure>

<p>patch最后会返回vnode，vnode和进入patch之前的不同在哪？<br>没错，就是vnode.el，<strong>唯一的改变就是之前vnode.el &#x3D; null, 而现在它引用的是对应的真实dom。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var oldVnode = patch (oldVnode, vnode)</span><br></pre></td></tr></table></figure>

<p>至此完成一个patch过程。</p>
<h3 id="patchVnode"><a href="#patchVnode" class="headerlink" title="patchVnode"></a>patchVnode</h3><p>两个节点值得比较时，会调用<code>patchVnode</code>函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">patchVnode (oldVnode, vnode) &#123;</span><br><span class="line">    const el = vnode.el = oldVnode.el</span><br><span class="line">    let i, oldCh = oldVnode.children, ch = vnode.children</span><br><span class="line">    if (oldVnode === vnode) return</span><br><span class="line">    if (oldVnode.text !== null &amp;&amp; vnode.text !== null &amp;&amp; oldVnode.text !== vnode.text) &#123;</span><br><span class="line">        api.setTextContent(el, vnode.text)</span><br><span class="line">    &#125;else &#123;</span><br><span class="line">        updateEle(el, vnode, oldVnode)</span><br><span class="line">     if (oldCh &amp;&amp; ch &amp;&amp; oldCh !== ch) &#123;</span><br><span class="line">      updateChildren(el, oldCh, ch)</span><br><span class="line">     &#125;else if (ch)&#123;</span><br><span class="line">      createEle(vnode) //create el&#x27;s children dom</span><br><span class="line">     &#125;else if (oldCh)&#123;</span><br><span class="line">      api.removeChildren(el)</span><br><span class="line">     &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>const el = vnode.el = oldVnode.el</code> 这是很重要的一步，让<code>vnode.el</code>引用到现在的真实dom，当<code>el</code>修改时，<code>vnode.el</code>会同步变化。</p>
<p>节点的比较有5种情况</p>
<ol>
<li><code>if (oldVnode === vnode)</code>，他们的引用一致，可以认为没有变化。</li>
<li><code>if(oldVnode.text !== null &amp;&amp; vnode.text !== null &amp;&amp; oldVnode.text !== vnode.text)</code>，文本节点的比较，需要修改，则会调用<code>Node.textContent = vnode.text</code>。</li>
<li><code>if( oldCh &amp;&amp; ch &amp;&amp; oldCh !== ch )</code>, 两个节点都有子节点，而且它们不一样，这样我们会调用<code>updateChildren</code>函数比较子节点，这是diff的核心，后边会讲到。</li>
<li><code>else if (ch)</code>，只有新的节点有子节点，调用<code>createEle(vnode)</code>，<code>vnode.el</code>已经引用了老的dom节点，<code>createEle</code>函数会在老dom节点上添加子节点。</li>
<li><code>else if (oldCh)</code>，新节点没有子节点，老节点有子节点，直接删除老节点。</li>
</ol>
<h3 id="updateChildren"><a href="#updateChildren" class="headerlink" title="updateChildren"></a>updateChildren</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">updateChildren (parentElm, oldCh, newCh) &#123;</span><br><span class="line">    let oldStartIdx = 0, newStartIdx = 0</span><br><span class="line">    let oldEndIdx = oldCh.length - 1</span><br><span class="line">    let oldStartVnode = oldCh[0]</span><br><span class="line">    let oldEndVnode = oldCh[oldEndIdx]</span><br><span class="line">    let newEndIdx = newCh.length - 1</span><br><span class="line">    let newStartVnode = newCh[0]</span><br><span class="line">    let newEndVnode = newCh[newEndIdx]</span><br><span class="line">    let oldKeyToIdx</span><br><span class="line">    let idxInOld</span><br><span class="line">    let elmToMove</span><br><span class="line">    let before</span><br><span class="line">    while (oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx) &#123;</span><br><span class="line">            if (oldStartVnode == null) &#123;   //对于vnode.key的比较，会把oldVnode = null</span><br><span class="line">                oldStartVnode = oldCh[++oldStartIdx] </span><br><span class="line">            &#125;else if (oldEndVnode == null) &#123;</span><br><span class="line">                oldEndVnode = oldCh[--oldEndIdx]</span><br><span class="line">            &#125;else if (newStartVnode == null) &#123;</span><br><span class="line">                newStartVnode = newCh[++newStartIdx]</span><br><span class="line">            &#125;else if (newEndVnode == null) &#123;</span><br><span class="line">                newEndVnode = newCh[--newEndIdx]</span><br><span class="line">            &#125;else if (sameVnode(oldStartVnode, newStartVnode)) &#123;</span><br><span class="line">                patchVnode(oldStartVnode, newStartVnode)</span><br><span class="line">                oldStartVnode = oldCh[++oldStartIdx]</span><br><span class="line">                newStartVnode = newCh[++newStartIdx]</span><br><span class="line">            &#125;else if (sameVnode(oldEndVnode, newEndVnode)) &#123;</span><br><span class="line">                patchVnode(oldEndVnode, newEndVnode)</span><br><span class="line">                oldEndVnode = oldCh[--oldEndIdx]</span><br><span class="line">                newEndVnode = newCh[--newEndIdx]</span><br><span class="line">            &#125;else if (sameVnode(oldStartVnode, newEndVnode)) &#123;</span><br><span class="line">                patchVnode(oldStartVnode, newEndVnode)</span><br><span class="line">                api.insertBefore(parentElm, oldStartVnode.el, api.nextSibling(oldEndVnode.el))</span><br><span class="line">                oldStartVnode = oldCh[++oldStartIdx]</span><br><span class="line">                newEndVnode = newCh[--newEndIdx]</span><br><span class="line">            &#125;else if (sameVnode(oldEndVnode, newStartVnode)) &#123;</span><br><span class="line">                patchVnode(oldEndVnode, newStartVnode)</span><br><span class="line">                api.insertBefore(parentElm, oldEndVnode.el, oldStartVnode.el)</span><br><span class="line">                oldEndVnode = oldCh[--oldEndIdx]</span><br><span class="line">                newStartVnode = newCh[++newStartIdx]</span><br><span class="line">            &#125;else &#123;</span><br><span class="line">               // 使用key时的比较</span><br><span class="line">                if (oldKeyToIdx === undefined) &#123;</span><br><span class="line">                    oldKeyToIdx = createKeyToOldIdx(oldCh, oldStartIdx, oldEndIdx) // 有key生成index表</span><br><span class="line">                &#125;</span><br><span class="line">                idxInOld = oldKeyToIdx[newStartVnode.key]</span><br><span class="line">                if (!idxInOld) &#123;</span><br><span class="line">                    api.insertBefore(parentElm, createEle(newStartVnode).el, oldStartVnode.el)</span><br><span class="line">                    newStartVnode = newCh[++newStartIdx]</span><br><span class="line">                &#125;</span><br><span class="line">                else &#123;</span><br><span class="line">                    elmToMove = oldCh[idxInOld]</span><br><span class="line">                    if (elmToMove.sel !== newStartVnode.sel) &#123;</span><br><span class="line">                        api.insertBefore(parentElm, createEle(newStartVnode).el, oldStartVnode.el)</span><br><span class="line">                    &#125;else &#123;</span><br><span class="line">                        patchVnode(elmToMove, newStartVnode)</span><br><span class="line">                        oldCh[idxInOld] = null</span><br><span class="line">                        api.insertBefore(parentElm, elmToMove.el, oldStartVnode.el)</span><br><span class="line">                    &#125;</span><br><span class="line">                    newStartVnode = newCh[++newStartIdx]</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        if (oldStartIdx &gt; oldEndIdx) &#123;</span><br><span class="line">            before = newCh[newEndIdx + 1] == null ? null : newCh[newEndIdx + 1].el</span><br><span class="line">            addVnodes(parentElm, before, newCh, newStartIdx, newEndIdx)</span><br><span class="line">        &#125;else if (newStartIdx &gt; newEndIdx) &#123;</span><br><span class="line">            removeVnodes(parentElm, oldCh, oldStartIdx, oldEndIdx)</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码很密集，为了形象的描述这个过程，可以看看这张图。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/aooy/blog/blob/master/images/issues-2/diff2.png?raw=true"><img src="/md-images/vue/assets/diff%E7%AE%97%E6%B3%95/diff2.png" alt="img"></a></p>
<p>过程可以概括为：<code>oldCh</code>和<code>newCh</code>各有两个头尾的变量<code>StartIdx</code>和<code>EndIdx</code>，它们的2个变量相互比较，一共有4种比较方式。如果4种比较都没匹配，如果设置了key，就会用key进行比较，在比较的过程中，变量会往中间靠，一旦<code>StartIdx&gt;EndIdx</code>表明<code>oldCh</code>和<code>newCh</code>至少有一个已经遍历完了，就会结束比较。</p>
<h3 id="具体的diff分析"><a href="#具体的diff分析" class="headerlink" title="具体的diff分析"></a>具体的diff分析</h3><p>设置key和不设置key的区别：<br><strong>不设key，newCh和oldCh只会进行头尾两端的相互比较，设key后，除了头尾两端的比较外，还会从用key生成的对象<code>oldKeyToIdx</code>中查找匹配的节点，所以为节点设置key可以更高效的利用dom。</strong></p>
<p>diff的遍历过程中，只要是对dom进行的操作都调用<code>api.insertBefore</code>，<code>api.insertBefore</code>只是原生<code>insertBefore</code>的简单封装。<br>比较分为两种，一种是有<code>vnode.key</code>的，一种是没有的。但这两种比较对真实dom的操作是一致的。</p>
<p>对于与<code>sameVnode(oldStartVnode, newStartVnode)</code>和<code>sameVnode(oldEndVnode,newEndVnode)</code>为true的情况，不需要对dom进行移动。</p>
<p>总结遍历过程，有3种dom操作：</p>
<ol>
<li>当<code>oldStartVnode</code>，<code>newEndVnode</code>值得比较，说明<code>oldStartVnode.el</code>跑到<code>oldEndVnode.el</code>的后边了。</li>
</ol>
<p>图中假设startIdx遍历到1。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/aooy/blog/blob/master/images/issues-2/diff3.png?raw=true"><img src="/md-images/vue/assets/diff%E7%AE%97%E6%B3%95/diff3.png" alt="img"></a></p>
<ol>
<li>当<code>oldEndVnode</code>，<code>newStartVnode</code>值得比较，说明 <code>oldEndVnode.el</code>跑到了<code>newStartVnode.el</code>的前边。（这里笔误，应该是“oldEndVnode.el跑到了oldStartVnode.el的前边”，准确的说应该是oldEndVnode.el需要移动到oldStartVnode.el的前边”）</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://github.com/aooy/blog/blob/master/images/issues-2/diff4.png?raw=true"><img src="/md-images/vue/assets/diff%E7%AE%97%E6%B3%95/diff4.png" alt="img"></a></p>
<ol>
<li>newCh中的节点oldCh里没有， 将新节点插入到<code>oldStartVnode.el</code>的前边。</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://github.com/aooy/blog/blob/master/images/issues-2/diff5.png?raw=true"><img src="/md-images/vue/assets/diff%E7%AE%97%E6%B3%95/diff5.png" alt="img"></a></p>
<p>在结束时，分为两种情况：</p>
<ol>
<li><code>oldStartIdx &gt; oldEndIdx</code>，可以认为<code>oldCh</code>先遍历完。当然也有可能<code>newCh</code>此时也正好完成了遍历，统一都归为此类。此时<code>newStartIdx</code>和<code>newEndIdx</code>之间的vnode是新增的，调用<code>addVnodes</code>，把他们全部插进<code>before</code>的后边，<code>before</code>很多时候是为null的。<code>addVnodes</code>调用的是<code>insertBefore</code>操作dom节点，我们看看<code>insertBefore</code>的文档：<code>parentElement.insertBefore(newElement, referenceElement)</code><br>如果referenceElement为null则newElement将被插入到子节点的末尾。如果newElement已经在DOM树中，newElement首先会从DOM树中移除。<strong>所以<code>before</code>为null，newElement将被插入到子节点的末尾。</strong></li>
</ol>
<p><a target="_blank" rel="noopener" href="https://github.com/aooy/blog/blob/master/images/issues-2/diff6.png?raw=true"><img src="/md-images/vue/assets/diff%E7%AE%97%E6%B3%95/diff6.png" alt="img"></a></p>
<ol>
<li><code>newStartIdx &gt; newEndIdx</code>，可以认为<code>newCh</code>先遍历完。此时<code>oldStartIdx</code>和<code>oldEndIdx</code>之间的vnode在新的子节点里已经不存在了，调用<code>removeVnodes</code>将它们从dom里删除。</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://github.com/aooy/blog/blob/master/images/issues-2/diff7.png?raw=true"><img src="/md-images/vue/assets/diff%E7%AE%97%E6%B3%95/diff7.png" alt="img"></a></p>
<h4 id="下面举个例子，画出diff完整的过程，每一步dom的变化都用不同颜色的线标出"><a href="#下面举个例子，画出diff完整的过程，每一步dom的变化都用不同颜色的线标出" class="headerlink" title="下面举个例子，画出diff完整的过程，每一步dom的变化都用不同颜色的线标出"></a>下面举个例子，画出diff完整的过程，每一步dom的变化都用不同颜色的线标出</h4><ol>
<li>a,b,c,d,e假设是4个不同的元素，我们没有设置key时，b没有复用，而是直接创建新的，删除旧的。</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://github.com/aooy/blog/blob/master/images/issues-2/diff8.png?raw=true"><img src="/md-images/vue/assets/diff%E7%AE%97%E6%B3%95/diff8.png" alt="img"></a></p>
<ol>
<li>当我们给4个元素加上唯一key时，b得到了的复用。</li>
</ol>
<p><a target="_blank" rel="noopener" href="https://github.com/aooy/blog/blob/master/images/issues-2/diff9.png?raw=true"><img src="/md-images/vue/assets/diff%E7%AE%97%E6%B3%95/diff9.png" alt="img"></a></p>
<p>这个例子如果我们使用手工优化，只需要3步就可以达到。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><ul>
<li>尽量不要跨层级的修改dom</li>
<li>设置key可以最大化的利用节点</li>
<li>diff的效率并不是每种情况下都是最优的</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mst123.github.io/javascript/JavaScript%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luopo.gif">
      <meta itemprop="name" content="马农">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="博客">
      <meta itemprop="description" content="学习记录">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/javascript/JavaScript%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC/" class="post-title-link" itemprop="url">JavaScript 风格指南</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-11-20 00:00:00" itemprop="dateCreated datePublished" datetime="2023-11-20T00:00:00+08:00">2023-11-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-07-13 14:54:40" itemprop="dateModified" datetime="2024-07-13T14:54:40+08:00">2024-07-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/javascript/" itemprop="url" rel="index"><span itemprop="name">javascript</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Original Repository: <a target="_blank" rel="noopener" href="https://github.com/ryanmcdermott/clean-code-javascript">ryanmcdermott&#x2F;clean-code-javascript</a></p>
<h1 id="JavaScript-风格指南"><a href="#JavaScript-风格指南" class="headerlink" title="JavaScript 风格指南"></a>JavaScript 风格指南</h1><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><ol>
<li><a href="#%E4%BB%8B%E7%BB%8D">介绍</a></li>
<li><a href="#%E5%8F%98%E9%87%8F">变量</a></li>
<li><a href="#%E5%87%BD%E6%95%B0">函数</a></li>
<li><a href="#objects-and-data-structures">对象和数据结构</a></li>
<li><a href="#%E7%B1%BB">类</a></li>
<li><a href="#%E6%B5%8B%E8%AF%95">测试</a></li>
<li><a href="#%E5%B9%B6%E5%8F%91">并发</a></li>
<li><a href="#%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86">错误处理</a></li>
<li><a href="#%E6%A0%BC%E5%BC%8F%E5%8C%96">格式化</a></li>
<li><a href="#%E6%B3%A8%E9%87%8A">注释</a></li>
</ol>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p><a target="_blank" rel="noopener" href="https://github.com/ryanmcdermott">作者</a>根据 Robert C. Martin <a target="_blank" rel="noopener" href="https://www.amazon.com/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882"><em>《代码整洁之道》</em></a>总结了适用于 JavaScript 的软件工程原则<a target="_blank" rel="noopener" href="https://github.com/ryanmcdermott/clean-code-javascript">《Clean Code JavaScript》</a>。</p>
<p>本文是对其的翻译。</p>
<p>不必严格遵守本文的所有原则，有时少遵守一些效果可能会更好，具体应根据实际情况决定。这是根据《代码整洁之道》作者多年经验整理的代码优化建议，但也仅仅只是一份建议。</p>
<p>软件工程已经发展了 50 多年，至今仍在不断前进。现在，把这些原则当作试金石，尝试将他们作为团队代码质量考核的标准之一吧。</p>
<p>最后你需要知道的是，这些东西不会让你立刻变成一个优秀的工程师，长期奉行他们也并不意味着你能够高枕无忧不再犯错。千里之行，始于足下。我们需要时常和同行们进行代码评审，不断优化自己的代码。不要惧怕改善代码质量所需付出的努力，加油。</p>
<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a><strong>变量</strong></h2><h3 id="使用有意义，可读性好的变量名"><a href="#使用有意义，可读性好的变量名" class="headerlink" title="使用有意义，可读性好的变量名"></a>使用有意义，可读性好的变量名</h3><p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> yyyymmdstr = <span class="title function_">moment</span>().<span class="title function_">format</span>(<span class="string">&#x27;YYYY/MM/DD&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> yearMonthDay = <span class="title function_">moment</span>().<span class="title function_">format</span>(<span class="string">&#x27;YYYY/MM/DD&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="使用-ES6-的-const-定义常量"><a href="#使用-ES6-的-const-定义常量" class="headerlink" title="使用 ES6 的 const 定义常量"></a>使用 ES6 的 const 定义常量</h3><p>反例中使用”var”定义的”常量”是可变的。</p>
<p>在声明一个常量时，该常量在整个程序中都应该是不可变的。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="variable constant_">FIRST_US_PRESIDENT</span> = <span class="string">&quot;George Washington&quot;</span>;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">FIRST_US_PRESIDENT</span> = <span class="string">&quot;George Washington&quot;</span>;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="对功能类似的变量名采用统一的命名风格"><a href="#对功能类似的变量名采用统一的命名风格" class="headerlink" title="对功能类似的变量名采用统一的命名风格"></a>对功能类似的变量名采用统一的命名风格</h3><p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getUserInfo</span>();</span><br><span class="line"><span class="title function_">getClientData</span>();</span><br><span class="line"><span class="title function_">getCustomerRecord</span>();</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getUser</span>();</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="使用易于检索名称"><a href="#使用易于检索名称" class="headerlink" title="使用易于检索名称"></a>使用易于检索名称</h3><p>我们需要阅读的代码远比自己写的要多，使代码拥有良好的可读性且易于检索非常重要。阅读变量名晦涩难懂的代码对读者来说是一种相当糟糕的体验。<br>让你的变量名易于检索。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 525600 是什么?</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">525600</span>; i++) &#123;</span><br><span class="line">  <span class="title function_">runCronJob</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Declare them as capitalized `var` globals.</span></span><br><span class="line"><span class="keyword">var</span> <span class="variable constant_">MINUTES_IN_A_YEAR</span> = <span class="number">525600</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="variable constant_">MINUTES_IN_A_YEAR</span>; i++) &#123;</span><br><span class="line">  <span class="title function_">runCronJob</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="使用说明变量-即有意义的变量名"><a href="#使用说明变量-即有意义的变量名" class="headerlink" title="使用说明变量(即有意义的变量名)"></a>使用说明变量(即有意义的变量名)</h3><p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> cityStateRegex = <span class="regexp">/^(.+)[,\\s]+(.+?)\s*(\d&#123;5&#125;)?$/</span>;</span><br><span class="line"><span class="title function_">saveCityState</span>(cityStateRegex.<span class="title function_">match</span>(cityStateRegex)[<span class="number">1</span>], cityStateRegex.<span class="title function_">match</span>(cityStateRegex)[<span class="number">2</span>]);</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">ADDRESS</span> = <span class="string">&#x27;One Infinite Loop, Cupertino 95014&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span> cityStateRegex = <span class="regexp">/^(.+)[,\\s]+(.+?)\s*(\d&#123;5&#125;)?$/</span>;</span><br><span class="line"><span class="keyword">var</span> match = <span class="variable constant_">ADDRESS</span>.<span class="title function_">match</span>(cityStateRegex)</span><br><span class="line"><span class="keyword">var</span> city = match[<span class="number">1</span>];</span><br><span class="line"><span class="keyword">var</span> state = match[<span class="number">2</span>];</span><br><span class="line"><span class="title function_">saveCityState</span>(city, state);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="不要绕太多的弯子"><a href="#不要绕太多的弯子" class="headerlink" title="不要绕太多的弯子"></a>不要绕太多的弯子</h3><p>显式优于隐式。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> locations = [<span class="string">&#x27;Austin&#x27;</span>, <span class="string">&#x27;New York&#x27;</span>, <span class="string">&#x27;San Francisco&#x27;</span>];</span><br><span class="line">locations.<span class="title function_">forEach</span>(<span class="function">(<span class="params">l</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">doStuff</span>();</span><br><span class="line">  <span class="title function_">doSomeOtherStuff</span>();</span><br><span class="line">  ...</span><br><span class="line">  ...</span><br><span class="line">  ...</span><br><span class="line">  <span class="comment">// l是什么？</span></span><br><span class="line">  <span class="title function_">dispatch</span>(l);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> locations = [<span class="string">&#x27;Austin&#x27;</span>, <span class="string">&#x27;New York&#x27;</span>, <span class="string">&#x27;San Francisco&#x27;</span>];</span><br><span class="line">locations.<span class="title function_">forEach</span>(<span class="function">(<span class="params">location</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">doStuff</span>();</span><br><span class="line">  <span class="title function_">doSomeOtherStuff</span>();</span><br><span class="line">  ...</span><br><span class="line">  ...</span><br><span class="line">  ...</span><br><span class="line">  <span class="title function_">dispatch</span>(location);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="避免重复的描述"><a href="#避免重复的描述" class="headerlink" title="避免重复的描述"></a>避免重复的描述</h3><p>当类&#x2F;对象名已经有意义时，对其变量进行命名不需要再次重复。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Car</span> = &#123;</span><br><span class="line">  <span class="attr">carMake</span>: <span class="string">&#x27;Honda&#x27;</span>,</span><br><span class="line">  <span class="attr">carModel</span>: <span class="string">&#x27;Accord&#x27;</span>,</span><br><span class="line">  <span class="attr">carColor</span>: <span class="string">&#x27;Blue&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">paintCar</span>(<span class="params">car</span>) &#123;</span><br><span class="line">  car.<span class="property">carColor</span> = <span class="string">&#x27;Red&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Car</span> = &#123;</span><br><span class="line">  <span class="attr">make</span>: <span class="string">&#x27;Honda&#x27;</span>,</span><br><span class="line">  <span class="attr">model</span>: <span class="string">&#x27;Accord&#x27;</span>,</span><br><span class="line">  <span class="attr">color</span>: <span class="string">&#x27;Blue&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">paintCar</span>(<span class="params">car</span>) &#123;</span><br><span class="line">  car.<span class="property">color</span> = <span class="string">&#x27;Red&#x27;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="避免无意义的条件判断"><a href="#避免无意义的条件判断" class="headerlink" title="避免无意义的条件判断"></a>避免无意义的条件判断</h3><p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createMicrobrewery</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> breweryName;</span><br><span class="line">  <span class="keyword">if</span> (name) &#123;</span><br><span class="line">    breweryName = name;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    breweryName = <span class="string">&#x27;Hipster Brew Co.&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createMicrobrewery</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> breweryName = name || <span class="string">&#x27;Hipster Brew Co.&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a><strong>函数</strong></h2><h3 id="函数参数-理想情况下应不超过-2-个"><a href="#函数参数-理想情况下应不超过-2-个" class="headerlink" title="函数参数 (理想情况下应不超过 2 个)"></a>函数参数 (理想情况下应不超过 2 个)</h3><p>限制函数参数数量很有必要，这么做使得在测试函数时更加轻松。过多的参数将导致难以采用有效的测试用例对函数的各个参数进行测试。</p>
<p>应避免三个以上参数的函数。通常情况下，参数超过两个意味着函数功能过于复杂，这时需要重新优化你的函数。当确实需要多个参数时，大多情况下可以考虑这些参数封装成一个对象。</p>
<p>JS 定义对象非常方便，当需要多个参数时，可以使用一个对象进行替代。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createMenu</span>(<span class="params">title, body, buttonText, cancellable</span>) &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> menuConfig = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;Foo&#x27;</span>,</span><br><span class="line">  <span class="attr">body</span>: <span class="string">&#x27;Bar&#x27;</span>,</span><br><span class="line">  <span class="attr">buttonText</span>: <span class="string">&#x27;Baz&#x27;</span>,</span><br><span class="line">  <span class="attr">cancellable</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createMenu</span>(<span class="params">menuConfig</span>) &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="函数功能的单一性"><a href="#函数功能的单一性" class="headerlink" title="函数功能的单一性"></a>函数功能的单一性</h3><p>这是软件功能中最重要的原则之一。</p>
<p>功能不单一的函数将导致难以重构、测试和理解。功能单一的函数易于重构，并使代码更加干净。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">emailClients</span>(<span class="params">clients</span>) &#123;</span><br><span class="line">  clients.<span class="title function_">forEach</span>(<span class="function"><span class="params">client</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> clientRecord = database.<span class="title function_">lookup</span>(client);</span><br><span class="line">    <span class="keyword">if</span> (clientRecord.<span class="title function_">isActive</span>()) &#123;</span><br><span class="line">      <span class="title function_">email</span>(client);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">emailClients</span>(<span class="params">clients</span>) &#123;</span><br><span class="line">  clients.<span class="title function_">forEach</span>(<span class="function"><span class="params">client</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">emailClientIfNeeded</span>(client);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">emailClientIfNeeded</span>(<span class="params">client</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">isClientActive</span>(client)) &#123;</span><br><span class="line">    <span class="title function_">email</span>(client);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isClientActive</span>(<span class="params">client</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> clientRecord = database.<span class="title function_">lookup</span>(client);</span><br><span class="line">  <span class="keyword">return</span> clientRecord.<span class="title function_">isActive</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="函数名应明确表明其功能"><a href="#函数名应明确表明其功能" class="headerlink" title="函数名应明确表明其功能"></a>函数名应明确表明其功能</h3><p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">dateAdd</span>(<span class="params">date, month</span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 很难理解dateAdd(date, 1)是什么意思</span></span><br><span class="line"><span class="title function_">dateAdd</span>(date, <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">dateAddMonth</span>(<span class="params">date, month</span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> date = <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="title function_">dateAddMonth</span>(date, <span class="number">1</span>);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="函数应该只做一层抽象"><a href="#函数应该只做一层抽象" class="headerlink" title="函数应该只做一层抽象"></a>函数应该只做一层抽象</h3><p>当函数的需要的抽象多于一层时通常意味着函数功能过于复杂，需将其进行分解以提高其可重用性和可测试性。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">parseBetterJSAlternative</span>(<span class="params">code</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="variable constant_">REGEXES</span> = [</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> statements = code.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">  <span class="keyword">let</span> tokens;</span><br><span class="line">  <span class="variable constant_">REGEXES</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">REGEX</span>) =&gt;</span> &#123;</span><br><span class="line">    statements.<span class="title function_">forEach</span>(<span class="function">(<span class="params">statement</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> ast;</span><br><span class="line">  tokens.<span class="title function_">forEach</span>(<span class="function">(<span class="params">token</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// lex...</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  ast.<span class="title function_">forEach</span>(<span class="function">(<span class="params">node</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// parse...</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">tokenize</span>(<span class="params">code</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> <span class="variable constant_">REGEXES</span> = [</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  ];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> statements = code.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">  <span class="keyword">let</span> tokens;</span><br><span class="line">  <span class="variable constant_">REGEXES</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">REGEX</span>) =&gt;</span> &#123;</span><br><span class="line">    statements.<span class="title function_">forEach</span>(<span class="function">(<span class="params">statement</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> tokens;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">lexer</span>(<span class="params">tokens</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> ast;</span><br><span class="line">  tokens.<span class="title function_">forEach</span>(<span class="function">(<span class="params">token</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// lex...</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> ast;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">parseBetterJSAlternative</span>(<span class="params">code</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> tokens = <span class="title function_">tokenize</span>(code);</span><br><span class="line">  <span class="keyword">let</span> ast = <span class="title function_">lexer</span>(tokens);</span><br><span class="line">  ast.<span class="title function_">forEach</span>(<span class="function">(<span class="params">node</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// parse...</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="移除重复的代码"><a href="#移除重复的代码" class="headerlink" title="移除重复的代码"></a>移除重复的代码</h3><p>永远、永远、永远不要在任何循环下有重复的代码。</p>
<p>这种做法毫无意义且潜在危险极大。重复的代码意味着逻辑变化时需要对不止一处进行修改。JS 弱类型的特点使得函数拥有更强的普适性。好好利用这一优点吧。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">showDeveloperList</span>(<span class="params">developers</span>) &#123;</span><br><span class="line">  developers.<span class="title function_">forEach</span>(<span class="function"><span class="params">developer</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> expectedSalary = developer.<span class="title function_">calculateExpectedSalary</span>();</span><br><span class="line">    <span class="keyword">var</span> experience = developer.<span class="title function_">getExperience</span>();</span><br><span class="line">    <span class="keyword">var</span> githubLink = developer.<span class="title function_">getGithubLink</span>();</span><br><span class="line">    <span class="keyword">var</span> data = &#123;</span><br><span class="line">      <span class="attr">expectedSalary</span>: expectedSalary,</span><br><span class="line">      <span class="attr">experience</span>: experience,</span><br><span class="line">      <span class="attr">githubLink</span>: githubLink</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">showManagerList</span>(<span class="params">managers</span>) &#123;</span><br><span class="line">  managers.<span class="title function_">forEach</span>(<span class="function"><span class="params">manager</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> expectedSalary = manager.<span class="title function_">calculateExpectedSalary</span>();</span><br><span class="line">    <span class="keyword">var</span> experience = manager.<span class="title function_">getExperience</span>();</span><br><span class="line">    <span class="keyword">var</span> portfolio = manager.<span class="title function_">getMBAProjects</span>();</span><br><span class="line">    <span class="keyword">var</span> data = &#123;</span><br><span class="line">      <span class="attr">expectedSalary</span>: expectedSalary,</span><br><span class="line">      <span class="attr">experience</span>: experience,</span><br><span class="line">      <span class="attr">portfolio</span>: portfolio</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">showList</span>(<span class="params">employees</span>) &#123;</span><br><span class="line">  employees.<span class="title function_">forEach</span>(<span class="function"><span class="params">employee</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> expectedSalary = employee.<span class="title function_">calculateExpectedSalary</span>();</span><br><span class="line">    <span class="keyword">var</span> experience = employee.<span class="title function_">getExperience</span>();</span><br><span class="line">    <span class="keyword">var</span> portfolio;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (employee.<span class="property">type</span> === <span class="string">&#x27;manager&#x27;</span>) &#123;</span><br><span class="line">      portfolio = employee.<span class="title function_">getMBAProjects</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      portfolio = employee.<span class="title function_">getGithubLink</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> data = &#123;</span><br><span class="line">      <span class="attr">expectedSalary</span>: expectedSalary,</span><br><span class="line">      <span class="attr">experience</span>: experience,</span><br><span class="line">      <span class="attr">portfolio</span>: portfolio</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">render</span>(data);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="采用默认参数精简代码"><a href="#采用默认参数精简代码" class="headerlink" title="采用默认参数精简代码"></a>采用默认参数精简代码</h3><p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">writeForumComment</span>(<span class="params">subject, body</span>) &#123;</span><br><span class="line">  subject = subject || <span class="string">&#x27;No Subject&#x27;</span>;</span><br><span class="line">  body = body || <span class="string">&#x27;No text&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">writeForumComment</span>(<span class="params">subject = <span class="string">&#x27;No subject&#x27;</span>, body = <span class="string">&#x27;No text&#x27;</span></span>) &#123;</span><br><span class="line">  ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="使用-Object-assign-设置默认对象"><a href="#使用-Object-assign-设置默认对象" class="headerlink" title="使用 Object.assign 设置默认对象"></a>使用 Object.assign 设置默认对象</h3><p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> menuConfig = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">body</span>: <span class="string">&#x27;Bar&#x27;</span>,</span><br><span class="line">  <span class="attr">buttonText</span>: <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">cancellable</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createMenu</span>(<span class="params">config</span>) &#123;</span><br><span class="line">  config.<span class="property">title</span> = config.<span class="property">title</span> || <span class="string">&#x27;Foo&#x27;</span></span><br><span class="line">  config.<span class="property">body</span> = config.<span class="property">body</span> || <span class="string">&#x27;Bar&#x27;</span></span><br><span class="line">  config.<span class="property">buttonText</span> = config.<span class="property">buttonText</span> || <span class="string">&#x27;Baz&#x27;</span></span><br><span class="line">  config.<span class="property">cancellable</span> = config.<span class="property">cancellable</span> === <span class="literal">undefined</span> ? config.<span class="property">cancellable</span> : <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">createMenu</span>(menuConfig);</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> menuConfig = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;Order&#x27;</span>,</span><br><span class="line">  <span class="comment">// User did not include &#x27;body&#x27; key</span></span><br><span class="line">  <span class="attr">buttonText</span>: <span class="string">&#x27;Send&#x27;</span>,</span><br><span class="line">  <span class="attr">cancellable</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createMenu</span>(<span class="params">config</span>) &#123;</span><br><span class="line">  config = <span class="title class_">Object</span>.<span class="title function_">assign</span>(&#123;</span><br><span class="line">    <span class="attr">title</span>: <span class="string">&#x27;Foo&#x27;</span>,</span><br><span class="line">    <span class="attr">body</span>: <span class="string">&#x27;Bar&#x27;</span>,</span><br><span class="line">    <span class="attr">buttonText</span>: <span class="string">&#x27;Baz&#x27;</span>,</span><br><span class="line">    <span class="attr">cancellable</span>: <span class="literal">true</span></span><br><span class="line">  &#125;, config);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// config now equals: &#123;title: &quot;Order&quot;, body: &quot;Bar&quot;, buttonText: &quot;Send&quot;, cancellable: true&#125;</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">createMenu</span>(menuConfig);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="不要使用标记-Flag-作为函数参数"><a href="#不要使用标记-Flag-作为函数参数" class="headerlink" title="不要使用标记(Flag)作为函数参数"></a>不要使用标记(Flag)作为函数参数</h3><p>这通常意味着函数的功能的单一性已经被破坏。此时应考虑对函数进行再次划分。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createFile</span>(<span class="params">name, temp</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (temp) &#123;</span><br><span class="line">    fs.<span class="title function_">create</span>(<span class="string">&#x27;./temp/&#x27;</span> + name);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    fs.<span class="title function_">create</span>(name);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">createTempFile</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  fs.<span class="title function_">create</span>(<span class="string">&#x27;./temp/&#x27;</span> + name);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">----------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createFile</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  fs.<span class="title function_">create</span>(name);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="避免副作用"><a href="#避免副作用" class="headerlink" title="避免副作用"></a>避免副作用</h3><p>当函数产生了除了“接受一个值并返回一个结果”之外的行为时，称该函数产生了副作用。比如写文件、修改全局变量或将你的钱全转给了一个陌生人等。</p>
<p>程序在某些情况下确实需要副作用这一行为，如先前例子中的写文件。这时应该将这些功能集中在一起，不要用多个函数&#x2F;类修改某个文件。用且只用一个 service 完成这一需求。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Global variable referenced by following function.</span></span><br><span class="line"><span class="comment">// If we had another function that used this name, now it&#x27;d be an array and it could break it.</span></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;Ryan McDermott&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">splitIntoFirstAndLastName</span>(<span class="params"></span>) &#123;</span><br><span class="line">  name = name.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">splitIntoFirstAndLastName</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name); <span class="comment">// [&#x27;Ryan&#x27;, &#x27;McDermott&#x27;];</span></span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">splitIntoFirstAndLastName</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> name.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> name = <span class="string">&#x27;Ryan McDermott&#x27;</span></span><br><span class="line"><span class="keyword">var</span> newName = <span class="title function_">splitIntoFirstAndLastName</span>(name);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(name); <span class="comment">// &#x27;Ryan McDermott&#x27;;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(newName); <span class="comment">// [&#x27;Ryan&#x27;, &#x27;McDermott&#x27;];</span></span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="不要写全局函数"><a href="#不要写全局函数" class="headerlink" title="不要写全局函数"></a>不要写全局函数</h3><p>在 JS 中污染全局是一个非常不好的实践，这么做可能和其他库起冲突，且调用你的 API 的用户在实际环境中得到一个 exception 前对这一情况是一无所知的。</p>
<p>想象以下例子：如果你想扩展 JS 中的 Array，为其添加一个 <code>diff</code> 函数显示两个数组间的差异，此时应如何去做？你可以将 diff 写入 <code>Array.prototype</code>，但这么做会和其他有类似需求的库造成冲突。如果另一个库对 diff 的需求为比较一个数组中首尾元素间的差异呢？</p>
<p>使用 ES6 中的 class 对全局的 Array 做简单的扩展显然是一个更棒的选择。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Array</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">diff</span> = <span class="keyword">function</span>(<span class="params">comparisonArray</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> values = [];</span><br><span class="line">  <span class="keyword">var</span> hash = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">of</span> comparisonArray) &#123;</span><br><span class="line">    hash[i] = <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">of</span> <span class="variable language_">this</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!hash[i]) &#123;</span><br><span class="line">      values.<span class="title function_">push</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> values;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SuperArray</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Array</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">...args</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>(...args);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">diff</span>(<span class="params">comparisonArray</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> values = [];</span><br><span class="line">    <span class="keyword">var</span> hash = &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">of</span> comparisonArray) &#123;</span><br><span class="line">      hash[i] = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">of</span> <span class="variable language_">this</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (!hash[i]) &#123;</span><br><span class="line">        values.<span class="title function_">push</span>(i);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> values;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="采用函数式编程"><a href="#采用函数式编程" class="headerlink" title="采用函数式编程"></a>采用函数式编程</h3><p>函数式的编程具有更干净且便于测试的特点。尽可能的使用这种风格吧。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> programmerOutput = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Uncle Bobby&#x27;</span>,</span><br><span class="line">    <span class="attr">linesOfCode</span>: <span class="number">500</span></span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Suzie Q&#x27;</span>,</span><br><span class="line">    <span class="attr">linesOfCode</span>: <span class="number">1500</span></span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Jimmy Gosling&#x27;</span>,</span><br><span class="line">    <span class="attr">linesOfCode</span>: <span class="number">150</span></span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Gracie Hopper&#x27;</span>,</span><br><span class="line">    <span class="attr">linesOfCode</span>: <span class="number">1000</span></span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> totalOutput = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; programmerOutput.<span class="property">length</span>; i++) &#123;</span><br><span class="line">  totalOutput += programmerOutput[i].<span class="property">linesOfCode</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> programmerOutput = [</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Uncle Bobby&#x27;</span>,</span><br><span class="line">    <span class="attr">linesOfCode</span>: <span class="number">500</span></span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Suzie Q&#x27;</span>,</span><br><span class="line">    <span class="attr">linesOfCode</span>: <span class="number">1500</span></span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Jimmy Gosling&#x27;</span>,</span><br><span class="line">    <span class="attr">linesOfCode</span>: <span class="number">150</span></span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;Gracie Hopper&#x27;</span>,</span><br><span class="line">    <span class="attr">linesOfCode</span>: <span class="number">1000</span></span><br><span class="line">  &#125;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> totalOutput = programmerOutput</span><br><span class="line">  .<span class="title function_">map</span>(<span class="function">(<span class="params">programmer</span>) =&gt;</span> programmer.<span class="property">linesOfCode</span>)</span><br><span class="line">  .<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, linesOfCode</span>) =&gt;</span> acc + linesOfCode, <span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="封装判断条件"><a href="#封装判断条件" class="headerlink" title="封装判断条件"></a>封装判断条件</h3><p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (fsm.<span class="property">state</span> === <span class="string">&#x27;fetching&#x27;</span> &amp;&amp; <span class="title function_">isEmpty</span>(listNode)) &#123;</span><br><span class="line">  <span class="comment">/// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">shouldShowSpinner</span>(<span class="params">fsm, listNode</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> fsm.<span class="property">state</span> === <span class="string">&#x27;fetching&#x27;</span> &amp;&amp; <span class="title function_">isEmpty</span>(listNode);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">shouldShowSpinner</span>(fsmInstance, listNodeInstance)) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="避免“否定情况”的判断"><a href="#避免“否定情况”的判断" class="headerlink" title="避免“否定情况”的判断"></a>避免“否定情况”的判断</h3><p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">isDOMNodeNotPresent</span>(<span class="params">node</span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="title function_">isDOMNodeNotPresent</span>(node)) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">isDOMNodePresent</span>(<span class="params">node</span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="title function_">isDOMNodePresent</span>(node)) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="避免条件判断"><a href="#避免条件判断" class="headerlink" title="避免条件判断"></a>避免条件判断</h3><p>这看起来似乎不太可能。</p>
<p>大多人听到这的第一反应是：“怎么可能不用 if 完成其他功能呢？”许多情况下通过使用多态(polymorphism)可以达到同样的目的。</p>
<p>第二个问题在于采用这种方式的原因是什么。答案是我们之前提到过的：保持函数功能的单一性。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Airplane</span> &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="title function_">getCruisingAltitude</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable language_">this</span>.<span class="property">type</span>) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;777&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">getMaxAltitude</span>() - <span class="title function_">getPassengerCount</span>();</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;Air Force One&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">getMaxAltitude</span>();</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;Cessna&#x27;</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">getMaxAltitude</span>() - <span class="title function_">getFuelExpenditure</span>();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Airplane</span> &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Boeing777</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Airplane</span> &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="title function_">getCruisingAltitude</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">getMaxAltitude</span>() - <span class="title function_">getPassengerCount</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AirForceOne</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Airplane</span> &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="title function_">getCruisingAltitude</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">getMaxAltitude</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Cessna</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Airplane</span> &#123;</span><br><span class="line">  <span class="comment">//...</span></span><br><span class="line">  <span class="title function_">getCruisingAltitude</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">getMaxAltitude</span>() - <span class="title function_">getFuelExpenditure</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="避免类型判断-part-1"><a href="#避免类型判断-part-1" class="headerlink" title="避免类型判断(part 1)"></a>避免类型判断(part 1)</h3><p>JS 是弱类型语言，这意味着函数可接受任意类型的参数。</p>
<p>有时这会对你带来麻烦，你会对参数做一些类型判断。有许多方法可以避免这些情况。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">travelToTexas</span>(<span class="params">vehicle</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (vehicle <span class="keyword">instanceof</span> <span class="title class_">Bicycle</span>) &#123;</span><br><span class="line">    vehicle.<span class="title function_">peddle</span>(<span class="variable language_">this</span>.<span class="property">currentLocation</span>, <span class="keyword">new</span> <span class="title class_">Location</span>(<span class="string">&#x27;texas&#x27;</span>));</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (vehicle <span class="keyword">instanceof</span> <span class="title class_">Car</span>) &#123;</span><br><span class="line">    vehicle.<span class="title function_">drive</span>(<span class="variable language_">this</span>.<span class="property">currentLocation</span>, <span class="keyword">new</span> <span class="title class_">Location</span>(<span class="string">&#x27;texas&#x27;</span>));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">travelToTexas</span>(<span class="params">vehicle</span>) &#123;</span><br><span class="line">  vehicle.<span class="title function_">move</span>(<span class="variable language_">this</span>.<span class="property">currentLocation</span>, <span class="keyword">new</span> <span class="title class_">Location</span>(<span class="string">&#x27;texas&#x27;</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="避免类型判断-part-2"><a href="#避免类型判断-part-2" class="headerlink" title="避免类型判断(part 2)"></a>避免类型判断(part 2)</h3><p>如果需处理的数据为字符串，整型，数组等类型，无法使用多态并仍有必要对其进行类型检测时，可以考虑使用 TypeScript。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">combine</span>(<span class="params">val1, val2</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">typeof</span> val1 == <span class="string">&quot;number&quot;</span> &amp;&amp; <span class="keyword">typeof</span> val2 == <span class="string">&quot;number&quot;</span> ||</span><br><span class="line">      <span class="keyword">typeof</span> val1 == <span class="string">&quot;string&quot;</span> &amp;&amp; <span class="keyword">typeof</span> val2 == <span class="string">&quot;string&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> val1 + val2;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;Must be of type String or Number&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">combine</span>(<span class="params">val1, val2</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> val1 + val2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="避免过度优化"><a href="#避免过度优化" class="headerlink" title="避免过度优化"></a>避免过度优化</h3><p>现代的浏览器在运行时会对代码自动进行优化。有时人为对代码进行优化可能是在浪费时间。</p>
<p><a target="_blank" rel="noopener" href="https://github.com/petkaantonov/bluebird/wiki/Optimization-killers">这里可以找到许多真正需要优化的地方</a></p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 这里使用变量len是因为在老式浏览器中，</span></span><br><span class="line"><span class="comment">// 直接使用正例中的方式会导致每次循环均重复计算list.length的值，</span></span><br><span class="line"><span class="comment">// 而在现代浏览器中会自动完成优化，这一行为是没有必要的</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>, len = list.<span class="property">length</span>; i &lt; len; i++) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; list.<span class="property">length</span>; i++) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="删除无效的代码"><a href="#删除无效的代码" class="headerlink" title="删除无效的代码"></a>删除无效的代码</h3><p>不再被调用的代码应及时删除。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">oldRequestModule</span>(<span class="params">url</span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">newRequestModule</span>(<span class="params">url</span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> req = newRequestModule;</span><br><span class="line"><span class="title function_">inventoryTracker</span>(<span class="string">&#x27;apples&#x27;</span>, req, <span class="string">&#x27;www.inventory-awesome.io&#x27;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">newRequestModule</span>(<span class="params">url</span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> req = newRequestModule;</span><br><span class="line"><span class="title function_">inventoryTracker</span>(<span class="string">&#x27;apples&#x27;</span>, req, <span class="string">&#x27;www.inventory-awesome.io&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h2 id="对象和数据结构"><a href="#对象和数据结构" class="headerlink" title="对象和数据结构"></a><strong>对象和数据结构</strong></h2><h3 id="使用-getters-和-setters"><a href="#使用-getters-和-setters" class="headerlink" title="使用 getters 和 setters"></a>使用 getters 和 setters</h3><p>JS 没有接口或类型，因此实现这一模式是很困难的，因为我们并没有类似 <code>public</code> 和 <code>private</code> 的关键词。</p>
<p>然而，使用 getters 和 setters 获取对象的数据远比直接使用点操作符具有优势。为什么呢？</p>
<ol>
<li>当需要对获取的对象属性执行额外操作时。</li>
<li>执行 <code>set</code> 时可以增加规则对要变量的合法性进行判断。</li>
<li>封装了内部逻辑。</li>
<li>在存取时可以方便的增加日志和错误处理。</li>
<li>继承该类时可以重载默认行为。</li>
<li>从服务器获取数据时可以进行懒加载。</li>
</ol>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BankAccount</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">balance</span> = <span class="number">1000</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> bankAccount = <span class="keyword">new</span> <span class="title class_">BankAccount</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Buy shoes...</span></span><br><span class="line">bankAccount.<span class="property">balance</span> = bankAccount.<span class="property">balance</span> - <span class="number">100</span>;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">BankAccount</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">balance</span> = <span class="number">1000</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// It doesn&#x27;t have to be prefixed with `get` or `set` to be a getter/setter</span></span><br><span class="line">  <span class="title function_">withdraw</span>(<span class="params">amount</span>) &#123;</span><br><span class="line">   <span class="keyword">if</span> (<span class="title function_">verifyAmountCanBeDeducted</span>(amount)) &#123;</span><br><span class="line">     <span class="variable language_">this</span>.<span class="property">balance</span> -= amount;</span><br><span class="line">   &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> bankAccount = <span class="keyword">new</span> <span class="title class_">BankAccount</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// Buy shoes...</span></span><br><span class="line">bankAccount.<span class="title function_">withdraw</span>(<span class="number">100</span>);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="让对象拥有私有成员"><a href="#让对象拥有私有成员" class="headerlink" title="让对象拥有私有成员"></a>让对象拥有私有成员</h3><p>可以通过闭包完成</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Employee</span> = <span class="keyword">function</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Employee</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">getName</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> employee = <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&#x27;John Doe&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Employee name: &#x27;</span> + employee.<span class="title function_">getName</span>()); <span class="comment">// Employee name: John Doe</span></span><br><span class="line"><span class="keyword">delete</span> employee.<span class="property">name</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Employee name: &#x27;</span> + employee.<span class="title function_">getName</span>()); <span class="comment">// Employee name: undefined</span></span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Employee</span> = (<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">Employee</span>(<span class="params">name</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">getName</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> name;</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> <span class="title class_">Employee</span>;</span><br><span class="line">&#125;());</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> employee = <span class="keyword">new</span> <span class="title class_">Employee</span>(<span class="string">&#x27;John Doe&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Employee name: &#x27;</span> + employee.<span class="title function_">getName</span>()); <span class="comment">// Employee name: John Doe</span></span><br><span class="line"><span class="keyword">delete</span> employee.<span class="property">name</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Employee name: &#x27;</span> + employee.<span class="title function_">getName</span>()); <span class="comment">// Employee name: John Doe</span></span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h2 id="类"><a href="#类" class="headerlink" title="类"></a><strong>类</strong></h2><h3 id="单一职责原则-SRP"><a href="#单一职责原则-SRP" class="headerlink" title="单一职责原则 (SRP)"></a>单一职责原则 (SRP)</h3><p>如《代码整洁之道》一书中所述，“修改一个类的理由不应该超过一个”。</p>
<p>将多个功能塞进一个类的想法很诱人，但这将导致你的类无法达到概念上的内聚，并经常不得不进行修改。</p>
<p>最小化对一个类需要修改的次数是非常有必要的。如果一个类具有太多太杂的功能，当你对其中一小部分进行修改时，将很难想象到这一修够对代码库中依赖该类的其他模块会带来什么样的影响。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UserSettings</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">user</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">user</span> = user;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">changeSettings</span>(<span class="params">settings</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">verifyCredentials</span>(user)) &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">verifyCredentials</span>(<span class="params">user</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">UserAuth</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">user</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">user</span> = user;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">verifyCredentials</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserSettings</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">user</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">user</span> = user;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">auth</span> = <span class="keyword">new</span> <span class="title class_">UserAuth</span>(user)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">changeSettings</span>(<span class="params">settings</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">auth</span>.<span class="title function_">verifyCredentials</span>()) &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="开-闭原则-OCP"><a href="#开-闭原则-OCP" class="headerlink" title="开&#x2F;闭原则 (OCP)"></a>开&#x2F;闭原则 (OCP)</h3><p>“代码实体(类，模块，函数等)应该易于扩展，难于修改。”</p>
<p>这一原则指的是我们应允许用户方便的扩展我们代码模块的功能，而不需要打开 js 文件源码手动对其进行修改。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AjaxRequester</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// What if we wanted another HTTP Method, like DELETE? We would have to</span></span><br><span class="line">    <span class="comment">// open this file up and modify this and put it in manually.</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">HTTP_METHODS</span> = [<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;PUT&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">get</span>(<span class="params">url</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AjaxRequester</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">HTTP_METHODS</span> = [<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;PUT&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">get</span>(<span class="params">url</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">addHTTPMethod</span>(<span class="params">method</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">HTTP_METHODS</span>.<span class="title function_">push</span>(method);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="利斯科夫替代原则-LSP"><a href="#利斯科夫替代原则-LSP" class="headerlink" title="利斯科夫替代原则 (LSP)"></a>利斯科夫替代原则 (LSP)</h3><p>“子类对象应该能够替换其超类对象被使用”。</p>
<p>也就是说，如果有一个父类和一个子类，当采用子类替换父类时不应该产生错误的结果。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">width</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">height</span> = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setColor</span>(<span class="params">color</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params">area</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setWidth</span>(<span class="params">width</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">width</span> = width;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setHeight</span>(<span class="params">height</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">height</span> = height;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getArea</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">width</span> * <span class="variable language_">this</span>.<span class="property">height</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Square</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Rectangle</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setWidth</span>(<span class="params">width</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">width</span> = width;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">height</span> = width;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setHeight</span>(<span class="params">height</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">width</span> = height;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">height</span> = height;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">renderLargeRectangles</span>(<span class="params">rectangles</span>) &#123;</span><br><span class="line">  rectangles.<span class="title function_">forEach</span>(<span class="function">(<span class="params">rectangle</span>) =&gt;</span> &#123;</span><br><span class="line">    rectangle.<span class="title function_">setWidth</span>(<span class="number">4</span>);</span><br><span class="line">    rectangle.<span class="title function_">setHeight</span>(<span class="number">5</span>);</span><br><span class="line">    <span class="keyword">let</span> area = rectangle.<span class="title function_">getArea</span>(); <span class="comment">// BAD: Will return 25 for Square. Should be 20.</span></span><br><span class="line">    rectangle.<span class="title function_">render</span>(area);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> rectangles = [<span class="keyword">new</span> <span class="title class_">Rectangle</span>(), <span class="keyword">new</span> <span class="title class_">Rectangle</span>(), <span class="keyword">new</span> <span class="title class_">Square</span>()];</span><br><span class="line"><span class="title function_">renderLargeRectangles</span>(rectangles);</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setColor</span>(<span class="params">color</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">render</span>(<span class="params">area</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Shape</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">width</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">height</span> = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setWidth</span>(<span class="params">width</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">width</span> = width;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setHeight</span>(<span class="params">height</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">height</span> = height;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getArea</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">width</span> * <span class="variable language_">this</span>.<span class="property">height</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Square</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Shape</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">length</span> = <span class="number">0</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setLength</span>(<span class="params">length</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">length</span> = length;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getArea</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">length</span> * <span class="variable language_">this</span>.<span class="property">length</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">renderLargeShapes</span>(<span class="params">shapes</span>) &#123;</span><br><span class="line">  shapes.<span class="title function_">forEach</span>(<span class="function">(<span class="params">shape</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> (shape.<span class="property">constructor</span>.<span class="property">name</span>) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;Square&#x27;</span>:</span><br><span class="line">        shape.<span class="title function_">setLength</span>(<span class="number">5</span>);</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;Rectangle&#x27;</span>:</span><br><span class="line">        shape.<span class="title function_">setWidth</span>(<span class="number">4</span>);</span><br><span class="line">        shape.<span class="title function_">setHeight</span>(<span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> area = shape.<span class="title function_">getArea</span>();</span><br><span class="line">    shape.<span class="title function_">render</span>(area);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> shapes = [<span class="keyword">new</span> <span class="title class_">Rectangle</span>(), <span class="keyword">new</span> <span class="title class_">Rectangle</span>(), <span class="keyword">new</span> <span class="title class_">Square</span>()];</span><br><span class="line"><span class="title function_">renderLargeShapes</span>(shapes);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="接口隔离原则-ISP"><a href="#接口隔离原则-ISP" class="headerlink" title="接口隔离原则 (ISP)"></a>接口隔离原则 (ISP)</h3><p>“客户端不应该依赖它不需要的接口；一个类对另一个类的依赖应该建立在最小的接口上。”</p>
<p>在 JS 中，当一个类需要许多参数设置才能生成一个对象时，或许大多时候不需要设置这么多的参数。此时减少对配置参数数量的需求是有益的。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DOMTraverser</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">settings</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">settings</span> = settings;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setup</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rootNode</span> = <span class="variable language_">this</span>.<span class="property">settings</span>.<span class="property">rootNode</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">animationModule</span>.<span class="title function_">setup</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">traverse</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> $ = <span class="keyword">new</span> <span class="title class_">DOMTraverser</span>(&#123;</span><br><span class="line">  <span class="attr">rootNode</span>: <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;body&#x27;</span>),</span><br><span class="line">  <span class="attr">animationModule</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125; <span class="comment">// Most of the time, we won&#x27;t need to animate when traversing.</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DOMTraverser</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">settings</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">settings</span> = settings;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">options</span> = settings.<span class="property">options</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setup</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setup</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">rootNode</span> = <span class="variable language_">this</span>.<span class="property">settings</span>.<span class="property">rootNode</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setupOptions</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setupOptions</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">animationModule</span>) &#123;</span><br><span class="line">      <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">traverse</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> $ = <span class="keyword">new</span> <span class="title class_">DOMTraverser</span>(&#123;</span><br><span class="line">  <span class="attr">rootNode</span>: <span class="variable language_">document</span>.<span class="title function_">getElementsByTagName</span>(<span class="string">&#x27;body&#x27;</span>),</span><br><span class="line">  <span class="attr">options</span>: &#123;</span><br><span class="line">    <span class="attr">animationModule</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="依赖反转原则-DIP"><a href="#依赖反转原则-DIP" class="headerlink" title="依赖反转原则 (DIP)"></a>依赖反转原则 (DIP)</h3><p>该原则有两个核心点：</p>
<ol>
<li>高层模块不应该依赖于低层模块。他们都应该依赖于抽象接口。</li>
<li>抽象接口应该脱离具体实现，具体实现应该依赖于抽象接口。</li>
</ol>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">InventoryTracker</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">items</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">items</span> = items;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// BAD: We have created a dependency on a specific request implementation.</span></span><br><span class="line">    <span class="comment">// We should just have requestItems depend on a request method: `request`</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">requester</span> = <span class="keyword">new</span> <span class="title class_">InventoryRequester</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">requestItems</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">items</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">requester</span>.<span class="title function_">requestItem</span>(item);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">InventoryRequester</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">REQ_METHODS</span> = [<span class="string">&#x27;HTTP&#x27;</span>];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">requestItem</span>(<span class="params">item</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> inventoryTracker = <span class="keyword">new</span> <span class="title class_">InventoryTracker</span>([<span class="string">&#x27;apples&#x27;</span>, <span class="string">&#x27;bananas&#x27;</span>]);</span><br><span class="line">inventoryTracker.<span class="title function_">requestItems</span>();</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">InventoryTracker</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">items, requester</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">items</span> = items;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">requester</span> = requester;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">requestItems</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">items</span>.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="property">requester</span>.<span class="title function_">requestItem</span>(item);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">InventoryRequesterV1</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">REQ_METHODS</span> = [<span class="string">&#x27;HTTP&#x27;</span>];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">requestItem</span>(<span class="params">item</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">InventoryRequesterV2</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">REQ_METHODS</span> = [<span class="string">&#x27;WS&#x27;</span>];</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">requestItem</span>(<span class="params">item</span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// By constructing our dependencies externally and injecting them, we can easily</span></span><br><span class="line"><span class="comment">// substitute our request module for a fancy new one that uses WebSockets.</span></span><br><span class="line"><span class="keyword">let</span> inventoryTracker = <span class="keyword">new</span> <span class="title class_">InventoryTracker</span>([<span class="string">&#x27;apples&#x27;</span>, <span class="string">&#x27;bananas&#x27;</span>], <span class="keyword">new</span> <span class="title class_">InventoryRequesterV2</span>());</span><br><span class="line">inventoryTracker.<span class="title function_">requestItems</span>();</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="使用-ES6-的-classes-而不是-ES5-的-Function"><a href="#使用-ES6-的-classes-而不是-ES5-的-Function" class="headerlink" title="使用 ES6 的 classes 而不是 ES5 的 Function"></a>使用 ES6 的 classes 而不是 ES5 的 Function</h3><p>典型的 ES5 的类(function)在继承、构造和方法定义方面可读性较差。</p>
<p>当需要继承时，优先选用 classes。</p>
<p>但是，当在需要更大更复杂的对象时，最好优先选择更小的 function 而非 classes。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">Animal</span> = <span class="keyword">function</span>(<span class="params">age</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!(<span class="variable language_">this</span> <span class="keyword">instanceof</span> <span class="title class_">Animal</span>)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Instantiate Animal with `new`&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">move</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Mammal</span> = <span class="keyword">function</span>(<span class="params">age, furColor</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!(<span class="variable language_">this</span> <span class="keyword">instanceof</span> <span class="title class_">Mammal</span>)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Instantiate Mammal with `new`&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Animal</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, age);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">furColor</span> = furColor;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Mammal</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Animal</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="title class_">Mammal</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">Mammal</span>;</span><br><span class="line"><span class="title class_">Mammal</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">liveBirth</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Human</span> = <span class="keyword">function</span>(<span class="params">age, furColor, languageSpoken</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!(<span class="variable language_">this</span> <span class="keyword">instanceof</span> <span class="title class_">Human</span>)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Instantiate Human with `new`&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title class_">Mammal</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>, age, furColor);</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">languageSpoken</span> = languageSpoken;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Human</span>.<span class="property"><span class="keyword">prototype</span></span> = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="title class_">Mammal</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line"><span class="title class_">Human</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">constructor</span> = <span class="title class_">Human</span>;</span><br><span class="line"><span class="title class_">Human</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">speak</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">age</span>) &#123;</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">move</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mammal</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Animal</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">age, furColor</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(age);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">furColor</span> = furColor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">liveBirth</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Human</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Mammal</span> &#123;</span><br><span class="line">    <span class="title function_">constructor</span>(<span class="params">age, furColor, languageSpoken</span>) &#123;</span><br><span class="line">        <span class="variable language_">super</span>(age, furColor);</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">languageSpoken</span> = languageSpoken;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="title function_">speak</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="使用方法链"><a href="#使用方法链" class="headerlink" title="使用方法链"></a>使用方法链</h3><p>这里我们的理解与《代码整洁之道》的建议有些不同。</p>
<p>有争论说方法链不够干净且违反了<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Law_of_Demeter">德米特法则</a>，也许这是对的，但这种方法在 JS 及许多库(如 JQuery)中显得非常实用。</p>
<p>因此，我认为在 JS 中使用方法链是非常合适的。在 class 的函数中返回 this，能够方便的将类需要执行的多个方法链接起来。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">make</span> = <span class="string">&#x27;Honda&#x27;</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">model</span> = <span class="string">&#x27;Accord&#x27;</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">color</span> = <span class="string">&#x27;white&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setMake</span>(<span class="params">make</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setModel</span>(<span class="params">model</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">model</span> = model;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setColor</span>(<span class="params">color</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">color</span> = color;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">save</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">make</span>, <span class="variable language_">this</span>.<span class="property">model</span>, <span class="variable language_">this</span>.<span class="property">color</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> car = <span class="keyword">new</span> <span class="title class_">Car</span>();</span><br><span class="line">car.<span class="title function_">setColor</span>(<span class="string">&#x27;pink&#x27;</span>);</span><br><span class="line">car.<span class="title function_">setMake</span>(<span class="string">&#x27;Ford&#x27;</span>);</span><br><span class="line">car.<span class="title function_">setModel</span>(<span class="string">&#x27;F-150&#x27;</span>)</span><br><span class="line">car.<span class="title function_">save</span>();</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Car</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">make</span> = <span class="string">&#x27;Honda&#x27;</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">model</span> = <span class="string">&#x27;Accord&#x27;</span>;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">color</span> = <span class="string">&#x27;white&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setMake</span>(<span class="params">make</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> Returning this for chaining</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setModel</span>(<span class="params">model</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">model</span> = model;</span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> Returning this for chaining</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setColor</span>(<span class="params">color</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">color</span> = color;</span><br><span class="line">    <span class="comment">// <span class="doctag">NOTE:</span> Returning this for chaining</span></span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">save</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">make</span>, <span class="variable language_">this</span>.<span class="property">model</span>, <span class="variable language_">this</span>.<span class="property">color</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> car = <span class="keyword">new</span> <span class="title class_">Car</span>()</span><br><span class="line">  .<span class="title function_">setColor</span>(<span class="string">&#x27;pink&#x27;</span>)</span><br><span class="line">  .<span class="title function_">setMake</span>(<span class="string">&#x27;Ford&#x27;</span>)</span><br><span class="line">  .<span class="title function_">setModel</span>(<span class="string">&#x27;F-150&#x27;</span>)</span><br><span class="line">  .<span class="title function_">save</span>();</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="优先使用组合模式而非继承"><a href="#优先使用组合模式而非继承" class="headerlink" title="优先使用组合模式而非继承"></a>优先使用组合模式而非继承</h3><p>在著名的<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Design_Patterns">设计模式</a>一书中提到，应多使用组合模式而非继承。</p>
<p>这么做有许多优点，在想要使用继承前，多想想能否通过组合模式满足需求吧。</p>
<p>那么，在什么时候继承具有更大的优势呢？这取决于你的具体需求，但大多情况下，可以遵守以下三点：</p>
<ol>
<li>继承关系表现为”是一个”而非”有一个”(如动物-&gt;人 和 用户-&gt;用户细节)</li>
<li>可以复用基类的代码(“Human”可以看成是”All animal”的一种)</li>
<li>希望当基类改变时所有派生类都受到影响(如修改”all animals”移动时的卡路里消耗量)</li>
</ol>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name, email</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">email</span> = email;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Bad because Employees &quot;have&quot; tax data. EmployeeTaxData is not a type of Employee</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmployeeTaxData</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Employee</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">ssn, salary</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ssn</span> = ssn;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">salary</span> = salary;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Employee</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name, email</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">email</span> = email;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">setTaxData</span>(<span class="params">ssn, salary</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">taxData</span> = <span class="keyword">new</span> <span class="title class_">EmployeeTaxData</span>(ssn, salary);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmployeeTaxData</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">ssn, salary</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">ssn</span> = ssn;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">salary</span> = salary;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a><strong>测试</strong></h2><p><a target="_blank" rel="noopener" href="http://gotwarlost.github.io/istanbul/">一些好的覆盖工具</a>。</p>
<p><a target="_blank" rel="noopener" href="http://jstherightway.org/#testing-tools">一些好的 JS 测试框架</a>。</p>
<h3 id="单一的测试每个概念"><a href="#单一的测试每个概念" class="headerlink" title="单一的测试每个概念"></a>单一的测试每个概念</h3><p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> assert = <span class="built_in">require</span>(<span class="string">&#x27;assert&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;MakeMomentJSGreatAgain&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;handles date boundaries&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> date;</span><br><span class="line"></span><br><span class="line">    date = <span class="keyword">new</span> <span class="title class_">MakeMomentJSGreatAgain</span>(<span class="string">&#x27;1/1/2015&#x27;</span>);</span><br><span class="line">    date.<span class="title function_">addDays</span>(<span class="number">30</span>);</span><br><span class="line">    date.<span class="title function_">shouldEqual</span>(<span class="string">&#x27;1/31/2015&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    date = <span class="keyword">new</span> <span class="title class_">MakeMomentJSGreatAgain</span>(<span class="string">&#x27;2/1/2016&#x27;</span>);</span><br><span class="line">    date.<span class="title function_">addDays</span>(<span class="number">28</span>);</span><br><span class="line">    assert.<span class="title function_">equal</span>(<span class="string">&#x27;02/29/2016&#x27;</span>, date);</span><br><span class="line"></span><br><span class="line">    date = <span class="keyword">new</span> <span class="title class_">MakeMomentJSGreatAgain</span>(<span class="string">&#x27;2/1/2015&#x27;</span>);</span><br><span class="line">    date.<span class="title function_">addDays</span>(<span class="number">28</span>);</span><br><span class="line">    assert.<span class="title function_">equal</span>(<span class="string">&#x27;03/01/2015&#x27;</span>, date);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> assert = <span class="built_in">require</span>(<span class="string">&#x27;assert&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="title function_">describe</span>(<span class="string">&#x27;MakeMomentJSGreatAgain&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;handles 30-day months&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> date = <span class="keyword">new</span> <span class="title class_">MakeMomentJSGreatAgain</span>(<span class="string">&#x27;1/1/2015&#x27;</span>);</span><br><span class="line">    date.<span class="title function_">addDays</span>(<span class="number">30</span>);</span><br><span class="line">    date.<span class="title function_">shouldEqual</span>(<span class="string">&#x27;1/31/2015&#x27;</span>);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;handles leap year&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> date = <span class="keyword">new</span> <span class="title class_">MakeMomentJSGreatAgain</span>(<span class="string">&#x27;2/1/2016&#x27;</span>);</span><br><span class="line">    date.<span class="title function_">addDays</span>(<span class="number">28</span>);</span><br><span class="line">    assert.<span class="title function_">equal</span>(<span class="string">&#x27;02/29/2016&#x27;</span>, date);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="title function_">it</span>(<span class="string">&#x27;handles non-leap year&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> date = <span class="keyword">new</span> <span class="title class_">MakeMomentJSGreatAgain</span>(<span class="string">&#x27;2/1/2015&#x27;</span>);</span><br><span class="line">    date.<span class="title function_">addDays</span>(<span class="number">28</span>);</span><br><span class="line">    assert.<span class="title function_">equal</span>(<span class="string">&#x27;03/01/2015&#x27;</span>, date);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h2 id="并发"><a href="#并发" class="headerlink" title="并发"></a><strong>并发</strong></h2><h3 id="用-Promises-替代回调"><a href="#用-Promises-替代回调" class="headerlink" title="用 Promises 替代回调"></a>用 Promises 替代回调</h3><p>回调不够整洁并会造成大量的嵌套。ES6 内嵌了 Promises，使用它吧。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;request&#x27;</span>).<span class="title function_">get</span>(<span class="string">&#x27;https://en.wikipedia.org/wiki/Robert_Cecil_Martin&#x27;</span>, <span class="keyword">function</span>(<span class="params">err, response</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(err);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).<span class="title function_">writeFile</span>(<span class="string">&#x27;article.html&#x27;</span>, response.<span class="property">body</span>, <span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(err);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;File written&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;request-promise&#x27;</span>).<span class="title function_">get</span>(<span class="string">&#x27;https://en.wikipedia.org/wiki/Robert_Cecil_Martin&#x27;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">&#x27;fs-promise&#x27;</span>).<span class="title function_">writeFile</span>(<span class="string">&#x27;article.html&#x27;</span>, response);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;File written&#x27;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(err);</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="Async-Await-是较-Promises-更好的选择"><a href="#Async-Await-是较-Promises-更好的选择" class="headerlink" title="Async&#x2F;Await 是较 Promises 更好的选择"></a>Async&#x2F;Await 是较 Promises 更好的选择</h3><p>Promises 是较回调而言更好的一种选择，但 ES7 中的 async 和 await 更胜过 Promises。</p>
<p>在能使用 ES7 特性的情况下可以尽量使用他们替代 Promises。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;request-promise&#x27;</span>).<span class="title function_">get</span>(<span class="string">&#x27;https://en.wikipedia.org/wiki/Robert_Cecil_Martin&#x27;</span>)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">response</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">require</span>(<span class="string">&#x27;fs-promise&#x27;</span>).<span class="title function_">writeFile</span>(<span class="string">&#x27;article.html&#x27;</span>, response);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;File written&#x27;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="keyword">function</span>(<span class="params">err</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(err);</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">getCleanCodeArticle</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> request = <span class="keyword">await</span> <span class="built_in">require</span>(<span class="string">&#x27;request-promise&#x27;</span>)</span><br><span class="line">    <span class="keyword">var</span> response = <span class="keyword">await</span> request.<span class="title function_">get</span>(<span class="string">&#x27;https://en.wikipedia.org/wiki/Robert_Cecil_Martin&#x27;</span>);</span><br><span class="line">    <span class="keyword">var</span> fileHandle = <span class="keyword">await</span> <span class="built_in">require</span>(<span class="string">&#x27;fs-promise&#x27;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">await</span> fileHandle.<span class="title function_">writeFile</span>(<span class="string">&#x27;article.html&#x27;</span>, response);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;File written&#x27;</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span>(err) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(err);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h2 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a><strong>错误处理</strong></h2><p>错误抛出是个好东西！这使得你能够成功定位运行状态中的程序产生错误的位置。</p>
<h3 id="别忘了捕获错误"><a href="#别忘了捕获错误" class="headerlink" title="别忘了捕获错误"></a>别忘了捕获错误</h3><p>对捕获的错误不做任何处理是没有意义的。</p>
<p>代码中 <code>try/catch</code> 的意味着你认为这里可能出现一些错误，你应该对这些可能的错误存在相应的处理方案。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="title function_">functionThatMightThrow</span>();</span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  <span class="title function_">functionThatMightThrow</span>();</span><br><span class="line">&#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">  <span class="comment">// One option (more noisy than console.log):</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">  <span class="comment">// Another option:</span></span><br><span class="line">  <span class="title function_">notifyUserOfError</span>(error);</span><br><span class="line">  <span class="comment">// Another option:</span></span><br><span class="line">  <span class="title function_">reportErrorToService</span>(error);</span><br><span class="line">  <span class="comment">// OR do all three!</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="不要忽略被拒绝的-promises"><a href="#不要忽略被拒绝的-promises" class="headerlink" title="不要忽略被拒绝的 promises"></a>不要忽略被拒绝的 promises</h3><p>理由同 <code>try/catch</code>。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getdata</span>()</span><br><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">functionThatMightThrow</span>(data);</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getdata</span>()</span><br><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">functionThatMightThrow</span>(data);</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// One option (more noisy than console.log):</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(error);</span><br><span class="line">  <span class="comment">// Another option:</span></span><br><span class="line">  <span class="title function_">notifyUserOfError</span>(error);</span><br><span class="line">  <span class="comment">// Another option:</span></span><br><span class="line">  <span class="title function_">reportErrorToService</span>(error);</span><br><span class="line">  <span class="comment">// OR do all three!</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h2 id="格式化"><a href="#格式化" class="headerlink" title="格式化"></a><strong>格式化</strong></h2><p>格式化是一件主观的事。如同这里的许多规则一样，这里并没有一定&#x2F;立刻需要遵守的规则。可以在<a target="_blank" rel="noopener" href="http://standardjs.com/rules.html">这里</a>完成格式的自动化。</p>
<h3 id="大小写一致"><a href="#大小写一致" class="headerlink" title="大小写一致"></a>大小写一致</h3><p>JS 是弱类型语言，合理的采用大小写可以告诉你关于变量&#x2F;函数等的许多消息。</p>
<p>这些规则是主观定义的，团队可以根据喜欢进行选择。重点在于无论选择何种风格，都需要注意保持一致性。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="variable constant_">DAYS_IN_WEEK</span> = <span class="number">7</span>;</span><br><span class="line"><span class="keyword">var</span> daysInMonth = <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> songs = [<span class="string">&#x27;Back In Black&#x27;</span>, <span class="string">&#x27;Stairway to Heaven&#x27;</span>, <span class="string">&#x27;Hey Jude&#x27;</span>];</span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Artists</span> = [<span class="string">&#x27;ACDC&#x27;</span>, <span class="string">&#x27;Led Zeppelin&#x27;</span>, <span class="string">&#x27;The Beatles&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">eraseDatabase</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">restore_database</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">animal</span> &#123;&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Alpaca</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="variable constant_">DAYS_IN_WEEK</span> = <span class="number">7</span>;</span><br><span class="line"><span class="keyword">var</span> <span class="variable constant_">DAYS_IN_MONTH</span> = <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> songs = [<span class="string">&#x27;Back In Black&#x27;</span>, <span class="string">&#x27;Stairway to Heaven&#x27;</span>, <span class="string">&#x27;Hey Jude&#x27;</span>];</span><br><span class="line"><span class="keyword">var</span> artists = [<span class="string">&#x27;ACDC&#x27;</span>, <span class="string">&#x27;Led Zeppelin&#x27;</span>, <span class="string">&#x27;The Beatles&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">eraseDatabase</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">restoreDatabase</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Animal</span> &#123;&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Alpaca</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="调用函数的函数和被调函数应放在较近的位置"><a href="#调用函数的函数和被调函数应放在较近的位置" class="headerlink" title="调用函数的函数和被调函数应放在较近的位置"></a>调用函数的函数和被调函数应放在较近的位置</h3><p>当函数间存在相互调用的情况时，应将两者置于较近的位置。</p>
<p>理想情况下，应将调用其他函数的函数写在被调用函数的上方。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PerformanceReview</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">employee</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">employee</span> = employee;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">lookupPeers</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> db.<span class="title function_">lookup</span>(<span class="variable language_">this</span>.<span class="property">employee</span>, <span class="string">&#x27;peers&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">lookupMananger</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> db.<span class="title function_">lookup</span>(<span class="variable language_">this</span>.<span class="property">employee</span>, <span class="string">&#x27;manager&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getPeerReviews</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> peers = <span class="variable language_">this</span>.<span class="title function_">lookupPeers</span>();</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">perfReview</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">getPeerReviews</span>();</span><br><span class="line">      <span class="title function_">getManagerReview</span>();</span><br><span class="line">      <span class="title function_">getSelfReview</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getManagerReview</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> manager = <span class="variable language_">this</span>.<span class="title function_">lookupManager</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getSelfReview</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> review = <span class="keyword">new</span> <span class="title class_">PerformanceReview</span>(user);</span><br><span class="line">review.<span class="title function_">perfReview</span>();</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">PerformanceReview</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">employee</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">employee</span> = employee;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">perfReview</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="title function_">getPeerReviews</span>();</span><br><span class="line">      <span class="title function_">getManagerReview</span>();</span><br><span class="line">      <span class="title function_">getSelfReview</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getPeerReviews</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> peers = <span class="variable language_">this</span>.<span class="title function_">lookupPeers</span>();</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">lookupPeers</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> db.<span class="title function_">lookup</span>(<span class="variable language_">this</span>.<span class="property">employee</span>, <span class="string">&#x27;peers&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getManagerReview</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> manager = <span class="variable language_">this</span>.<span class="title function_">lookupManager</span>();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">lookupMananger</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> db.<span class="title function_">lookup</span>(<span class="variable language_">this</span>.<span class="property">employee</span>, <span class="string">&#x27;manager&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">getSelfReview</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> review = <span class="keyword">new</span> <span class="title class_">PerformanceReview</span>(employee);</span><br><span class="line">review.<span class="title function_">perfReview</span>();</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a><strong>注释</strong></h2><h3 id="只对存在一定业务逻辑复杂性的代码进行注释"><a href="#只对存在一定业务逻辑复杂性的代码进行注释" class="headerlink" title="只对存在一定业务逻辑复杂性的代码进行注释"></a>只对存在一定业务逻辑复杂性的代码进行注释</h3><p>注释并不是必须的，好的代码是能够让人一目了然，不用过多无谓的注释。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">hashIt</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="comment">// The hash</span></span><br><span class="line">  <span class="keyword">var</span> hash = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Length of string</span></span><br><span class="line">  <span class="keyword">var</span> length = data.<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Loop through every character in data</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">    <span class="comment">// Get character code.</span></span><br><span class="line">    <span class="keyword">var</span> char = data.<span class="title function_">charCodeAt</span>(i);</span><br><span class="line">    <span class="comment">// Make the hash</span></span><br><span class="line">    hash = ((hash &lt;&lt; <span class="number">5</span>) - hash) + char;</span><br><span class="line">    <span class="comment">// Convert to 32-bit integer</span></span><br><span class="line">    hash = hash &amp; hash;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">hashIt</span>(<span class="params">data</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> hash = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">var</span> length = data.<span class="property">length</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">    <span class="keyword">var</span> char = data.<span class="title function_">charCodeAt</span>(i);</span><br><span class="line">    hash = ((hash &lt;&lt; <span class="number">5</span>) - hash) + char;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Convert to 32-bit integer</span></span><br><span class="line">    hash = hash &amp; hash;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="不要在代码库中遗留被注释掉的代码"><a href="#不要在代码库中遗留被注释掉的代码" class="headerlink" title="不要在代码库中遗留被注释掉的代码"></a>不要在代码库中遗留被注释掉的代码</h3><p>版本控制的存在是有原因的。让旧代码存在于你的 history 里吧。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">doStuff</span>();</span><br><span class="line"><span class="comment">// doOtherStuff();</span></span><br><span class="line"><span class="comment">// doSomeMoreStuff();</span></span><br><span class="line"><span class="comment">// doSoMuchStuff();</span></span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">doStuff</span>();</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="不需要版本更新类型注释"><a href="#不需要版本更新类型注释" class="headerlink" title="不需要版本更新类型注释"></a>不需要版本更新类型注释</h3><p>记住，我们可以使用版本控制。废代码、被注释的代码及用注释记录代码中的版本更新说明都是没有必要的。</p>
<p>需要时可以使用 <code>git log</code> 获取历史版本。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 2016-12-20: Removed monads, didn&#x27;t understand them (RM)</span></span><br><span class="line"><span class="comment"> * 2016-10-01: Improved using special monads (JP)</span></span><br><span class="line"><span class="comment"> * 2016-02-03: Removed type-checking (LI)</span></span><br><span class="line"><span class="comment"> * 2015-03-14: Added combine with type-checking (JR)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">combine</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">combine</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="避免位置标记"><a href="#避免位置标记" class="headerlink" title="避免位置标记"></a>避免位置标记</h3><p>这些东西通常只能代码麻烦，采用适当的缩进就可以了。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">// Scope Model Instantiation</span></span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="keyword">let</span> $scope.<span class="property">model</span> = &#123;</span><br><span class="line">  <span class="attr">menu</span>: <span class="string">&#x27;foo&#x27;</span>,</span><br><span class="line">  <span class="attr">nav</span>: <span class="string">&#x27;bar&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="comment">// Action setup</span></span><br><span class="line"><span class="comment">////////////////////////////////////////////////////////////////////////////////</span></span><br><span class="line"><span class="keyword">let</span> actions = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> $scope.<span class="property">model</span> = &#123;</span><br><span class="line">  <span class="attr">menu</span>: <span class="string">&#x27;foo&#x27;</span>,</span><br><span class="line">  <span class="attr">nav</span>: <span class="string">&#x27;bar&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> actions = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>
<h3 id="避免在源文件中写入法律评论"><a href="#避免在源文件中写入法律评论" class="headerlink" title="避免在源文件中写入法律评论"></a>避免在源文件中写入法律评论</h3><p>将你的 <code>LICENSE</code> 文件置于源码目录树的根目录。</p>
<p><strong>反例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">The MIT License (MIT)</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Copyright (c) 2016 Ryan McDermott</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">Permission is hereby granted, free of charge, to any person obtaining a copy</span></span><br><span class="line"><span class="comment">of this software and associated documentation files (the &quot;Software&quot;), to deal</span></span><br><span class="line"><span class="comment">in the Software without restriction, including without limitation the rights</span></span><br><span class="line"><span class="comment">to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span></span><br><span class="line"><span class="comment">copies of the Software, and to permit persons to whom the Software is</span></span><br><span class="line"><span class="comment">furnished to do so, subject to the following conditions:</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">The above copyright notice and this permission notice shall be included in all</span></span><br><span class="line"><span class="comment">copies or substantial portions of the Software.</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span></span><br><span class="line"><span class="comment">IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span></span><br><span class="line"><span class="comment">FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span></span><br><span class="line"><span class="comment">AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span></span><br><span class="line"><span class="comment">LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span></span><br><span class="line"><span class="comment">OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE</span></span><br><span class="line"><span class="comment">SOFTWARE</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">calculateBill</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>正例</strong>:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">calculateBill</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><a href="#%E7%9B%AE%E5%BD%95">回到目录</a></strong></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mst123.github.io/nodejs/circle-load/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luopo.gif">
      <meta itemprop="name" content="马农">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="博客">
      <meta itemprop="description" content="学习记录">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/nodejs/circle-load/" class="post-title-link" itemprop="url">commonjs循环加载</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-09-20 18:00:01" itemprop="dateCreated datePublished" datetime="2023-09-20T18:00:01+08:00">2023-09-20</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/nodejs/" itemprop="url" rel="index"><span itemprop="name">nodejs</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="介绍一下commonjs循环加载的处理方式"><a href="#介绍一下commonjs循环加载的处理方式" class="headerlink" title="介绍一下commonjs循环加载的处理方式"></a>介绍一下commonjs循环加载的处理方式</h2><p><a target="_blank" rel="noopener" href="https://juejin.cn/post/6994224541312483336#heading-3">有循环加载的原理解释，理解起来更加清晰</a></p>
<p>先介绍下require的特性</p>
<p>​        1 module 被加载的时候执行，模块的所有语句都会被执行</p>
<p>​        2 module 加载后缓存，以后使用会在内存中寻找，不会二次加载</p>
<p>​        3 一旦出现某个模块被循环加载，就只输出已经执行的部分，还未执行的部分不会输出（下方解释）</p>
<p>脚本文件<code>a.js</code>代码如下。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exports</span>.<span class="property">done</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">var</span> b = <span class="built_in">require</span>(<span class="string">&#x27;./b.js&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;在 a.js 之中，b.done = %j&#x27;</span>, b.<span class="property">done</span>);</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">done</span> = <span class="literal">true</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;a.js 执行完毕&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>上面代码之中，<code>a.js</code>脚本先输出一个<code>done</code>变量，然后加载另一个脚本文件<code>b.js</code>。注意，此时<code>a.js</code>代码就停在这里，等待<code>b.js</code>执行完毕，再往下执行。</p>
<p>再看<code>b.js</code>的代码。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exports</span>.<span class="property">done</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">&#x27;./a.js&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;在 b.js 之中，a.done = %j&#x27;</span>, a.<span class="property">done</span>);</span><br><span class="line"><span class="built_in">exports</span>.<span class="property">done</span> = <span class="literal">true</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;b.js 执行完毕&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>上面代码之中，<code>b.js</code>执行到第二行，就会去加载<code>a.js</code>，这时，就发生了“循环加载”。系统会去<code>a.js</code>模块对应对象的<code>exports</code>属性取值，可是因为<code>a.js</code>还没有执行完，从<code>exports</code>属性只能取回已经执行的部分，而不是最后的值。</p>
<p><code>a.js</code>已经执行的部分，只有一行。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exports</span>.<span class="property">done</span> = <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>

<p>因此，对于<code>b.js</code>来说，它从<code>a.js</code>只输入一个变量<code>done</code>，值为<code>false</code>。</p>
<p>然后，<code>b.js</code>接着往下执行，等到全部执行完毕，再把执行权交还给<code>a.js</code>。于是，<code>a.js</code>接着往下执行，直到执行完毕。我们写一个脚本<code>main.js</code>，验证这个过程。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">&#x27;./a.js&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> b = <span class="built_in">require</span>(<span class="string">&#x27;./b.js&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;在 main.js 之中, a.done=%j, b.done=%j&#x27;</span>, a.<span class="property">done</span>, b.<span class="property">done</span>);</span><br></pre></td></tr></table></figure>

<p>执行<code>main.js</code>，运行结果如下。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ node main.<span class="property">js</span></span><br><span class="line"></span><br><span class="line">在 b.<span class="property">js</span> 之中，a.<span class="property">done</span> = <span class="literal">false</span></span><br><span class="line">b.<span class="property">js</span> 执行完毕</span><br><span class="line">在 a.<span class="property">js</span> 之中，b.<span class="property">done</span> = <span class="literal">true</span></span><br><span class="line">a.<span class="property">js</span> 执行完毕</span><br><span class="line">在 main.<span class="property">js</span> 之中, a.<span class="property">done</span>=<span class="literal">true</span>, b.<span class="property">done</span>=<span class="literal">true</span></span><br></pre></td></tr></table></figure>

<p>具体执行顺序如下</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// main.js</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">&#x27;./a.js&#x27;</span>); <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="built_in">require</span>(<span class="string">&#x27;./b.js&#x27;</span>); <span class="comment">// 12</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;在 main.js 之中, a.done=%j, b.done=%j&#x27;</span>, a.<span class="property">done</span>, b.<span class="property">done</span>); <span class="comment">// 13</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// a.js</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">done</span> = <span class="literal">false</span>; <span class="comment">// 2</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="built_in">require</span>(<span class="string">&#x27;./b.js&#x27;</span>); <span class="comment">// 3</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;在 a.js 之中，b.done = %j&#x27;</span>, b.<span class="property">done</span>); <span class="comment">// 9</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">done</span> = <span class="literal">true</span>; <span class="comment">// 10</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;a.js 执行完毕&#x27;</span>); <span class="comment">// 11</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// b.js</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">done</span> = <span class="literal">false</span>; <span class="comment">// 4</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="built_in">require</span>(<span class="string">&#x27;./a.js&#x27;</span>); <span class="comment">// 5</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;在 b.js 之中，a.done = %j&#x27;</span>, a.<span class="property">done</span>); <span class="comment">// 6</span></span><br><span class="line"><span class="built_in">exports</span>.<span class="property">done</span> = <span class="literal">true</span>; <span class="comment">// 7</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;b.js 执行完毕&#x27;</span>); <span class="comment">// 8</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mst123.github.io/%E7%AE%97%E6%B3%95/%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luopo.gif">
      <meta itemprop="name" content="马农">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="博客">
      <meta itemprop="description" content="学习记录">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E7%AE%97%E6%B3%95/%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%95%B0/" class="post-title-link" itemprop="url">二叉搜索树</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-12-29 00:00:00" itemprop="dateCreated datePublished" datetime="2021-12-29T00:00:00+08:00">2021-12-29</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-07-13 13:13:43" itemprop="dateModified" datetime="2024-07-13T13:13:43+08:00">2024-07-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="二叉搜索树"><a href="#二叉搜索树" class="headerlink" title="二叉搜索树"></a>二叉搜索树</h3><p><img src="/md-images/%E7%AE%97%E6%B3%95/assets/%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%95%B0/image-20210730105124238.png" alt="image-20210730105124238"></p>
<h3 id="常见操作"><a href="#常见操作" class="headerlink" title="常见操作"></a>常见操作</h3><p>​ 模拟操作示意网站<a target="_blank" rel="noopener" href="https://visualgo.net/zh/bst">二叉搜索树</a></p>
<ul>
<li><p>查询</p>
</li>
<li><p>插入</p>
<p>首先需要搜索是否有重复节点，如果有 count++ ，如果没有，查询到的最后节点也就是插入需要操作的节点</p>
</li>
<li><p>删除</p>
<ul>
<li>删除 叶子节点(即最底层的节点，仅有一个关联节点)很简单，直接删除就可以，如果是关联节点(有子节点)，则会找出该节点右侧最小的节点替换它的位置（即比它大的最小值），<strong>需要注意指针的替换和删除</strong></li>
</ul>
<p><img src="/md-images/%E7%AE%97%E6%B3%95/assets/%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%95%B0/image-20210730105732099.png" alt="image-20210730105732099"></p>
<p><img src="/md-images/%E7%AE%97%E6%B3%95/assets/%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%95%B0/image-20210730105831806.png" alt="image-20210730105831806"></p>
</li>
</ul>
<h3 id="时间复杂度"><a href="#时间复杂度" class="headerlink" title="时间复杂度"></a>时间复杂度</h3><p><img src="/md-images/%E7%AE%97%E6%B3%95/assets/%E4%BA%8C%E5%8F%89%E6%90%9C%E7%B4%A2%E6%95%B0/image-20210730105043533.png" alt="image-20210730105043533"></p>
<p>时间复杂度log2 N 也就是 2的X次方 &#x3D; N  x是查询次数</p>
<p>插入 一个数 首先需要搜索是否有重复节点，如果有 count++ ，如果没有，查询到的最后节点也就是插入需要操作的节点</p>
<p>删除 叶子节点(即最底层的节点，仅有一个关联节点)很简单，直接删除就可以，如果是</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mst123.github.io/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luopo.gif">
      <meta itemprop="name" content="马农">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="博客">
      <meta itemprop="description" content="学习记录">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">字符串常用方法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-12-14 00:00:00" itemprop="dateCreated datePublished" datetime="2021-12-14T00:00:00+08:00">2021-12-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-02-17 15:45:27" itemprop="dateModified" datetime="2022-02-17T15:45:27+08:00">2022-02-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B/" itemprop="url" rel="index"><span itemprop="name">数据类型</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>字符串对象是不可变的，所以字符串对象提供的涉及到字符串“修改”的方法都是返回修改后的新字符串，并不对原始字符串做任何修改，无一例外<br>JavaScript字符串由 16位码元（code unit）组成。对多数字符来说，每 16位码元对应一个字符。<br>JavaScript字符串使用了两种 Unicode编码混合的策略：UCS-2和 UTF-16。对于可以采用 16位编码 的字符（U+0000~U+FFFF）16的四次方</p>
<h2 id="charAt"><a href="#charAt" class="headerlink" title="charAt()"></a>charAt()</h2><p>charAt()方法返回给定索引位置的字符，由传给方法的整数参数指定。具体来说，这个方法查找指定索引位置的 16位码元，并返回该码元对应的字符：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let message = &quot;abcde&quot;; </span><br><span class="line"> </span><br><span class="line">console.log(message.charAt(2)); // &quot;c&quot; </span><br></pre></td></tr></table></figure>

<h2 id="charCodeAt"><a href="#charCodeAt" class="headerlink" title="charCodeAt()"></a>charCodeAt()</h2><p>使用 charCodeAt()方法可以查看指定码元的字符编码。这个方法返回指定索引位置的码元值，索引以整数指定</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let message = &quot;abcde&quot;; </span><br><span class="line">// Unicode &quot;Latin small letter C&quot;的编码是 U+0063 </span><br><span class="line">console.log(message.charCodeAt(2));  // 99 </span><br><span class="line"> </span><br></pre></td></tr></table></figure>

<h2 id="fromCharCode-原型方法"><a href="#fromCharCode-原型方法" class="headerlink" title="fromCharCode() 原型方法"></a>fromCharCode() 原型方法</h2><p>fromCharCode() 方法用于根据给定的 UTF-16 码元创建字符串中的字符。这个方法可以接受任意多个数值，并返回将所有数值对应的字符拼接起来的字符串：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console.log(String.fromCharCode(0x61, 0x62, 0x63, 0x64, 0x65));  // &quot;abcde&quot; </span><br></pre></td></tr></table></figure>

<blockquote>
<p>对于 U+0000~U+FFFF范围内的字符，length、charAt()、charCodeAt()和 fromCharCode() 返回的结果都跟预期是一样的。<br>为正确解析既包含单码元字符又包含代理对字符的字符串，与charCodeAt()有对应的 codePointAt()一样，fromCharCode()也有一个对应的 fromCodePoint()</p>
</blockquote>
<h2 id="normalize-非诚不常用"><a href="#normalize-非诚不常用" class="headerlink" title="normalize() 非诚不常用"></a>normalize() 非诚不常用</h2><p>，Unicode提供了4种规范化形式，可以将类似上面的字符规范化为一致的格式，无论 底层字符的代码是什么。这 4种规范化形式是：NFD（Normalization Form D）、NFC（Normalization Form C）、 NFKD（Normalization Form KD）和 NFKC（Normalization Form KC）。可以使用 normalize()方法对字 符串应用上述规范化形式，使用时需要传入表示哪种形式的字符串：”NFD”、”NFC”、”NFKD”或”NFKC”。</p>
<h2 id="concat"><a href="#concat" class="headerlink" title="concat()"></a>concat()</h2><p>首先是 concat()，用于将一个或多个字符串拼接成一个新字符串。concat()方法可以接收任意多个参数，因此可以一次性拼接多个字符串。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let stringValue = &quot;hello &quot;; </span><br><span class="line">let result = stringValue.concat(&quot;world&quot;, &quot;!&quot;); </span><br><span class="line">console.log(result);      // &quot;hello world!&quot; </span><br><span class="line">console.log(stringValue); // &quot;hello &quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>虽然 concat()方法可以拼接字符串，但更常用的方式是使用加号操作符（+）。而且多数情况下，对于拼接多个字符串来说，使用加号更方便。</p>
</blockquote>
<h2 id="slice-、substr-和-substring-截取字符串"><a href="#slice-、substr-和-substring-截取字符串" class="headerlink" title="slice()、substr() 和 substring() 截取字符串"></a>slice()、substr() 和 substring() 截取字符串</h2><p>这3个方法都返回调用它们的字符串的一个子字符串，而且都接收一或两个参数。第一个参数表示子字符串开始的位置，第二个参数表示子字符串结束的位置。<br>对<code>slice()</code>和<code>substring()</code>而言，第二个参数是提取结束的位置（即该位置之前的字符会被提取出来）。<br>对<code>substr()</code>而言，第二个参数表示返回的子字符串数量。任何情况下，省略第二个参数都意味着提取到字符串末尾。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let stringValue = &quot;hello world&quot;; </span><br><span class="line">console.log(stringValue.slice(3));       // &quot;lo world&quot; </span><br><span class="line">console.log(stringValue.substring(3));   // &quot;lo world&quot; </span><br><span class="line">console.log(stringValue.substr(3));      // &quot;lo world&quot; </span><br><span class="line">console.log(stringValue.slice(3, 7));    // &quot;lo w&quot; </span><br><span class="line">console.log(stringValue.substring(3,7)); // &quot;lo w&quot; </span><br><span class="line">console.log(stringValue.substr(3, 7));   // &quot;lo worl&quot;</span><br></pre></td></tr></table></figure>

<p>当某个参数是负值时，这3个方法的行为又有不同。<br>比如，slice()方法将所有负值参数都当成字符串长度加上负参数值。<br>而substr()方法将第一个负参数值当成字符串长度加上该值，将第二个负参数值转换为 0。<br>substring()方法会将所有负参数值都转换为 0。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let stringValue = &quot;hello world&quot;; </span><br><span class="line">console.log(stringValue.slice(-3));         // &quot;rld&quot; </span><br><span class="line">console.log(stringValue.substring(-3));     // &quot;hello world&quot; </span><br><span class="line">console.log(stringValue.substr(-3));        // &quot;rld&quot; </span><br><span class="line">console.log(stringValue.slice(3, -4));      // &quot;lo w&quot; </span><br><span class="line">console.log(stringValue.substring(3, -4));  // &quot;hel&quot; </span><br><span class="line">console.log(stringValue.substr(3, -4));     // &quot;&quot; (empty string) </span><br></pre></td></tr></table></figure>

<h2 id="indexOf-和-lastIndexOf-字符串位置方法"><a href="#indexOf-和-lastIndexOf-字符串位置方法" class="headerlink" title="indexOf() 和 lastIndexOf() 字符串位置方法"></a>indexOf() 和 lastIndexOf() 字符串位置方法</h2><p>这两个方法从字符串中搜索传入的字符串，并返回位置（如果没找到，则返回-1）。两者的区别在于，indexOf()方法 从字符串开头开始查找子字符串，而 lastIndexOf()方法从字符串末尾开始查找子字符串</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let stringValue = &quot;hello world&quot;; </span><br><span class="line">console.log(stringValue.indexOf(&quot;o&quot;));     // 4 </span><br><span class="line">console.log(stringValue.lastIndexOf(&quot;o&quot;)); // 7 </span><br></pre></td></tr></table></figure>

<p>这两个方法都可以接收可选的第二个参数，表示开始搜索的位置。这意味着，indexOf()会从这个参数指定的位置开始向字符串末尾搜索，<strong>忽略该位置之前</strong>的字符；lastIndexOf()则会从这个参数指定的位置开始向字符串开头搜索，<strong>忽略该位置之后</strong>直到字符串末尾的字符。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let stringValue = &quot;hello world&quot;; </span><br><span class="line">console.log(stringValue.indexOf(&quot;o&quot;, 6));     // 7 </span><br><span class="line">console.log(stringValue.lastIndexOf(&quot;o&quot;, 6)); // 4 </span><br></pre></td></tr></table></figure>

<h2 id="startsWith-、endsWith-和-includes-字符串包含方法"><a href="#startsWith-、endsWith-和-includes-字符串包含方法" class="headerlink" title="startsWith()、endsWith() 和 includes() 字符串包含方法"></a>startsWith()、endsWith() 和 includes() 字符串包含方法</h2><p>这些方法都会从字符串中搜索传入的字符串，并返回一个表示是否包含的布尔值。它们的区别在于，startsWith()检查开始于索引 0 的匹配项，endsWith()检查开始于索引(string.length - substring.length)的匹配项，而 includes()检查整个字符串</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let message = &quot;foobarbaz&quot;; </span><br><span class="line">console.log(message.startsWith(&quot;foo&quot;));  // true </span><br><span class="line">console.log(message.startsWith(&quot;bar&quot;));  // false </span><br><span class="line">console.log(message.endsWith(&quot;baz&quot;));    // true </span><br><span class="line">console.log(message.endsWith(&quot;bar&quot;));    // false  </span><br><span class="line">console.log(message.includes(&quot;bar&quot;));    // true </span><br><span class="line">console.log(message.includes(&quot;qux&quot;));    // false </span><br></pre></td></tr></table></figure>

<p>startsWith()和 includes()方法接收可选的第二个参数，表示开始搜索的位置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let message = &quot;foobarbaz&quot;; </span><br><span class="line"> </span><br><span class="line">console.log(message.startsWith(&quot;foo&quot;));     // true </span><br><span class="line">console.log(message.startsWith(&quot;foo&quot;, 1));  // false </span><br><span class="line"> </span><br><span class="line">console.log(message.includes(&quot;bar&quot;));       // true </span><br><span class="line">console.log(message.includes(&quot;bar&quot;, 4));    // false </span><br></pre></td></tr></table></figure>

<p>endsWith()方法接收可选的第二个参数，表示应该当作字符串末尾的位置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let message = &quot;foobarbaz&quot;; </span><br><span class="line"> </span><br><span class="line">console.log(message.endsWith(&quot;bar&quot;));     // false </span><br><span class="line">console.log(message.endsWith(&quot;bar&quot;, 6));  // true </span><br></pre></td></tr></table></figure>

<h2 id="trim-、-trimLeft-和-trimRight"><a href="#trim-、-trimLeft-和-trimRight" class="headerlink" title="trim()、 trimLeft() 和 trimRight()"></a>trim()、 trimLeft() 和 trimRight()</h2><p>trim()这个方法会创建字符串的一个副本，删除前、 后所有空格符，再返回结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">let stringValue = &quot;  hello world  &quot;; </span><br><span class="line">let trimmedStringValue = stringValue.trim(); </span><br><span class="line">console.log(stringValue);         // &quot;  hello world &quot; </span><br><span class="line">console.log(trimmedStringValue);  // &quot;hello world&quot; </span><br></pre></td></tr></table></figure>

<p>trimLeft()和 trimRight()方法分别用于从字符串开始和末尾清理空格符。</p>
<h2 id="repeat"><a href="#repeat" class="headerlink" title="repeat()"></a>repeat()</h2><p>这个方法接收一个整数参数，表示要将字符串复制多少次，然后返回拼接所有副本后的结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let stringValue = &quot;na &quot;; </span><br><span class="line">console.log(stringValue.repeat(16) + &quot;batman&quot;); </span><br><span class="line">// na na na na na na na na na na na na na na na na batman </span><br></pre></td></tr></table></figure>

<h2 id="padStart-和-padEnd"><a href="#padStart-和-padEnd" class="headerlink" title="padStart()和 padEnd()"></a>padStart()和 padEnd()</h2><p><code>padStart()</code>和<code>padEnd()</code>方法会复制字符串，如果小于指定长度，则在相应一边填充字符，直至满足长度条件。这两个方法的第一个参数是长度，第二个参数是可选的填充字符串，默认为空格（U+0020）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let stringValue = &quot;foo&quot;; </span><br><span class="line"> </span><br><span class="line">console.log(stringValue.padStart(6));       // &quot;   foo&quot; </span><br><span class="line">console.log(stringValue.padStart(9, &quot;.&quot;));  // &quot;......foo&quot; </span><br><span class="line"> </span><br><span class="line">console.log(stringValue.padEnd(6));         // &quot;foo   &quot; </span><br><span class="line">console.log(stringValue.padEnd(9, &quot;.&quot;));    // &quot;foo......&quot; </span><br></pre></td></tr></table></figure>

<p>可选的第二个参数并不限于一个字符。如果提供了多个字符的字符串，则会将其拼接并截断以匹配指定长度。此外，<strong>如果长度小于或等于字符串长度，则会返回原始字符串</strong>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">let stringValue = &quot;foo&quot;; </span><br><span class="line"> </span><br><span class="line">console.log(stringValue.padStart(8, &quot;bar&quot;)); // &quot;barbafoo&quot; </span><br><span class="line">console.log(stringValue.padStart(2));        // &quot;foo&quot; </span><br><span class="line"> </span><br><span class="line">console.log(stringValue.padEnd(8, &quot;bar&quot;));   // &quot;foobarba&quot; </span><br><span class="line">console.log(stringValue.padEnd(2));          // &quot;foo&quot;</span><br></pre></td></tr></table></figure>

<h2 id="toLowerCase-、toLocaleLowerCase-、toUpperCase-和-toLocaleUpperCase-大小写转换"><a href="#toLowerCase-、toLocaleLowerCase-、toUpperCase-和-toLocaleUpperCase-大小写转换" class="headerlink" title="toLowerCase()、toLocaleLowerCase()、toUpperCase() 和 toLocaleUpperCase() 大小写转换"></a>toLowerCase()、toLocaleLowerCase()、toUpperCase() 和 toLocaleUpperCase() 大小写转换</h2><p>toLowerCase()和toUpperCase()方法是原来就有的方法， 与 java.lang.String 中的方法同名。toLocaleLowerCase()和 toLocaleUpperCase()方法旨在基于特定地区实现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">let stringValue = &quot;hello world&quot;; </span><br><span class="line">console.log(stringValue.toLocaleUpperCase());  // &quot;HELLO WORLD&quot; </span><br><span class="line">console.log(stringValue.toUpperCase());        // &quot;HELLO WORLD&quot; </span><br><span class="line">console.log(stringValue.toLocaleLowerCase());  // &quot;hello world&quot; </span><br><span class="line">console.log(stringValue.toLowerCase());        // &quot;hello world&quot; </span><br></pre></td></tr></table></figure>

<h2 id="match-search-和-replace-字符串模式匹配方法"><a href="#match-search-和-replace-字符串模式匹配方法" class="headerlink" title="match() search() 和 replace() 字符串模式匹配方法"></a>match() search() 和 replace() 字符串模式匹配方法</h2><p>match()方法本质上跟 RegExp 对象的exec()方法相同。match()方法接收一个参数，可以是一个正则表达式字 符串，也可以是一个 RegExp 对象</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">let text = &quot;cat, bat, sat, fat&quot;; </span><br><span class="line">let pattern = /.at/; </span><br><span class="line"> </span><br><span class="line">// 等价于 pattern.exec(text) </span><br><span class="line">let matches = text.match(pattern); </span><br><span class="line">console.log(matches.index);      // 0 </span><br><span class="line">console.log(matches[0]);         // &quot;cat&quot; </span><br><span class="line">console.log(pattern.lastIndex);  // 0 </span><br></pre></td></tr></table></figure>

<p>search()这个方法返回模式第一个匹配的位置索引，如果没找到则返回-1。search()始终从字符串开头向后匹配模式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">let text = &quot;cat, bat, sat, fat&quot;; </span><br><span class="line">let pos = text.search(/at/); </span><br><span class="line">console.log(pos);  // 1 </span><br></pre></td></tr></table></figure>

<p>replace()方法。这个方法接收两个参数，第一个参数可以是一个 RegExp 对象或一个字符串（这个字符串不会转换为正则表达式），第二个参数可以是一个字符串或一个函数。<br>如果第一个参数是字符串，那么只会替换第一个子字符串。要想替换所有子字符串，第一个参数必须为正则表达式并且带全局标记</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let text = &quot;cat, bat, sat, fat&quot;; </span><br><span class="line">let result = text.replace(&quot;at&quot;, &quot;ond&quot;); </span><br><span class="line">console.log(result);  // &quot;cond, bat, sat, fat&quot; </span><br><span class="line"> </span><br><span class="line">result = text.replace(/at/g, &quot;ond&quot;); </span><br><span class="line">console.log(result);  // &quot;cond, bond, sond, fond&quot; </span><br></pre></td></tr></table></figure>

<h2 id="localeCompare"><a href="#localeCompare" class="headerlink" title="localeCompare()"></a>localeCompare()</h2><p>这个方法比较两个字符串，返回如下 3个值中的一个。</p>
<ul>
<li>如果按照字母表顺序，字符串应该排在字符串参数前头，则返回负值。（通常是-1，具体还要看与实际值相关的实现。） </li>
<li>如果字符串与字符串参数相等，则返回 0。 </li>
<li>如果按照字母表顺序，字符串应该排在字符串参数后头，则返回正值。（通常是 1，具体还要看与实际值相关的实现。）</li>
</ul>
<figure class="highlight plaintext"><figcaption><span>stringValue </span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">console.log(stringValue.localeCompare(&quot;brick&quot;));  // 1 </span><br><span class="line">console.log(stringValue.localeCompare(&quot;yellow&quot;)); // 0 </span><br><span class="line">console.log(stringValue.localeCompare(&quot;zoo&quot;));    // -1 </span><br></pre></td></tr></table></figure>

<h2 id="matchAll"><a href="#matchAll" class="headerlink" title="matchAll()"></a>matchAll()</h2><p>matchAll()方法返回一个正则表达式在当前字符串的所有匹配，详见ES6深入浅出《正则的扩展》的一章。</p>
<h2 id="replaceAll"><a href="#replaceAll" class="headerlink" title="replaceAll()"></a>replaceAll()</h2><p>历史上，字符串的实例方法replace()只能替换第一个匹配。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x27;aabbcc&#x27;.replace(&#x27;b&#x27;, &#x27;_&#x27;)</span><br><span class="line">// &#x27;aa_bcc&#x27;</span><br></pre></td></tr></table></figure>

<p>上面例子中，replace()只将第一个b替换成了下划线。</p>
<p>如果要替换所有的匹配，不得不使用正则表达式的g修饰符。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x27;aabbcc&#x27;.replace(/b/g, &#x27;_&#x27;)</span><br><span class="line">// &#x27;aa__cc&#x27;</span><br></pre></td></tr></table></figure>

<p>正则表达式毕竟不是那么方便和直观，<strong>ES2021</strong> 引入了replaceAll()方法，可以一次性替换所有匹配。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x27;aabbcc&#x27;.replaceAll(&#x27;b&#x27;, &#x27;_&#x27;)</span><br><span class="line">// &#x27;aa__cc&#x27;</span><br></pre></td></tr></table></figure>

<p>它的用法与replace()相同，返回一个新字符串，不会改变原字符串。</p>
<blockquote>
<p>更多详细用法见ES6深入浅出 string 方法章节</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mst123.github.io/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luopo.gif">
      <meta itemprop="name" content="马农">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="博客">
      <meta itemprop="description" content="学习记录">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/" class="post-title-link" itemprop="url">腾讯企鹅辅导 H5 性能极致优化案例</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-12-09 00:00:00" itemprop="dateCreated datePublished" datetime="2021-12-09T00:00:00+08:00">2021-12-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-07-13 13:13:32" itemprop="dateModified" datetime="2024-07-13T13:13:32+08:00">2024-07-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" itemprop="url" rel="index"><span itemprop="name">性能优化</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzI1ODE4NzE1Nw==&mid=2247490349&idx=1&sn=139c52fb354eba09c0c3c5a92dc5ffa2&chksm=ea0d51d7dd7ad8c1be5be5b17fd79f5ccc8d84fe013040232a0861290728112c75fb6061499f&scene=178&cur_album_id=1806166719669796864#rd">原文地址</a></p>
<p>很有实际意义的一片优化文章，防止链接挂掉，特地复制下来</p>
<h2 id="通过案例你可以学到什么"><a href="#通过案例你可以学到什么" class="headerlink" title="通过案例你可以学到什么"></a>通过案例你可以学到什么</h2><p>简单总结一下设计的知识点</p>
<ul>
<li>onload<ul>
<li>DOM 的解析受 JS 加载和执行的影响，尽量对 JS 进行压缩、拆分处理（HTTP2环境下），能减少 DOMContentLoaded 时间。</li>
<li>图片、视频、iframe 等资源，会阻塞 onload 事件的触发，需要优化资源的加载时机，尽快触发 onload。</li>
</ul>
</li>
<li>性能指标</li>
<li>threeshaking</li>
<li>Splitchunks 拆分首屏js</li>
<li>延迟加载非必要js prefetch</li>
<li>lazyload</li>
<li>图片优化</li>
<li>coverage 查看首屏 js css使用比例</li>
<li>critters critters-webpack-plugin 为预渲染&#x2F;SSR 的单页应用程序内联关键 CSS</li>
<li>CLF 页面布局抖动</li>
</ul>
<h2 id="项目背景"><a href="#项目背景" class="headerlink" title="项目背景"></a>项目背景</h2><p>H5 项目是企鹅辅导的核心项目，已迭代四年多，包括了课程详情页&#x2F;老师详情页&#x2F;报名页&#x2F;支付页面等页面，构建产物用于企鹅辅导 APP&#x2F;H5（微信&#x2F;QQ&#x2F;浏览器），迭代过程中了也累积了一些性能问题导致页面加载、渲染速度变慢，为了提升用户体验，近期启动了 “H5 性能优化” 项目，针对页面加载速度，渲染速度做了专项优化，下面是对本次优化的总结，包括以下几部分内容：</p>
<ol>
<li>性能优化效果展示</li>
<li>性能指标及数据采集</li>
<li>性能分析方法及环境准备</li>
<li>性能优化具体实践</li>
</ol>
<h2 id="一、性能指标及数据采集"><a href="#一、性能指标及数据采集" class="headerlink" title="一、性能指标及数据采集"></a>一、性能指标及数据采集</h2><p>企鹅辅导 H5 采用的性能指标包括：</p>
<p>\1. 页面加载时间 —— 页面以多快的速度加载和渲染元素到页面上，具体如下：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzI1ODE4NzE1Nw==&mid=2247490349&idx=1&sn=139c52fb354eba09c0c3c5a92dc5ffa2&chksm=ea0d51d7dd7ad8c1be5be5b17fd79f5ccc8d84fe013040232a0861290728112c75fb6061499f&scene=178&cur_album_id=1806166719669796864">First contentful paint (FCP)</a>：测量页面开始加载到某一块内容显示在页面上的时间。</li>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzI1ODE4NzE1Nw==&mid=2247490349&idx=1&sn=139c52fb354eba09c0c3c5a92dc5ffa2&chksm=ea0d51d7dd7ad8c1be5be5b17fd79f5ccc8d84fe013040232a0861290728112c75fb6061499f&scene=178&cur_album_id=1806166719669796864">Largest contentful paint (LCP)</a>：测量页面开始加载到最大文本块内容或图片显示在页面中的时间。</li>
<li>DomContentLoaded Event：DOM 解析完成时间。</li>
<li>OnLoad Event：页面资源加载完成时间。</li>
</ul>
<p>\2. 加载后响应时间 —— 页面加载和执行js代码后多久能响应用户交互。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzI1ODE4NzE1Nw==&mid=2247490349&idx=1&sn=139c52fb354eba09c0c3c5a92dc5ffa2&chksm=ea0d51d7dd7ad8c1be5be5b17fd79f5ccc8d84fe013040232a0861290728112c75fb6061499f&scene=178&cur_album_id=1806166719669796864">First input delay (FID)</a>：测量用户首次与网站进行交互(例如点击一个链接、按钮、js自定义控件)到浏览器真正进行响应的时间。</li>
</ul>
<p>\3. 视觉稳定性 —— 页面元素是否会以用户不期望的方式移动，并干扰用户的交互。</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzI1ODE4NzE1Nw==&mid=2247490349&idx=1&sn=139c52fb354eba09c0c3c5a92dc5ffa2&chksm=ea0d51d7dd7ad8c1be5be5b17fd79f5ccc8d84fe013040232a0861290728112c75fb6061499f&scene=178&cur_album_id=1806166719669796864">Cumulative layout shift (CLS)</a>：测量从页面开始加载到状态变为隐藏过程中，发生不可预期的 layout shifts 的累积分数。</li>
</ul>
<p>项目使用了 IMLOG 进行数据上报，<strong>ELK 体系进行现网数据监控，Grafana 配置视图</strong>，观察现网情况。</p>
<p>根据指标的数据分布，能及时发现页面数据异常采取措施。</p>
<h2 id="二、性能分析及环境准备"><a href="#二、性能分析及环境准备" class="headerlink" title="二、性能分析及环境准备"></a>二、性能分析及环境准备</h2><p>现网页面情况：</p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114724642.gif" alt="图片"></p>
<p><strong>可以看到进度条在页面已经展示后还在持续 loading，加载时间长达十几秒，比较影响了用户体验。</strong></p>
<p>根据<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzI1ODE4NzE1Nw==&mid=2247490349&idx=1&sn=139c52fb354eba09c0c3c5a92dc5ffa2&chksm=ea0d51d7dd7ad8c1be5be5b17fd79f5ccc8d84fe013040232a0861290728112c75fb6061499f&scene=178&cur_album_id=1806166719669796864">Google 开发文档</a>对浏览器架构的解释：</p>
<blockquote>
<p>当导航提交完成后，渲染进程开始着手加载资源以及渲染页面。一旦渲染进程“完成”（finished）渲染，它会通过 IPC 告知浏览器进程（注意这发生在页面上所有帧(frames) 的 <strong>onload</strong> 事件都已经被触发了而且对应的处理函数已经执行完成了的时候），然后 UI 线程就会停止导航栏上旋转的圈圈。</p>
</blockquote>
<p><strong>我们可以知道，进度条的加载时长和 onload 时间密切相关，要想进度条尽快结束就要减少 onload 时长。</strong></p>
<p>根据现状，使用 ChromeDevTool 作为基础的性能分析工具，观察页面性能情况：</p>
<ul>
<li>Network：观察网络资源加载耗时及顺序</li>
<li>Performace：观察页面渲染表现及JS执行情况</li>
<li>Lighthouse：对网站进行整体评分，找出可优化项</li>
</ul>
<p>下面以<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzI1ODE4NzE1Nw==&mid=2247490349&idx=1&sn=139c52fb354eba09c0c3c5a92dc5ffa2&chksm=ea0d51d7dd7ad8c1be5be5b17fd79f5ccc8d84fe013040232a0861290728112c75fb6061499f&scene=178&cur_album_id=1806166719669796864">企鹅辅导课程详情页</a>为案例进行分析，找出潜在的优化项。</p>
<p><strong>（注意使用 Chrome 隐身窗口并禁用插件，移除其他加载项对页面的影响。）</strong></p>
<h3 id="1-Network-分析"><a href="#1-Network-分析" class="headerlink" title="1. Network 分析"></a>1. Network 分析</h3><p>通常进行网络分析需要禁用缓存、启用网络限速（4g &#x2F; 3g） 模拟移动端弱网情况下的加载情况，因为 wifi 网络可能会抹平性能差距。</p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114704018" alt="图片"></p>
<p>可以看到 DOMContentLoaded 的时间在 6.03s ，但 onload 的时间却在 20.92s。</p>
<p>先观察 DOMContentLoaded 阶段，发现<strong>最长请求路径在 vendor.js ，JS大小为 170kB，花费时间为 4.32s。</strong></p>
<p>继续观察 DOMContentLoaded 到 onload 的这段时间：</p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114701494" alt="图片"></p>
<p><strong>可以发现 onload 事件被大量媒体资源阻塞了，关于 onload 事件的影响因素，可以参考这篇</strong><strong><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzI1ODE4NzE1Nw==&mid=2247490349&idx=1&sn=139c52fb354eba09c0c3c5a92dc5ffa2&chksm=ea0d51d7dd7ad8c1be5be5b17fd79f5ccc8d84fe013040232a0861290728112c75fb6061499f&scene=178&cur_album_id=1806166719669796864">文章</a>。</strong></p>
<p>结论是<strong>浏览器认为资源完全加载完成（HTML解析的资源和动态加载的资源）才会触发 onload。</strong></p>
<p>结合上图<strong>可以发现加载了图片、视频、iframe 等资源，阻塞了 onload 事件的触发。</strong></p>
<p><strong>Network 总结</strong></p>
<ol>
<li>DOM 的解析受 JS 加载和执行的影响，尽量对 JS 进行压缩、拆分处理（HTTP2环境下），能减少 DOMContentLoaded 时间。</li>
<li>图片、视频、iframe 等资源，会阻塞 onload 事件的触发，需要优化资源的加载时机，尽快触发 onload。</li>
</ol>
<h3 id="2-Performance-分析"><a href="#2-Performance-分析" class="headerlink" title="2. Performance 分析"></a>2. Performance 分析</h3><p>使用 Performance 模拟移动端注意手机处理器能力比 PC 差，所以一般将 CPU 设置为 4x slowdown 或 6x slowdown 进行模拟。</p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p>
<p>观察几个核心的数据：</p>
<ol>
<li><strong>Web Vitals ( FP &#x2F; FCP &#x2F; LCP &#x2F; Layout Shift ) 核心页面指标 和 Timings 时长</strong></li>
</ol>
<p>可以看到 LCP、DCL和 Onload Event 时间较长，且出现了多次 Layout Shift。</p>
<p>要 LCP 尽量早触发，需要减少页面大块元素的渲染时间，观察 Frames 或ScreenShots 的截图，关注页面的元素渲染情况。</p>
<p>可以通过在 Experience 行点击Layout Shift ，在 Summary 面板找到具体的偏移内容。</p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114701037" alt="图片"></p>
<ol>
<li><strong>Main Long Tasks 长任务数量和时长</strong></li>
</ol>
<p>可以看到页面有大量的 Long Tasks 需要进行优化，其中 couse.js (页面代码)的解析执行时间长达 800ms。</p>
<p>处理 Long Tasks，可以在开发环境进行录制，这样在 Main Timeline 能看到具体的代码执行文件和消耗时长。</p>
<p><strong>Performance 总结</strong></p>
<ol>
<li>页面 LCP 触发时间较晚，且出现多次布局偏移，影响用户体验，需要尽早渲染内容和减少布局偏移。</li>
<li>页面 Long Tasks 较多，需要对 JS 进行合理拆分和加载，减少 Long Tasks 数量，特别是 影响 DCL 和 Onload Event 的 Task。</li>
</ol>
<h3 id="3-Lighthouse-分析"><a href="#3-Lighthouse-分析" class="headerlink" title="3. Lighthouse 分析"></a>3. Lighthouse 分析</h3><p>使用 ChromeDevTool 内置 lighthouse 对页面进行跑分：</p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114701427" alt="图片"></p>
<p>分数较低，可以看到 Metrics 给出了核心的数据指标，这边显示的是 TTI SI TBT 不合格，LCP 需要提升，FCP 和 CLS 达到了良好的标准，可以查看<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzI1ODE4NzE1Nw==&mid=2247490349&idx=1&sn=139c52fb354eba09c0c3c5a92dc5ffa2&chksm=ea0d51d7dd7ad8c1be5be5b17fd79f5ccc8d84fe013040232a0861290728112c75fb6061499f&scene=178&cur_album_id=1806166719669796864">分数计算标准</a>。</p>
<p>同时 Lighthouse 会提供一些优化建议，在 Oppotunities 和 Diagnostics 项，能看到具体的操作指南，如图片大小、移除无用 JS 等，可以根据指南进行项目的优化。</p>
<p>Lighthouse 的评分内容是根据项目整体加载项目进行打分的，审查出的问题同样包含 Network、Performance 的内容，所以也可以看作是对 Network、Performance 问题的优化建议。</p>
<p><strong>Lighthouse 总结</strong></p>
<ol>
<li>根据评分，可以看出 TTI、SI、TBT、LCP这四项指标需要提高，可以参考<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzI1ODE4NzE1Nw==&mid=2247490349&idx=1&sn=139c52fb354eba09c0c3c5a92dc5ffa2&chksm=ea0d51d7dd7ad8c1be5be5b17fd79f5ccc8d84fe013040232a0861290728112c75fb6061499f&scene=178&cur_album_id=1806166719669796864">lighthouse 文档</a>进行优化。</li>
<li>Oppotunities 和 Diagnostics 提供了具体的优化建议，可以参考进行改善。</li>
</ol>
<h3 id="4-环境准备"><a href="#4-环境准备" class="headerlink" title="4. 环境准备"></a>4. 环境准备</h3><p>刚才是对线上网页进行初步的问题分析，要实际进行优化和观察，<strong>需要进行环境的模拟，让优化效果能更真实在测试环境中体现。</strong></p>
<p>代理使用：whistle、charles、fiddler 等。</p>
<p>本地环境、测试环境模拟：nginx、nohost、stke 等。</p>
<p>数据上报：IMLOG、TAM、RUM 等（这三个工具均为团队内部的日志上报工具，类似业界 log4js、sentry）。</p>
<p>前端代码打包分析：webpack-bundle-analyzer 、rollup-plugin-visualizer 等。</p>
<p>分析问题时使用本地代码，本地模拟线上环境验证优化效果，最后再部署到测试环境验证，提高开发效率。</p>
<h2 id="三、性能优化具体实践"><a href="#三、性能优化具体实践" class="headerlink" title="三、性能优化具体实践"></a>三、性能优化具体实践</h2><h3 id="PART1-加载时间优化"><a href="#PART1-加载时间优化" class="headerlink" title="PART1: 加载时间优化"></a>PART1: 加载时间优化</h3><p>Network 中对页面中加载的资源进行分类：<img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114701088" alt="图片"></p>
<p>第一部分是影响 DOM 解析的 JS 资源，可以看到这里分类为关键 JS 和非关键 JS，是根据<strong>是否参与首面渲染划分的。</strong></p>
<p>这里的非关键 JS 我们可以考虑延迟异步加载，关键 JS 进行拆分优化处理。</p>
<h4 id="1-关键-JS-打包优化"><a href="#1-关键-JS-打包优化" class="headerlink" title="1. 关键 JS 打包优化"></a>1. 关键 JS 打包优化</h4><p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114701211" alt="图片"></p>
<p>JS 文件数量8个，总体积 460.8kB，最大文件 170KB</p>
<h5 id="1-1-Splitchunks-的正确配置"><a href="#1-1-Splitchunks-的正确配置" class="headerlink" title="1.1 Splitchunks 的正确配置"></a>1.1 Splitchunks 的正确配置</h5><p>vendor.js 170kB(gzipd) 是所有页面都会加载的公共文件，打包规则是 <strong>miniChunks: 3</strong>，引用超过3次的模块将被打进这个js。</p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114701775" alt="图片"></p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114701295" alt="图片"></p>
<p>分析vendor.js的具体构成（上图）</p>
<p>以 string-strip-html.umd.js 为例 大小为34.7KB，占了 vendor.js 的 20%体积，但<strong>只有一个页面多次使用到了这个包，触发了 miniChunks 的规则</strong>，被打进了 vendor.js。</p>
<p>同理对 vendor.js 的其他模块进行分析，iosSelect.js、howler.js、weixin-js-sdk 等模块都只有 3、4 个页面&#x2F;组件依赖，但也同样打进了 vendor.js。</p>
<p>由上面的分析，我们可以得出结论：<strong>不能简单的依靠 miniChunks 规则对页面依赖模块进行抽离打包，要根据具体情况拆分公共依赖。</strong></p>
<p>修改后的 vendor 根据业务具体的需求，提取不同页面和组件都有的共同依赖（imutils&#x2F;imlog&#x2F;qqapi）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">vendor: &#123;</span><br><span class="line">  test(&#123; resource &#125;) &#123;</span><br><span class="line">    return/[\\/]node_modules[\\/](@tencent\/imutils|imlog\/)|qqapi/.test(resource);</span><br><span class="line">  &#125;,</span><br><span class="line">  name: &#x27;vendor&#x27;,</span><br><span class="line">  priority: 50,</span><br><span class="line">  minChunks: 1,</span><br><span class="line">  reuseExistingChunk: true,</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<p>而其他未指定的公共依赖，新增一个 common.js，将阈值调高到 20 或更高（当前页面数76），让公共依赖成为大多数页面的依赖，提高依赖缓存利用率，调整完后，vendor.js 的大小减少到 30KB，common.js 大小为 42KB。</p>
<p><strong>两个文件加起来大小为 72KB，相对于优化前体积减少了 60%（100KB）。</strong></p>
<h4 id="1-2-公共组件的按需加载"><a href="#1-2-公共组件的按需加载" class="headerlink" title="1.2 公共组件的按需加载"></a>1.2 公共组件的按需加载</h4><p>course.js 101kB (gzipd) 这个文件是页面业务代码的文件：</p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114701809" alt="图片"></p>
<p>观察上图，基本都是业务代码，除了一个巨大的 <strong>component Icon，占了 25k，页面文件1&#x2F;4的体积，<strong><strong>但在代码中</strong></strong>使用到的 Icon 总共才8个。</strong></p>
<p>分析代码，可以看到这里使用 require 加载 svg，<strong>Webpack 将 require 文件夹内的内容一并打包，导致页面 Icon 组件冗余。</strong></p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114701772" alt="图片"></p>
<p>如何解决这类问题实现按需加载？</p>
<p>按需加载的内容应该为独立的组件，我们将之前的单一入口的 Icon 组件（动态 dangerouslySetInnerHTML）<strong>改成单文件组件模式直接引入使用图标。</strong></p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114702059" alt="图片"></p>
<p>但实际开发中这样会有些麻烦，一般需要统一的 import 路径，指定需要的图标再加载，参考 <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzI1ODE4NzE1Nw==&mid=2247490349&idx=1&sn=139c52fb354eba09c0c3c5a92dc5ffa2&chksm=ea0d51d7dd7ad8c1be5be5b17fd79f5ccc8d84fe013040232a0861290728112c75fb6061499f&scene=178&cur_album_id=1806166719669796864">babel-plugin-import</a>，我们可以配置 babel 的依赖加载路径调整 Icon 的引入方式，这样就实现了图标的按需加载。</p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114701942" alt="图片"></p>
<p>按需加载后，重新编译，查看打包带来的收益，<strong>页面的 Icons 组件 stat size 由 74KB 降到了 20KB，体积减少了 70%。</strong></p>
<h4 id="1-3-业务组件的代码拆分-Code-Splitting"><a href="#1-3-业务组件的代码拆分-Code-Splitting" class="headerlink" title="1.3 业务组件的代码拆分 (Code Splitting)"></a>1.3 业务组件的代码拆分 (Code Splitting)</h4><p>观察页面，可以看到”课程大纲“、”课程详情“、”购课须知“这三个模块并不在页面的首屏渲染内容里：</p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114702110" alt="图片"></p>
<p>我们可以考虑对页面这几部分组件进行拆分再延迟加载，减少业务代码 JS 大小和执行时长。</p>
<p>拆分的方式很多，可以使用 react-loadable、@loadable&#x2F;component 等库实现，也可以使用React 官方提供的 React.lazy。</p>
<p>拆分后的代码：</p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114702079" alt="图片"></p>
<p><strong>代码拆分会导致组件会有渲染的延迟，所以在项目中使用应该综合用户体验和性能再做决定，通过拆分也能使部分资源延后加载优化加载时间。</strong></p>
<h4 id="1-4-Tree-Shaking-优化"><a href="#1-4-Tree-Shaking-优化" class="headerlink" title="1.4 Tree Shaking 优化"></a>1.4 Tree Shaking 优化</h4><p>项目中使用了 TreeShaking 的优化，用时候要注意 <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzI1ODE4NzE1Nw==&mid=2247490349&idx=1&sn=139c52fb354eba09c0c3c5a92dc5ffa2&chksm=ea0d51d7dd7ad8c1be5be5b17fd79f5ccc8d84fe013040232a0861290728112c75fb6061499f&scene=178&cur_album_id=1806166719669796864">sideEffects 的使用场景</a>，以免打包产物和开发不一致。</p>
<p>经过上述优化步骤，整体打包内容：</p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114701966" alt="图片"></p>
<p>JS 文件数量6个，总体积 308KB，最大文件体积 109KB</p>
<p>关键 JS 优化数据对比：</p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left">文件总体积</th>
<th align="left">最大文件体积</th>
</tr>
</thead>
<tbody><tr>
<td align="left">优化前</td>
<td align="left">460.8 kb</td>
<td align="left">170 kb</td>
</tr>
<tr>
<td align="left">优化后</td>
<td align="left">308 kb</td>
<td align="left">109 kb</td>
</tr>
<tr>
<td align="left">优化效果</td>
<td align="left">总体积减少 50%</td>
<td align="left">最大文件体积减少 56%</td>
</tr>
</tbody></table>
<h3 id="2-非关键-JS-延迟加载"><a href="#2-非关键-JS-延迟加载" class="headerlink" title="2.非关键 JS 延迟加载"></a>2.非关键 JS 延迟加载</h3><p>页面中包含了一些上报相关的 JS 如 sentry，beacon（灯塔 SDK）等，对于这类资源，如果在弱网情况，可能会成为影响 DOM 解析的因素。</p>
<p>为了减少这类非关键 JS 的影响，可以在页面完成加载后再加载非关键 JS，如 sentry 官方也提供了<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzI1ODE4NzE1Nw==&mid=2247490349&idx=1&sn=139c52fb354eba09c0c3c5a92dc5ffa2&chksm=ea0d51d7dd7ad8c1be5be5b17fd79f5ccc8d84fe013040232a0861290728112c75fb6061499f&scene=178&cur_album_id=1806166719669796864">延迟加载的方案</a>。</p>
<p>在项目中还发现了一部分非关键 JS，如验证码组件，为了在下一个页面中能利用缓存尽快加载，<strong>所以在上一个页面提前加载一次生成缓存。</strong></p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114702102" alt="图片"></p>
<p>如果不访问下一个页面，可以认为这是一次无效加载，这类的提前缓存方案反而会影响到页面性能。</p>
<p>针对这里资源，我们可以使用 Resource Hints，针对资源做 Prefetch 处理。</p>
<p>检测浏览器是否支持 Prefech，<strong>支持的情况下我们可以创建 Prefetch 链接</strong>，不支持就使用旧逻辑直接加载，这样能更大程度保证页面性能，为下一个页面提供提前加载的支持。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">const isPrefetchSupported = () =&gt; &#123;</span><br><span class="line">  const link = document.createElement(&#x27;link&#x27;);</span><br><span class="line">  const &#123; relList &#125; = link;</span><br><span class="line"> </span><br><span class="line">  if (!relList || !relList.supports) &#123;</span><br><span class="line">    returnfalse;</span><br><span class="line">  &#125;</span><br><span class="line">  return relList.supports(&#x27;prefetch&#x27;);</span><br><span class="line">&#125;;</span><br><span class="line">const prefetch = () =&gt; &#123;</span><br><span class="line">    const isPrefetchSupport = isPrefetchSupported();</span><br><span class="line">    if (isPrefetchSupport) &#123;</span><br><span class="line">      const link = document.createElement(&#x27;link&#x27;);</span><br><span class="line">      link.rel = &#x27;prefetch&#x27;;</span><br><span class="line">      link.as = type;</span><br><span class="line">      link.href = url;</span><br><span class="line">      document.head.appendChild(link);</span><br><span class="line">    &#125; elseif (type === &#x27;script&#x27;) &#123;</span><br><span class="line">            // load script</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br></pre></td></tr></table></figure>

<p>优化效果：非关键JS不影响页面加载</p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" alt="图片"></p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114702608" alt="图片"></p>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><h3 id="3-媒体资源加载优化"><a href="#3-媒体资源加载优化" class="headerlink" title="3.媒体资源加载优化"></a>3.媒体资源加载优化</h3><h4 id="3-1-加载时序优化"><a href="#3-1-加载时序优化" class="headerlink" title="3.1 加载时序优化"></a>3.1 加载时序优化</h4><p>可以观察到 onload 被大量的图片资源和视频资源阻塞了，但是页面上并没有展示对应的图片或视频，这部分内容应该进行懒加载处理。</p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114702456" alt="图片"></p>
<p>处理方式主要是要控制好图片懒加载的逻辑（如 onload 后再加载），可以借助各类 lazyload 的库去实现。H5项目用的是位置检测（getBoundingClientRect ）图片到达页面可视区域再展示。</p>
<p><strong>但要注意懒加载不能阻塞业务的正常展示，应该做好超时处理、重试等兜底措施。</strong></p>
<h4 id="3-2-大小尺寸优化"><a href="#3-2-大小尺寸优化" class="headerlink" title="3.2 大小尺寸优化"></a>3.2 大小尺寸优化</h4><p>课程详情页 每张详情图的宽为 1715px，以 6s 为基准（375px）已经是 4x 图了，大图片在弱网情况下会影响页面加载和渲染速度。</p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114702638" alt="图片"></p>
<p>使用 CDN 图床尺寸大小压缩功能，根据不同的设备渲染不同大小的图片调整图片格式，根据网络情况，渲染不同清晰度的图。</p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640.gif" alt="图片"></p>
<p>可以看到在弱网（移动 3G 网络）的情况下，同一张图片不同尺寸加载速度最高和最低相差接近 6 倍，给用户的体验截然不同。</p>
<p>CDN 配合业务具体实现：<strong>使用 img 标签 srcset&#x2F;sizes 属性和 picutre 标签实现响应式图片</strong>，具体可参考<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzI1ODE4NzE1Nw==&mid=2247490349&idx=1&sn=139c52fb354eba09c0c3c5a92dc5ffa2&chksm=ea0d51d7dd7ad8c1be5be5b17fd79f5ccc8d84fe013040232a0861290728112c75fb6061499f&scene=178&cur_album_id=1806166719669796864">文档</a>。</p>
<p><strong>使用 URL 动态拼接方式构造 URL 请求，根据机型宽度和网络情况，判断当前图片宽度倍数进行调整</strong>（如 iPhone 1x，iPad 2x，弱网 0.5x）。</p>
<p><strong>优化效果：移动端 正常网络情况下图片体积减小 220%、弱网情况下图片体积减小 13 倍。</strong></p>
<p>注意实际业务中需要视觉同学参与，评估图片的清晰度是否符合视觉标准，避免反向优化！</p>
<h4 id="3-3-其他类型资源优化"><a href="#3-3-其他类型资源优化" class="headerlink" title="3.3 其他类型资源优化"></a>3.3 其他类型资源优化</h4><p><strong>iframe</strong></p>
<p>加载 iframe 有可能会对页面的加载产生严重的影响，在 onload 之前加载会阻塞 onload 事件触发，从而阻塞 loading，但是还存在另一个问题。</p>
<p>如下图所示，页面在已经 onload 的情况下触发 iframe 的加载，进度条仍然在不停的转动，直到 iframe 的内容加载完成。</p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114703076" alt="图片"></p>
<p>可以将 iframe 的时机放在 onload 之后，并使用 setTimeout 触发异步加载 iframe，可避免 iframe 带来的 loading 影响。</p>
<p><strong>数据上报</strong></p>
<p>项目中使用 image 的数据上报请求，在正常网络情况下可能感受不到对页面性能的影响。</p>
<p>但在一些特殊情况，如其中一个图片请求的耗时特别长就会阻塞页面 onload 事件的触发，延长 loading 时间。</p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114702838" alt="图片"></p>
<p>解决上报对性能的影响问题有以下方案：</p>
<ol>
<li>延迟合并上报</li>
<li>使用 Beacon API</li>
<li>使用 post 上报</li>
</ol>
<p>H5项目采用了延迟合并上报的方案，业务可根据实际需要进行选择。</p>
<p><strong>优化效果：全部数据上报在 onload 后处理，避免对性能产生影响。</strong></p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114702897" alt="图片"></p>
<p><strong>字体优化</strong></p>
<p>项目中可能会包含很多视觉指定渲染的字体，当字体文件比较大的时候，也会影响到页面的加载和渲染，可以使用 fontmin 将字体资源进行压缩，生成精简版的字体文件。</p>
<p>优化前：20kB &#x3D;&gt; 优化后：14kB：</p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114703084" alt="图片"></p>
<h3 id="-1"><a href="#-1" class="headerlink" title=""></a></h3><h3 id="PART2-页面渲染优化"><a href="#PART2-页面渲染优化" class="headerlink" title="PART2: 页面渲染优化"></a>PART2: 页面渲染优化</h3><h4 id="1-直出页面-TTFB-时间优化"><a href="#1-直出页面-TTFB-时间优化" class="headerlink" title="1. 直出页面 TTFB 时间优化"></a>1. 直出页面 TTFB 时间优化</h4><p><em>名词解释：</em></p>
<p><em>NGW：内部网关，基于 Node.js。</em></p>
<p><em>STKE：公司内部 TKE。</em></p>
<p>目前我们在 STKE 部署了直出服务，通过监控发现直出平均耗时在 300+ms。</p>
<p><strong>TTFB 时间在 100 ～ 200 之间波动，影响了直出页面的渲染。</strong></p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114703436" alt="图片"></p>
<p>通过日志打点、<strong>查看 Nginx Accesslog 日志、网关监控耗时</strong>，得出以下数据（如图）</p>
<ul>
<li>STKE 直出程序耗时是 20ms 左右</li>
<li>直出网关 NGW -&gt; STKE 耗时 60ms 左右</li>
<li>反向代理网关 Nginx -&gt; NGW 耗时 60ms 左右</li>
</ul>
<p>登录 所在机器，ping STKE 机器，有以下数据</p>
<p><strong>平均时延在 32ms，tcp 三次握手+返回数据（最后一次 ack 时发送数据）&#x3D; 2个 rtt，约 64ms，和日志记录的数据一致</strong></p>
<p><strong>查看 NGW 机器所在区域为天津，STKE 机器所在区域为南京，可以初步判断是由机房物理距离导致的网络时延，如下图所示：</strong></p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114703195" alt="图片"></p>
<p>切换 NGW 到南京机器 ping STKE 南京的机器，有以下数据：</p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114703580" alt="图片"></p>
<p>同区域机器 ping 的网络时延只有 0.x毫秒，如下图所示：<img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114703307" alt="图片"></p>
<p>综合上述分析，直出页面TTFB时间过长的根本原因是：<strong>NGW 网关部署和 Nginx、STKE 不在同一区域，导致网络时延的产生。</strong></p>
<p>解决方案是<strong>让网关和直出服务机房部署在同一区域</strong>，执行了以下操作：</p>
<ul>
<li><strong>NGW扩容</strong></li>
<li><strong>北极星开启就近访问</strong></li>
</ul>
<p>优化前：<img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114703586" alt="图片"></p>
<p>优化后：<img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114703703" alt="图片"></p>
<p>优化效果如上图：</p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left">七天网关平均耗时</th>
</tr>
</thead>
<tbody><tr>
<td align="left">优化前</td>
<td align="left">153 ms</td>
</tr>
<tr>
<td align="left">优化后</td>
<td align="left">31 ms 优化 80%（120 ms）</td>
</tr>
</tbody></table>
<h4 id="-2"><a href="#-2" class="headerlink" title=""></a></h4><h4 id="2-页面渲染时间优化"><a href="#2-页面渲染时间优化" class="headerlink" title="2. 页面渲染时间优化"></a>2. 页面渲染时间优化</h4><p>模拟弱网情况（slow 3g）Performance 录制页面渲染情况，从下图 Screenshot 中可以发现：<img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114704068" alt="图片"></p>
<ol>
<li>DOM 开始解析，但页面还未渲染</li>
<li>CSS 文件下载完成后页面才正常渲染</li>
</ol>
<p><strong>CSS 不会阻塞页面解析，但会阻塞页面渲染，如果 CSS 文件较大或弱网情况，会影响到页面渲染时间，影响用户体验。</strong></p>
<p>借助 ChromeDevTool 的 Coverage 工具（More Tools 里面），录制页面渲染时 CSS 的使用率：</p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114704028" alt="图片"></p>
<p>发现首屏的 CSS 使用率才 15%，可以考虑<strong>对页面首屏的关键 CSS 进行内联</strong>，<strong>让页面渲染不被CSS 阻塞，再把完整 CSS 加载进来。</strong></p>
<p>实现 Critial CSS 的优化可以考虑使用 <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzI1ODE4NzE1Nw==&mid=2247490349&idx=1&sn=139c52fb354eba09c0c3c5a92dc5ffa2&chksm=ea0d51d7dd7ad8c1be5be5b17fd79f5ccc8d84fe013040232a0861290728112c75fb6061499f&scene=178&cur_album_id=1806166719669796864">critters</a>。</p>
<p>优化后效果：</p>
<p><strong>CSS 资源正在下载时，页面已经能正常渲染显示了，对比优化前，渲染时间上提升了 1～2 个 CSS 文件加载的时间。</strong></p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114704127" alt="图片"></p>
<h4 id="3-页面布局抖动优化"><a href="#3-页面布局抖动优化" class="headerlink" title="3. 页面布局抖动优化"></a>3. 页面布局抖动优化</h4><p>观察页面的元素变化：</p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114717022.gif" alt="图片"></p>
<p>优化前（左图）：图标缺失、背景图缺失、字体大小改变导致页面抖动、出现非预期页面元素导致页面抖动。</p>
<p>优化后：内容相对固定， 页面元素出现无突兀感。</p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114704716" alt="图片"></p>
<p>主要优化内容：</p>
<ol>
<li><strong>确定直出页面元素出现位置，根据直出数据做好布局</strong></li>
<li><strong>页面小图可以通过 base64 处理，页面解析的时候就会立即展示</strong></li>
<li><strong>减少动态内容对页面布局的影响，使用脱离文档流的方式或定好宽高</strong></li>
</ol>
<h2 id="四、性能优化效果展示"><a href="#四、性能优化效果展示" class="headerlink" title="四、性能优化效果展示"></a>四、性能优化效果展示</h2><p><strong>优化效果由以下指标量化：</strong></p>
<ul>
<li>首次内容绘制时间FCP（First Contentful Paint）：标记浏览器渲染来自 DOM 第一位内容的时间点。</li>
<li>视窗最大内容渲染时间LCP（Largest Contentful Paint）：代表页面可视区域接近完整渲染。</li>
<li>加载进度条时间：浏览器 onload 事件触发时间，触发后导航栏进度条显示完成。</li>
</ul>
<p><strong>Chrome 模拟器 4G 无缓存对比（左优化前、右优化后）：</strong></p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114716391.gif" alt="图片"></p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left">首屏最大内容绘制时间</th>
<th align="left">进度条加载（onload）时间</th>
</tr>
</thead>
<tbody><tr>
<td align="left">优化前</td>
<td align="left">1067 ms</td>
<td align="left">6.18s</td>
</tr>
<tr>
<td align="left">优化后</td>
<td align="left">31 ms 优化 80%（120 ms）</td>
<td align="left">1.19s 优化 81%</td>
</tr>
</tbody></table>
<p>**<br>**</p>
<p><strong>Lighthouse 跑分对比：</strong></p>
<p>优化前：</p>
<p><img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114704288" alt="图片"></p>
<p>优化后：<img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114704479" alt="图片"></p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left">性能得分</th>
</tr>
</thead>
<tbody><tr>
<td align="left">优化前</td>
<td align="left">平均 40 ～ 50</td>
</tr>
<tr>
<td align="left">优化后</td>
<td align="left">平均 75 ～ 85 提升 47%</td>
</tr>
</tbody></table>
<p><strong>srobot 性能检测一周数据</strong></p>
<p><em>srobot 是团队内的性能检测工具，使用 TRobot 指令一键创建页面健康检测，定时自动化检测页面性能及异常。</em></p>
<p>优化前：<img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114704825" alt="图片"></p>
<p>优化后：<img src="/md-images/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/assets/%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/640-20211209114705042" alt="图片"></p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left">进度条平均加载（onload）时间（4G）</th>
</tr>
</thead>
<tbody><tr>
<td align="left">优化前</td>
<td align="left">4632ms</td>
</tr>
<tr>
<td align="left">优化后</td>
<td align="left"><strong>2581ms 提升45%</strong></td>
</tr>
</tbody></table>
<p>五、优化总结和未来规划</p>
<ol>
<li>以上优化手段主要是围绕首次加载页面的耗时和渲染优化，但二次加载还有很大的优化空间 如 <strong>PWA 的使用、非直出页面骨架屏处理、CSR 转 SSR等</strong>。</li>
<li>对比竞品发现我们 CDN 的下载耗时较长，近期准备启动 CDN 上云，期待上云后 CDN 的效果提升。</li>
<li>项目迭代一直在进行，需要思考在工程上如何持续保障页面性能</li>
<li>上文是围绕课程详情页进行的分析和优化处理，虽然对项目整体做了优化处理，但性能优化没有银弹，不同页面的优化要根据页面具体需求进行，需要开发同学主动关注。</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">马农</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  





</body>
</html>
