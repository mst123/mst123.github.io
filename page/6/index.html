<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"mst123.github.io","root":"/","images":"/images","scheme":"Pisces","darkmode":true,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="学习记录">
<meta property="og:type" content="website">
<meta property="og:title" content="博客">
<meta property="og:url" content="https://mst123.github.io/page/6/index.html">
<meta property="og:site_name" content="博客">
<meta property="og:description" content="学习记录">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="马农">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://mst123.github.io/page/6/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/6/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>博客</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">博客</h1>
      <i class="logo-line"></i>
    </a>
      <img class="custom-logo-image" src="/images/gintama.jpg" alt="博客">
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="马农"
      src="/images/luopo.gif">
  <p class="site-author-name" itemprop="name">马农</p>
  <div class="site-description" itemprop="description">学习记录</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">105</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">125</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mst123.github.io/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/render/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luopo.gif">
      <meta itemprop="name" content="马农">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="博客">
      <meta itemprop="description" content="学习记录">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/render/" class="post-title-link" itemprop="url">4.浏览器渲染</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-06-15 00:00:00" itemprop="dateCreated datePublished" datetime="2021-06-15T00:00:00+08:00">2021-06-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-07-13 14:30:33" itemprop="dateModified" datetime="2024-07-13T14:30:33+08:00">2024-07-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" itemprop="url" rel="index"><span itemprop="name">性能优化</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="浏览器渲染流程"><a href="#浏览器渲染流程" class="headerlink" title="浏览器渲染流程"></a>浏览器渲染流程</h3><p><img src="/assets/render/image-20210122101059973.png" alt="image-20210122101059973"></p>
<ol>
<li>触发视觉变化（不仅仅是js控制还有可能是css）</li>
<li>浏览器对样式进行重新计算</li>
<li>计算出新的元素布局</li>
<li>浏览器进行重新绘制</li>
<li>渲染层的合成</li>
</ol>
<blockquote>
<p>浏览器初次加载会完整的走过整个流程，但是之后我们可以对这个流程进行优化，避免非必要的流程</p>
</blockquote>
<h3 id="布局-layouts-与绘制-paint"><a href="#布局-layouts-与绘制-paint" class="headerlink" title="布局(layouts)与绘制(paint)"></a>布局(layouts)与绘制(paint)</h3><blockquote>
<p><strong>详细的回流重绘见下一篇文章</strong></p>
</blockquote>
<ul>
<li>渲染树只包含网页需要的节点（不包括meta、display：none）</li>
<li>布局计算每个节点接触的位置和大小</li>
<li>绘制是像素化每个节点的过程</li>
</ul>
<p><strong>重新布局被称为reflow 回流，重新绘制被称为repaint 重绘</strong></p>
<ol>
<li>回流(<code>reflow</code>), 布局引擎为<code>frame</code>计算图形, 以确定对象位置, 浏览器根据各种样式来计算结果放在它该出现的位置.<ul>
<li><strong>YaHoo!性能小组总结了一些导致<code>回流</code>发生的一些因素:</strong><ol>
<li>调整窗口大小</li>
<li>改变字体</li>
<li>增加或者移除样式表</li>
<li>内容变化，比如用户在 input 框中输入文字, CSS3 动画等</li>
<li>激活 <code>CSS</code> 伪类，比如 <code>:hover</code></li>
<li>操作<code>class</code>属性</li>
<li>脚本操作<code>DOM</code></li>
<li>计算<code>offsetWidth</code>和<code>offsetHeight</code>属性</li>
<li>设置 style 属性的值</li>
</ol>
</li>
<li>当不可避免的出现回流时，应该避免 layout thrashing 布局抖动<ul>
<li>避免回流（减少次数）</li>
<li>读写分离（可以借助fastdom）</li>
</ul>
</li>
</ul>
</li>
<li>重绘(<code>repaint</code>), 当计算好盒子模型的位置, 大小以及其他属性后, 浏览器就根据各自的特性进行绘制一遍, 显现出来给用户看<ul>
<li>重绘则是视觉效果变化引起的重新绘制。比如 <code>color</code> 或者 <code>background</code> 发生了变化，那就该给触发重绘的元素化化妆，化成它想要的样子。</li>
</ul>
</li>
</ol>
<p>回流与重绘两者之间的联系在于: <strong>触发回流一定会触发重绘, 而触发重绘却不一定会触发回流</strong>。</p>
<h3 id="复合线程-compositor-thread-与图层-layers"><a href="#复合线程-compositor-thread-与图层-layers" class="headerlink" title="复合线程(compositor thread)与图层(layers)"></a>复合线程(compositor thread)与图层(layers)</h3><p>详细介绍见 <a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000014520786">https://segmentfault.com/a/1190000014520786</a></p>
<p>淘宝团队的文章 <a target="_blank" rel="noopener" href="https://fed.taobao.org/blog/taofed/do71ct/performance-composite/">https://fed.taobao.org/blog/taofed/do71ct/performance-composite/</a></p>
<p>提升到合成层的最好方法就是 用 <strong>transfrom + opacity 搭配 will-change</strong></p>
<p>京东和淘宝的轮播容器都是采用opacity + transform 3d</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">opacity: 1;</span><br><span class="line">transform: translate3d(0px, 0px, 0px);</span><br><span class="line">transition: none 0s ease 0s;</span><br></pre></td></tr></table></figure>

<h3 id="优化相关的函数"><a href="#优化相关的函数" class="headerlink" title="优化相关的函数"></a>优化相关的函数</h3><p>一帧的声明周期</p>
<p><img src="/assets/render/image-20210122121308752.png" alt="image-20210122121308752"></p>
<h4 id="requestAnimationFrame"><a href="#requestAnimationFrame" class="headerlink" title="requestAnimationFrame"></a>requestAnimationFrame</h4><p>防抖应用，按照实际帧数触发</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">let flag = false;</span><br><span class="line">window.addEventListener(&quot;pointermove&quot;, () =&gt; &#123;</span><br><span class="line">  if (flag) &#123;</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line">  flag = true;</span><br><span class="line">  window.requestAnimationFrame(() =&gt; &#123;</span><br><span class="line">    /* </span><br><span class="line">     * 处理事件</span><br><span class="line">    */</span><br><span class="line">    flag = false;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="requestIdleCallback"><a href="#requestIdleCallback" class="headerlink" title="requestIdleCallback"></a>requestIdleCallback</h4><p><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Window/requestIdleCallback#Browser_compatibility">mdn上的requestIdleCallback</a></p>
<p>案例： react 16 通过rAF 模拟 rIF 进行事件调度  </p>
<p>下图是rAF 和 rIF 的不同</p>
<p><img src="/assets/render/image-20210122142533699.png" alt="image-20210122142533699"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mst123.github.io/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E6%80%A7%E8%83%BD%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luopo.gif">
      <meta itemprop="name" content="马农">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="博客">
      <meta itemprop="description" content="学习记录">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E6%80%A7%E8%83%BD%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7/" class="post-title-link" itemprop="url">3.性能调试工具</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-06-08 00:00:00" itemprop="dateCreated datePublished" datetime="2021-06-08T00:00:00+08:00">2021-06-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-05-06 17:49:46" itemprop="dateModified" datetime="2022-05-06T17:49:46+08:00">2022-05-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" itemprop="url" rel="index"><span itemprop="name">性能优化</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>简单记录工具的本地化，可以跳过</p>
<h3 id="测试工具"><a href="#测试工具" class="headerlink" title="测试工具"></a>测试工具</h3><ul>
<li>Chrome DevTools  开发调试、性能评测</li>
<li>Lighthouse  网站整体质量评估</li>
<li>WebPackTest 多测试地点、全面性能报告<ul>
<li><a target="_blank" rel="noopener" href="https://www.webpagetest.org/runtest.php">地址</a></li>
<li>主要是三个指标，waterfall 、first view、repeat view</li>
</ul>
</li>
</ul>
<h3 id="lighthouse-使用"><a href="#lighthouse-使用" class="headerlink" title="lighthouse 使用"></a>lighthouse 使用</h3><ul>
<li>可以使用npm 全局安装</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">npm install -g lighthouse</span><br><span class="line"></span><br><span class="line">Lighthouse http://www.bilibili.com</span><br><span class="line">会生成一个本地测试报告</span><br></pre></td></tr></table></figure>

<ul>
<li>直接用chrome浏览器</li>
</ul>
<h3 id="WebPageTest本地部署说明"><a href="#WebPageTest本地部署说明" class="headerlink" title="WebPageTest本地部署说明"></a>WebPageTest本地部署说明</h3><ol>
<li><p>拉取镜像</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker pull webpagetest/server</span><br><span class="line"></span><br><span class="line">docker pull webpagetest/agent</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行实例</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p 4000:80 --rm webpagetest/server</span><br><span class="line"></span><br><span class="line">docker run -d -p 4001:80 --network=&quot;host&quot; -e &quot;SERVER_URL=http://localhost:4000/work/&quot; -e &quot;LOCATION=Test&quot; webpagetest/agent</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="mac-用户自定义镜像"><a href="#mac-用户自定义镜像" class="headerlink" title="mac 用户自定义镜像"></a>mac 用户自定义镜像</h4><ol>
<li><p>创建server目录</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir wpt-mac-server</span><br><span class="line">cd wpt-mac-server</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建Dockerfile，添加内容</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim Dockerfile</span><br><span class="line"></span><br><span class="line">FROM webpagetest/server</span><br><span class="line">ADD locations.ini /var/www/html/settings/</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建locations.ini配置文件，添加内容</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">vim locations.ini</span><br><span class="line"></span><br><span class="line">[locations]</span><br><span class="line">1=Test_loc</span><br><span class="line">[Test_loc]</span><br><span class="line">1=Test</span><br><span class="line">label=Test Location</span><br><span class="line">group=Desktop</span><br><span class="line">[Test]</span><br><span class="line">browser=Chrome,Firefox</span><br><span class="line">label=&quot;Test Location&quot;</span><br><span class="line">connectivity=LAN</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建自定义server镜像</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t wpt-mac-server .</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建agent目录</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir wpt-mac-agent</span><br><span class="line">cd wpt-mac-agent</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建Dockerfile，添加内容</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim Dockerfile</span><br><span class="line"></span><br><span class="line">FROM webpagetest/agent</span><br><span class="line">ADD script.sh /</span><br><span class="line">ENTRYPOINT /script.sh</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建script.sh， 添加内容</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">vim script.sh</span><br><span class="line"></span><br><span class="line">#!/bin/bash</span><br><span class="line">set -e</span><br><span class="line">if [ -z &quot;$SERVER_URL&quot; ]; then</span><br><span class="line">  echo &gt;&amp;2 &#x27;SERVER_URL not set&#x27;</span><br><span class="line">  exit 1</span><br><span class="line">fi</span><br><span class="line">if [ -z &quot;$LOCATION&quot; ]; then</span><br><span class="line">  echo &gt;&amp;2 &#x27;LOCATION not set&#x27;</span><br><span class="line">  exit 1</span><br><span class="line">fi</span><br><span class="line">EXTRA_ARGS=&quot;&quot;</span><br><span class="line">if [ -n &quot;$NAME&quot; ]; then</span><br><span class="line">  EXTRA_ARGS=&quot;$EXTRA_ARGS --name $NAME&quot;</span><br><span class="line">fi</span><br><span class="line">python /wptagent/wptagent.py --server $SERVER_URL --location $LOCATION $EXTRA_ARGS --xvfb --dockerized -vvvvv --shaper none</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改script.sh权限</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chmod u+x script.sh</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建自定义agent镜像</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker build -t wpt-mac-agent .</span><br></pre></td></tr></table></figure>
</li>
<li><p>用新镜像运行实例 (注意先停掉之前运行的containers)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker ps 查看docker实例 </span><br><span class="line">docker stop 实例id 实例id 即可停止</span><br><span class="line">docker run -d -p 4000:80 --rm wpt-mac-server</span><br><span class="line">docker run -d -p 4001:80 --network=&quot;host&quot; -e &quot;SERVER_URL=http://localhost:4000/work/&quot; -e &quot;LOCATION=Test&quot; wpt-mac-agent</span><br></pre></td></tr></table></figure>
</li>
<li><p>m1平台构建有问题 应该是需要 设置–platform 暂时不会</p>
</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mst123.github.io/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/rail/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luopo.gif">
      <meta itemprop="name" content="马农">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="博客">
      <meta itemprop="description" content="学习记录">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/rail/" class="post-title-link" itemprop="url">2.什么是RAIL</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-06-06 00:00:00" itemprop="dateCreated datePublished" datetime="2021-06-06T00:00:00+08:00">2021-06-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2022-02-17 15:53:04" itemprop="dateModified" datetime="2022-02-17T15:53:04+08:00">2022-02-17</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" itemprop="url" rel="index"><span itemprop="name">性能优化</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="RAIL的概念"><a href="#RAIL的概念" class="headerlink" title="RAIL的概念"></a>RAIL的概念</h3><ol>
<li>Response 响应</li>
<li>Animation 动画</li>
<li>Idle 空闲</li>
<li>Load 加载</li>
</ol>
<h3 id="RAIL评估标准"><a href="#RAIL评估标准" class="headerlink" title="RAIL评估标准"></a>RAIL评估标准</h3><ol>
<li>响应： 处理事件应在50ms以内完成</li>
<li>动画：每10ms产生一帧（1&#x2F;60 &#x3D; 16.66）剩余毫秒值 浏览器需要渲染</li>
<li>空闲： 尽可能增加空闲事件</li>
<li>加载：在5s内完成内容加载，并可以交互</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mst123.github.io/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E5%9F%BA%E7%A1%80%E8%B0%83%E8%AF%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luopo.gif">
      <meta itemprop="name" content="马农">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="博客">
      <meta itemprop="description" content="学习记录">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/%E5%9F%BA%E7%A1%80%E8%B0%83%E8%AF%95/" class="post-title-link" itemprop="url">1.基本调试</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-06-01 00:00:00" itemprop="dateCreated datePublished" datetime="2021-06-01T00:00:00+08:00">2021-06-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-07-13 14:30:32" itemprop="dateModified" datetime="2024-07-13T14:30:32+08:00">2024-07-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%80%A7%E8%83%BD%E4%BC%98%E5%8C%96/" itemprop="url" rel="index"><span itemprop="name">性能优化</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="chrome-浏览器调试工具的使用"><a href="#chrome-浏览器调试工具的使用" class="headerlink" title="chrome 浏览器调试工具的使用"></a>chrome 浏览器调试工具的使用</h2><h3 id="network性能测试"><a href="#network性能测试" class="headerlink" title="network性能测试"></a>network性能测试</h3><p><img src="/assets/%E5%9F%BA%E7%A1%80%E8%B0%83%E8%AF%95/image-20210118103539289.png" alt="image-20210118103539289"></p>
<p>打开调试工具 -&gt; network 注意打钩选项 然后按住刷新，选择清空缓存并硬性重新加载</p>
<p><img src="/assets/%E5%9F%BA%E7%A1%80%E8%B0%83%E8%AF%95/image-20210118104323123.png" alt="image-20210118104323123"></p>
<blockquote>
<p>network底部有 transferred over network和 resources loaded by the page. 这两个大小有何区别？后边那个指的是解压后的大小，前边那个指的是源文件</p>
</blockquote>
<p>下面重点研究瀑布图</p>
<p><img src="/assets/%E5%9F%BA%E7%A1%80%E8%B0%83%E8%AF%95/image-20210118104749352.png" alt="image-20210118104749352"></p>
<p>  瀑布图由长短不一的条状图构成，处于同一竖线起点的请求，就是并行请求，并行请求数量浏览器有上限，其他的请求必须等上一个请求完成后，才可以发出，瀑布图上可以看到</p>
<p>​ 瀑布图上蓝色竖线表示dom加载完成的时间，红色表示所有资源加载完成的时间。</p>
<p>​ 把鼠标放在到瀑布图上，还可以展示具体的时间构成</p>
<p><img src="/assets/%E5%9F%BA%E7%A1%80%E8%B0%83%E8%AF%95/image-20210118105340061.png" alt="image-20210118105340061"></p>
<blockquote>
<p>TTFB(Time To First Byte)</p>
</blockquote>
<p>可以把结果保存至本地</p>
<p><img src="/assets/%E5%9F%BA%E7%A1%80%E8%B0%83%E8%AF%95/image-20210118110952135.png" alt="image-20210118110952135"></p>
<h3 id="lighthouse"><a href="#lighthouse" class="headerlink" title="lighthouse"></a>lighthouse</h3><p>主要看两个属性</p>
<p><img src="/assets/%E5%9F%BA%E7%A1%80%E8%B0%83%E8%AF%95/image-20210118110414575.png" alt="image-20210118110414575"></p>
<h3 id="帧数"><a href="#帧数" class="headerlink" title="帧数"></a>帧数</h3><p><code>command</code>+<code>shift</code>+<code>p</code>  输入frame 选择展示帧数</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mst123.github.io/%E5%A4%A7%E5%89%8D%E7%AB%AF/%E9%89%B4%E6%9D%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luopo.gif">
      <meta itemprop="name" content="马农">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="博客">
      <meta itemprop="description" content="学习记录">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%A4%A7%E5%89%8D%E7%AB%AF/%E9%89%B4%E6%9D%83/" class="post-title-link" itemprop="url">鉴权的几种方式介绍对比</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-05-30 00:00:00" itemprop="dateCreated datePublished" datetime="2021-05-30T00:00:00+08:00">2021-05-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-07-13 13:13:22" itemprop="dateModified" datetime="2024-07-13T13:13:22+08:00">2024-07-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%A4%A7%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">大前端</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>转载于<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/271768645">知乎</a></p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>说起鉴权大家应该都很熟悉，不过作为前端开发来讲，鉴权的流程大头都在后端小哥那边，本文的目的就是为了让大家了解一下常见的鉴权的方式和原理。</p>
<p>认知：HTTP 是一个无状态协议，所以客户端每次发出请求时，下一次请求无法得知上一次请求所包含的状态数据。</p>
<h2 id="一、HTTP-Auth-Authentication"><a href="#一、HTTP-Auth-Authentication" class="headerlink" title="一、HTTP Auth Authentication"></a>一、HTTP Auth Authentication</h2><h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p>HTTP 提供一个用于权限控制和认证的通用框架。最常用的HTTP认证方案是HTTP Basic Authentication</p>
<p><img src="/assets/%E9%89%B4%E6%9D%83/v2-71336270489a1f46abaacd308d8d9fde_720w.jpg" alt="img"></p>
<h3 id="鉴权流程"><a href="#鉴权流程" class="headerlink" title="鉴权流程"></a>鉴权流程</h3><p><img src="/assets/%E9%89%B4%E6%9D%83/v2-b957b0802ac5bd9cab96e3a4594147b5_720w.jpg" alt="img"></p>
<h3 id="加解密过程"><a href="#加解密过程" class="headerlink" title="加解密过程"></a>加解密过程</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Authorization 加密过程</span></span><br><span class="line"><span class="keyword">let</span> email = <span class="string">&quot;postmail@test.com&quot;</span></span><br><span class="line"><span class="keyword">let</span> password = <span class="string">&quot;12345678&quot;</span></span><br><span class="line"><span class="keyword">let</span> auth = <span class="string">`<span class="subst">$&#123;email&#125;</span>:<span class="subst">$&#123;password&#125;</span>`</span></span><br><span class="line"><span class="keyword">const</span> buf = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(auth, <span class="string">&#x27;ascii&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">info</span>(buf.<span class="title function_">toString</span>(<span class="string">&#x27;base64&#x27;</span>)); <span class="comment">// cG9zdG1haWxAdGVzdC5jb206MTIzNDU2Nzg=</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Authorization 解密过程</span></span><br><span class="line"><span class="keyword">const</span> buf = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(authorization.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>)[<span class="number">1</span>] || <span class="string">&#x27;&#x27;</span>),  <span class="string">&#x27;base64&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> user = buf.<span class="title function_">toString</span>(<span class="string">&#x27;ascii&#x27;</span>).<span class="title function_">split</span>(<span class="string">&#x27;:&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="其他-HTTP-认证"><a href="#其他-HTTP-认证" class="headerlink" title="其他 HTTP 认证"></a>其他 HTTP 认证</h3><p>通用 HTTP 身份验证框架有多个验证方案使用。不同的验证方案会在安全强度上有所不同。</p>
<p>IANA 维护了<a href="https://link.zhihu.com/?target=http://www.iana.org/assignments/http-authschemes/http-authschemes.xhtml">一系列的验证方案</a>，除此之外还有其他类型的验证方案由虚拟主机服务提供，例如 Amazon AWS ，常见的验证方案包括：</p>
<ul>
<li>Basic (查看 <a href="https://link.zhihu.com/?target=https://tools.ietf.org/html/rfc7617">RFC 7617</a>, Base64 编码凭证. 详情请参阅下文.),</li>
<li>Bearer (查看 <a href="https://link.zhihu.com/?target=https://tools.ietf.org/html/rfc6750">RFC 6750</a>, bearer 令牌通过OAuth 2.0保护资源),</li>
<li>Digest (查看 <a href="https://link.zhihu.com/?target=https://tools.ietf.org/html/rfc6750">RFC 7616</a>, 只有 md5 散列 在Firefox中支持, 查看 <a href="https://link.zhihu.com/?target=https://bugzilla.mozilla.org/show_bug.cgi?id=472823">bug 472823</a> 用于SHA加密支持),</li>
<li>HOBA (查看 <a href="https://link.zhihu.com/?target=https://tools.ietf.org/html/rfc7486">RFC 7486</a> (草案), HTTP Origin-Bound 认证, 基于数字签名),</li>
<li>Mutual (查看 <a href="https://link.zhihu.com/?target=https://tools.ietf.org/html/draft-ietf-httpauth-mutual-11">draft-ietf-httpauth-mutual</a>),</li>
<li>AWS4-HMAC-SHA256 (查看 <a href="https://link.zhihu.com/?target=http://docs.aws.amazon.com/AmazonS3/latest/API/sigv4-auth-using-authorization-header.html">AWS docs</a>)</li>
</ul>
<h2 id="二、Cookie-Session"><a href="#二、Cookie-Session" class="headerlink" title="二、Cookie + Session"></a>二、Cookie + Session</h2><h3 id="注册流程"><a href="#注册流程" class="headerlink" title="注册流程"></a>注册流程</h3><p><img src="/assets/%E9%89%B4%E6%9D%83/v2-63251d6ab5fb9daa53fd70eb7c75c873_720w.jpg" alt="img"></p>
<p><a href="https://link.zhihu.com/?target=https://www.cnblogs.com/apolloren/p/11985083.html">思考：为什么要在密码里加点“盐”？</a></p>
<h3 id="鉴权流程-1"><a href="#鉴权流程-1" class="headerlink" title="鉴权流程"></a>鉴权流程</h3><p><img src="/assets/%E9%89%B4%E6%9D%83/v2-8dda0c46d5fdd8e08ad79ffa7f7e8174_720w.jpg" alt="img"></p>
<h3 id="Session-存储"><a href="#Session-存储" class="headerlink" title="Session 存储"></a>Session 存储</h3><p>最常用的 Session 存储方式是 KV 存储，如Redis，在分布式、API 支持、性能方面都是比较好的，除此之外还有 mysql、file 存储。</p>
<p>如果服务是分布式的，使用 file 存储，多个服务间存在同步 session 的问题；高并发情况下错误读写锁的控制。</p>
<h3 id="Session-Refresh"><a href="#Session-Refresh" class="headerlink" title="Session Refresh"></a>Session Refresh</h3><p>我们上面提到的流程中，缺少 Session 的刷新的环节，我们不能在用户登录之后经过一个 expires 时间就把用户踢出去，如果在 Session 有效期间用户一直在操作，这时候 expires 时间就应该刷新。</p>
<p>以 Koa 为例，刷新 Session 的机制也比较简单： 开发一个 middleware（默认情况下所有请求都会经过该 middleware），如果校验 Session 有效，就更新 Session 的 expires: 当前时间+过期时间。</p>
<p><img src="/assets/%E9%89%B4%E6%9D%83/v2-4d4fa3b83c1e6275d1fa3a7f1731d8da_720w.jpg" alt="img"></p>
<p><strong>优化：</strong></p>
<ol>
<li>频繁更新 session 会影响性能，可以在 session 快过期的时候再更新过期时间。</li>
<li>如果某个用户一直在操作，同一个 sessionID 可能会长期有效，如果相关 cookie 泄露，可能导致比较大的风险，可以在生成 sessionID 的同时生成一个 refreshID，在 sessionID 过期之后使用 refreshID 请求服务端生成新的 sessionID（这个方案需要前端判断 sessionID 失效，并携带 refreshID 发请求)。</li>
</ol>
<h3 id="单设备登录"><a href="#单设备登录" class="headerlink" title="单设备登录"></a>单设备登录</h3><p>有些情况下，只允许一个帐号在一个端下登录，如果换了一个端，需要把之前登录的端踢下线（默认情况下，同一个帐号可以在不同的端下同时登录的）。</p>
<p>这时候可以借助一个服务保存用户唯一标识和 sessionId 值的对应关系，如果同一个用户，但 sessionId 不一样，则不允许登录或者把之前的踢下线(删除旧 session )。</p>
<h2 id="三、JWT"><a href="#三、JWT" class="headerlink" title="三、JWT"></a>三、JWT</h2><h3 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h3><p>JSON Web Token (JWT)是一个开放标准(RFC 7519)，它定义了一种紧凑的、自包含的方式，用于作为JSON对象在各方之间安全地传输信息。该信息可以被验证和信任，因为它是数字签名的。</p>
<h3 id="JWT-组成"><a href="#JWT-组成" class="headerlink" title="JWT 组成"></a>JWT 组成</h3><p>JWT 由三部分组成，分别是 header(头部)，payload(载荷)，signature(签证) 这三部分以小数点连接起来。</p>
<p>例如使用名为 jwt-token 的cookie来存储 JWT 例如：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jwt-token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJuYW1lIjoibHVzaGlqaWUiLCJpYXQiOjE1MzI1OTUyNTUsImV4cCI6MTUzMjU5NTI3MH0.WZ9_poToN9llFFUfkswcpTljRDjF4JfZcmqYS0JcKO8;</span><br></pre></td></tr></table></figure>

<p>使用<code>.</code>分割值可以得到三部分组成元素，按照顺序分别为：</p>
<ul>
<li><p><code>header</code>：</p>
<ul>
<li><ul>
<li>值：eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9</li>
</ul>
</li>
<li>Base64 解码: <code>&#123;&quot;alg&quot;: &quot;HS256&quot;, &quot;type&quot;: &quot;JWT&quot;&#125;</code></li>
</ul>
</li>
<li><p><code>payload</code>：</p>
<ul>
<li><ul>
<li>值：eyJuYW1lIjoibHVzaGlqaWUiLCJpYXQiOjE1MzI1OTUyNTUsImV4cCI6MTUzMjU5NTI3MH0</li>
</ul>
</li>
<li>Base64 解码：</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;       </span><br><span class="line">    <span class="string">&quot;name&quot;</span>: <span class="string">&quot;lushijie&quot;</span>,        </span><br><span class="line">    <span class="string">&quot;iat&quot;</span>: <span class="number">1532595255</span>, <span class="comment">// 发布时间       </span></span><br><span class="line">    <span class="string">&quot;exp&quot;</span>: <span class="number">1532595270</span> <span class="comment">// 过期时间     </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>signature</code>：</p>
<ul>
<li><ul>
<li>值：WZ9_poToN9llFFUfkswcpTljRDjF4JfZcmqYS0JcKO8</li>
</ul>
</li>
<li>解码：</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> headerEncode = <span class="title function_">base64Encode</span>(header);     </span><br><span class="line"><span class="keyword">const</span> payloadEncode = <span class="title function_">base64Encode</span>(payload);     </span><br><span class="line"><span class="keyword">let</span> signature = <span class="title class_">HMACSHA256</span>(headerEncode + <span class="string">&#x27;.&#x27;</span> + payloadEncode, <span class="string">&#x27;密钥&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ul>
<li>防CSRF（主要是伪造请求，带上cookie）</li>
<li>适合移动应用 app</li>
</ul>
<h3 id="鉴权流程-2"><a href="#鉴权流程-2" class="headerlink" title="鉴权流程"></a>鉴权流程</h3><p><img src="/assets/%E9%89%B4%E6%9D%83/v2-470f68419e3a414cbbfb7cc4162c2e12_720w.jpg" alt="img"></p>
<h3 id="Token-校验"><a href="#Token-校验" class="headerlink" title="Token 校验"></a>Token 校验</h3><p>对于验证一个 JWT 是否有效也是比较简单的，服务端根据前面介绍的计算方法计算出 signature，和要校验的JWT中的 signature 部分进行对比就可以了，如果 signature 部分相等则是一个有效的 JWT。</p>
<h3 id="Token-Refresh"><a href="#Token-Refresh" class="headerlink" title="Token Refresh"></a>Token Refresh</h3><p>为了减少 JWT Token 泄露风险，一般有效期会设置的比较短。 这样就会存在 JWT Token 过期的情况，我们不可能让用户频繁去登录获取新的 JWT Token。</p>
<p><strong>解决方案：</strong></p>
<p>可以同时生成 JWT Token 与 Refresh Token，其中 Refresh Roken 的有效时间长于 JWT Token，这样当 JWT Token 过期之后，使用 Refresh Token 获取新的 JWT Token 与 Refresh Token，<strong>其中 Refresh Token 只能使用一次</strong>。</p>
<h2 id="四、OAuth"><a href="#四、OAuth" class="headerlink" title="四、OAuth"></a>四、OAuth</h2><p><a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2019/04/oauth_design.html">阮一峰通俗介绍OAuth</a></p>
<p><a href="https://link.zhihu.com/?target=http://www.ruanyifeng.com/blog/2019/04/oauth-grant-types.html">OAuth 2.0 的四种方式 - 阮一峰的网络日志www.ruanyifeng.com<img src="/assets/https:/pic2.zhimg.com/v2-b80f9dfb7ec08c42b4563246d8d137d5_180x120.jpg" alt="图标"></a></p>
<p>下面是转载，防止链接失效</p>
<h3 id="RFC-6749"><a href="#RFC-6749" class="headerlink" title="RFC 6749"></a>RFC 6749</h3><p>OAuth 2.0 的标准是 <a target="_blank" rel="noopener" href="https://tools.ietf.org/html/rfc6749">RFC 6749</a> 文件。该文件先解释了 OAuth 是什么。</p>
<p>OAuth 引入了一个授权层，用来分离两种不同的角色：客户端和资源所有者。……资源所有者同意以后，资源服务器可以向客户端颁发令牌。客户端通过令牌，去请求数据。</p>
<p>这段话的意思就是，<strong>OAuth 的核心就是向第三方应用颁发令牌。</strong>然后，RFC 6749 接着写道：</p>
<p>（由于互联网有多种场景，）本标准定义了获得令牌的四种授权方式（authorization grant ）。</p>
<p>也就是说，<strong>OAuth 2.0 规定了四种获得令牌的流程。你可以选择最适合自己的那一种，向第三方应用颁发令牌。</strong>下面就是这四种授权方式。</p>
<ul>
<li>授权码（authorization-code）</li>
<li>隐藏式（implicit）</li>
<li>密码式（password）：</li>
<li>客户端凭证（client credentials）</li>
</ul>
<p>注意，不管哪一种授权方式，第三方应用申请令牌之前，都必须先到系统备案，说明自己的身份，然后会拿到两个身份识别码：客户端 ID（client ID）和客户端密钥（client secret）。这是为了防止令牌被滥用，没有备案过的第三方应用，是不会拿到令牌的。</p>
<h3 id="第一种授权方式：授权码"><a href="#第一种授权方式：授权码" class="headerlink" title="第一种授权方式：授权码"></a>第一种授权方式：授权码</h3><p><strong>授权码（authorization code）方式，指的是第三方应用先申请一个授权码，然后再用该码获取令牌。</strong></p>
<p>这种方式是最常用的流程，安全性也最高，它适用于那些有后端的 Web 应用。授权码通过前端传送，令牌则是储存在后端，而且所有与资源服务器的通信都在后端完成。这样的前后端分离，可以避免令牌泄漏。</p>
<p>第一步，A 网站提供一个链接，用户点击后就会跳转到 B 网站，授权用户数据给 A 网站使用。下面就是 A 网站跳转 B 网站的一个示意链接。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">https</span>:<span class="comment">//b.com/oauth/authorize?</span></span><br><span class="line">response_type=code&amp;</span><br><span class="line">client_id=<span class="variable constant_">CLIENT_ID</span>&amp;</span><br><span class="line">redirect_uri=<span class="variable constant_">CALLBACK_URL</span>&amp;</span><br><span class="line">scope=read</span><br></pre></td></tr></table></figure>


<p>上面 URL 中，<code>response_type</code>参数表示要求返回授权码（<code>code</code>），<code>client_id</code>参数让 B 知道是谁在请求，<code>redirect_uri</code>参数是 B 接受或拒绝请求后的跳转网址，<code>scope</code>参数表示要求的授权范围（这里是只读）。</p>
<p><img src="/assets/%E9%89%B4%E6%9D%83/bg2019040902.jpg" alt="img"></p>
<p>第二步，用户跳转后，B 网站会要求用户登录，然后询问是否同意给予 A 网站授权。用户表示同意，这时 B 网站就会跳回<code>redirect_uri</code>参数指定的网址。跳转时，会传回一个授权码，就像下面这样。&#96;&#96;</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">https</span>:<span class="comment">//a.com/callback?code=AUTHORIZATION_CODE</span></span><br></pre></td></tr></table></figure>

<p>上面 URL 中，<code>code</code>参数就是授权码。</p>
<p><img src="/assets/%E9%89%B4%E6%9D%83/bg2019040907.jpg" alt="img"></p>
<p>第三步，A 网站拿到授权码以后，就可以在后端，向 B 网站请求令牌。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">https</span>:<span class="comment">//b.com/oauth/token?</span></span><br><span class="line"> client_id=<span class="variable constant_">CLIENT_ID</span>&amp;</span><br><span class="line"> client_secret=<span class="variable constant_">CLIENT_SECRET</span>&amp;</span><br><span class="line"> grant_type=authorization_code&amp;</span><br><span class="line"> code=<span class="variable constant_">AUTHORIZATION_CODE</span>&amp;</span><br><span class="line"> redirect_uri=<span class="variable constant_">CALLBACK_URL</span></span><br></pre></td></tr></table></figure>

<p>上面 URL 中，<code>client_id</code>参数和<code>client_secret</code>参数用来让 B 确认 A 的身份（<code>client_secret</code>参数是保密的，因此只能在后端发请求），<code>grant_type</code>参数的值是<code>AUTHORIZATION_CODE</code>，表示采用的授权方式是授权码，<code>code</code>参数是上一步拿到的授权码，<code>redirect_uri</code>参数是令牌颁发后的回调网址。</p>
<p><img src="/assets/%E9%89%B4%E6%9D%83/bg2019040904.jpg" alt="img"></p>
<p>第四步，B 网站收到请求以后，就会颁发令牌。具体做法是向<code>redirect_uri</code>指定的网址，发送一段 JSON 数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;    </span><br><span class="line">  <span class="string">&quot;access_token&quot;</span>:<span class="string">&quot;ACCESS_TOKEN&quot;</span>,</span><br><span class="line">  <span class="string">&quot;token_type&quot;</span>:<span class="string">&quot;bearer&quot;</span>,</span><br><span class="line">  <span class="string">&quot;expires_in&quot;</span>:<span class="number">2592000</span>,</span><br><span class="line">  <span class="string">&quot;refresh_token&quot;</span>:<span class="string">&quot;REFRESH_TOKEN&quot;</span>,</span><br><span class="line">  <span class="string">&quot;scope&quot;</span>:<span class="string">&quot;read&quot;</span>,</span><br><span class="line">  <span class="string">&quot;uid&quot;</span>:<span class="number">100101</span>,</span><br><span class="line">  <span class="string">&quot;info&quot;</span>:&#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面 JSON 数据中，<code>access_token</code>字段就是令牌，A 网站在后端拿到了。</p>
<p><img src="/assets/%E9%89%B4%E6%9D%83/bg2019040905.jpg" alt="img"></p>
<h3 id="第二种方式：隐藏式"><a href="#第二种方式：隐藏式" class="headerlink" title="第二种方式：隐藏式"></a>第二种方式：隐藏式</h3><p>有些 Web 应用是纯前端应用，没有后端。这时就不能用上面的方式了，必须将令牌储存在前端。<strong>RFC 6749 就规定了第二种方式，允许直接向前端颁发令牌。这种方式没有授权码这个中间步骤，所以称为（授权码）”隐藏式”（implicit）。</strong></p>
<p>第一步，A 网站提供一个链接，要求用户跳转到 B 网站，授权用户数据给 A 网站使用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">https</span>:<span class="comment">//b.com/oauth/authorize?</span></span><br><span class="line">  response_type=token&amp;</span><br><span class="line">  client_id=<span class="variable constant_">CLIENT_ID</span>&amp;</span><br><span class="line">  redirect_uri=<span class="variable constant_">CALLBACK_URL</span>&amp;</span><br><span class="line">  scope=read</span><br></pre></td></tr></table></figure>

<p>上面 URL 中，<code>response_type</code>参数为<code>token</code>，表示要求直接返回令牌。</p>
<p>第二步，用户跳转到 B 网站，登录后同意给予 A 网站授权。这时，B 网站就会跳回<code>redirect_uri</code>参数指定的跳转网址，并且把令牌作为 URL 参数，传给 A 网站。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">https</span>:<span class="comment">//a.com/callback#token=ACCESS_TOKEN</span></span><br></pre></td></tr></table></figure>

<p>上面 URL 中，<code>token</code>参数就是令牌，A 网站因此直接在前端拿到令牌。</p>
<p>注意，令牌的位置是 URL 锚点（fragment），而不是查询字符串（querystring），这是因为 OAuth 2.0 允许跳转网址是 HTTP 协议，因此存在”中间人攻击”的风险，而浏览器跳转时，锚点不会发到服务器，就减少了泄漏令牌的风险。</p>
<p><img src="/assets/%E9%89%B4%E6%9D%83/bg2019040906.jpg" alt="img"></p>
<p>这种方式把令牌直接传给前端，是很不安全的。因此，只能用于一些安全要求不高的场景，并且令牌的有效期必须非常短，通常就是会话期间（session）有效，浏览器关掉，令牌就失效了。</p>
<h3 id="第三种方式：密码式"><a href="#第三种方式：密码式" class="headerlink" title="第三种方式：密码式"></a>第三种方式：密码式</h3><p><strong>如果你高度信任某个应用，RFC 6749 也允许用户把用户名和密码，直接告诉该应用。该应用就使用你的密码，申请令牌，这种方式称为”密码式”（password）。</strong></p>
<p>第一步，A 网站要求用户提供 B 网站的用户名和密码。拿到以后，A 就直接向 B 请求令牌。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">https</span>:<span class="comment">//oauth.b.com/token?</span></span><br><span class="line">  grant_type=password&amp;</span><br><span class="line">  username=<span class="variable constant_">USERNAME</span>&amp;</span><br><span class="line">  password=<span class="variable constant_">PASSWORD</span>&amp;</span><br><span class="line">  client_id=<span class="variable constant_">CLIENT_ID</span></span><br></pre></td></tr></table></figure>

<p>上面 URL 中，<code>grant_type</code>参数是授权方式，这里的<code>password</code>表示”密码式”，<code>username</code>和<code>password</code>是 B 的用户名和密码。</p>
<p>第二步，B 网站验证身份通过后，直接给出令牌。注意，这时不需要跳转，而是把令牌放在 JSON 数据里面，作为 HTTP 回应，A 因此拿到令牌。</p>
<p>这种方式需要用户给出自己的用户名&#x2F;密码，显然风险很大，因此只适用于其他授权方式都无法采用的情况，而且必须是用户高度信任的应用。</p>
<h3 id="第四种方式：凭证式"><a href="#第四种方式：凭证式" class="headerlink" title="第四种方式：凭证式"></a>第四种方式：凭证式</h3><p><strong>最后一种方式是凭证式（client credentials），适用于没有前端的命令行应用，即在命令行下请求令牌。</strong></p>
<p>第一步，A 应用在命令行向 B 发出请求。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">https</span>:<span class="comment">//oauth.b.com/token?</span></span><br><span class="line">  grant_type=client_credentials&amp;</span><br><span class="line">  client_id=<span class="variable constant_">CLIENT_ID</span>&amp;</span><br><span class="line">  client_secret=<span class="variable constant_">CLIENT_SECRET</span></span><br></pre></td></tr></table></figure>

<p>上面 URL 中，<code>grant_type</code>参数等于<code>client_credentials</code>表示采用凭证式，<code>client_id</code>和<code>client_secret</code>用来让 B 确认 A 的身份。</p>
<p>第二步，B 网站验证通过以后，直接返回令牌。</p>
<p>这种方式给出的令牌，是针对第三方应用的，而不是针对用户的，即有可能多个用户共享同一个令牌。</p>
<h3 id="令牌的使用"><a href="#令牌的使用" class="headerlink" title="令牌的使用"></a>令牌的使用</h3><p>A 网站拿到令牌以后，就可以向 B 网站的 API 请求数据了。</p>
<p>此时，每个发到 API 的请求，都必须带有令牌。具体做法是在请求的头信息，加上一个<code>Authorization</code>字段，令牌就放在这个字段里面。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -H <span class="string">&quot;Authorization: Bearer ACCESS_TOKEN&quot;</span> \</span><br><span class="line"><span class="string">&quot;https://api.b.com&quot;</span></span><br></pre></td></tr></table></figure>

<p>上面命令中，<code>ACCESS_TOKEN</code>就是拿到的令牌。</p>
<h3 id="更新令牌"><a href="#更新令牌" class="headerlink" title="更新令牌"></a>更新令牌</h3><p>令牌的有效期到了，如果让用户重新走一遍上面的流程，再申请一个新的令牌，很可能体验不好，而且也没有必要。OAuth 2.0 允许用户自动更新令牌。</p>
<p>具体方法是，B 网站颁发令牌的时候，一次性颁发两个令牌，一个用于获取数据，另一个用于获取新的令牌（refresh token 字段）。令牌到期前，用户使用 refresh token 发一个请求，去更新令牌。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">https</span>:<span class="comment">//b.com/oauth/token?</span></span><br><span class="line">  grant_type=refresh_token&amp;</span><br><span class="line">  client_id=<span class="variable constant_">CLIENT_ID</span>&amp;</span><br><span class="line">  client_secret=<span class="variable constant_">CLIENT_SECRET</span>&amp;</span><br><span class="line">  refresh_token=<span class="variable constant_">REFRESH_TOKEN</span></span><br></pre></td></tr></table></figure>

<p>上面 URL 中，<code>grant_type</code>参数为<code>refresh_token</code>表示要求更新令牌，<code>client_id</code>参数和<code>client_secret</code>参数用于确认身份，<code>refresh_token</code>参数就是用于更新令牌的令牌。</p>
<p>B 网站验证通过以后，就会颁发新的令牌。</p>
<p>写到这里，颁发令牌的四种方式就介绍完了。<a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2019/04/github-oauth.html">下一篇文章</a>会编写一个真实的 Demo，演示如何通过 OAuth 2.0 向 GitHub 的 API 申请令牌，然后再用令牌获取数据。</p>
<p><a href="https://link.zhihu.com/?target=https://blog.csdn.net/maxchenBug/article/details/88791514">https://link.zhihu.com/?target=https%3A//blog.csdn.net/maxchenBug/article/details/88791514</a>)</p>
<h2 id="五、总结对比"><a href="#五、总结对比" class="headerlink" title="五、总结对比"></a>五、总结对比</h2><p>没有最好，只有最合适！！！</p>
<h4 id="HTTP-Auth-Authentication"><a href="#HTTP-Auth-Authentication" class="headerlink" title="HTTP Auth Authentication"></a>HTTP Auth Authentication</h4><ul>
<li><p>梳理总结：</p>
<ul>
<li>通用 HTTP 身份验证框架有多个验证方案使用。不同的验证方案会在安全强度上有所不同。HTTP Auth Authentication 是最常用的 HTTP认证方案，为了减少泄露风险一般要求 HTTPS 协议。</li>
</ul>
</li>
<li><p>适用场景</p>
<ul>
<li>一般多被用在内部安全性要求不高的的系统上，如路由器网页管理接口</li>
</ul>
</li>
<li><p>问题：</p>
<ul>
<li>请求上携带验证信息，容易被嗅探到</li>
<li>无法注销</li>
</ul>
</li>
<li></li>
</ul>
<h4 id="Cookie-Session"><a href="#Cookie-Session" class="headerlink" title="Cookie + Session"></a>Cookie + Session</h4><ul>
<li><p>梳理总结：</p>
<ul>
<li>服务端存储 session ，客户端存储 cookie，其中 cookie 保存的为 sessionID</li>
<li>可以灵活 revoke(撤销) 权限，更新信息后可以方便的同步 session 中相应内容</li>
<li>分布式 session 一般使用 redis(或其他KV) 存储</li>
</ul>
</li>
<li><p>使用场景：</p>
<ul>
<li>适合传统系统独立鉴权</li>
</ul>
</li>
</ul>
<h4 id="JWT"><a href="#JWT" class="headerlink" title="JWT"></a>JWT</h4><ul>
<li><p>梳理总结：</p>
<ul>
<li>服务器不再需要存储 session，服务器认证鉴权业务可以方便扩展</li>
<li>JWT 并不依赖 cookie（防范CSRF），也可以使用 header 传递</li>
<li>为减少盗用(中间人)，要使用 HTTPS 协议传输</li>
</ul>
</li>
<li><p>适用场景：</p>
<ul>
<li>适合做简单的 RESTful API 认证</li>
<li>适合一次性验证，例如注册激活链接</li>
</ul>
</li>
<li><p>问题：</p>
<ul>
<li>使用过程中无法废弃某个 token，有效期内 token 一直有效</li>
<li>payload 信息更新时，已下发的 token 无法同步</li>
</ul>
</li>
</ul>
<h4 id="OAuth"><a href="#OAuth" class="headerlink" title="OAuth"></a>OAuth</h4><ul>
<li><p>梳理总结：</p>
<ul>
<li>OAuth是一个开放标准，允许用户授权第三方应用访问他们存储在另外的服务提供者上的信息，而不需要将用户名和密码提供给第三方移动应用或分享他们数据的所有内容。</li>
<li>GitHub OAuth 文档 <a href="https://link.zhihu.com/?target=https://docs.github.com/en/free-pro-team@latest/developers/apps/identifying-and-authorizing-users-for-github-apps">Identifying and authorizing users for GitHub Apps</a></li>
</ul>
</li>
<li><p>适用场景：OAuth 分为下面四种模式</p>
<ul>
<li>简化模式，不安全，适用于纯静态页面应用</li>
<li>授权码模式，功能最完整、流程最严密的授权模式，通常使用在公网的开放平台中</li>
<li>密码模式，一般在内部系统中使用，调用者是以用户为单位。</li>
<li>客户端模式，一般在内部系统之间的 API 调用。两个平台之间调用，以平台为单位。</li>
</ul>
</li>
</ul>
<p>转载于<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/271768645">知乎</a></p>
<p><strong>延伸阅读</strong></p>
<p><a href="https://link.zhihu.com/?target=https://blog.csdn.net/Faker_Wang/article/details/80877654">单点登录注销_Faker_Wang的博客-CSDN博客blog.csdn.net</a></p>
<p>[《手机扫码登录内网怎么实现的？》blog.csdn.net](</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mst123.github.io/css/css%E4%B8%AD%E7%9A%84%E9%87%8D%E8%A6%81%E6%A6%82%E5%BF%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luopo.gif">
      <meta itemprop="name" content="马农">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="博客">
      <meta itemprop="description" content="学习记录">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/css/css%E4%B8%AD%E7%9A%84%E9%87%8D%E8%A6%81%E6%A6%82%E5%BF%B5/" class="post-title-link" itemprop="url">css中重要的概念</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-05-28 00:00:00" itemprop="dateCreated datePublished" datetime="2021-05-28T00:00:00+08:00">2021-05-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-07-19 14:48:19" itemprop="dateModified" datetime="2024-07-19T14:48:19+08:00">2024-07-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/css/" itemprop="url" rel="index"><span itemprop="name">css</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="层叠上下文"><a href="#层叠上下文" class="headerlink" title="层叠上下文"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/CSS_Positioning/Understanding_z_index/The_stacking_context">层叠上下文</a></h3><p>文档中的层叠上下文由满足以下任意一个条件的元素形成：</p>
<p><strong>小总结</strong></p>
<p>z-index相关：</p>
<ul>
<li>z-index不为auto<ul>
<li>position 为absolute relative fixed sticky（后两种z-index无限制）</li>
<li>flex grid容器的子元素</li>
</ul>
</li>
<li>新属性css3相关<ul>
<li>transform 变换</li>
<li>filter 过滤器</li>
</ul>
</li>
<li>和性能方面有关系<ul>
<li>will-change</li>
<li>contain</li>
</ul>
</li>
</ul>
<p><strong>详细介绍</strong></p>
<ul>
<li>文档根元素（<code>&lt;html&gt;</code>）；</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/position"><code>position</code></a> 值为 <code>absolute</code>（绝对定位）或 <code>relative</code>（相对定位）且 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/z-index"><code>z-index</code></a> 值不为 <code>auto</code> 的元素；</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/position"><code>position</code></a> 值为 <code>fixed</code>（固定定位）或 <code>sticky</code>（粘滞定位）的元素（沾滞定位适配所有移动设备上的浏览器，但老的桌面浏览器不支持）；</li>
<li>flex (<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/flex"><code>flex</code></a>) 容器的子元素，且 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/z-index"><code>z-index</code></a> 值不为 <code>auto</code>；</li>
<li>grid (<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/grid"><code>grid</code></a>) 容器的子元素，且 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/z-index"><code>z-index</code></a> 值不为 <code>auto</code>；</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/opacity"><code>opacity</code></a> 属性值小于 <code>1</code> 的元素（参见 <a target="_blank" rel="noopener" href="https://www.w3.org/TR/css3-color/#transparency">the specification for opacity</a>）；</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/mix-blend-mode"><code>mix-blend-mode</code></a> 属性值不为 <code>normal</code> 的元素；</li>
<li>以下任意属性值不为<code>none</code>的元素：<ul>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/transform"><code>transform</code></a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/filter"><code>filter</code></a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/backdrop-filter"><code>backdrop-filter</code></a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/perspective"><code>perspective</code></a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/clip-path"><code>clip-path</code></a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/mask"><code>mask</code></a> &#x2F; <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/mask-image"><code>mask-image</code></a> &#x2F; <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/mask-border"><code>mask-border</code></a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/isolation"><code>isolation</code></a> 属性值为 <code>isolate</code> 的元素；</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/will-change"><code>will-change</code></a> 值设定了任一属性而该属性在 non-initial 值时会创建层叠上下文的元素（参考<a target="_blank" rel="noopener" href="https://dev.opera.com/articles/css-will-change-property/">这篇文章</a>）；</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/contain"><code>contain</code></a> 属性值为 <code>layout</code>、<code>paint</code> 或包含它们其中之一的合成值（比如 <code>contain: strict</code>、<code>contain: content</code>）的元素。在层叠上下文中，子元素同样也按照上面解释的规则进行层叠。 重要的是，其子级层叠上下文的 <code>z-index</code>值只在父级中才有意义。子级层叠上下文被自动视为父级层叠上下文的一个独立单元。</li>
</ul>
<p>总结:</p>
<ul>
<li>层叠上下文可以包含在其他层叠上下文中，并且一起创建一个层叠上下文的层级。</li>
<li>每个层叠上下文都完全独立于它的兄弟元素：当处理层叠时只考虑子元素。</li>
<li>每个层叠上下文都是自包含的：当一个元素的内容发生层叠后，该元素将被作为整体在父级层叠上下文中按顺序进行层叠。</li>
</ul>
<p>Tips:  层叠上下文顺序</p>
<p><img src="/assets/css%E4%B8%AD%E7%9A%84%E9%87%8D%E8%A6%81%E6%A6%82%E5%BF%B5/2016-01-09_211116.png" alt="更完整的7阶层叠顺序图"></p>
<h3 id="BFC"><a href="#BFC" class="headerlink" title="BFC"></a><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/Guide/CSS/Block_formatting_context">BFC</a></h3><p><strong>块格式化上下文（Block Formatting Context，BFC）</strong> 是Web页面的可视CSS渲染的一部分，是块盒子的布局过程发生的区域，也是浮动元素与其他元素交互的区域。</p>
<p>下列方式会创建<strong>块格式化上下文</strong>：</p>
<ul>
<li>根元素（<code>&lt;html&gt;）</code></li>
<li>浮动元素（元素的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/float"><code>float</code></a> 不是 <code>none</code>）</li>
<li>绝对定位元素（元素的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/position"><code>position</code></a> 为 <code>absolute</code> 或 <code>fixed</code>）</li>
<li>行内块元素（元素的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/display"><code>display</code></a> 为 <code>inline-block</code>）</li>
<li>表格单元格（元素的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/display"><code>display</code></a> 为 <code>table-cell</code>，HTML表格单元格默认为该值）</li>
<li>表格标题（元素的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/display"><code>display</code></a> 为 <code>table-caption</code>，HTML表格标题默认为该值）</li>
<li>匿名表格单元格元素（元素的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/display"><code>display</code></a> 为 <code>table、``table-row</code>、 <code>table-row-group、``table-header-group、``table-footer-group</code>（分别是HTML table、row、tbody、thead、tfoot 的默认属性）或 <code>inline-table</code>）</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/overflow"><code>overflow</code></a> 计算值(Computed)不为 <code>visible</code> 的块元素</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/display"><code>display</code></a> 值为 <code>flow-root</code> 的元素</li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/contain"><code>contain</code></a> 值为 <code>layout</code>、<code>content</code>或 paint 的元素</li>
<li>弹性元素（<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/display"><code>display</code></a> 为 <code>flex</code> 或 <code>inline-flex</code>元素的直接子元素）</li>
<li>网格元素（<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/display"><code>display</code></a> 为 <code>grid</code> 或 <code>inline-grid</code> 元素的直接子元素）</li>
<li>多列容器（元素的 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/column-count"><code>column-count</code></a> 或 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/CSS/column-width"><code>column-width</code> (en-US)</a> 不为 <code>auto，包括 ``column-count</code> 为 <code>1</code>）</li>
<li><code>column-span</code> 为 <code>all</code> 的元素始终会创建一个新的BFC，即使该元素没有包裹在一个多列容器中（<a target="_blank" rel="noopener" href="https://github.com/w3c/csswg-drafts/commit/a8634b96900279916bd6c505fda88dda71d8ec51">标准变更</a>，<a target="_blank" rel="noopener" href="https://bugs.chromium.org/p/chromium/issues/detail?id=709362">Chrome bug</a>）。</li>
</ul>
<p>块格式化上下文包含创建它的元素内部的所有内容.</p>
<p>块格式化上下文对浮动定位（参见 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/float"><code>float</code></a>）与清除浮动（参见 <a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/CSS/clear"><code>clear</code></a>）都很重要。浮动定位和清除浮动时只会应用于同一个BFC内的元素。浮动不会影响其它BFC中元素的布局，而清除浮动只能清除同一BFC中在它前面的元素的浮动。外边距折叠（<a target="_blank" rel="noopener" href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Box_Model/Mastering_margin_collapsing">Margin collapsing</a>）也只会发生在属于同一BFC的块级元素之间。</p>
<p>几个重要的应用:</p>
<ul>
<li><p>BFC 可以包含浮动的元素（清除浮动，防止高度塌陷）</p>
</li>
<li><p>同一个 BFC 下外边距会发生折叠</p>
</li>
<li><p>BFC 可以阻止元素被浮动元素覆盖(左侧固定，右侧自适应布局)  </p>
<p><img src="/assets/css%E4%B8%AD%E7%9A%84%E9%87%8D%E8%A6%81%E6%A6%82%E5%BF%B5/v2-5ebd48f09fac875f0bd25823c76ba7fa_720w-20211213143017754.png" alt="img"></p>
</li>
</ul>
<p>可以参考<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/25321647">知乎</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mst123.github.io/%E5%A4%A7%E5%89%8D%E7%AB%AF/redis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luopo.gif">
      <meta itemprop="name" content="马农">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="博客">
      <meta itemprop="description" content="学习记录">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%A4%A7%E5%89%8D%E7%AB%AF/redis/" class="post-title-link" itemprop="url">redis</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-05-25 00:00:00" itemprop="dateCreated datePublished" datetime="2021-05-25T00:00:00+08:00">2021-05-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-07-13 13:13:23" itemprop="dateModified" datetime="2024-07-13T13:13:23+08:00">2024-07-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%A4%A7%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">大前端</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h2><p><img src="/assets/redis/image-20210428205046181.png" alt="image-20210428205046181"></p>
<h3 id="redis特点"><a href="#redis特点" class="headerlink" title="redis特点"></a>redis特点</h3><ul>
<li>高性能，可持久化</li>
<li>key-value结构，支持多种数据类型</li>
<li>支持事务，数据的原子性</li>
</ul>
<h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><ul>
<li>缓存（读写性能优异）</li>
<li>计数&amp;消息系统（高并发、发布&#x2F;订阅阻塞队列功能）</li>
<li>分布式回话session&amp;分布式锁（秒杀）</li>
</ul>
<h3 id="redis-vs-mongo"><a href="#redis-vs-mongo" class="headerlink" title="redis vs mongo"></a>redis vs mongo</h3><ul>
<li>储存方式不一样：key-value vs document</li>
<li>使用方式&amp;可靠性不一样： MongoDB SQL &amp; ACDI支持</li>
<li>应用场景不一样：高性能缓存 vs 海量数据分析</li>
</ul>
<h3 id="使用docker-安装redis"><a href="#使用docker-安装redis" class="headerlink" title="使用docker 安装redis"></a>使用docker 安装redis</h3><h4 id="Docker-compose配置"><a href="#Docker-compose配置" class="headerlink" title="Docker-compose配置"></a>Docker-compose配置</h4><p>在linux服务器中，新建<code>/home/redistest/docker-compose.yml</code>，并书写以下内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">version: &quot;3&quot;</span><br><span class="line">services: </span><br><span class="line">  redis-test:</span><br><span class="line">    image: &quot;redis&quot;</span><br><span class="line">    restart: always</span><br><span class="line">    container_name: &quot;redis-test&quot;</span><br><span class="line">    ports: </span><br><span class="line">      - 15001:6379</span><br><span class="line">    volumes: </span><br><span class="line">      - /home/redistest:/data // 持久化</span><br><span class="line">    command: [&quot;redis-server&quot;,&quot;--requirepass&quot;,&quot;123456&quot;] // 设置密码</span><br></pre></td></tr></table></figure>

<p>然后在当前目录运行<code>docker-compose up -d</code> 会自动抓取redis 并运行在15001端口</p>
<p>然后运行linux端口放行<code>firewall-cmd --zone=public --add-port=15001/tcp --permanent</code></p>
<h4 id="使用redis-cli"><a href="#使用redis-cli" class="headerlink" title="使用redis-cli"></a>使用redis-cli</h4><p><a target="_blank" rel="noopener" href="http://doc.redisfans.com/">redis命令</a></p>
<ul>
<li>进入容器交互终端  <code>docker exec -it redis-test /bin/bash</code></li>
<li>输入 redis-cli 回车</li>
<li>输入 auth 123456 &#x2F;&#x2F; 密码登陆</li>
<li>输出OK表示成功</li>
</ul>
<blockquote>
<p>想从镜像终端中出来，输入exit</p>
</blockquote>
<h5 id="常用的redis命令"><a href="#常用的redis命令" class="headerlink" title="常用的redis命令"></a>常用的redis命令</h5><ul>
<li><p>ping ，如果运行正确 会返回pong</p>
</li>
<li><p>quit 断开当前redis 服务</p>
</li>
<li><p>auth 123456 &#x2F;&#x2F; 登陆</p>
</li>
<li><p>select  number 切换自动数据库，默认有0 - 15</p>
</li>
<li><p>设置数据</p>
<ul>
<li>set key value 设置键值</li>
<li>get key 获取键值</li>
<li>incr 变量自增 例如 set index 0 ；incr inde ；&#x2F;&#x2F; 1 计数器</li>
<li>decr 递减</li>
<li>keys 正则 （*所有）查看符合条件的键值</li>
<li>exists  key  […key] 看键值是否存在 1 存在 0 不存在</li>
<li>del  key 删除键值 1成功 0失败</li>
</ul>
</li>
<li><p>设置过期时间</p>
<ul>
<li>set key value  ‘EX’  seconds</li>
</ul>
</li>
<li><p>Hash</p>
<ul>
<li><p>hset obj key value</p>
</li>
<li><pre><code>就像给一个对象设置键值对一样 
hset brian name &quot;brian&quot;
hset brian age 19
brian = &#123;
 name: &quot;brian&quot;,
  age: 20
&#125;
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- hgetall obj  返回对象的key value对</span><br><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  hgetall brian</span><br><span class="line">  name</span><br><span class="line">  brian</span><br><span class="line">  age</span><br><span class="line">  19</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
<li><p>Hmset 设置多对键值对</p>
</li>
<li><pre><code>hmset brian name xxx age 19 email ueih@122
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- Hmget 获取多个键值</span><br><span class="line"></span><br><span class="line">- ```</span><br><span class="line">  hmget brian name age</span><br><span class="line">  xxx</span><br><span class="line">  19</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
</li>
<li><p>list list操作</p>
</li>
<li><p>pub&#x2F;sub 发布订阅</p>
</li>
<li><p>server命令</p>
<ul>
<li>client list 可以查看redis-cli连接的哪些redis-client服务 通过idle空闲时间判断当前使用的</li>
<li>client kill host:port 断开</li>
<li>flushdb 清空当前数据库的数据</li>
<li>flushall 清空所有数据库</li>
</ul>
</li>
<li><p>slowlog  slow log是用来记录执行时间的日子系统</p>
</li>
</ul>
<h3 id="redis备份"><a href="#redis备份" class="headerlink" title="redis备份"></a>redis备份</h3><p>save 命令备份（同步任务，会阻塞，使用bgsave） 会生成一个dump.rdb，quit停止服务</p>
<p>CONFIG get dir 找到数据存在位置，把dump.rdb放入，重启服务就可以了</p>
<h3 id="Redis-GUI"><a href="#Redis-GUI" class="headerlink" title="Redis GUI"></a>Redis GUI</h3><p>安装一个破解版的redis desktop manage，可以修改语言为中文，通过gui中的终端服务，可以很轻松的使用</p>
<h3 id="Nodejs-集成-redis"><a href="#Nodejs-集成-redis" class="headerlink" title="Nodejs 集成 redis"></a>Nodejs 集成 redis</h3><p>首先安装redis <code>npm install redis --save</code></p>
<p>redis配置示例如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">import redis from &quot;redis&quot;</span><br><span class="line">const &#123; promisify &#125; = require(&quot;util&quot;);</span><br><span class="line">const options = &#123;</span><br><span class="line">  host: &quot;39.106.100.189&quot;, // 切记不需要写http之类的</span><br><span class="line">  port: 15001,</span><br><span class="line">  password: &quot;123456&quot;,</span><br><span class="line">  detect_buffers: true, // 不转换二进制</span><br><span class="line">  retry_strategy: function(options) &#123; // 重连错误处理</span><br><span class="line">    if (options.error &amp;&amp; options.error.code === &quot;ECONNREFUSED&quot;) &#123;</span><br><span class="line">      // End reconnecting on a specific error and flush all commands with</span><br><span class="line">      // a individual error</span><br><span class="line">      return new Error(&quot;The server refused the connection&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if (options.total_retry_time &gt; 1000 * 60 * 60) &#123;</span><br><span class="line">      // End reconnecting after a specific timeout and flush all commands</span><br><span class="line">      // with a individual error</span><br><span class="line">      return new Error(&quot;Retry time exhausted&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if (options.attempt &gt; 10) &#123;</span><br><span class="line">      // End reconnecting with built in error</span><br><span class="line">      return undefined;</span><br><span class="line">    &#125;</span><br><span class="line">    // reconnect after</span><br><span class="line">    return Math.min(options.attempt * 100, 3000);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 创建一个redis实例</span><br><span class="line">const client = redis.createClient(options)</span><br><span class="line"></span><br><span class="line">// set方法</span><br><span class="line">const setValue = (key, value) =&gt; &#123;</span><br><span class="line">   return client.set(key, value)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 创建promise</span><br><span class="line">const getAsync = promisify(client.get).bind(client);</span><br><span class="line"></span><br><span class="line">// get方法</span><br><span class="line">const getValue = (key) =&gt; &#123;</span><br><span class="line">  return getAsync(key)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">export &#123;</span><br><span class="line">  client,</span><br><span class="line">  setValue,</span><br><span class="line">  getValue</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">setValue(&quot;ceshi&quot;, 122333)</span><br><span class="line">getValue(&quot;ceshi&quot;).then(res =&gt; &#123;</span><br><span class="line">  console.log(res);</span><br><span class="line">&#125;)</span><br><span class="line">// 122333 成功</span><br></pre></td></tr></table></figure>

<p>get 、set方法生产模式再次封装一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">/ set方法</span><br><span class="line">const setValue = (key, value) =&gt; &#123;</span><br><span class="line">  if (typeof value === &quot;undefined&quot; || value == null || value === &quot;&quot;) &#123;</span><br><span class="line">    // == null 包含null 和 undefined</span><br><span class="line">    return;</span><br><span class="line">  &#125;</span><br><span class="line">  if (typeof value === &quot;string&quot;) &#123;</span><br><span class="line">    return client.set(key, value)</span><br><span class="line">  &#125; else if (typeof value === &quot;object&quot;) &#123;</span><br><span class="line">    // 对象层级应该只有能一层，不能多级嵌套</span><br><span class="line">    Object.keys(value).forEach((keyC) =&gt; &#123;</span><br><span class="line">      client.hset(key, keyC, value[keyC], redis.print)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// 创建promise</span><br><span class="line">const getAsync = promisify(client.get).bind(client);</span><br><span class="line">// get方法</span><br><span class="line">const getValue = (key) =&gt; &#123;</span><br><span class="line">  return getAsync(key)</span><br><span class="line">&#125;</span><br><span class="line">// hash get方法</span><br><span class="line">const getHValue = (key) =&gt; &#123;</span><br><span class="line">  return promisify(client.hgetall).bind(client)(key)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mst123.github.io/%E5%A4%A7%E5%89%8D%E7%AB%AF/mongoose/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luopo.gif">
      <meta itemprop="name" content="马农">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="博客">
      <meta itemprop="description" content="学习记录">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E5%A4%A7%E5%89%8D%E7%AB%AF/mongoose/" class="post-title-link" itemprop="url">MongoDB mongoose 基础用法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-05-15 00:00:00" itemprop="dateCreated datePublished" datetime="2021-05-15T00:00:00+08:00">2021-05-15</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-07-13 13:13:20" itemprop="dateModified" datetime="2024-07-13T13:13:20+08:00">2024-07-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%A4%A7%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">大前端</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener" href="http://www.mongoosejs.net/docs/guide.html">mongoose中文网</a></p>
<h2 id="mongoose-基础用法记录"><a href="#mongoose-基础用法记录" class="headerlink" title="mongoose 基础用法记录"></a>mongoose 基础用法记录</h2><h3 id="基础用法"><a href="#基础用法" class="headerlink" title="基础用法"></a>基础用法</h3><ul>
<li>首先在mongoDB里新建一个数据库，例如test1，借助Navicat工具</li>
</ul>
<p><img src="/assets/mongoose/image-20210428170647238.png" alt="image-20210428170647238"></p>
<ul>
<li>然后书写test.js</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">var mongoose = require(&#x27;mongoose&#x27;);</span><br><span class="line">// 后面跟随的配置是安全配置，防止控制台输出警告</span><br><span class="line">mongoose.connect(&#x27;mongodb://39.106.100.189:10050/test1&#x27;, &#123;</span><br><span class="line">  useUnifiedTopology: true,</span><br><span class="line">  useNewUrlParser: true</span><br><span class="line">&#125;);</span><br><span class="line">// 如果有用户名 密码 可以使用</span><br><span class="line">// mongoose.connect(&#x27;mongodb://name:pwd@39.106.100.189:10050/test1&#x27;, &#123;</span><br><span class="line">  useUnifiedTopology: true,</span><br><span class="line">  useNewUrlParser: true</span><br><span class="line">&#125;);</span><br><span class="line">var db = mongoose.connection;</span><br><span class="line">db.on(&#x27;error&#x27;, function () &#123;</span><br><span class="line">  console.log(&#x27;error&#x27;);</span><br><span class="line">&#125;);</span><br><span class="line">db.once(&#x27;open&#x27;, function() &#123;</span><br><span class="line">  console.log(&#x27;success&#x27;);</span><br><span class="line">  var kittySchema = mongoose.Schema(&#123;</span><br><span class="line">    name: String</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  kittySchema.methods.speak = function () &#123;</span><br><span class="line">    var greeting = this.name</span><br><span class="line">      ? &quot;Meow name is &quot; + this.name</span><br><span class="line">      : &quot;I don&#x27;t have a name&quot;;</span><br><span class="line">    console.log(greeting);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  // 简历表</span><br><span class="line">  var Kitten = mongoose.model(&#x27;Kitten&#x27;, kittySchema);</span><br><span class="line"></span><br><span class="line">  var fluffy = new Kitten(&#123; name: &#x27;fluffy&#x27; &#125;);</span><br><span class="line">  fluffy.speak(); // &quot;Meow name is fluffy&quot; </span><br><span class="line">  </span><br><span class="line">  fluffy.save(function (err, fluffy) &#123;</span><br><span class="line">    if (err) return console.error(err);</span><br><span class="line">    fluffy.speak();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line">// 还有一种方式 更加简洁</span><br><span class="line">var User = mongoose.model(&#x27;User&#x27;, &#123; // 建立表</span><br><span class="line"> name: String,</span><br><span class="line"> age: Number</span><br><span class="line">&#125;);</span><br><span class="line">var fluffy = new User(&#123; name: &#x27;ming&#x27;, age: 15 &#125;); </span><br><span class="line"></span><br><span class="line">fluffy.save(function (err, fluffy) &#123; // 保存一条数据</span><br><span class="line"> if (err) return console.error(err);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li>新增了一条fluffy数据，数据库显示如下</li>
</ul>
<p><img src="/assets/mongoose/image-20210428170922882.png" alt="image-20210428170922882"></p>
<h3 id="项目中按功能拆分"><a href="#项目中按功能拆分" class="headerlink" title="项目中按功能拆分"></a>项目中按功能拆分</h3><p>一般会把mongoose初始化，Schema，和操作表分离</p>
<p><img src="/assets/mongoose/image-20210428181713717.png" alt="image-20210428181713717"></p>
<h4 id="mongoose初始化"><a href="#mongoose初始化" class="headerlink" title="mongoose初始化"></a>mongoose初始化</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">DBHelper.js</span><br><span class="line"></span><br><span class="line">import mongoose from &#x27;mongoose&#x27;;</span><br><span class="line">import config from &#x27;./index&#x27;;</span><br><span class="line"></span><br><span class="line">// 创建链接</span><br><span class="line">mongoose.connect(config.DB_URL, &#123;</span><br><span class="line">  useUnifiedTopology: true,</span><br><span class="line">  useNewUrlParser: true</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 连接成功</span><br><span class="line">mongoose.connection.on(&quot;connected&quot;, () =&gt; &#123;</span><br><span class="line">  console.log(&#x27;success&#x27; + config.DB_URL);</span><br><span class="line">&#125;)</span><br><span class="line">// 连接异常</span><br><span class="line">mongoose.connection.on(&quot;error&quot;, (error) =&gt; &#123;</span><br><span class="line">  console.log(&#x27;error&#x27;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">// 断开连接</span><br><span class="line">mongoose.connection.on(&quot;disconnected&quot;, () =&gt; &#123;</span><br><span class="line">  console.log(&#x27;断开连接&#x27;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">export default mongoose</span><br></pre></td></tr></table></figure>

<h4 id="Schema文件"><a href="#Schema文件" class="headerlink" title="Schema文件"></a>Schema文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">model/User.js // 对应数据库 users表</span><br><span class="line"></span><br><span class="line">import mongoose from &#x27;../config/DBHelpler&#x27;;</span><br><span class="line">const Schema = mongoose.Schema;</span><br><span class="line"></span><br><span class="line">const UserSchema = new Schema(&#123;</span><br><span class="line">  name: &#123;</span><br><span class="line">    type: String</span><br><span class="line">  &#125;,</span><br><span class="line">  age: &#123;</span><br><span class="line">    type: Number</span><br><span class="line">  &#125;,</span><br><span class="line">  email: &#123;</span><br><span class="line">    type: String</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">const UserModel = mongoose.model(&#x27;User&#x27;, UserSchema)</span><br><span class="line"></span><br><span class="line">export default UserModel</span><br></pre></td></tr></table></figure>

<h4 id="controller文件"><a href="#controller文件" class="headerlink" title="controller文件"></a>controller文件</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">// 模拟</span><br><span class="line">// 增删改查基础操作</span><br><span class="line">import User from &#x27;./User&#x27;;</span><br><span class="line"></span><br><span class="line">// 增</span><br><span class="line">const user = &#123;</span><br><span class="line">  name: &quot;xiaoming&quot;,</span><br><span class="line">  age: 30,</span><br><span class="line">  email: &quot;46546746&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const run = async () =&gt; &#123;</span><br><span class="line">  const data = new User(user)</span><br><span class="line">  const result = await data.save() // promise</span><br><span class="line">  console.log(result);</span><br><span class="line">&#125;</span><br><span class="line">run();</span><br><span class="line">// 查</span><br><span class="line">const search = async () =&gt; &#123;</span><br><span class="line">  const result = await User.find() // promise</span><br><span class="line">  console.log(result);</span><br><span class="line">&#125;</span><br><span class="line">search();</span><br><span class="line">// 改</span><br><span class="line">const update = async () =&gt; &#123;</span><br><span class="line">  // User.updateMany</span><br><span class="line">  const result = await User.updateOne(&#123;</span><br><span class="line">    // filter</span><br><span class="line">    name: &quot;xiaoming&quot;</span><br><span class="line">  &#125;, &#123;</span><br><span class="line">    email: &quot;safasfas&quot;</span><br><span class="line">  &#125;)</span><br><span class="line">  console.log(result);</span><br><span class="line">&#125;</span><br><span class="line">update();</span><br><span class="line">// 删</span><br><span class="line">const delete_ = async () =&gt; &#123;</span><br><span class="line">  // User.deleteMany</span><br><span class="line">  const result = await User.deleteOne(&#123;</span><br><span class="line">    // filter</span><br><span class="line">    name: &quot;ming&quot;</span><br><span class="line">  &#125;)</span><br><span class="line">  console.log(result);</span><br><span class="line">&#125;</span><br><span class="line">delete_();</span><br></pre></td></tr></table></figure>

<h3 id="静态方法"><a href="#静态方法" class="headerlink" title="静态方法"></a>静态方法</h3><p>添加 <code>Model</code> 的静态方法也十分简单，继续用 <code>animalSchema</code> 举例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// assign a function to the &quot;statics&quot; object of our animalSchema</span></span><br><span class="line">animalSchema.<span class="property">statics</span>.<span class="property">findByName</span> = <span class="keyword">function</span>(<span class="params">name, cb</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="title function_">find</span>(&#123; <span class="attr">name</span>: <span class="keyword">new</span> <span class="title class_">RegExp</span>(name, <span class="string">&#x27;i&#x27;</span>) &#125;, cb);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Animal</span> = mongoose.<span class="title function_">model</span>(<span class="string">&#x27;Animal&#x27;</span>, animalSchema);</span><br><span class="line"><span class="title class_">Animal</span>.<span class="title function_">findByName</span>(<span class="string">&#x27;fido&#x27;</span>, <span class="keyword">function</span>(<span class="params">err, animals</span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(animals);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>同样<strong>不要</strong>在静态方法中使用 ES6 箭头函数</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mst123.github.io/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luopo.gif">
      <meta itemprop="name" content="马农">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="博客">
      <meta itemprop="description" content="学习记录">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" class="post-title-link" itemprop="url">设计模式</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-05-14 00:00:00" itemprop="dateCreated datePublished" datetime="2021-05-14T00:00:00+08:00">2021-05-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-07-13 13:13:26" itemprop="dateModified" datetime="2024-07-13T13:13:26+08:00">2024-07-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">设计模式</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="五大设计原则"><a href="#五大设计原则" class="headerlink" title="五大设计原则"></a>五大设计原则</h1><p>js常用前两种原则，语言特性和后三种原则关联不大。</p>
<ul>
<li>单一职责原则<ul>
<li>一个程序只做好一件事</li>
<li>如果功能复杂就拆分开，每个部分保持独立</li>
</ul>
</li>
<li>开放封闭原则<ul>
<li>对扩展开放，对修改封闭</li>
<li>增加需求时，扩展新代码，而非修改已有代码</li>
<li>这是软件设计的终极目标</li>
</ul>
</li>
<li>李氏置换原则</li>
<li>接口独立原则</li>
<li>依赖导致原则</li>
</ul>
<h1 id="设计模式的基本-面向对象"><a href="#设计模式的基本-面向对象" class="headerlink" title="设计模式的基本-面向对象"></a>设计模式的基本-面向对象</h1><p>为何使用面向对象</p>
<ul>
<li>程序执行：顺序、判断、循环 —- 结构化</li>
<li>面对对象 —- 数据结构化</li>
<li>对于计算机，结构化的才是最简单的</li>
<li>变成应该 简单&amp;抽象</li>
</ul>
<h1 id="js常用设计模式简介及举例"><a href="#js常用设计模式简介及举例" class="headerlink" title="js常用设计模式简介及举例"></a>js常用设计模式简介及举例</h1><h2 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h2><h3 id="实际例子"><a href="#实际例子" class="headerlink" title="实际例子"></a>实际例子</h3><h4 id="jQuery"><a href="#jQuery" class="headerlink" title="jQuery"></a>jQuery</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class jQuery &#123;</span><br><span class="line">  construct(selector)&#123;</span><br><span class="line">    .....</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">window.$ = function(selector)&#123;</span><br><span class="line">  return new jQuery(selector)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="React-createElement"><a href="#React-createElement" class="headerlink" title="React.createElement"></a>React.createElement</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class Vnode(tag, attrs, children) &#123;</span><br><span class="line">  ....</span><br><span class="line">&#125;</span><br><span class="line">React.createElement = function(tag, attrs, children) &#123;</span><br><span class="line">  return new Vnode(tag, attrs, children)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h2><p>js利用闭包和立即执行函数实现</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">class SingleObj&#123;</span><br><span class="line">  login() &#123;</span><br><span class="line">    console.log(&#x27;111&#x27;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">SingleObj.getInstance = (function () &#123;</span><br><span class="line">  let instance = null;</span><br><span class="line">  return function () &#123;</span><br><span class="line">    if (!instance) &#123;</span><br><span class="line">      instance = new SingleObj();</span><br><span class="line">    &#125;</span><br><span class="line">    return instance;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line">const test1 = SingleObj.getInstance();</span><br><span class="line">const test2 = SingleObj.getInstance();</span><br><span class="line"></span><br><span class="line">console.log(test1 === test2); // true</span><br><span class="line"></span><br><span class="line">// 无法防止错误用法，例如：</span><br><span class="line">const test3 = new SingleObj();</span><br></pre></td></tr></table></figure>

<h2 id="适配器模式"><a href="#适配器模式" class="headerlink" title="适配器模式"></a>适配器模式</h2><h3 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h3><ul>
<li>旧接口格式和使用者不兼容</li>
<li>中间加一个适配转换接口</li>
</ul>
<h3 id="实际例子-1"><a href="#实际例子-1" class="headerlink" title="实际例子"></a>实际例子</h3><h4 id="封装旧接口"><a href="#封装旧接口" class="headerlink" title="封装旧接口"></a>封装旧接口</h4><p>解决新旧代码不兼容的问题，尽量避免全局替换</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// 自己封装的ajax，使用方式如下</span><br><span class="line">ajax(&#123;</span><br><span class="line">  url:&#x27;/getData&#x27;,</span><br><span class="line">  type:&#x27;post&#x27;,</span><br><span class="line">  data: &#123;</span><br><span class="line">    id: 2</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).done(function()&#123;&#125;)</span><br><span class="line">// 但是由于历史原因，代码全是 $.ajax(&#123;...&#125;)</span><br><span class="line"></span><br><span class="line">// 解决方案，做一层适配器</span><br><span class="line">var $ = &#123;</span><br><span class="line">  ajax: function(option) &#123;</span><br><span class="line">    return ajax(option);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="vue-computed"><a href="#vue-computed" class="headerlink" title="vue computed"></a>vue computed</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=&quot;example&quot;&gt;</span><br><span class="line">  &lt;p&gt;Original message: &quot;&#123;&#123; message &#125;&#125;&quot;&lt;/p&gt;</span><br><span class="line">  &lt;p&gt;Computed reversed message: &quot;&#123;&#123; reversedMessage &#125;&#125;&quot;&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">----------------------------------</span><br><span class="line">var vm = new Vue(&#123;</span><br><span class="line">  el: &#x27;#example&#x27;,</span><br><span class="line">  data: &#123;</span><br><span class="line">    message: &#x27;Hello&#x27;</span><br><span class="line">  &#125;,</span><br><span class="line">  computed: &#123;</span><br><span class="line">    // 计算属性的 getter</span><br><span class="line">    reversedMessage: function () &#123;</span><br><span class="line">      // `this` 指向 vm 实例</span><br><span class="line">      return this.message.split(&#x27;&#x27;).reverse().join(&#x27;&#x27;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="装饰器模式"><a href="#装饰器模式" class="headerlink" title="装饰器模式"></a>装饰器模式</h2><h3 id="应用场景-1"><a href="#应用场景-1" class="headerlink" title="应用场景"></a>应用场景</h3><ul>
<li>为对象添加新功能</li>
<li>不改变其原有的结构和功能</li>
</ul>
<h3 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h3><h4 id="es7装饰器提案"><a href="#es7装饰器提案" class="headerlink" title="es7装饰器提案"></a>es7装饰器提案</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@testable</span><br><span class="line">class MyTestableClass &#123;</span><br><span class="line">  // ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function testable(target) &#123;</span><br><span class="line">  target.isTestable = true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">MyTestableClass.isTestable // true</span><br></pre></td></tr></table></figure>

<p>上面代码中，<code>@testable</code>就是一个装饰器。它修改了<code>MyTestableClass</code>这个类的行为，为它加上了静态属性<code>isTestable</code>。<code>testable</code>函数的参数<code>target</code>是<code>MyTestableClass</code>类本身。</p>
<p>基本上，装饰器的行为就是下面这样。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@decorator</span><br><span class="line">class A &#123;&#125;</span><br><span class="line"></span><br><span class="line">// 等同于</span><br><span class="line"></span><br><span class="line">class A &#123;&#125;</span><br><span class="line">A = decorator(A) || A;</span><br></pre></td></tr></table></figure>

<p>也就是说，装饰器是一个对类进行处理的函数。装饰器函数的第一个参数，就是所要装饰的目标类。</p>
<p>装饰器实现 <code>mixin</code> 功能演示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function mixins(...list) &#123;</span><br><span class="line">  return function (target) &#123;</span><br><span class="line">    Object.assign(target.prototype, ...list)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">const Foo = &#123;</span><br><span class="line">  foo() &#123;</span><br><span class="line">    console.log(&#x27;foo&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">@mixins(Foo)</span><br><span class="line">class MyClass &#123;&#125;</span><br><span class="line"></span><br><span class="line">const obj = new MyClass();</span><br><span class="line">obj.foo() // &#x27;foo&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="core-decorators"><a href="#core-decorators" class="headerlink" title="core-decorators"></a>core-decorators</h4><p>第三方类库，提供了一些常用装饰器<br><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/core-decorators">npm地址</a><br>只读</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import &#123; readonly &#125; from &#x27;core-decorators&#x27;;</span><br><span class="line"> </span><br><span class="line">class Meal &#123;</span><br><span class="line">  @readonly</span><br><span class="line">  entree = &#x27;steak&#x27;;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">var dinner = new Meal();</span><br><span class="line">dinner.entree = &#x27;salmon&#x27;;</span><br><span class="line">// Cannot assign to read only property &#x27;entree&#x27; of [object Object]</span><br></pre></td></tr></table></figure>

<p>即将废弃</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import &#123; deprecate &#125; from &#x27;core-decorators&#x27;;</span><br><span class="line"> </span><br><span class="line">class Person &#123;</span><br><span class="line">  @deprecate</span><br><span class="line">  facepalm() &#123;&#125;</span><br><span class="line"> </span><br><span class="line">  @deprecate(&#x27;We stopped facepalming&#x27;)</span><br><span class="line">  facepalmHard() &#123;&#125;</span><br><span class="line"> </span><br><span class="line">  @deprecate(&#x27;We stopped facepalming&#x27;, &#123; url: &#x27;http://knowyourmeme.com/memes/facepalm&#x27; &#125;)</span><br><span class="line">  facepalmHarder() &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">let person = new Person();</span><br><span class="line"> </span><br><span class="line">person.facepalm();</span><br><span class="line">// DEPRECATION Person#facepalm: This function will be removed in future versions.</span><br><span class="line"> </span><br><span class="line">person.facepalmHard();</span><br><span class="line">// DEPRECATION Person#facepalmHard: We stopped facepalming</span><br><span class="line"> </span><br><span class="line">person.facepalmHarder();</span><br><span class="line">// DEPRECATION Person#facepalmHarder: We stopped facepalming</span><br><span class="line">//</span><br><span class="line">//     See http://knowyourmeme.com/memes/facepalm for more details.</span><br><span class="line">//</span><br></pre></td></tr></table></figure>

<h3 id="常用使用场景"><a href="#常用使用场景" class="headerlink" title="常用使用场景"></a>常用使用场景</h3><h4 id="类的装饰"><a href="#类的装饰" class="headerlink" title="类的装饰"></a>类的装饰</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">class Circle&#123;</span><br><span class="line">  constructor()&#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  draw()&#123;</span><br><span class="line">    console.log(&#x27;画一个圆形&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 装饰器</span><br><span class="line">class Decorator() &#123;</span><br><span class="line">  constructor(circle) &#123;</span><br><span class="line">    this.circle = circle</span><br><span class="line">  &#125;</span><br><span class="line">  draw() &#123;</span><br><span class="line">    this.circle.draw()</span><br><span class="line">    this.setRedBorder(this.circle)</span><br><span class="line">  &#125;</span><br><span class="line">  setRedBorder(circle)&#123;</span><br><span class="line">    console.log(&#x27;设置红色边框&#x27;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="方法的装饰"><a href="#方法的装饰" class="headerlink" title="方法的装饰"></a>方法的装饰</h4><p>例子1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">function readonly(target, name, descriptor) &#123;</span><br><span class="line">  // 属性描述符</span><br><span class="line">  descriptor.writable = false;</span><br><span class="line">  return descriptor;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Person &#123;</span><br><span class="line">  constructor() &#123;</span><br><span class="line">    this.first = &#x27;A&#x27;</span><br><span class="line">    this.last = &#x27;B&#x27;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @readonly</span><br><span class="line">  name() &#123;</span><br><span class="line">    return `$&#123;this.first&#125; $&#123;this.last&#125;`</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">p.name = () =&gt; &#123; // 报错</span><br><span class="line">  console.log(1111)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>例子2 函数改造，重点在于 call 和 this 的用法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">function log(target, name, descriptor)&#123;</span><br><span class="line">  const oldFnc = descriptor.value;</span><br><span class="line">  descriptor.value = function()&#123;</span><br><span class="line">    console.log(target, name, descriptor);</span><br><span class="line">    // return 是为了确保不丢失函数返回值</span><br><span class="line">    return oldFnc.call(this, arguments);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Math &#123;</span><br><span class="line">  @log</span><br><span class="line">  add(a, b) &#123;</span><br><span class="line">    return a + b</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h2><p>代理类和目标类分离，隔离开目标类和使用者<br>常用场景</p>
<ul>
<li>网页事件代理</li>
<li>jQuery $.proxy</li>
<li>es6 proxy</li>
<li>set get<br>代码示意</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">// 本体</span><br><span class="line">class RealImg&#123;</span><br><span class="line">  constructor(fileName) &#123;</span><br><span class="line">    this.fileName = fileName;</span><br><span class="line">    this.loadFromDisk() // 初始化从硬盘加载文件</span><br><span class="line">  &#125;</span><br><span class="line">  diaplay() &#123;</span><br><span class="line">    console.log(&#x27;...diaplay&#x27; + this.fileName);</span><br><span class="line">  &#125;</span><br><span class="line">  loadFromDisk() &#123;</span><br><span class="line">    console.log(&#x27;...loading&#x27; + this.fileName);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 代理</span><br><span class="line">class ProxyImg&#123;</span><br><span class="line">  constructor(fileName) &#123;</span><br><span class="line">    this.realImg = new RealImg(fileName);</span><br><span class="line">  &#125;</span><br><span class="line">  display() &#123;</span><br><span class="line">    this.realImg.diaplay();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 演示</span><br><span class="line">const img1 = new ProxyImg(&#x27;1.png&#x27;);</span><br><span class="line">img1.display();</span><br></pre></td></tr></table></figure>

<h2 id="外观模式"><a href="#外观模式" class="headerlink" title="外观模式"></a>外观模式</h2><p>使用场景</p>
<ul>
<li>为子系统中的一组接口提供了一个高层接口</li>
<li>使用者使用这个高层接口</li>
</ul>
<p><img src="/assets/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F-7521436.png" alt="外观模式"></p>
<h2 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h2><p>前端最常用、最重要的模式<br>代码示意</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">class Subject &#123;</span><br><span class="line">  constructor() &#123;</span><br><span class="line">    this.state = 0;</span><br><span class="line">    this.observers = [];</span><br><span class="line">  &#125;</span><br><span class="line">  getState() &#123;</span><br><span class="line">    return this.state;</span><br><span class="line">  &#125;</span><br><span class="line">  setState(state) &#123;</span><br><span class="line">    this.state = state;</span><br><span class="line">    this.notifyAllObservers();</span><br><span class="line">  &#125;</span><br><span class="line">  notifyAllObservers() &#123;</span><br><span class="line">    this.observers.forEach(observer =&gt; &#123;</span><br><span class="line">      observer.update();</span><br><span class="line">      console.log(`$&#123;observer.name&#125; -- updata --- $&#123;this.getState()&#125;`);</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  attach(observer) &#123;</span><br><span class="line">    this.observers.push(observer);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// 观察者</span><br><span class="line">class Observer &#123;</span><br><span class="line">  constructor(name, subject) &#123;</span><br><span class="line">    this.name = name;</span><br><span class="line">    this.subject = subject;</span><br><span class="line">    this.subject.attach(this);</span><br><span class="line">  &#125;</span><br><span class="line">  update() &#123;</span><br><span class="line">    console.log(&#x27;更新&#x27;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">const subject = new Subject();</span><br><span class="line">const ob1 = new Observer(&#x27;ob1&#x27;, subject);</span><br><span class="line">const ob2 = new Observer(&#x27;ob2&#x27;, subject);</span><br><span class="line">const ob3 = new Observer(&#x27;ob3&#x27;, subject);</span><br><span class="line">subject.setState(1);</span><br><span class="line">subject.setState(2);</span><br><span class="line">subject.setState(3);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>应用场景</p>
<ul>
<li>网页事件绑定</li>
<li>promise</li>
<li>jQuery callback</li>
<li>nodejs 自定义事件</li>
</ul>
<h2 id="迭代器模式"><a href="#迭代器模式" class="headerlink" title="迭代器模式"></a>迭代器模式</h2><p>使用场景</p>
<ul>
<li>顺序访问一个集合</li>
<li>使用者无需知道集合的内部结构<br>代码演示</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">class Interator&#123;</span><br><span class="line">  index = 0</span><br><span class="line">  constructor(container) &#123;</span><br><span class="line">    this.list = container.list</span><br><span class="line">  &#125;</span><br><span class="line">  next() &#123;</span><br><span class="line">    if (this.hasNext()) &#123;</span><br><span class="line">      // 先返回，后加加</span><br><span class="line">      return this.list[this.index++]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  hasNext() &#123;</span><br><span class="line">    if (this.index &gt;= this.list.length) &#123;</span><br><span class="line">      return false</span><br><span class="line">    &#125;</span><br><span class="line">    return true</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Container&#123;</span><br><span class="line">  constructor(list) &#123;</span><br><span class="line">    this.list = list;</span><br><span class="line">  &#125;</span><br><span class="line">  getInterator() &#123;</span><br><span class="line">    return new Interator(this);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实例</p>
<ul>
<li>iterator &amp; for of</li>
</ul>
<h2 id="状态模式"><a href="#状态模式" class="headerlink" title="状态模式"></a>状态模式</h2><p>使用场景</p>
<ul>
<li>一个对象有状态变化</li>
<li>每个状态变化都会触发一个逻辑</li>
<li>不能中使用if-else来控制</li>
</ul>
<p>实际应用</p>
<ul>
<li>状态机 例如html标签解析</li>
<li>promise 状态</li>
</ul>
<h2 id="其他模式"><a href="#其他模式" class="headerlink" title="其他模式"></a>其他模式</h2><p>不常用，暂时略过</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://mst123.github.io/%E7%AE%97%E6%B3%95/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/luopo.gif">
      <meta itemprop="name" content="马农">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="博客">
      <meta itemprop="description" content="学习记录">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/%E7%AE%97%E6%B3%95/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/" class="post-title-link" itemprop="url">排序算法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-05-10 00:00:00" itemprop="dateCreated datePublished" datetime="2021-05-10T00:00:00+08:00">2021-05-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-07-13 13:13:43" itemprop="dateModified" datetime="2024-07-13T13:13:43+08:00">2024-07-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">算法</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>简单记录学习极客时间-数据与结构之美-排序相关的知识记录</p>
<h3 id="tips"><a href="#tips" class="headerlink" title="tips"></a>tips</h3><p>排序动画演示 可用手机app</p>
<h2 id="时间复杂度-On2"><a href="#时间复杂度-On2" class="headerlink" title="时间复杂度 On2"></a>时间复杂度 On2</h2><h3 id="冒泡排序"><a href="#冒泡排序" class="headerlink" title="冒泡排序"></a>冒泡排序</h3><p>冒泡排序只会操作相邻的两个数据。每次冒泡操作都会对相邻的两个元素进行比较，看是否 满足大小关系要求。如果不满足就让它俩互换。一次冒泡会让至少一个元素移动到它应该在 的位置，重复 n 次，就完成了 n 个数据的排序工作。</p>
<p>冒泡排序最不容易出错。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">const arr = [4,5,2,3,8,7,6,1,10]</span><br><span class="line">function bubble(arr) &#123;</span><br><span class="line">  const l = arr.length</span><br><span class="line">  for (let i = 0; i &lt; l - 1; i++) &#123;</span><br><span class="line">    // 没有交换发生 其实代表数组已经是有序的了</span><br><span class="line">    let flag = true;</span><br><span class="line">    for (let j = i + 1; j &lt; arr.length; j++) &#123;</span><br><span class="line">      if (arr[i] &gt; arr[j]) &#123;</span><br><span class="line">        const temp = arr[i]</span><br><span class="line">        arr[i] = arr[j]</span><br><span class="line">        arr[j] = temp</span><br><span class="line">        // 有交换发生</span><br><span class="line">        flag = false;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    if (flag) &#123;</span><br><span class="line">      break;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">bubble(arr)</span><br><span class="line">console.log(arr);</span><br></pre></td></tr></table></figure>

<h3 id="插入排序"><a href="#插入排序" class="headerlink" title="插入排序"></a>插入排序</h3><p>首先，我们将数组中的数据分为两个区间，已排序区间和未排序区间。初始已排序区间只有 一个元素，就是数组的第一个元素。插入算法的核心思想是取未排序区间中的元素，在已排 序区间中找到合适的插入位置将其插入，并保证已排序区间数据一直有序。重复这个过程， 直到未排序区间中元素为空，算法结束。</p>
<p><strong>插入排序写起来比较费劲，要注意的地方比较多</strong></p>
<p>我自己的写的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">function insert(arr) &#123;</span><br><span class="line">  const l = arr.length</span><br><span class="line">  for (let i = 0; i &lt; l - 1; i++) &#123;</span><br><span class="line">    let j = i + 1</span><br><span class="line">    while (arr[j-1] &gt; arr[j] &amp;&amp; j&gt;=0) &#123;</span><br><span class="line">      const temp = arr[j]</span><br><span class="line">      arr[j] = arr[j-1]</span><br><span class="line">      arr[j-1] = temp</span><br><span class="line">      j--</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">insert(arr)</span><br></pre></td></tr></table></figure>

<p>教程写的，已经换成JavaScript，并加了注释</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">function insert2(arr) &#123;</span><br><span class="line">  const l = arr.length;</span><br><span class="line">  for (let i = 1; i &lt; l; ++i) &#123;</span><br><span class="line">    // 缓存当前处理的元素，减少交换次数 </span><br><span class="line">    let value = arr[i];</span><br><span class="line">    // 对比前方排序区，查找插入的位置</span><br><span class="line">    let j = i - 1;</span><br><span class="line">    for ( ; j &gt;= 0; --j) &#123;</span><br><span class="line">      if (arr[j] &gt; value) &#123;</span><br><span class="line">        // 相当于把arr[j]向右移一位</span><br><span class="line">        // 第一次被覆盖掉的元素是当前处理元素，已在顶部缓存</span><br><span class="line">        // 第一次以后被覆盖的元素，实际上已经保存在右侧了</span><br><span class="line">        arr[j + 1] = arr[j]; // 数据移动</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">        // 当前元素已经满足条件，不需要交换</span><br><span class="line">        break;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    // 只在最后交换 j+1 </span><br><span class="line">    arr[j + 1] = value; // 插入数据</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="选择排序"><a href="#选择排序" class="headerlink" title="选择排序"></a>选择排序</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">function select(arr) &#123;</span><br><span class="line">  const l = arr.length</span><br><span class="line">  let min, minIndex</span><br><span class="line">  for (let i = 0; i &lt; l - 1; i++) &#123;</span><br><span class="line">   // 起始位置</span><br><span class="line">    min = arr[i]</span><br><span class="line">    minIndex = i</span><br><span class="line">    for (let j = i+1; j &lt; l; j++) &#123;</span><br><span class="line">      if (arr[j] &lt; min) &#123;</span><br><span class="line">        min = arr[j]</span><br><span class="line">        minIndex = j</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    const temp = arr[i]</span><br><span class="line">    arr[i] = min</span><br><span class="line">    arr[minIndex] = temp</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">// select(arr)</span><br><span class="line">console.log(arr);</span><br></pre></td></tr></table></figure>

<h2 id="时间复杂度-O-nlogn"><a href="#时间复杂度-O-nlogn" class="headerlink" title="时间复杂度 O nlogn"></a>时间复杂度 O nlogn</h2><h3 id="归并排序-稳定"><a href="#归并排序-稳定" class="headerlink" title="归并排序(稳定)"></a>归并排序(稳定)</h3><p>自己的代码，未优化的版本，找了好久的错误</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">// 归并排序</span><br><span class="line">function merginInto(arr, l, r) &#123;</span><br><span class="line">  if (l === r) &#123;</span><br><span class="line">    return arr</span><br><span class="line">  &#125;</span><br><span class="line">  const m = (l + r) &gt;&gt; 1 // 相当于除以2 取整</span><br><span class="line">  const left = arr.slice(l, m + 1)</span><br><span class="line">  const right = arr.slice(m + 1, r + 1)</span><br><span class="line">  return sortOrderArr(</span><br><span class="line">    left.length &lt;= 1 ? left: merginInto(</span><br><span class="line">     // 忘了把边界改成新数组的了</span><br><span class="line">      left, 0, m</span><br><span class="line">    ),</span><br><span class="line">    right.length &lt;= 1 ? right : merginInto(</span><br><span class="line">      // 忘了把边界改成新数组的了</span><br><span class="line">      right, 0, r - (m + 1)</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br><span class="line">// 将两个有序数组合并</span><br><span class="line">function sortOrderArr(arr1, arr2) &#123;</span><br><span class="line">  const res = []</span><br><span class="line">  let i1 = i2 = 0, l1 = arr1.length, l2 = arr2.length</span><br><span class="line">  while (i1&lt;l1 || i2&lt;l2) &#123;</span><br><span class="line">    if (i1 === l1) &#123;</span><br><span class="line">      res.push(arr2[i2++])</span><br><span class="line">    &#125; else if(i2===l2) &#123;</span><br><span class="line">      res.push(arr1[i1++])</span><br><span class="line">    &#125;else if (arr1[i1] &lt;= arr2[i2]) &#123;</span><br><span class="line">      res.push(arr1[i1++])</span><br><span class="line">    &#125;else(</span><br><span class="line">      res.push(arr2[i2++])</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">  return res</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>比较大众的写法，<strong>这个类似于二叉树的后续遍历</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">function mergeInto(arr, l, r) &#123;</span><br><span class="line">  if (l &gt;= r) &#123;</span><br><span class="line">    return arr</span><br><span class="line">  &#125;</span><br><span class="line">  const m = (l + r) &gt;&gt; 1;</span><br><span class="line">  // 原地排序 不需要返回</span><br><span class="line">  mergeInto(arr, l, m)</span><br><span class="line">  mergeInto(arr, m + 1, r)</span><br><span class="line">  // 两个已经拍好序的数组</span><br><span class="line">  mergeArr(arr, l, m, r)</span><br><span class="line">  return arr</span><br><span class="line">&#125;</span><br><span class="line">function mergeArr(arr, l, m, r) &#123;</span><br><span class="line">  const res = []</span><br><span class="line">  let i1 = l, i2 = m + 1, l1 = m+1, l2 = r+1</span><br><span class="line">  while (i1&lt;l1 || i2&lt;l2) &#123;</span><br><span class="line">    if (i1 === l1) &#123;</span><br><span class="line">      res.push(arr[i2++])</span><br><span class="line">    &#125; else if(i2===l2) &#123;</span><br><span class="line">      res.push(arr[i1++])</span><br><span class="line">    &#125;else if (arr[i1] &lt;= arr[i2]) &#123;</span><br><span class="line">      res.push(arr[i1++])</span><br><span class="line">    &#125;else(</span><br><span class="line">      res.push(arr[i2++])</span><br><span class="line">    )</span><br><span class="line">  &#125;</span><br><span class="line">  for (let i = l,j=0; i &lt; r+1; i++,j++) &#123;</span><br><span class="line">    arr[i] = res[j]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="快速排序-不稳定"><a href="#快速排序-不稳定" class="headerlink" title="快速排序(不稳定)"></a>快速排序(不稳定)</h3><p><strong>把比参考位置小的数移到左侧，大的移到右侧，如果不额外占用空间的话，比较难写</strong></p>
<p>空间复杂度 O n 比较容易写出来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">function fastSort(arr, l, r) &#123;</span><br><span class="line">  if (l &gt;= r) &#123;</span><br><span class="line">    return arr</span><br><span class="line">  &#125;</span><br><span class="line">  const p = fastSortHandle(arr, l, r)</span><br><span class="line">  fastSort(arr, l, p - 1)</span><br><span class="line">  fastSort(arr, p + 1, r)</span><br><span class="line">  return arr</span><br><span class="line">&#125;</span><br><span class="line">// 快排辅助函数 分区 排序</span><br><span class="line">function fastSortHandle(arr, l, r) &#123;</span><br><span class="line"> // 占用了 On的空间</span><br><span class="line">  const res = []</span><br><span class="line">  //随机会好一点</span><br><span class="line">  const rdm = Math.floor(Math.random()*(r-l+1)+l)</span><br><span class="line">  const ref = arr[rdm]</span><br><span class="line">  let li = l, ri = r</span><br><span class="line">  for (let i = l; i &lt; r + 1; i++) &#123;</span><br><span class="line">    if (i === rdm) &#123;</span><br><span class="line">      continue</span><br><span class="line">    &#125;</span><br><span class="line">    if (arr[i] &lt;= ref) &#123;</span><br><span class="line">      res[li] = arr[i]</span><br><span class="line">      li++</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">      res[ri] = arr[i]</span><br><span class="line">      ri--</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  res[ri] = ref</span><br><span class="line">  for (let i = l; i &lt; r+1; i++) &#123;</span><br><span class="line">    arr[i] = res[i]</span><br><span class="line">  &#125;</span><br><span class="line">  return ri</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="O1空间复杂度左右归类的算法解释"><a href="#O1空间复杂度左右归类的算法解释" class="headerlink" title="O1空间复杂度左右归类的算法解释"></a>O1空间复杂度左右归类的算法解释</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">function fastSortHandle(arr, l, r) &#123;</span><br><span class="line">  // const rdm = Math.floor(Math.random()*(r-l+1)+l)</span><br><span class="line">  const rdm = 1</span><br><span class="line">  const ref = arr[rdm]</span><br><span class="line">  let j = l</span><br><span class="line">  for (let i = l; i &lt; r + 1; i++) &#123;</span><br><span class="line">    // 跳过</span><br><span class="line">    if (i === rdm) &#123;</span><br><span class="line">      continue;</span><br><span class="line">    &#125;</span><br><span class="line">    // 跳过</span><br><span class="line">    if (j === rdm) &#123;</span><br><span class="line">      j++</span><br><span class="line">    &#125;</span><br><span class="line">    if (arr[i] &lt;= ref) &#123;</span><br><span class="line">      [arr[i], arr[j]] = [arr[j], arr[i]]</span><br><span class="line">      j++</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  if (rdm &lt; j) &#123;</span><br><span class="line">    j--</span><br><span class="line">  &#125;</span><br><span class="line">  [arr[rdm], arr[j]] = [arr[j], arr[rdm]]</span><br><span class="line">  return j</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当选择一个随机数N，下标INDEX作为参照点的话，程序运行到关键点的情况应该如下图所示</p>
<p>左侧是小于等于N的数，右侧是大于N的数，但是N可能在左侧或者右侧</p>
<p><img src="/assets/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/image-20211112105742642.png" alt="image-20211112105742642"></p>
<p>最好的情况就是 把N的位置放进 j-1 和 j之间，但是这样<strong>时间复杂度较高，采取交换替代</strong></p>
<p>如果N在左侧就和<code>J-1</code>交换，N在右侧就和<code>J</code>置换，如果不需要随机选择位置的话，N取最右侧元素，就不需要判断了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if (rdm &lt; j) &#123;</span><br><span class="line">    j--</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  [arr[rdm], arr[j]] = [arr[j], arr[rdm]]</span><br><span class="line">  return j</span><br></pre></td></tr></table></figure>

<h4 id="更好的随机数左右归类"><a href="#更好的随机数左右归类" class="headerlink" title="更好的随机数左右归类"></a>更好的随机数左右归类</h4><p><a target="_blank" rel="noopener" href="https://leetcode-cn.com/problems/sort-an-array/solution/pai-xu-shu-zu-by-leetcode-solution/">力扣官方</a>采取先用随机数与最后一位交换位置在进行常规方法，方法容易理解，也不容易出错</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">int partition(vector&lt;int&gt;&amp; nums, int l, int r) &#123;</span><br><span class="line">      int pivot = nums[r];</span><br><span class="line">      int i = l - 1;</span><br><span class="line">      for (int j = l; j &lt;= r - 1; ++j) &#123;</span><br><span class="line">          if (nums[j] &lt;= pivot) &#123;</span><br><span class="line">              i = i + 1;</span><br><span class="line">              swap(nums[i], nums[j]);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      swap(nums[i + 1], nums[r]);</span><br><span class="line">      return i + 1;</span><br><span class="line">  &#125;</span><br><span class="line">  int randomized_partition(vector&lt;int&gt;&amp; nums, int l, int r) &#123;</span><br><span class="line">      int i = rand() % (r - l + 1) + l; // 随机选一个作为我们的主元</span><br><span class="line">      swap(nums[r], nums[i]);</span><br><span class="line">      return partition(nums, l, r);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>最后总结出JavaScript版本的快速排序</p>
<p><img src="/assets/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/image-20211112112025117.png" alt="image-20211112112025117"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">function fastSort(arr, l, r) &#123;</span><br><span class="line">  if (l &gt;= r) &#123;</span><br><span class="line">    return arr</span><br><span class="line">  &#125;</span><br><span class="line">  const p = fastSortHandle(arr, l, r)</span><br><span class="line">  // -1 +1 可别忘 会死循环的</span><br><span class="line">  fastSort(arr, l, p - 1)</span><br><span class="line">  fastSort(arr, p + 1, r)</span><br><span class="line">  return arr</span><br><span class="line">&#125;</span><br><span class="line">function fastSortHandle(arr, l, r) &#123;</span><br><span class="line">  const rdm = Math.floor(Math.random() * (r - l + 1) + l)</span><br><span class="line">  // 与最后元素交换</span><br><span class="line">  swap(arr, rdm, r)</span><br><span class="line"></span><br><span class="line">  const ref = arr[r]</span><br><span class="line">  let j = l</span><br><span class="line">  for (let i = l; i &lt; r; i++) &#123;</span><br><span class="line">    if (arr[i] &lt;= ref) &#123;</span><br><span class="line">      swap(arr, i, j)</span><br><span class="line">      j++</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  swap(arr, r, j)</span><br><span class="line">  return j</span><br><span class="line">&#125;</span><br><span class="line">function swap(arr, p, q) &#123;</span><br><span class="line">  const temp = arr[p]</span><br><span class="line">  arr[p] = arr[q]</span><br><span class="line">  arr[q] = temp</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="归并排序和快速排序的区别与联系"><a href="#归并排序和快速排序的区别与联系" class="headerlink" title="归并排序和快速排序的区别与联系"></a>归并排序和快速排序的区别与联系</h3><p><img src="/assets/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/image-20211112112920927.png" alt="image-20211112112920927"></p>
<p>快排和归并用的都是分治思想，递推公式和递归代码也非常相似，那它们的区别在哪里呢?</p>
<p><img src="/assets/%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95/image-20211112113107064.png" alt="image-20211112113107064">可以发现，归并排序的处理过程是由下到上的，先处理子问题，然后再合并。</p>
<p>而快排正好相反，它的处理过程是由上到下的，先分区，然后再处理子问题。</p>
<p>归并排序虽然是稳定的、时 间复杂度为 O(nlogn) 的排序算法，但是它是非原地排序算法。我们前面讲过，归并之所以 是非原地排序算法，主要原因是合并函数无法在原地执行。快速排序通过设计巧妙的原地分区函数，可以实现原地排序，解决了归并排序占用太多内存的问题。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/5/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/7/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">马农</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  





</body>
</html>
